import{_ as n}from"./_plugin-vue_export-helper.cdc0426e.js";import{o as s,c as a,f as t}from"./app.6c577caf.js";const e={},p=t(`<blockquote><p>\u6D45\u8C08hyperledger fabric\u6E90\u7801|Peer\u8282\u70B9\u542F\u52A8</p><p>\u6587\u7AE0\u53CA\u4EE3\u7801\uFF1A /</p><p>\u5206\u652F\uFF1Av1.1.0</p></blockquote><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gn1cycj35uj31c00u0gww.jpg" alt="b43356d6533644cca27da75d63f275fa"></p><h2 id="\u542F\u52A8\u6D41\u7A0B\u6982\u8FF0" tabindex="-1"><a class="header-anchor" href="#\u542F\u52A8\u6D41\u7A0B\u6982\u8FF0" aria-hidden="true">#</a> \u542F\u52A8\u6D41\u7A0B\u6982\u8FF0</h2><p>\u5165\u53E3\uFF1Apeer/main.go:</p><p><code>main</code>()\u51FD\u6570\u8D1F\u8D23\u521D\u59CB\u5316<code>peer</code>\u4E3B\u547D\u4EE4\u5BF9\u8C61\uFF0C\u6CE8\u518C\u5B50\u547D\u4EE4\u4E0E\u521D\u59CB\u5316\u73AF\u5883\u914D\u7F6E\uFF0C\u89E3\u6790\u7528\u6237\u8F93\u5165\u5B50\u547D\u4EE4<code>start</code>\u5E76\u542F\u52A8Peer\u8282\u70B9\uFF0C\u5305\u62EC\u5982\u4E0B\u6D41\u7A0B\u6B65\u9AA4\uFF1A</p><ul><li>\u5B9A\u4E49\u3001\u6CE8\u518C\u547D\u4EE4\u4E0E\u521D\u59CB\u5316\u57FA\u672C\u914D\u7F6E\u3002\u57FA\u4E8E<code>Cobra</code>\u7EC4\u4EF6\u5B9A\u4E49peer\u4E3B\u547D\u4EE4\u5BF9\u8C61<code>mainCmd</code>\uFF0C\u5E76\u901A\u8FC7<code>Viper</code>\u7EC4\u4EF6\u8C03\u7528<code>InitConfig</code>()\u51FD\u6570\uFF0C\u4ECE\u672C\u5730<code>core.yaml</code>\u914D\u7F6E\u6587\u4EF6\u3001\u73AF\u5883\u53D8\u91CF\u3001\u547D\u4EE4\u884C\u9009\u9879\u7B49\u8BFB\u53D6\u4E0E\u89E3\u6790<code>peer</code>\u547D\u4EE4\u7684\u76F8\u5173\u914D\u7F6E\u3002\u540C\u65F6\uFF0C\u521D\u59CB\u5316\u4E3B\u547D\u4EE4<code>mainCmd</code>\u7684\u6807\u5FD7\u4F4D\u9009\u9879 <code>version</code>\u3001<code>logging-level</code>\u7B49\uFF0C\u7136\u540E\u5728\u4E3B\u547D\u4EE4<code>mainCmd</code>\u4E0A\u6CE8\u518C<code>version\u3001node\u3001chaincode\u3001channel</code>\u7B49\u5B50\u547D\u4EE4\uFF0C\u8BBE\u7F6E\u6700\u5927\u53EF\u7528<code>CPU</code>\u6838\u6570\u4E0E\u65E5\u5FD7\u540E\u7AEF\uFF1B</li><li>\u521D\u59CB\u5316\u672C\u5730<code>MSP</code>\u7EC4\u4EF6\u3002\u901A\u8FC7<code>Viper</code>\u7EC4\u4EF6\u83B7\u53D6<code>MSP</code>\u7EC4\u4EF6\u7684\u914D\u7F6E\u6587\u4EF6\u8DEF\u5F84<code>mspMgrConfigDir</code>\u3001<code>BCCSP</code>\u914D\u7F6E\u9879<code>bccspConfig</code>\u3001MSP\u540D\u79F0ID\u5373localMSPID\u3001<code>MSP</code>\u7EC4\u4EF6\u7C7B\u578B<code>localMSPType</code>\u7B49\uFF0C\u57FA\u4E8E\u8FD94\u4E2A\u53C2\u6570\u6784\u9020\u672C\u5730<code>MSP</code>\u914D\u7F6E\u5BF9\u8C61\uFF0C\u63A5\u7740\u521B\u5EFA\u9ED8\u8BA4\u7684<code>bccspmsp</code>\u7ED3\u6784\u5BF9\u8C61\u4F5C\u4E3A\u672C\u5730<code>MSP</code>\u7EC4\u4EF6\uFF0C\u5E76\u89E3\u6790<code>MSP</code>\u914D\u7F6E\u5BF9\u8C61\u4E0E\u521D\u59CB\u5316\u672C\u5730<code>MSP</code>\u7EC4\u4EF6\uFF1B</li><li>\u6267\u884CmainCmd.Execute()\u65B9\u6CD5\u542F\u52A8<code>Peer</code>\u8282\u70B9</li></ul><p>\u63A5\u4E0B\u6765\u5C06\u4F1A\u5206\u522B\u5BF9\u8FD9\u51E0\u4E2A\u5173\u952E\u90E8\u5206\u8FDB\u884C\u7EC6\u8BF4\u3002</p><h2 id="\u5B9A\u4E49\u3001\u6CE8\u518C\u547D\u4EE4\u4E0E\u521D\u59CB\u5316\u57FA\u672C\u914D\u7F6E" tabindex="-1"><a class="header-anchor" href="#\u5B9A\u4E49\u3001\u6CE8\u518C\u547D\u4EE4\u4E0E\u521D\u59CB\u5316\u57FA\u672C\u914D\u7F6E" aria-hidden="true">#</a> \u5B9A\u4E49\u3001\u6CE8\u518C\u547D\u4EE4\u4E0E\u521D\u59CB\u5316\u57FA\u672C\u914D\u7F6E</h2><h3 id="\u5B9A\u4E49\u4E3B\u547D\u4EE4" tabindex="-1"><a class="header-anchor" href="#\u5B9A\u4E49\u4E3B\u547D\u4EE4" aria-hidden="true">#</a> \u5B9A\u4E49\u4E3B\u547D\u4EE4</h3><p>\u4EE3\u7801\u5206\u6790 \u5982\u4E0B\uFF1A</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">var</span> mainCmd <span class="token operator">=</span> <span class="token operator">&amp;</span>cobra<span class="token punctuation">.</span>Command<span class="token punctuation">{</span> <span class="token comment">// \u57FA\u4E8ECobra\u7EC4\u4EF6\u6784\u9020\u4E3B\u547D\u4EE4</span>
	Use<span class="token punctuation">:</span> <span class="token string">&quot;peer&quot;</span><span class="token punctuation">,</span> <span class="token comment">// \u5B9A\u4E49\u547D\u4EE4\u4F7F\u7528\u65B9\u6CD5</span>
	<span class="token comment">//// \u5B9A\u4E49\u6267\u884C\u51FD\u6570</span>
	PersistentPreRunE<span class="token punctuation">:</span> <span class="token keyword">func</span><span class="token punctuation">(</span>cmd <span class="token operator">*</span>cobra<span class="token punctuation">.</span>Command<span class="token punctuation">,</span> args <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
		<span class="token comment">//\u68C0\u67E5CORE_LOGGING_LEVEL\u73AF\u5883\u53D8\u91CF\uFF0C\u8986\u76D6\u6240\u6709\u5176\u4ED6\u65E5\u5FD7\u8BBE\u7F6E\u503C\u3002\u5426\u5219\uFF0C\u4F7F\u7528core.yaml\u6587\u4EF6\u4E2D\u7684\u914D\u7F6E\u503C</span>
		<span class="token keyword">var</span> loggingSpec <span class="token builtin">string</span>
		<span class="token keyword">if</span> viper<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span><span class="token string">&quot;logging_level&quot;</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token string">&quot;&quot;</span> <span class="token punctuation">{</span>
			loggingSpec <span class="token operator">=</span> viper<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span><span class="token string">&quot;logging_level&quot;</span><span class="token punctuation">)</span> <span class="token comment">// \u83B7\u53D6\u914D\u7F6E\u6587\u4EF6\u4E2D\u7684\u65E5\u5FD7\u7EA7\u522B</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			loggingSpec <span class="token operator">=</span> viper<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span><span class="token string">&quot;logging.level&quot;</span><span class="token punctuation">)</span> <span class="token comment">// \u83B7\u53D6\u914D\u7F6E\u6587\u4EF6\u4E2D\u7684\u65E5\u5FD7\u7EA7\u522B</span>
		<span class="token punctuation">}</span>
		flogging<span class="token punctuation">.</span><span class="token function">InitFromSpec</span><span class="token punctuation">(</span>loggingSpec<span class="token punctuation">)</span> <span class="token comment">// \u6839\u636E\u914D\u7F6E\u7684\u65E5\u5FD7\u7EA7\u522B\u521D\u59CB\u5316\u65E5\u5FD7\u8BB0\u5F55\u5668</span>
		<span class="token keyword">return</span> <span class="token boolean">nil</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	Run<span class="token punctuation">:</span> <span class="token keyword">func</span><span class="token punctuation">(</span>cmd <span class="token operator">*</span>cobra<span class="token punctuation">.</span>Command<span class="token punctuation">,</span> args <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// \u5B9A\u4E49\u6267\u884C\u51FD\u6570</span>
		<span class="token keyword">if</span> versionFlag <span class="token punctuation">{</span>
			fmt<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span>version<span class="token punctuation">.</span><span class="token function">GetInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// \u6253\u5370peer\u7A0B\u5E8F\u7248\u672C\u4FE1\u606F</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			cmd<span class="token punctuation">.</span><span class="token function">HelpFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>cmd<span class="token punctuation">,</span> args<span class="token punctuation">)</span> <span class="token comment">// \u76F4\u63A5\u6253\u5370\u547D\u4EE4\u5E2E\u52A9\u4FE1\u606F</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u6CE8\u518C\u5B50\u547D\u4EE4" tabindex="-1"><a class="header-anchor" href="#\u6CE8\u518C\u5B50\u547D\u4EE4" aria-hidden="true">#</a> \u6CE8\u518C\u5B50\u547D\u4EE4</h3><p>\u5C06\u51E0\u7C7B\u5B50\u547D\u4EE4\u6CE8\u518C\u5230\u4E3B\u547D\u4EE4\u4E0A\uFF0C\u79CD\u7C7B\u5982\u4E0B\uFF1A</p><ul><li>channel\u901A\u9053\u5B50\u547D\u4EE4\uFF1A\u7528\u4E8E\u521B\u5EFA\u5E94\u7528\u901A\u9053\u3001\u83B7\u53D6\u533A\u5757\u3001Peer\u8282\u70B9\u52A0\u5165\u5E94\u7528\u901A\u9053\u3001\u83B7\u53D6\u8282\u70B9\u6240\u52A0\u5165\u7684\u5E94\u7528\u901A\u9053\u5217\u8868\u3001\u66F4\u65B0\u5E94\u7528\u901A\u9053\u914D\u7F6E\u3001\u7B7E\u540D\u914D\u7F6E\u4EA4\u6613\u6587\u4EF6\u3001\u83B7\u53D6\u6307\u5B9A\u7684\u5E94\u7528\u901A\u9053\u4FE1\u606F\u7B49\uFF0C\u5305\u62EC<code>create\u3001fetch\u3001join\u3001list\u3001update\u3001signconfigtx\u3001getinfo</code>\u7B49\u5B50\u547D\u4EE4\uFF1B</li><li>chaincode\u94FE\u7801\u5B50\u547D\u4EE4\uFF1A\u7528\u4E8E\u5B89\u88C5\u94FE\u7801\u3001\u5B9E\u4F8B\u5316\uFF08\u90E8\u7F72\uFF09\u94FE\u7801\u3001\u8C03\u7528\u94FE\u7801\u3001\u6253\u5305\u94FE\u7801\u3001\u67E5\u8BE2\u94FE\u7801\u3001\u7B7E\u540D\u94FE\u7801\u5305\u3001\u5347\u7EA7\u94FE\u7801\u3001\u83B7\u53D6\u901A\u9053\u94FE\u7801\u5217\u8868\u7B49\uFF0C\u5305\u62EC<code>install\u3001instantiate\u3001invoke\u3001package\u3001query\u3001signpackage\u3001upgrade\u3001list</code>\u7B49\u5B50\u547D\u4EE4\uFF1B</li><li>node\u8282\u70B9\u5B50\u547D\u4EE4\uFF1A\u7528\u4E8E\u7BA1\u7406\u8282\u70B9\u670D\u52A1\u8FDB\u7A0B\u4E0E\u67E5\u8BE2\u670D\u52A1\u72B6\u6001\uFF0C\u5305\u62EC<code>start\u3001status</code>\u7B49\u5B50\u547D\u4EE4\uFF1B</li><li>logging\u65E5\u5FD7\u5B50\u547D\u4EE4\uFF1A\u7528\u4E8E\u83B7\u53D6\u3001\u8BBE\u7F6E\u4E0E\u6062\u590D\u65E5\u5FD7\u7EA7\u522B\u529F\u80FD\uFF0C\u5305\u62EC<code>getlevel\u3001setlevel\u3001 revertlevels</code>\u7B49\u5B50\u547D\u4EE4\uFF1B</li><li>version\u7248\u672C\u5B50\u547D\u4EE4\uFF1A\u7528\u4E8E\u6253\u5370<code>Fabric</code>\u4E2D\u7684<code>Peer</code>\u8282\u70B9\u670D\u52A1\u5668\u7248\u672C\u4FE1\u606F\u3002</li></ul><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>viper<span class="token punctuation">.</span><span class="token function">SetEnvPrefix</span><span class="token punctuation">(</span>cmdRoot<span class="token punctuation">)</span>               <span class="token comment">// \u8BBE\u7F6E\u73AF\u5883\u53D8\u91CF\u524D\u7F00core</span>
	viper<span class="token punctuation">.</span><span class="token function">AutomaticEnv</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                      <span class="token comment">// \u67E5\u627E\u5339\u914D\u73AF\u5883\u53D8\u91CF</span>
	replacer <span class="token operator">:=</span> strings<span class="token punctuation">.</span><span class="token function">NewReplacer</span><span class="token punctuation">(</span><span class="token string">&quot;.&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;_&quot;</span><span class="token punctuation">)</span> <span class="token comment">// \u521B\u5EFA\u66FF\u6362\u7B26</span>
	viper<span class="token punctuation">.</span><span class="token function">SetEnvKeyReplacer</span><span class="token punctuation">(</span>replacer<span class="token punctuation">)</span>         <span class="token comment">// \u8BBE\u7F6E\u73AF\u5883\u53D8\u91CF\u66FF\u6362\u7B26</span>
	<span class="token comment">// \u5B9A\u4E49\u547D\u4EE4\u884C\u9009\u9879\u96C6\u5408\uFF0C\u5BF9\u6240\u6709peer\u53CA\u5176\u5B50\u547D\u4EE4\u90FD\u6709\u6548</span>
	mainFlags <span class="token operator">:=</span> mainCmd<span class="token punctuation">.</span><span class="token function">PersistentFlags</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">// \u8BBE\u7F6E\u7ED1\u5B9Aversion\u4E0Elogging-level\u9009\u9879</span>
	mainFlags<span class="token punctuation">.</span><span class="token function">BoolVarP</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>versionFlag<span class="token punctuation">,</span> <span class="token string">&quot;version&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;v&quot;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token string">&quot;Display current version of fabric peer server&quot;</span><span class="token punctuation">)</span>
	mainFlags<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token string">&quot;logging-level&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Default logging level and overrides, see core.yaml for full syntax&quot;</span><span class="token punctuation">)</span>
	<span class="token comment">// Viper\u914D\u7F6E\u7ED1\u5B9A\u547D\u4EE4\u884C\u9009\u9879</span>
	viper<span class="token punctuation">.</span><span class="token function">BindPFlag</span><span class="token punctuation">(</span><span class="token string">&quot;logging_level&quot;</span><span class="token punctuation">,</span> mainFlags<span class="token punctuation">.</span><span class="token function">Lookup</span><span class="token punctuation">(</span><span class="token string">&quot;logging-level&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token comment">// \u6CE8\u518C\u5B50\u547D\u4EE4</span>
	mainCmd<span class="token punctuation">.</span><span class="token function">AddCommand</span><span class="token punctuation">(</span>version<span class="token punctuation">.</span><span class="token function">Cmd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>       <span class="token comment">// version\u5B50\u547D\u4EE4</span>
	mainCmd<span class="token punctuation">.</span><span class="token function">AddCommand</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span><span class="token function">Cmd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>          <span class="token comment">// node\u5B50\u547D\u4EE4start\u3001status</span>
	mainCmd<span class="token punctuation">.</span><span class="token function">AddCommand</span><span class="token punctuation">(</span>chaincode<span class="token punctuation">.</span><span class="token function">Cmd</span><span class="token punctuation">(</span><span class="token boolean">nil</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// chaincode\u5B50\u547D\u4EE4install\u7B49</span>
	mainCmd<span class="token punctuation">.</span><span class="token function">AddCommand</span><span class="token punctuation">(</span>clilogging<span class="token punctuation">.</span><span class="token function">Cmd</span><span class="token punctuation">(</span><span class="token boolean">nil</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// cli\u65E5\u5FD7\u5B50\u547D\u4EE4 getlevel</span>
	mainCmd<span class="token punctuation">.</span><span class="token function">AddCommand</span><span class="token punctuation">(</span>channel<span class="token punctuation">.</span><span class="token function">Cmd</span><span class="token punctuation">(</span><span class="token boolean">nil</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment">// channel\u5B50\u547D\u4EE4 create\u7B49</span>
	<span class="token comment">// \u52A0\u8F7D\u914D\u7F6E\u6587\u4EF6core.yaml</span>
	err <span class="token operator">:=</span> common<span class="token punctuation">.</span><span class="token function">InitConfig</span><span class="token punctuation">(</span>cmdRoot<span class="token punctuation">)</span>
	<span class="token operator">...</span>
	runtime<span class="token punctuation">.</span><span class="token function">GOMAXPROCS</span><span class="token punctuation">(</span>viper<span class="token punctuation">.</span><span class="token function">GetInt</span><span class="token punctuation">(</span><span class="token string">&quot;peer.gomaxprocs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// \u8BBE\u7F6E\u6700\u5927\u53EF\u7528\u7684CPU\u6838\u6570</span>
	<span class="token comment">// setup system-wide logging backend based on settings from core.yaml</span>
	<span class="token comment">// \u521D\u59CB\u5316\u7CFB\u7EDF\u65E5\u5FD7\u540E\u7AEF</span>
	flogging<span class="token punctuation">.</span><span class="token function">InitBackend</span><span class="token punctuation">(</span>flogging<span class="token punctuation">.</span><span class="token function">SetFormat</span><span class="token punctuation">(</span>viper<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span><span class="token string">&quot;logging.format&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> logOutput<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u521D\u59CB\u5316\u672C\u5730msp\u7EC4\u4EF6" tabindex="-1"><a class="header-anchor" href="#\u521D\u59CB\u5316\u672C\u5730msp\u7EC4\u4EF6" aria-hidden="true">#</a> \u521D\u59CB\u5316\u672C\u5730MSP\u7EC4\u4EF6</h2><p><code>MSP</code>\u7EC4\u4EF6\u662F\u7BA1\u7406\u672C\u5730\u6210\u5458\u8EAB\u4EFD\u7684\u91CD\u8981\u5B89\u5168\u6A21\u5757\uFF0C\u5C01\u88C5\u4E86\u6839<code>CA</code>\u8BC1\u4E66\u3001\u672C\u5730\u7B7E\u540D\u8005\u5B9E\u4F53\u7B49.</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// \u521D\u59CB\u5316\u672C\u5730MSP\u7EC4\u4EF6\u5BF9\u8C61</span>
	<span class="token keyword">var</span> mspMgrConfigDir <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">GetPath</span><span class="token punctuation">(</span><span class="token string">&quot;peer.mspConfigPath&quot;</span><span class="token punctuation">)</span> <span class="token comment">// \u83B7\u53D6MSP\u914D\u7F6E\u6587\u4EF6\u8DEF\u5F84</span>
	<span class="token keyword">var</span> mspID <span class="token operator">=</span> viper<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span><span class="token string">&quot;peer.localMspId&quot;</span><span class="token punctuation">)</span>             <span class="token comment">// \u83B7\u53D6\u672C\u5730MSP\u540D\u79F0</span>
	<span class="token keyword">var</span> mspType <span class="token operator">=</span> viper<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span><span class="token string">&quot;peer.localMspType&quot;</span><span class="token punctuation">)</span>         <span class="token comment">// \u83B7\u53D6\u672C\u5730MSP\u7EC4\u4EF6\u7C7B\u578B</span>
	<span class="token keyword">if</span> mspType <span class="token operator">==</span> <span class="token string">&quot;&quot;</span> <span class="token punctuation">{</span>
		<span class="token comment">// \u9ED8\u8BA4\u8BBE\u7F6EMSP\u7EC4\u4EF6\u7C7B\u578B\u4E3AFABRIC\u7C7B\u578B</span>
		mspType <span class="token operator">=</span> msp<span class="token punctuation">.</span><span class="token function">ProviderTypeToString</span><span class="token punctuation">(</span>msp<span class="token punctuation">.</span>FABRIC<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// \u83B7\u53D6BCCSP\u7EC4\u4EF6\u914D\u7F6E\u4FE1\u606F\uFF0C\u521D\u59CB\u5316MSP\u7EC4\u4EF6\u5BF9\u8C61</span>
	err <span class="token operator">=</span> common<span class="token punctuation">.</span><span class="token function">InitCrypto</span><span class="token punctuation">(</span>mspMgrConfigDir<span class="token punctuation">,</span> mspID<span class="token punctuation">,</span> mspType<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u6267\u884C\u4E3B\u547D\u4EE4" tabindex="-1"><a class="header-anchor" href="#\u6267\u884C\u4E3B\u547D\u4EE4" aria-hidden="true">#</a> \u6267\u884C\u4E3B\u547D\u4EE4</h2><p>\u51FD\u6570\u5982\u4E0B\uFF1A</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">if</span> mainCmd<span class="token punctuation">.</span><span class="token function">Execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u63A5\u4E0B\u6765\u8FDB\u5165\u5230<code>Execute()</code>\u51FD\u6570\u4E2D\u7EE7\u7EED\u5206\u6790\uFF1A /vendor/github.com/spf13/cobra/command.go/ExecuteC()</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>Command<span class="token punctuation">)</span> <span class="token function">ExecuteC</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>cmd <span class="token operator">*</span>Command<span class="token punctuation">,</span> err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u901A\u8FC7<code>Cobra</code>\u7EC4\u4EF6\u8C03\u7528\u4E3B\u547D\u4EE4<code>Execute</code>()\u65B9\u6CD5\uFF0C\u6267\u884C<code>peer node start</code>\u547D\u4EE4\u542F\u52A8<code>Peer</code>\u8282\u70B9\u3002\u5176\u4E2D\uFF0C<code>Cobra</code>\u7EC4\u4EF6\u89E3\u6790\u5B8C\u7528\u6237\u8F93\u5165\u7684\u547D\u4EE4\u884C\u9009\u9879\u4E4B\u540E\uFF0C\u4F9D\u6B21\u6267\u884C\u8282\u70B9\u542F\u52A8\u547D\u4EE4nodeStartCmd\u5BF9\u8C61\u4E2D\u5B9A\u4E49\u7684\u6240\u6709\u76F8\u5173\u7684\u6267\u884C\u65B9\u6CD5\uFF0C\u5E76\u6309\u7167<code>cobra.Command</code>\u547D\u4EE4\u4E2D\u5B9A\u4E49\u7684\u5982\u4E0B\u987A\u5E8F\u6765\u6267\u884C</p><ul><li>PersistentPreRunE()/PersistentPreRun()\uFF1B</li><li>PreRunE()/PreRun()\uFF1B</li><li>RunE()/Run()\uFF1B</li><li>PostRunE()/PostRun()\uFF1B</li><li>PersistentPostRunE()/PersistentPostRun();</li></ul><p>\u5230\u8FD9\u91CC\u4E3A\u6B62\u8282\u70B9\u547D\u4EE4\u5F00\u542F\u6267\u884C\uFF0C\u56E0\u4E3A\u8FD9\u90E8\u5206\u4E3B\u8981\u662F\u8BB2\u7684\u8282\u70B9\u542F\u52A8\uFF0C\u6240\u4EE5\u4E0B\u9762\u96C6\u4E2D\u5C06\u8282\u70B9\u542F\u52A8\u547D\u4EE4\u6267\u884C\u7684\u8FD0\u884C\u6D41\u7A0B\u3002</p><h2 id="\u8282\u70B9\u542F\u52A8\u547D\u4EE4\u6267\u884C" tabindex="-1"><a class="header-anchor" href="#\u8282\u70B9\u542F\u52A8\u547D\u4EE4\u6267\u884C" aria-hidden="true">#</a> \u8282\u70B9\u542F\u52A8\u547D\u4EE4\u6267\u884C</h2><p>\u8282\u70B9\u542F\u52A8\u7684\u547D\u4EE4\u53EF\u4EE5\u6839\u636E\u4EE5\u4E0B\u4EE3\u7801\u8DEF\u5F84\u67E5\u627E\uFF1A</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>mainCmd<span class="token punctuation">.</span><span class="token function">AddCommand</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span><span class="token function">Cmd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">Cmd</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span>cobra<span class="token punctuation">.</span>Command <span class="token punctuation">{</span>
	nodeCmd<span class="token punctuation">.</span><span class="token function">AddCommand</span><span class="token punctuation">(</span><span class="token function">startCmd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	nodeCmd<span class="token punctuation">.</span><span class="token function">AddCommand</span><span class="token punctuation">(</span><span class="token function">statusCmd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">return</span> nodeCmd
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD9\u91CC\u53EA\u8BA8\u8BBA\u8282\u70B9\u542F\u52A8\u547D\u4EE4</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">startCmd</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span>cobra<span class="token punctuation">.</span>Command <span class="token punctuation">{</span>
<span class="token operator">...</span>
	<span class="token keyword">return</span> nodeStartCmd
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">var</span> nodeStartCmd <span class="token operator">=</span> <span class="token operator">&amp;</span>cobra<span class="token punctuation">.</span>Command<span class="token punctuation">{</span>
<span class="token operator">...</span>
		<span class="token keyword">return</span> <span class="token function">serve</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6B63\u5F0F\u8FDB\u5165\u5230serve\u51FD\u6570\u8BA8\u8BBA\uFF1A</p><h3 id="\u521D\u59CB\u5316\u8D44\u6E90" tabindex="-1"><a class="header-anchor" href="#\u521D\u59CB\u5316\u8D44\u6E90" aria-hidden="true">#</a> \u521D\u59CB\u5316\u8D44\u6E90</h3><p>\u2460\uFF1A<em>\u83B7\u53D6\u672C\u5730MSP\u7EC4\u4EF6\u7C7B\u578B\u5E76\u68C0\u67E5MSP\u7EC4\u4EF6\u7C7B\u578B</em></p><p>\u76EE\u524D\uFF0C<code>Hyperledger Fabric</code>\u652F\u6301<code>FABRIC</code>\u7C7B\u578B\u548C<code>IDEMIX</code>\u7C7B\u578B\u4E24\u79CD<code>MSP</code>\u7EC4\u4EF6\uFF0C\u9ED8\u8BA4\u91C7\u7528\u57FA\u4E8E<code>BCCSP</code>\u7EC4\u4EF6\u6784\u5EFA\u7684<code>FABRIC</code>\u7C7B\u578B<code>MSP</code>\u7EC4\u4EF6.</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>mspType <span class="token operator">:=</span> mgmt<span class="token punctuation">.</span><span class="token function">GetLocalMSP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// \u83B7\u53D6\u672C\u5730MSP\u7EC4\u4EF6\u7C7B\u578B</span>
	<span class="token keyword">if</span> mspType <span class="token operator">!=</span> msp<span class="token punctuation">.</span>FABRIC <span class="token punctuation">{</span>              <span class="token comment">// \u68C0\u67E5MSP\u7EC4\u4EF6\u7C7B\u578B</span>
		<span class="token function">panic</span><span class="token punctuation">(</span><span class="token string">&quot;Unsupported msp type &quot;</span> <span class="token operator">+</span> msp<span class="token punctuation">.</span><span class="token function">ProviderTypeToString</span><span class="token punctuation">(</span>mspType<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u2461\uFF1A<em>\u521D\u59CB\u5316\u8D44\u6E90\u8BBF\u95EE\u7B56\u7565\u63D0\u4F9B\u8005</em></p><div class="language-GO ext-GO line-numbers-mode"><pre class="language-GO"><code>aclmgmt.RegisterACLProvider(nil)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u2462\uFF1A<em>\u521D\u59CB\u5316\u672C\u5730\u8D26\u672C\u7BA1\u7406\u5668</em></p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>ledgermgmt<span class="token punctuation">.</span><span class="token function">Initialize</span><span class="token punctuation">(</span>peer<span class="token punctuation">.</span>ConfigTxProcessors<span class="token punctuation">)</span> 	
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>core/ledger/ledgermgmt/ledger_mgmt.go/initialize</p></blockquote><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">initialize</span><span class="token punctuation">(</span>customTxProcessors customtx<span class="token punctuation">.</span>Processors<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	logger<span class="token punctuation">.</span><span class="token function">Info</span><span class="token punctuation">(</span><span class="token string">&quot;Initializing ledger mgmt&quot;</span><span class="token punctuation">)</span>
	lock<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">defer</span> lock<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// \u8BBE\u7F6EPeer\u8282\u70B9\u521D\u59CB\u5316\u6807\u5FD7\u4F4D\u4E3Atrue</span>
	initialized <span class="token operator">=</span> <span class="token boolean">true</span>
	<span class="token comment">// \u521B\u5EFA\u5DF2\u6253\u5F00\u7684\u8D26\u672C\u5B57\u5178openedLedgers</span>
	openedLedgers <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>ledger<span class="token punctuation">.</span>PeerLedger<span class="token punctuation">)</span>
	<span class="token comment">// \u521D\u59CB\u5316\u914D\u7F6E\u4EA4\u6613\u6D88\u606F\u5904\u7406\u5668\u5B57\u5178\uFF0C\u8BBE\u7F6E\u7ED9\u5168\u5C40\u53D8\u91CFprocessors\u5B57\u5178</span>
	customtx<span class="token punctuation">.</span><span class="token function">Initialize</span><span class="token punctuation">(</span>customTxProcessors<span class="token punctuation">)</span>
	cceventmgmt<span class="token punctuation">.</span><span class="token function">Initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token comment">// \u521D\u59CB\u5316\u94FE\u7801\u4E8B\u4EF6\u7BA1\u7406\u5668</span>
	provider<span class="token punctuation">,</span> err <span class="token operator">:=</span> kvledger<span class="token punctuation">.</span><span class="token function">NewProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// \u521B\u5EFA\u672C\u5730Peer\u8282\u70B9\u8D26\u672C\u63D0\u4F9B\u8005</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token function">panic</span><span class="token punctuation">(</span>fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;Error in instantiating ledger provider: %s&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	provider<span class="token punctuation">.</span><span class="token function">Initialize</span><span class="token punctuation">(</span>kvLedgerStateListeners<span class="token punctuation">)</span> <span class="token comment">// \u521D\u59CB\u5316\u72B6\u6001\u76D1\u542C\u5668</span>
	ledgerProvider <span class="token operator">=</span> provider                   <span class="token comment">// \u8BBE\u7F6E\u4E3A\u5168\u5C40\u9ED8\u8BA4\u7684Peer\u8282\u70B9\u8D26\u672C\u63D0\u4F9B\u8005</span>
	logger<span class="token punctuation">.</span><span class="token function">Info</span><span class="token punctuation">(</span><span class="token string">&quot;ledger mgmt initialized&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6B63\u672C\u63D0\u4F9B\u8005\u6709\u4EE5\u4E0B\u51E0\u79CD\uFF1A</p><ul><li><p>\u8D26\u672CID\u6570\u636E\u5E93\uFF08idStore\u7C7B\u578B\uFF09\uFF1A\u63D0\u4F9B\u5B58\u50A8\u8D26\u672CID\uFF08\u5373\u94FEID\uFF09\u4E0E\u521B\u4E16\u533A\u5757\u952E\u503C\u5BF9\u7684<code>LevelDB</code>\u6570\u636E\u5E93\uFF1B</p></li><li><p>\u8D26\u672C\u6570\u636E\u5B58\u50A8\u5BF9\u8C61\u63D0\u4F9B\u8005\uFF08ledgerstorage.Provider\u7C7B\u578B\uFF09\uFF1A\u521B\u5EFA\u8D26\u672C\u6570\u636E\u5B58\u50A8\u5BF9\u8C61\uFF0C\u8D1F\u8D23\u7BA1\u7406\u533A\u5757\u6570\u636E\u6587\u4EF6\u3001\u9690\u79C1\u6570\u636E\u5E93\u3001\u533A\u5757\u7D22\u5F15\u6570\u636E\u5E93\u7B49\uFF1B</p></li><li><p>\u5386\u53F2\u6570\u636E\u5E93\u63D0\u4F9B\u8005\uFF08HistoryDBProvider\u7C7B\u578B\uFF09\uFF1A\u521B\u5EFA\u5386\u53F2\u6570\u636E\u5E93\uFF0C\u5B58\u50A8\u6BCF\u4E2A\u72B6\u6001\u6570\u636E\u7684\u5386\u53F2\u4FE1\u606F\uFF1B</p></li><li><p>\u72B6\u6001\u6570\u636E\u5E93\u63D0\u4F9B\u8005\uFF08CommonStorageDBProvider\u7C7B\u578B\uFF09\uFF1A\u521B\u5EFA\u72B6\u6001\u6570\u636E\u5E93\uFF08<code>LevelDB</code>\u6216<code>CouchDB</code>\u7C7B\u578B\uFF09\uFF0C\u5B58\u50A8\u4E16\u754C\u72B6\u6001\uFF08<code>world state</code>\uFF09\uFF0C\u5305\u62EC\u6709\u6548\u4EA4\u6613\u7684\u516C\u6709\u6570\u636E\u4E0E\u9690\u79C1\u6570\u636E\u3002</p></li></ul><p>\u2463\uFF1A<em>\u521D\u59CB\u5316\u670D\u52A1\u5668\u53C2\u6570</em></p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">if</span> chaincodeDevMode <span class="token punctuation">{</span>
		<span class="token comment">//\u8BBE\u7F6E\u94FE\u7801\u6A21\u5F0F</span>
		viper<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">&quot;chaincode.mode&quot;</span><span class="token punctuation">,</span> chaincode<span class="token punctuation">.</span>DevModeUserRunsChaincode<span class="token punctuation">)</span>

	<span class="token punctuation">}</span>
	<span class="token comment">// \u8BFB\u53D6\u914D\u7F6E\u5E76\u7F13\u5B58Peer\u8282\u70B9\u5730\u5740\u4E0E\u7AEF\u70B9</span>
	<span class="token keyword">if</span> err <span class="token operator">:=</span> peer<span class="token punctuation">.</span><span class="token function">CacheConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> err
	<span class="token punctuation">}</span>
	<span class="token comment">// \u83B7\u53D6\u7F13\u5B58\u7684Peer\u7AEF\u70B9</span>
	peerEndpoint<span class="token punctuation">,</span> err <span class="token operator">:=</span> peer<span class="token punctuation">.</span><span class="token function">GetPeerEndpoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token operator">...</span>
	<span class="token keyword">var</span> peerHost <span class="token builtin">string</span>
	<span class="token comment">// \u83B7\u53D6Peer\u8282\u70B9IP\u5730\u5740\uFF0C\u6CE8\u610FIP\u5730\u5740\u4E0E\u7AEF\u53E3\u5DF2\u7ECF\u88AB\u5206\u79BB</span>
	peerHost<span class="token punctuation">,</span> <span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">=</span> net<span class="token punctuation">.</span><span class="token function">SplitHostPort</span><span class="token punctuation">(</span>peerEndpoint<span class="token punctuation">.</span>Address<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u521B\u5EFAgrpc\u670D\u52A1\u5668" tabindex="-1"><a class="header-anchor" href="#\u521B\u5EFAgrpc\u670D\u52A1\u5668" aria-hidden="true">#</a> \u521B\u5EFAGRPC\u670D\u52A1\u5668</h3><p>\u2460\uFF1A<em>\u521B\u5EFAgRPC\u670D\u52A1\u5668</em></p><p><code>serve()</code>\u51FD\u6570\u521B\u5EFA\u4E86\u81F3\u5C11 3 \u4E2A<code>gRPC</code>\u670D\u52A1\u5668\uFF08\u72EC\u7ACB\u7AEF\u53E3\uFF09\uFF0C\u7528\u4E8E\u6CE8\u518C<code>Peer</code>\u8282\u70B9\u529F\u80FD\u670D\u52A1\u5668\uFF0C\u5982\u4E0B\u6240\u793A\uFF1A</p><table><thead><tr><th>\u5E8F\u53F7</th><th>\u7AEF\u53E3</th><th>\u529F\u80FD\u670D\u52A1\u5668</th><th>\u8BF4\u660E</th><th>\u670D\u52A1\u63A5\u53E3</th></tr></thead><tbody><tr><td>1</td><td>7051</td><td>DeliverEvents\u4E8B\u4EF6\u670D\u52A1\u5668</td><td>\u5904\u7406\u533A\u5757\u8BF7\u6C42\u6D88\u606F</td><td>Deliver()</td></tr><tr><td></td><td>7051</td><td>Admin\u670D\u52A1\u5668</td><td>\u83B7\u53D6\u8282\u70B9\u72B6\u6001\u3001\u7EF4\u62A4\u65E5\u5FD7\u7B49</td><td>GetStatus()</td></tr><tr><td></td><td>7051</td><td>Endorser\u80CC\u4E66\u670D\u52A1\u5668</td><td>\u63D0\u4F9B\u80CC\u4E66\u670D\u52A1</td><td>ProcessProposal()</td></tr><tr><td></td><td>7051</td><td>Gossip\u6D88\u606F\u670D\u52A1\u5668</td><td>\u7EC4\u7EC7\u5185\u8282\u70B9\u5206\u53D1\u6570\u636E\u4E0E\u540C\u6B65\u72B6\u6001\u7B49</td><td>GossipStream()</td></tr><tr><td>2</td><td>7052</td><td>chaincodeSupport\u94FE\u7801\u652F\u6301\u670D\u52A1\u5668</td><td>\u63D0\u4F9BPeer\u8282\u70B9\u94FE\u7801\u652F\u6301\u670D\u52A1</td><td>Register()</td></tr><tr><td>3</td><td>7053</td><td>EventHub\u4E8B\u4EF6\u670D\u52A1\u5668</td><td>\u63D0\u4F9B\u8BA2\u9605\u4E8B\u4EF6\u670D\u52A1(1.3.0\u5E9F\u5F03)</td><td>Chat()</td></tr></tbody></table><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>serverConfig<span class="token punctuation">,</span> err <span class="token operator">:=</span> peer<span class="token punctuation">.</span><span class="token function">GetServerConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token operator">...</span>
peerServer<span class="token punctuation">,</span> err <span class="token operator">:=</span> peer<span class="token punctuation">.</span><span class="token function">CreatePeerServer</span><span class="token punctuation">(</span>listenAddr<span class="token punctuation">,</span> serverConfig<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u2461\uFF1A<em>\u521B\u5EFAEventHub\u4E8B\u4EF6\u670D\u52A1\u5668</em></p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>	<span class="token keyword">if</span> serverConfig<span class="token punctuation">.</span>SecOpts<span class="token punctuation">.</span>UseTLS <span class="token punctuation">{</span>
		<span class="token operator">...</span>
		cs <span class="token operator">:=</span> comm<span class="token punctuation">.</span><span class="token function">GetCredentialSupport</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// \u521B\u5EFA\u8BC1\u4E66\u652F\u6301\u5BF9\u8C61CredentialSupport\u7ED3\u6784\u5BF9\u8C61</span>
		cs<span class="token punctuation">.</span>ServerRootCAs <span class="token operator">=</span> serverConfig<span class="token punctuation">.</span>SecOpts<span class="token punctuation">.</span>ServerRootCAs
		<span class="token comment">//// \u83B7\u53D6gRPC\u5BA2\u6237\u7AEF\u8BC1\u4E66\u7528\u4E8ETLS\u8FDE\u63A5\u8BA4\u8BC1</span>
		clientCert<span class="token punctuation">,</span> err <span class="token operator">:=</span> peer<span class="token punctuation">.</span><span class="token function">GetClientCertificate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token comment">// \u8BBE\u7F6E\u5BA2\u6237\u7AEF\u8BC1\u4E66</span>
		comm<span class="token punctuation">.</span><span class="token function">GetCredentialSupport</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">SetClientCertificate</span><span class="token punctuation">(</span>clientCert<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token comment">//// \u521B\u5EFA\u4E8B\u4EF6EventHub\u670D\u52A1\u5668\uFF087053\u7AEF\u53E3\uFF09</span>
	ehubGrpcServer<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">createEventHubServer</span><span class="token punctuation">(</span>serverConfig<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u2462\uFF1A<em>\u521B\u5EFADeliverEvents\u4E8B\u4EF6\u670D\u52A1\u5668</em></p><p><code>serve()</code>\u51FD\u6570\u68C0\u67E5\u5982\u679C\u5F00\u542F\u4E86\u53CC\u5411\u7684<code>TLS</code>\u5B89\u5168\u8BA4\u8BC1\uFF0C\u5219\u8BBE\u7F6E<code>mutualTLS</code>\u6807\u5FD7\u4F4D\u4E3A<code>true</code>\uFF0C\u5E76\u5B9A\u4E49\u83B7\u53D6\u8D44\u6E90\u7B56\u7565\u68C0\u67E5\u5668\u5373<code>policyCheckerProvider</code>()\u51FD\u6570\u3002\u8BE5\u51FD\u6570\u5C06\u76F4\u63A5\u8C03\u7528\u5168\u5C40\u53D8\u91CF<code>aclProvider</code>\u5BF9\u8C61\u7684<code>CheckACL</code>()\u65B9\u6CD5\uFF0C\u68C0\u67E5\u7B7E\u540D\u6D88\u606F\u5728\u901A\u9053\uFF08channelID\uFF09\u4E0A\u662F\u5426\u6EE1\u8DB3\u6307\u5B9A\u8D44\u6E90\u7684\u8BBF\u95EE\u63A7\u5236\u6743\u9650\u7B56\u7565\u3002</p><p>\u63A5\u7740\uFF0C<code>serve</code>()\u51FD\u6570\u8C03\u7528<code>peer.NewDeliverEventsServer()</code>\u51FD\u6570\uFF0C\u57FA\u4E8E<code>mutualTLS</code>\u3001<code>policy-CheckerProvider</code>\u7B49\u53C2\u6570\u521B\u5EFA<code>DeliverEvents</code>\u4E8B\u4EF6\u670D\u52A1\u5668<code>abServer</code>\uFF0C\u63D0\u4F9B<code>Deliver()</code>\u4E0E<code>DeliverFiltered</code>()\u670D\u52A1\u63A5\u53E3\uFF0C\u5206\u522B\u7528\u4E8E\u5904\u7406\u8BF7\u6C42\u6B63\u5E38\u533A\u5757\u4E0E\u8FC7\u6EE4\u533A\u5757\u7684\u6D88\u606F\u3002</p><p>\u7136\u540E\u8C03\u7528<code>pb.RegisterDeliverServer()</code>\u65B9\u6CD5\uFF0C\u5C06<code>DeliverEvents</code>\u4E8B\u4EF6\u670D\u52A1\u5668<code>abServer</code>\u6CE8\u518C\u5230\u9ED8\u8BA4\u7684<code>gRPC</code>\u670D\u52A1\u5668\u4E0A\uFF087051\u7AEF\u53E3\uFF09\uFF0C\u4EE5\u63D0\u4F9B\u672C\u5730\u4E8B\u4EF6\u670D\u52A1\u3002</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">//// \u68C0\u67E5\u662F\u5426\u5F00\u542F\u4E86\u53CC\u5411\u7684TLS\u5B89\u5168\u8BA4\u8BC1</span>
	mutualTLS <span class="token operator">:=</span> serverConfig<span class="token punctuation">.</span>SecOpts<span class="token punctuation">.</span>UseTLS <span class="token operator">&amp;&amp;</span> serverConfig<span class="token punctuation">.</span>SecOpts<span class="token punctuation">.</span>RequireClientCert
	<span class="token comment">//// \u5B9A\u4E49\u8D44\u6E90\u8BBF\u95EE\u6743\u9650\u7B56\u7565\u68C0\u67E5\u51FD\u6570</span>
	policyCheckerProvider <span class="token operator">:=</span> <span class="token keyword">func</span><span class="token punctuation">(</span>resourceName <span class="token builtin">string</span><span class="token punctuation">)</span> deliver<span class="token punctuation">.</span>PolicyChecker <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">func</span><span class="token punctuation">(</span>env <span class="token operator">*</span>cb<span class="token punctuation">.</span>Envelope<span class="token punctuation">,</span> channelID <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> aclmgmt<span class="token punctuation">.</span><span class="token function">GetACLProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">CheckACL</span><span class="token punctuation">(</span>resourceName<span class="token punctuation">,</span> channelID<span class="token punctuation">,</span> env<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token comment">//\u521B\u5EFADeliverEvents\u4E8B\u4EF6\u670D\u52A1\u5668\uFF0C\u5E76\u6CE8\u518C\u5230Peer\u8282\u70B9gRPC\u670D\u52A1\u5668\u4E0A\uFF087051\u7AEF\u53E3\uFF09</span>
	abServer <span class="token operator">:=</span> peer<span class="token punctuation">.</span><span class="token function">NewDeliverEventsServer</span><span class="token punctuation">(</span>mutualTLS<span class="token punctuation">,</span> policyCheckerProvider<span class="token punctuation">,</span> <span class="token operator">&amp;</span>peer<span class="token punctuation">.</span>DeliverSupportManager<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	pb<span class="token punctuation">.</span><span class="token function">RegisterDeliverServer</span><span class="token punctuation">(</span>peerServer<span class="token punctuation">.</span><span class="token function">Server</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> abServer<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u2463\uFF1A<em>\u521B\u5EFAChaincodeSupport\u94FE\u7801\u652F\u6301\u670D\u52A1\u5668</em></p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">//\u521B\u5EFA\u94FE\u7801\u652F\u6301\u670D\u52A1\u4E13\u7528gRPC\u670D\u52A1\u5668\u4E0E\u94FE\u7801\u652F\u6301\u670D\u52A1\u5B9E\u4F8BChaincodeSupport\uFF08\u4E13\u7528\u7AEF\u53E3\u62167052\u7AEF\u53E3\uFF09</span>
	ccSrv<span class="token punctuation">,</span> ccEndpoint<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">createChaincodeServer</span><span class="token punctuation">(</span>ca<span class="token punctuation">,</span> peerHost<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		logger<span class="token punctuation">.</span><span class="token function">Panicf</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to create chaincode server: %s&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token comment">//\u5C06\u94FE\u7801\u652F\u6301\u670D\u52A1\u5668\u5B9E\u4F8BChaincodeSupoort\u5BF9\u8C61\u6CE8\u518C\u5230Peer\u8282\u70B9gRPC\u670D\u52A1\u5668\u4E0A</span>
	<span class="token comment">// \u540C\u65F6\u6CE8\u518C\u7CFB\u7EDF\u94FE\u7801\u4EE5\u652F\u6301\u90E8\u7F72\u8C03\u7528\u7CFB\u7EDF\u94FE\u7801</span>
	<span class="token function">registerChaincodeSupport</span><span class="token punctuation">(</span>ccSrv<span class="token punctuation">,</span> ccEndpoint<span class="token punctuation">,</span> ca<span class="token punctuation">)</span>
	<span class="token keyword">go</span> ccSrv<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//\u542F\u52A8gRPC\u670D\u52A1\u5668\u63D0\u4F9B\u94FE\u7801\u652F\u6301\u670D\u52A1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u2464\uFF1A<em>\u521B\u5EFAAdmin\u7BA1\u7406\u670D\u52A1\u5668\u4E0EEndorser\u80CC\u4E66\u670D\u52A1\u5668</em></p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>	<span class="token comment">//\u521B\u5EFAAdmin\u7BA1\u7406\u670D\u52A1\u5668\u4E0E</span>
	pb<span class="token punctuation">.</span><span class="token function">RegisterAdminServer</span><span class="token punctuation">(</span>peerServer<span class="token punctuation">.</span><span class="token function">Server</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> core<span class="token punctuation">.</span><span class="token function">NewAdminServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token comment">// \u5B9A\u4E49Gossip\u534F\u8BAE\u5206\u53D1\u9690\u79C1\u6570\u636E\u51FD\u6570</span>
	privDataDist <span class="token operator">:=</span> <span class="token keyword">func</span><span class="token punctuation">(</span>channel <span class="token builtin">string</span><span class="token punctuation">,</span> txID <span class="token builtin">string</span><span class="token punctuation">,</span> privateData <span class="token operator">*</span>rwset<span class="token punctuation">.</span>TxPvtReadWriteSet<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> service<span class="token punctuation">.</span><span class="token function">GetGossipService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">DistributePrivateData</span><span class="token punctuation">(</span>channel<span class="token punctuation">,</span> txID<span class="token punctuation">,</span> privateData<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token comment">//\u521B\u5EFA\u65B0\u7684EndorserServer\u80CC\u4E66\u8282\u70B9\u670D\u52A1\u5668</span>
	serverEndorser <span class="token operator">:=</span> endorser<span class="token punctuation">.</span><span class="token function">NewEndorserServer</span><span class="token punctuation">(</span>privDataDist<span class="token punctuation">,</span> <span class="token operator">&amp;</span>endorser<span class="token punctuation">.</span>SupportImpl<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	libConf <span class="token operator">:=</span> library<span class="token punctuation">.</span>Config<span class="token punctuation">{</span><span class="token punctuation">}</span>
	<span class="token keyword">if</span> err <span class="token operator">=</span> viperutil<span class="token punctuation">.</span><span class="token function">EnhancedExactUnmarshalKey</span><span class="token punctuation">(</span><span class="token string">&quot;peer.handlers&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>libConf<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> errors<span class="token punctuation">.</span><span class="token function">WithMessage</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> <span class="token string">&quot;could not load YAML config&quot;</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token comment">//// \u521B\u5EFA\u6D88\u606F\u8FC7\u6EE4\u5668\u5217\u8868</span>
	authFilters <span class="token operator">:=</span> library<span class="token punctuation">.</span><span class="token function">InitRegistry</span><span class="token punctuation">(</span>libConf<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Lookup</span><span class="token punctuation">(</span>library<span class="token punctuation">.</span>Auth<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span>authHandler<span class="token punctuation">.</span>Filter<span class="token punctuation">)</span>
	<span class="token comment">// \u5C06\u6240\u6709\u6D88\u606F\u8FC7\u6EE4\u5668\u5747\u6784\u9020\u6210\u6D88\u606F\u8FC7\u6EE4\u5668\u94FE\uFF0C\u5E76\u8FD4\u56DE\u7B2C1\u4E2A\u8FC7\u6EE4\u5668\uFF08Filter\u7C7B\u578B\uFF0C\u5B9E\u73B0\u4E86EndorserServer // \u63A5\u53E3\uFF09</span>
	auth <span class="token operator">:=</span> authHandler<span class="token punctuation">.</span><span class="token function">ChainFilters</span><span class="token punctuation">(</span>serverEndorser<span class="token punctuation">,</span> authFilters<span class="token operator">...</span><span class="token punctuation">)</span>
	<span class="token comment">// Register the Endorser server</span>
	<span class="token comment">//// \u6CE8\u518CEndorserServer\u80CC\u4E66\u670D\u52A1\u5668\u5230gRPC\u670D\u52A1\u5668</span>
	pb<span class="token punctuation">.</span><span class="token function">RegisterEndorserServer</span><span class="token punctuation">(</span>peerServer<span class="token punctuation">.</span><span class="token function">Server</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> auth<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u2465\uFF1A<em>\u521B\u5EFAGossip\u6D88\u606F\u670D\u52A1\u5668</em></p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>	<span class="token comment">//\u83B7\u53D6Bootstrap\u8FDE\u63A5\u7684\u521D\u59CB\u8282\u70B9\u5730\u5740\u5217\u8868\uFF0C\u9ED8\u8BA4\u4E3A127.0.0.1:7051</span>
	bootstrap <span class="token operator">:=</span> viper<span class="token punctuation">.</span><span class="token function">GetStringSlice</span><span class="token punctuation">(</span><span class="token string">&quot;peer.gossip.bootstrap&quot;</span><span class="token punctuation">)</span>

	<span class="token comment">////\u83B7\u53D6\u672C\u5730MSP\u7B7E\u540D\u8005\u8EAB\u4EFD\u5B9E\u4F53 \u5E76\u5E8F\u5217\u5316</span>
	serializedIdentity<span class="token punctuation">,</span> err <span class="token operator">:=</span> mgmt<span class="token punctuation">.</span><span class="token function">GetLocalSigningIdentityOrPanic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Serialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token operator">...</span>
	messageCryptoService <span class="token operator">:=</span> peergossip<span class="token punctuation">.</span><span class="token function">NewMCS</span><span class="token punctuation">(</span> <span class="token comment">// \u6784\u9020Gossip\u6D88\u606F\u52A0\u5BC6\u670D\u52A1\u7EC4\u4EF6</span>
		peer<span class="token punctuation">.</span><span class="token function">NewChannelPolicyManagerGetter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// \u901A\u9053\u7B56\u7565\u7BA1\u7406\u5668\u83B7\u53D6\u7EC4\u4EF6</span>
		localmsp<span class="token punctuation">.</span><span class="token function">NewSigner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                 <span class="token comment">// \u672C\u5730\u7B7E\u540D\u8005</span>
		mgmt<span class="token punctuation">.</span><span class="token function">NewDeserializersManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>       <span class="token comment">// \u8EAB\u4EFD\u53CD\u5E8F\u5217\u5316\u7EC4\u4EF6\u7BA1\u7406\u5668</span>
	secAdv <span class="token operator">:=</span> peergossip<span class="token punctuation">.</span><span class="token function">NewSecurityAdvisor</span><span class="token punctuation">(</span>mgmt<span class="token punctuation">.</span><span class="token function">NewDeserializersManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

	<span class="token comment">// callback function for secure dial options for gossip service</span>
	<span class="token comment">//\u5B9A\u4E49Gossip\u670D\u52A1\u5668\u56DE\u8C03\u51FD\u6570\uFF0C\u7528\u4E8E\u521B\u5EFAGossip\u670D\u52A1\u5668\u5B89\u5168\u914D\u7F6E\u7684gRPC\u62E8\u53F7\u8FDE\u63A5\u9009\u9879</span>
	secureDialOpts <span class="token operator">:=</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>grpc<span class="token punctuation">.</span>DialOption <span class="token punctuation">{</span>
		<span class="token keyword">var</span> dialOpts <span class="token punctuation">[</span><span class="token punctuation">]</span>grpc<span class="token punctuation">.</span>DialOption
		<span class="token comment">// set max send/recv msg sizes</span>
		dialOpts <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>dialOpts<span class="token punctuation">,</span> grpc<span class="token punctuation">.</span><span class="token function">WithDefaultCallOptions</span><span class="token punctuation">(</span>grpc<span class="token punctuation">.</span><span class="token function">MaxCallRecvMsgSize</span><span class="token punctuation">(</span>comm<span class="token punctuation">.</span><span class="token function">MaxRecvMsgSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
			grpc<span class="token punctuation">.</span><span class="token function">MaxCallSendMsgSize</span><span class="token punctuation">(</span>comm<span class="token punctuation">.</span><span class="token function">MaxSendMsgSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// \u8BBE\u7F6E\u6700\u5927\u53D1\u9001\u548C\u63A5\u6536\u6D88\u606F\u5B57\u8282\u6570</span>
		<span class="token comment">// set the keepalive options</span>
		kaOpts <span class="token operator">:=</span> comm<span class="token punctuation">.</span><span class="token function">DefaultKeepaliveOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// \u83B7\u53D6\u9ED8\u8BA4\u7684\u5FC3\u8DF3\u6D88\u606Fkeepalive\u9009\u9879</span>
		<span class="token operator">...</span>
		<span class="token comment">//\u5728gRPC\u901A\u4FE1\u62E8\u53F7\u8FDE\u63A5\u9009\u9879\u4E2D\u8BBE\u7F6E\u5FC3\u8DF3\u901A\u4FE1keepalive\u9009\u9879</span>
		dialOpts <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>dialOpts<span class="token punctuation">,</span> comm<span class="token punctuation">.</span><span class="token function">ClientKeepaliveOptions</span><span class="token punctuation">(</span>kaOpts<span class="token punctuation">)</span><span class="token operator">...</span><span class="token punctuation">)</span>

		<span class="token keyword">if</span> comm<span class="token punctuation">.</span><span class="token function">TLSEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// \u542F\u7528TLS\u5B89\u5168\u8BA4\u8BC1\uFF0C\u8BBE\u7F6E\u5BA2\u6237\u7AEFTLS\u901A\u4FE1\u8BC1\u4E66</span>
			dialOpts <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>dialOpts<span class="token punctuation">,</span> grpc<span class="token punctuation">.</span><span class="token function">WithTransportCredentials</span><span class="token punctuation">(</span>comm<span class="token punctuation">.</span><span class="token function">GetCredentialSupport</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetPeerCredentials</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			dialOpts <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>dialOpts<span class="token punctuation">,</span> grpc<span class="token punctuation">.</span><span class="token function">WithInsecure</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// \u5426\u5219\uFF0C\u5173\u95EDTLS\u5B89\u5168\u8BA4\u8BC1</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> dialOpts
	<span class="token punctuation">}</span>

	<span class="token comment">// \u68C0\u67E5gRPC\u670D\u52A1\u5668\u7AEF\u662F\u5426\u542F\u7528TLS\u5B89\u5168\u8BA4\u8BC1\uFF0C\u83B7\u53D6\u5E76\u8BBE\u7F6E\u670D\u52A1\u5668\u7AEF\u4E0E\u5BA2\u6237\u7AEF\u8EAB\u4EFD\u8BC1\u4E66</span>
	<span class="token keyword">var</span> certs <span class="token operator">*</span>common2<span class="token punctuation">.</span>TLSCertificates
	<span class="token keyword">if</span> peerServer<span class="token punctuation">.</span><span class="token function">TLSEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		serverCert <span class="token operator">:=</span> peerServer<span class="token punctuation">.</span><span class="token function">ServerCertificate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		clientCert<span class="token punctuation">,</span> err <span class="token operator">:=</span> peer<span class="token punctuation">.</span><span class="token function">GetClientCertificate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> errors<span class="token punctuation">.</span><span class="token function">Wrap</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> <span class="token string">&quot;failed obtaining client certificates&quot;</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		certs <span class="token operator">=</span> <span class="token operator">&amp;</span>common2<span class="token punctuation">.</span>TLSCertificates<span class="token punctuation">{</span><span class="token punctuation">}</span>
		certs<span class="token punctuation">.</span>TLSServerCert<span class="token punctuation">.</span><span class="token function">Store</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>serverCert<span class="token punctuation">)</span>
		certs<span class="token punctuation">.</span>TLSClientCert<span class="token punctuation">.</span><span class="token function">Store</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>clientCert<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// \u521B\u5EFAGossip\u6D88\u606F\u670D\u52A1\u5668\u5B9E\u4F8BgossipServiceInstance</span>
	err <span class="token operator">=</span> service<span class="token punctuation">.</span><span class="token function">InitGossipService</span><span class="token punctuation">(</span>serializedIdentity<span class="token punctuation">,</span> peerEndpoint<span class="token punctuation">.</span>Address<span class="token punctuation">,</span> peerServer<span class="token punctuation">.</span><span class="token function">Server</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> certs<span class="token punctuation">,</span>
		messageCryptoService<span class="token punctuation">,</span> secAdv<span class="token punctuation">,</span> secureDialOpts<span class="token punctuation">,</span> bootstrap<span class="token operator">...</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u90E8\u7F72\u7CFB\u7EDF\u94FE\u7801\u4E0E\u521D\u59CB\u5316\u73B0\u5B58\u901A\u9053\u7684\u94FE\u7ED3\u6784" tabindex="-1"><a class="header-anchor" href="#\u90E8\u7F72\u7CFB\u7EDF\u94FE\u7801\u4E0E\u521D\u59CB\u5316\u73B0\u5B58\u901A\u9053\u7684\u94FE\u7ED3\u6784" aria-hidden="true">#</a> \u90E8\u7F72\u7CFB\u7EDF\u94FE\u7801\u4E0E\u521D\u59CB\u5316\u73B0\u5B58\u901A\u9053\u7684\u94FE\u7ED3\u6784</h3><p>\u2460\uFF1A<em>\u90E8\u7F72\u7CFB\u7EDF\u94FE\u7801</em></p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>	<span class="token comment">//\u90E8\u7F72\u7CFB\u7EDF\u94FE\u7801</span>
	<span class="token function">initSysCCs</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>\u2461\uFF1A<em>\u521D\u59CB\u5316\u73B0\u5B58\u901A\u9053\u4E0A\u7684\u94FE\u7ED3\u6784</em></p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">//\u521D\u59CB\u5316\u73B0\u5B58\u901A\u9053\u4E0A\u7684\u94FE\u7ED3\u6784</span>
	peer<span class="token punctuation">.</span><span class="token function">Initialize</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span>cid <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>core/peer/peer.go/Initialize</p></blockquote><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">Initialize</span><span class="token punctuation">(</span>init <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	nWorkers <span class="token operator">:=</span> viper<span class="token punctuation">.</span><span class="token function">GetInt</span><span class="token punctuation">(</span><span class="token string">&quot;peer.validatorPoolSize&quot;</span><span class="token punctuation">)</span> <span class="token comment">// \u83B7\u53D6\u4EA4\u6613\u9A8C\u8BC1\u7EBF\u7A0B\u6570\u91CF</span>
	<span class="token keyword">if</span> nWorkers <span class="token operator">&lt;=</span> <span class="token number">0</span> <span class="token punctuation">{</span>
		nWorkers <span class="token operator">=</span> runtime<span class="token punctuation">.</span><span class="token function">NumCPU</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token comment">//// \u8BBE\u7F6E\u4FE1\u53F7\u91CF\u5E76\u53D1\u8BBF\u95EE\u6570\u91CF</span>
	validationWorkersSemaphore <span class="token operator">=</span> semaphore<span class="token punctuation">.</span><span class="token function">NewWeighted</span><span class="token punctuation">(</span><span class="token function">int64</span><span class="token punctuation">(</span>nWorkers<span class="token punctuation">)</span><span class="token punctuation">)</span>

	chainInitializer <span class="token operator">=</span> init <span class="token comment">// \u8BBE\u7F6E\u521D\u59CB\u5316\u51FD\u6570</span>

	<span class="token keyword">var</span> cb <span class="token operator">*</span>common<span class="token punctuation">.</span>Block
	<span class="token keyword">var</span> ledger ledger<span class="token punctuation">.</span>PeerLedger
	<span class="token comment">//// \u521D\u59CB\u5316\u8D26\u672C\u7BA1\u7406\u5668</span>
	ledgermgmt<span class="token punctuation">.</span><span class="token function">Initialize</span><span class="token punctuation">(</span>ConfigTxProcessors<span class="token punctuation">)</span>
	<span class="token comment">//// \u83B7\u53D6\u5F53\u524D\u8D26\u672C\u7BA1\u7406\u5668\u4E0B\u7684\u8D26\u672CID\u5217\u8868</span>
	ledgerIds<span class="token punctuation">,</span> err <span class="token operator">:=</span> ledgermgmt<span class="token punctuation">.</span><span class="token function">GetLedgerIDs</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token function">panic</span><span class="token punctuation">(</span>fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;Error in initializing ledgermgmt: %s&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> cid <span class="token operator">:=</span> <span class="token keyword">range</span> ledgerIds <span class="token punctuation">{</span>
		peerLogger<span class="token punctuation">.</span><span class="token function">Infof</span><span class="token punctuation">(</span><span class="token string">&quot;Loading chain %s&quot;</span><span class="token punctuation">,</span> cid<span class="token punctuation">)</span>
		<span class="token comment">//\u521B\u5EFA\u672C\u5730Peer\u8282\u70B9\u8D26\u672C</span>
		<span class="token keyword">if</span> ledger<span class="token punctuation">,</span> err <span class="token operator">=</span> ledgermgmt<span class="token punctuation">.</span><span class="token function">OpenLedger</span><span class="token punctuation">(</span>cid<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			peerLogger<span class="token punctuation">.</span><span class="token function">Warningf</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to load ledger %s(%s)&quot;</span><span class="token punctuation">,</span> cid<span class="token punctuation">,</span> err<span class="token punctuation">)</span>
			peerLogger<span class="token punctuation">.</span><span class="token function">Debugf</span><span class="token punctuation">(</span><span class="token string">&quot;Error while loading ledger %s with message %s. We continue to the next ledger rather than abort.&quot;</span><span class="token punctuation">,</span> cid<span class="token punctuation">,</span> err<span class="token punctuation">)</span>
			<span class="token keyword">continue</span>
		<span class="token punctuation">}</span>
		<span class="token comment">//// \u4ECE\u6307\u5B9A\u901A\u9053\u8D26\u672C\u4E2D\u83B7\u53D6\u6700\u65B0\u914D\u7F6E\u533A\u5757</span>
		<span class="token keyword">if</span> cb<span class="token punctuation">,</span> err <span class="token operator">=</span> <span class="token function">getCurrConfigBlockFromLedger</span><span class="token punctuation">(</span>ledger<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			peerLogger<span class="token punctuation">.</span><span class="token function">Warningf</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to find config block on ledger %s(%s)&quot;</span><span class="token punctuation">,</span> cid<span class="token punctuation">,</span> err<span class="token punctuation">)</span>
			peerLogger<span class="token punctuation">.</span><span class="token function">Debugf</span><span class="token punctuation">(</span><span class="token string">&quot;Error while looking for config block on ledger %s with message %s. We continue to the next ledger rather than abort.&quot;</span><span class="token punctuation">,</span> cid<span class="token punctuation">,</span> err<span class="token punctuation">)</span>
			<span class="token keyword">continue</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// Create a chain if we get a valid ledger with config block</span>
		<span class="token comment">//// \u5728Peer\u8282\u70B9\u4E0A\u521B\u5EFA\u6307\u5B9A\u901A\u9053\u7684\u94FE\u7ED3\u6784</span>
		<span class="token keyword">if</span> err <span class="token operator">=</span> <span class="token function">createChain</span><span class="token punctuation">(</span>cid<span class="token punctuation">,</span> ledger<span class="token punctuation">,</span> cb<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			peerLogger<span class="token punctuation">.</span><span class="token function">Warningf</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to load chain %s(%s)&quot;</span><span class="token punctuation">,</span> cid<span class="token punctuation">,</span> err<span class="token punctuation">)</span>
			peerLogger<span class="token punctuation">.</span><span class="token function">Debugf</span><span class="token punctuation">(</span><span class="token string">&quot;Error reloading chain %s with message %s. We continue to the next chain rather than abort.&quot;</span><span class="token punctuation">,</span> cid<span class="token punctuation">,</span> err<span class="token punctuation">)</span>
			<span class="token keyword">continue</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// \u7528\u81EA\u5B9A\u4E49\u51FD\u6570\u521D\u59CB\u5316\u901A\u9053\u94FE\u7ED3\u6784\uFF0C\u5982\u90E8\u7F72\u7CFB\u7EDF\u94FE\u7801</span>
		<span class="token function">InitChain</span><span class="token punctuation">(</span>cid<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u542F\u52A8grpc\u670D\u52A1\u5668\u4E0Eprofile\u670D\u52A1\u5668" tabindex="-1"><a class="header-anchor" href="#\u542F\u52A8grpc\u670D\u52A1\u5668\u4E0Eprofile\u670D\u52A1\u5668" aria-hidden="true">#</a> \u542F\u52A8gRPC\u670D\u52A1\u5668\u4E0Eprofile\u670D\u52A1\u5668</h3><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// \u5EFA\u7ACB\u4F20\u9012\u9519\u8BEF\u6D88\u606F\u7684\u901A\u9053</span>
	serve <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
	<span class="token comment">// \u4F20\u9012\u4FE1\u53F7\u7684\u901A\u9053</span>
	sigs <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> os<span class="token punctuation">.</span>Signal<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token comment">// \u8BBE\u7F6E\u672C\u8FDB\u7A0B\u4FE1\u53F7\u901A\u9053\u7684\u901A\u77E5\u4FE1\u53F7\uFF0C\u5305\u62EC\u4E2D\u65AD/\u7EC8\u6B62\u4FE1\u53F7</span>
	signal<span class="token punctuation">.</span><span class="token function">Notify</span><span class="token punctuation">(</span>sigs<span class="token punctuation">,</span> syscall<span class="token punctuation">.</span>SIGINT<span class="token punctuation">,</span> syscall<span class="token punctuation">.</span>SIGTERM<span class="token punctuation">)</span>
	<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// \u8BBE\u7F6E\u672C\u8FDB\u7A0B\u963B\u585E\u7B49\u5F85\u7684\u7279\u5B9A\u901A\u77E5\u4FE1\u53F7</span>
		sig <span class="token operator">:=</span> <span class="token operator">&lt;-</span>sigs <span class="token comment">// \u4ECEsigs\u901A\u9053\u8BFB\u53D6\u4FE1\u53F7\u503C\uFF0C\u963B\u585E\u7B49\u5F85\u65B9\u5F0F</span>
		logger<span class="token punctuation">.</span><span class="token function">Debugf</span><span class="token punctuation">(</span><span class="token string">&quot;sig: %s&quot;</span><span class="token punctuation">,</span> sig<span class="token punctuation">)</span>
		serve <span class="token operator">&lt;-</span> <span class="token boolean">nil</span>
	<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token comment">// \u5229\u7528goroutine \u542F\u52A8gRPC\u670D\u52A1\u5668\uFF087051\u7AEF\u53E3\uFF0C\u6CE8\u518C\u4E86Admin\u7BA1\u7406\u670D\u52A1\u5668\u3001Endorser\u80CC\u4E66\u670D\u52A1\u5668\u7B49\uFF09</span>
	<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">var</span> grpcErr <span class="token builtin">error</span>
		<span class="token keyword">if</span> grpcErr <span class="token operator">=</span> peerServer<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> grpcErr <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span> <span class="token comment">// \u76D1\u542C\u7AEF\u53E3\uFF087051\uFF09\u63D0\u4F9B\u670D\u52A1</span>
			grpcErr <span class="token operator">=</span> fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;grpc server exited with error: %s&quot;</span><span class="token punctuation">,</span> grpcErr<span class="token punctuation">)</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			logger<span class="token punctuation">.</span><span class="token function">Info</span><span class="token punctuation">(</span><span class="token string">&quot;peer server exited&quot;</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		serve <span class="token operator">&lt;-</span> grpcErr <span class="token comment">// \u82E5\u56E0\u53D1\u751F\u9519\u8BEF\u800C\u9000\u51FA\uFF0C\u5219\u53D1\u9001\u9519\u8BEF\u5230serve\u901A\u9053</span>
	<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token comment">// \u5411\u8FDB\u7A0B\u6587\u4EF6\u4E2D\u5199\u5165\u8FD0\u884C\u8FDB\u7A0BID</span>
	<span class="token keyword">if</span> err <span class="token operator">:=</span> <span class="token function">writePid</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span><span class="token function">GetPath</span><span class="token punctuation">(</span><span class="token string">&quot;peer.fileSystemPath&quot;</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;/peer.pid&quot;</span><span class="token punctuation">,</span> os<span class="token punctuation">.</span><span class="token function">Getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> err
	<span class="token punctuation">}</span>

	<span class="token comment">// Start the event hub server</span>
	<span class="token comment">// \u542F\u52A8\u57FA\u4E8E\u4E13\u7528\u4E8B\u4EF6\u76D1\u542C\u7AEF\u53E3\u7684gRPC\u670D\u52A1\u5668\uFF087053\u7AEF\u53E3\uFF0C\u5DF2\u6CE8\u518CEventHub\u4E8B\u4EF6\u670D\u52A1\u5668\uFF09</span>
	<span class="token keyword">if</span> ehubGrpcServer <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token keyword">go</span> ehubGrpcServer<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// Start profiling http endpoint if enabled</span>
	<span class="token comment">// \u5982\u679C\u6253\u5F00profile\u4F7F\u80FD\u6807\u5FD7\u4F4D\uFF0C\u5219\u542F\u52A8\u63D0\u4F9B\u670D\u52A1</span>
	<span class="token keyword">if</span> viper<span class="token punctuation">.</span><span class="token function">GetBool</span><span class="token punctuation">(</span><span class="token string">&quot;peer.profile.enabled&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// \u542F\u52A8go profile\u670D\u52A1\u5668\uFF0C\u5982\u679C\u51FA\u9519\uFF0C\u5219\u4E0D\u4F1A\u53D1\u9001\u9519\u8BEF\u4FE1\u606F\uFF0C\u53EA\u662F\u8BB0\u5F55\u5230\u65E5\u5FD7\u91CC</span>
			<span class="token comment">// \u83B7\u53D6profile\u76D1\u542C\u5730\u5740</span>
			profileListenAddress <span class="token operator">:=</span> viper<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span><span class="token string">&quot;peer.profile.listenAddress&quot;</span><span class="token punctuation">)</span>
			logger<span class="token punctuation">.</span><span class="token function">Infof</span><span class="token punctuation">(</span><span class="token string">&quot;Starting profiling server with listenAddress = %s&quot;</span><span class="token punctuation">,</span> profileListenAddress<span class="token punctuation">)</span>
			<span class="token keyword">if</span> profileErr <span class="token operator">:=</span> http<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span>profileListenAddress<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span><span class="token punctuation">;</span> profileErr <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
				logger<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;Error starting profiler: %s&quot;</span><span class="token punctuation">,</span> profileErr<span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u81F3\u6B64\uFF0CPeer\u8282\u70B9\u53CA\u5176\u529F\u80FD\u670D\u52A1\u5668\u542F\u52A8\u5B8C\u6BD5.</p><hr><h2 id="\u53C2\u8003" tabindex="-1"><a class="header-anchor" href="#\u53C2\u8003" aria-hidden="true">#</a> \u53C2\u8003</h2><blockquote><p>/</p></blockquote>`,79),o=[p];function c(i,l){return s(),a("div",null,o)}const d=n(e,[["render",c],["__file","6.hyperledger_fabric_source_Peer_node_startup.html.vue"]]);export{d as default};
