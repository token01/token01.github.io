<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="keywords" content="web3.0 åŒºå—é“¾ åŸºç¡€çŸ¥è¯† P2Pç½‘ç»œ"><meta property="og:url" content="https://bytecodes.tech/blockchain/Male_chain_research/ethereum/Etheric_fang_clique_algorithm.html"><meta property="og:site_name" content="å‡¤å‡°æ¶…æ§ƒè¿›é˜¶ä¹‹è·¯"><meta property="og:title" content="ä»¥å¤ªåŠcliqueç®—æ³•"><meta property="og:description" content="å‡¤å‡°æ¶…æ§ƒè¿›é˜¶ä¹‹è·¯ web3.0 åŒºå—é“¾ åŒºå—é“¾åŸºç¡€çŸ¥è¯†"><meta property="og:type" content="article"><meta property="og:updated_time" content="2022-12-12T06:43:36.000Z"><meta property="og:locale" content="zh-CN"><meta property="article:tag" content="æµ…è°ˆä»¥å¤ªåŠæºç åˆ†æ"><meta property="article:modified_time" content="2022-12-12T06:43:36.000Z"><meta name="robots" content="all"><meta name="author" content="Abelsun"><meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate"><meta http-equiv="Pragma" content="no-cache"><meta http-equiv="Expires" content="0"><meta name="apple-mobile-web-app-capable" content="yes"><script>
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?5230ac143650bf5eb3c14f3fb9b1d3ec";
          var s = document.getElementsByTagName("script")[0]; 
          s.parentNode.insertBefore(hm, s);
        })();
      </script><link rel="stylesheet" href="//at.alicdn.com/t/font_3180624_7cy10l7jqqh.css"><link rel="icon" href="/favicon.ico"><link rel="icon" href="/assets/icon/chrome-mask-512.png" type="image/png" sizes="512x512"><link rel="icon" href="/assets/icon/chrome-mask-192.png" type="image/png" sizes="192x192"><link rel="icon" href="/assets/icon/chrome-512.png" type="image/png" sizes="512x512"><link rel="icon" href="/assets/icon/chrome-192.png" type="image/png" sizes="192x192"><link rel="manifest" href="/manifest.webmanifest" crossorigin="use-credentials"><meta name="theme-color" content="#096dd9"><link rel="apple-touch-icon" href="/assets/icon/apple-icon-152.png"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="msapplication-TileImage" content="/assets/icon/ms-icon-144.png"><meta name="msapplication-TileColor" content="#ffffff"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"><title>ä»¥å¤ªåŠcliqueç®—æ³• | å‡¤å‡°æ¶…æ§ƒè¿›é˜¶ä¹‹è·¯</title><meta name="description" content="å‡¤å‡°æ¶…æ§ƒè¿›é˜¶ä¹‹è·¯ web3.0 åŒºå—é“¾ åŒºå—é“¾åŸºç¡€çŸ¥è¯†">
    <meta name="keywords" content="è‡ªæˆ‘æå‡,æ•ˆç‡æå‡,å¼€æºå·¥å…·,å­¦ä¹ ç¬”è®°" />
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background-color: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="stylesheet" href="/assets/style.9613470c.css">
    <link rel="modulepreload" href="/assets/app.d50e5263.js"><link rel="modulepreload" href="/assets/Etheric_fang_clique_algorithm.html.5cc85626.js"><link rel="modulepreload" href="/assets/_plugin-vue_export-helper.cdc0426e.js"><link rel="modulepreload" href="/assets/Etheric_fang_clique_algorithm.html.8915cb99.js">
    <!-- çœ‹æ¿å¨˜åŒºå— -->
    <link href="https://lf9-cdn-tos.bytecdntp.com/cdn/expire-1-y/font-awesome/6.0.0/css/all.min.css" type="text/css" rel="stylesheet" />
    <script src="/live2d-widget/autoload.js"></script>
    <!-- End çœ‹æ¿å¨˜åŒºå— -->
    <!-- Matomo æ­¤åŒºå—ä¸ºç»Ÿè®¡ä»£ç ï¼Œè¯·åˆ é™¤-->
    <script>
      var _paq = window._paq = window._paq || [];
      /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
      _paq.push(['trackPageView']);
      _paq.push(['enableLinkTracking']);
      (function() {
        var u="https://piwik.seoipo.com/";
        _paq.push(['setTrackerUrl', u+'matomo.php']);
        _paq.push(['setSiteId', '7']);
        var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
        g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
      })();
    </script>
    <!-- End Matomo Code æ­¤åŒºå—ä¸ºç»Ÿè®¡ä»£ç ï¼Œè¯·åˆ é™¤-->
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">Skip to content</a><!--]--><div class="theme-container no-sidebar has-toc"><!--[--><!--[--><header class="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><a href="/" class="brand"><img class="logo" src="/assets/icon/logo.png" alt="å‡¤å‡°æ¶…æ§ƒè¿›é˜¶ä¹‹è·¯"><!----><span class="site-name hide-in-pad">å‡¤å‡°æ¶…æ§ƒè¿›é˜¶ä¹‹è·¯</span></a><!----></div><div class="navbar-center"><!----><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/blog.html" class="nav-link" aria-label="åšå®¢"><span class="icon iconfont icon-gaishu"></span>åšå®¢<!----></a></div><div class="nav-item hide-in-mobile"><a href="/home.html" class="nav-link" aria-label="Web2.0è¿›é˜¶ä¹‹è·¯"><span class="icon iconfont icon-lujing"></span>Web2.0è¿›é˜¶ä¹‹è·¯<!----></a></div><div class="nav-item hide-in-mobile"><a href="/blockchain/" class="nav-link active" aria-label="Web3.0è¿›é˜¶ä¹‹è·¯"><span class="icon iconfont icon-lujing"></span>Web3.0è¿›é˜¶ä¹‹è·¯<!----></a></div><div class="nav-item hide-in-mobile"><a href="/learningPath/" class="nav-link" aria-label="å­¦ä¹ è·¯çº¿"><span class="icon iconfont icon-luxian"></span>å­¦ä¹ è·¯çº¿<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="çè—èµ„æº"><span class="title"><span class="icon iconfont icon-youzhi"></span>çè—èµ„æº</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/sidebar/sanfene/" class="nav-link" aria-label="é¢è¯•é€†è¢­"><span class="icon iconfont icon-zhunbei"></span>é¢è¯•é€†è¢­<!----></a></li></ul></button></div></div></nav><!----></div><div class="navbar-right"><!----><div class="nav-item"><a class="repo-link" href="https://github.com/token01/token01.github.io" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button class="outlook-button" tabindex="-1" ariahidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="outlook-dropdown"><!----></div></button></div><div id="docsearch-container"></div><!----><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->ä»¥å¤ªåŠcliqueç®—æ³•</h1><div class="page-info"><span class="author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="down" localizeddate="2022å¹´12æœˆ12æ—¥" isoriginal="false" pageview="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="author-item" href="/about-the-author/" target="_blank" rel="noopener noreferrer">Abel sun</a></span><span property="author" content="Abel sun"></span></span><!----><span class="date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="down" isoriginal="false" pageview="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span>2022å¹´12æœˆ12æ—¥</span><meta property="datePublished" content="2022-12-12T06:43:36.000Z"></span><span class="category-info" aria-label="åˆ†ç±»ğŸŒˆ" data-balloon-pos="down" localizeddate="2022å¹´12æœˆ12æ—¥" isoriginal="false" pageview="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><ul class="categories-wrapper"><li class="category category5 clickable" role="navigation">åŒºå—é“¾</li><meta property="articleSection" content="åŒºå—é“¾"></ul></span><span aria-label="æ ‡ç­¾ğŸ·" data-balloon-pos="down" localizeddate="2022å¹´12æœˆ12æ—¥" isoriginal="false" pageview="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><ul class="tags-wrapper"><li class="tag tag3 clickable" role="navigation">æµ…è°ˆä»¥å¤ªåŠæºç åˆ†æ</li></ul><meta property="keywords" content="æµ…è°ˆä»¥å¤ªåŠæºç åˆ†æ"></span><span class="words-info" aria-label="å­—æ•°ğŸ” " data-balloon-pos="down" localizeddate="2022å¹´12æœˆ12æ—¥" isoriginal="false" pageview="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon word-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="word icon"><path d="M518.217 432.64V73.143A73.143 73.143 0 01603.43 1.097a512 512 0 01419.474 419.474 73.143 73.143 0 01-72.046 85.212H591.36a73.143 73.143 0 01-73.143-73.143z"></path><path d="M493.714 566.857h340.297a73.143 73.143 0 0173.143 85.577A457.143 457.143 0 11371.566 117.76a73.143 73.143 0 0185.577 73.143v339.383a36.571 36.571 0 0036.571 36.571z"></path></svg><span>çº¦ 6750 å­—</span><meta property="wordCount" content="6750"></span><span class="reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="down" localizeddate="2022å¹´12æœˆ12æ—¥" isoriginal="false" pageview="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 23 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT23M"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">æ­¤é¡µå†…å®¹</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blockchain/Male_chain_research/ethereum/Etheric_fang_clique_algorithm.html#clique" class="router-link-active router-link-exact-active toc-link level2">clique</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blockchain/Male_chain_research/ethereum/Etheric_fang_clique_algorithm.html#æºç åˆ†æ" class="router-link-active router-link-exact-active toc-link level2">æºç åˆ†æ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blockchain/Male_chain_research/ethereum/Etheric_fang_clique_algorithm.html#cliqueåº•å±‚æœºåˆ¶" class="router-link-active router-link-exact-active toc-link level2">Cliqueåº•å±‚æœºåˆ¶</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blockchain/Male_chain_research/ethereum/Etheric_fang_clique_algorithm.html#ä¸€-cliqueæ˜¯å¦‚ä½•ç¡®å®šç­¾åè€…ä»¥åŠç­¾åæ–¹æ³•çš„" class="router-link-active router-link-exact-active toc-link level3">ä¸€ï¼šcliqueæ˜¯å¦‚ä½•ç¡®å®šç­¾åè€…ä»¥åŠç­¾åæ–¹æ³•çš„ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blockchain/Male_chain_research/ethereum/Etheric_fang_clique_algorithm.html#goè¯­æ³•è¡¥å……-comma-okæ–­è¨€" class="router-link-active router-link-exact-active toc-link level3">Goè¯­æ³•è¡¥å……ï¼šComma-okæ–­è¨€</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blockchain/Male_chain_research/ethereum/Etheric_fang_clique_algorithm.html#äºŒ-snapshotèµ·åˆ°çš„ä½œç”¨æ˜¯ä»€ä¹ˆ" class="router-link-active router-link-exact-active toc-link level3">äºŒï¼šSnapshotèµ·åˆ°çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blockchain/Male_chain_research/ethereum/Etheric_fang_clique_algorithm.html#ä¸‰-è®¤è¯ç»“ç‚¹çš„å‡ºå—æœºä¼šå‡ç­‰" class="router-link-active router-link-exact-active toc-link level3">ä¸‰ï¼šè®¤è¯ç»“ç‚¹çš„å‡ºå—æœºä¼šå‡ç­‰</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blockchain/Male_chain_research/ethereum/Etheric_fang_clique_algorithm.html#å››-å‡ºå—éš¾åº¦" class="router-link-active router-link-exact-active toc-link level3">å››ï¼šå‡ºå—éš¾åº¦</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blockchain/Male_chain_research/ethereum/Etheric_fang_clique_algorithm.html#äº”-åŒºå—æ ¡éªŒ" class="router-link-active router-link-exact-active toc-link level3">äº”ï¼šåŒºå—æ ¡éªŒ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blockchain/Male_chain_research/ethereum/Etheric_fang_clique_algorithm.html#å…­-åŸºäºæŠ•ç¥¨çš„è®¤è¯ç»“ç‚¹çš„è¿è¡Œæœºåˆ¶" class="router-link-active router-link-exact-active toc-link level3">å…­ï¼š åŸºäºæŠ•ç¥¨çš„è®¤è¯ç»“ç‚¹çš„è¿è¡Œæœºåˆ¶</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blockchain/Male_chain_research/ethereum/Etheric_fang_clique_algorithm.html#æ€»ç»“" class="router-link-active router-link-exact-active toc-link level2">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blockchain/Male_chain_research/ethereum/Etheric_fang_clique_algorithm.html#æ€»ç»“-å‚è€ƒ" class="router-link-active router-link-exact-active toc-link level2">æ€»ç»“&amp;å‚è€ƒ</a></li><!----><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><blockquote><p>ä»¥å¤ªåŠcliqueç®—æ³•</p><p>ä»£ç åˆ†æ”¯ï¼š<a href="https://github.com/ethereum/go-ethereum/tree/v1.9.9" target="_blank" rel="noopener noreferrer">https://github.com/ethereum/go-ethereum/tree/v1.9.9<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></blockquote><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gomsueveelj31ao0t6wor.jpg" alt="bca914bd89fa6439facc5a61b6e6d0a1"></p><h2 id="clique" tabindex="-1"><a class="header-anchor" href="#clique" aria-hidden="true">#</a> clique</h2><p>ä»¥å¤ªåŠçš„å®˜æ–¹å…±è¯†ç®—æ³•æ˜¯ethashç®—æ³•ï¼Œè¿™åœ¨å‰æ–‡å·²ç»æœ‰äº†è¯¦ç»†çš„åˆ†æï¼š</p><blockquote><p>å®ƒæ˜¯åŸºäºPOWçš„å…±è¯†æœºåˆ¶çš„ï¼ŒçŸ¿å·¥éœ€è¦é€šè¿‡è®¡ç®—nonceå€¼ï¼Œä¼šæ¶ˆè€—å¤§é‡ç®—åŠ›æ¥åŒ¹é…targetå€¼ã€‚</p></blockquote><p>å¦‚æœåœ¨è”ç›Ÿé“¾æˆ–è€…ç§é“¾çš„æ–¹æ¡ˆé‡Œï¼Œç»§ç»­ä½¿ç”¨ethashå°±ä¼šæµªè´¹ç®—åŠ›ï¼ŒPOWä¹Ÿæ²¡æœ‰å­˜åœ¨çš„æ„ä¹‰ã€‚æ‰€ä»¥ä»¥å¤ªåŠæœ‰äº†å¦ä¸€ç§å…±è¯†æ–¹æ¡ˆï¼šåŸºäºPOAçš„cliqueã€‚</p><blockquote><p>POA, Proof of Authorityã€‚æƒåŠ›è¯æ˜ï¼Œä¸åŒäºPOWçš„å·¥ä½œé‡è¯æ˜ï¼ŒPOAæ˜¯èƒ½å¤Ÿç›´æ¥ç¡®å®šå‡ ä¸ªèŠ‚ç‚¹å…·å¤‡å‡ºå—çš„æƒåŠ›ï¼Œè¿™å‡ ä¸ªèŠ‚ç‚¹å‡ºçš„å—ä¼šè¢«å…¨ç½‘å…¶ä»–èŠ‚ç‚¹éªŒè¯ä¸ºæœ‰æ•ˆå—ã€‚</p></blockquote><p><a href="https://github.com/evsward/blog/blob/master/posts/%E4%BB%A5%E5%A4%AA%E5%9D%8A-%E7%A7%81%E6%9C%89%E9%93%BE%E6%90%AD%E5%BB%BA%E5%88%9D%E6%AD%A5%E5%AE%9E%E8%B7%B5.md" target="_blank" rel="noopener noreferrer">å»ºç«‹ç§é“¾<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>é€šè¿‡è¿™ç¯‡æ–‡ç« çš„æ“ä½œå¯ä»¥å»ºç«‹ä¸€ä¸ªç§æœ‰é“¾ï¼Œè§‚å¯Ÿè¿™ä¸ªæµç¨‹å¯ä»¥çœ‹åˆ°ï¼Œé€šè¿‡puppethå·¥å…·å»ºç«‹åˆ›ä¸–å—æ—¶ï¼Œä¼šæç¤ºä½ é€‰æ‹©å“ªç§å…±è¯†æ–¹å¼ï¼Œæœ‰ethashå’Œcliqueä¸¤ä¸ªé€‰é¡¹ï¼Œè¯´åˆ°è¿™é‡Œæˆ‘ä»¬å°±æ˜ç™½äº†ä¸ºä»€ä¹ˆæ–‡ç« ä¸­é»˜è®¤è¦é€‰æ‹©cliqueã€‚</p><h2 id="æºç åˆ†æ" tabindex="-1"><a class="header-anchor" href="#æºç åˆ†æ" aria-hidden="true">#</a> æºç åˆ†æ</h2><p>è®²è¿‡äº†åŸºæœ¬æ¦‚å¿µï¼Œä¸‹é¢æˆ‘ä»¬æ·±å…¥ä»¥å¤ªåŠæºç æ¥ä»”ç»†åˆ†æcliqueç®—æ³•çš„å…·ä½“å®ç°ã€‚</p><p>å…¥å£ä»ç„¶é€‰æ‹©<a href="http://www.cnblogs.com/Evsward/p/miner.html#uncles%E5%8F%94%E5%9D%97%E7%9A%84%E6%A6%82%E5%BF%B5" target="_blank" rel="noopener noreferrer">sealæ–¹æ³•<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ï¼Œè¿™é‡Œä¸å‰æ–‡åˆ†æethashç®—æ³•çš„å…¥å£æ˜¯ä¿æŒä¸€è‡´çš„ï¼Œå› ä¸ºä»–ä»¬æ˜¯Sealçš„ä¸åŒå®ç°ã€‚</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>// æˆ‘ä»¬çš„æ³¨é‡Šå¯ä»¥å¯¹æ¯”ç€æ¥çœ‹ï¼Œcliqueçš„sealå‡½æ•°çš„ç›®çš„æ˜¯ï¼šå°è¯•é€šè¿‡æœ¬åœ°ç­¾åè®¤è¯ï¼ˆæƒåŠ›ç­¾åä¸è®¤è¯ï¼Œæ‰¾åˆ°æœ‰æƒåŠ›çš„ç»“ç‚¹ï¼‰æ¥åˆ›å»ºä¸€ä¸ªå·²å¯†å°çš„åŒºå—ã€‚
func (c *Clique) Seal(chain consensus.ChainReader, block *types.Block, stop &lt;-chan struct{}) (*types.Block, error) {
 header := block.Header()

 number := header.Number.Uint64()
 if number == 0 {// ä¸å…è®¸å¯†å°åˆ›ä¸–å—
  return nil, errUnknownBlock
 }
 // è·³è½¬åˆ°ä¸‹æ–¹Cliqueå¯¹è±¡çš„åˆ†æã€‚ä¸æ”¯æŒ0-periodçš„é“¾ï¼ŒåŒæ—¶æ‹’ç»å¯†å°ç©ºå—ï¼Œæ²¡æœ‰å¥–åŠ±ä½†æ˜¯èƒ½å¤Ÿæ—‹è½¬å¯†å°
 if c.config.Period == 0 &amp;&amp; len(block.Transactions()) == 0 {
  return nil, errWaitTransactions
 }
 // åœ¨æ•´ä¸ªå¯†å°åŒºå—çš„è¿‡ç¨‹ä¸­ï¼Œä¸è¦æŒæœ‰signerç­¾åè€…å­—æ®µã€‚
 c.lock.RLock() // ä¸Šé”è·å–configä¸­çš„ç­¾åè€…å’Œç­¾åæ–¹æ³•ã€‚
 signer, signFn := c.signer, c.signFn
 c.lock.RUnlock()

 snap, err := c.snapshot(chain, number-1, header.ParentHash, nil)// snapshotå‡½æ•°è§ä¸‹æ–¹åˆ†æ
    // æ ¡éªŒå¤„ç†ï¼šå¦‚æœæˆ‘ä»¬æœªç»æˆæƒå»ç­¾åäº†ä¸€ä¸ªåŒºå—
 if err != nil {
  return nil, err
 }
 if _, authorized := snap.Signers[signer]; !authorized {
  return nil, errUnauthorized
 }
 // å¦‚æœæˆ‘ä»¬æ˜¯ã€æœ€è¿‘ç­¾åè€…ã€‘çš„ä¸€å‘˜ï¼Œåˆ™ç­‰å¾…ä¸‹ä¸€ä¸ªåŒºå—ï¼Œ// è§ä¸‹æ–¹[åº•å±‚æœºåˆ¶ä¸‰](http://www.cnblogs.com/Evsward/p/clique.html#%E4%B8%89%E8%AE%A4%E8%AF%81%E7%BB%93%E7%82%B9%E7%9A%84%E5%87%BA%E5%9D%97%E6%9C%BA%E4%BC%9A%E5%9D%87%E7%AD%89)
 for seen, recent := range snap.Recents {
  if recent == signer {
   // Signerå½“å‰ç­¾åè€…åœ¨ã€æœ€è¿‘ç­¾åè€…ã€‘ä¸­ï¼Œå¦‚æœå½“å‰åŒºå—æ²¡æœ‰å‰”é™¤ä»–çš„è¯åªèƒ½ç»§ç»­ç­‰å¾…ã€‚
   if limit := uint64(len(snap.Signers)/2 + 1); number &lt; limit || seen &gt; number-limit {
    log.Info(&quot;Signed recently, must wait for others&quot;)
    &lt;-stop
    return nil, nil
   }
  }
 }
 // é€šè¿‡ä»¥ä¸Šæ ¡éªŒï¼Œåˆ°äº†è¿™é‡Œè¯´æ˜åè®®å·²ç»å…è®¸æˆ‘ä»¬æ¥ç­¾åè¿™ä¸ªåŒºå—ï¼Œç­‰å¾…æ­¤å·¥ä½œå®Œæˆ
 delay := time.Unix(header.Time.Int64(), 0).Sub(time.Now())
 if header.Difficulty.Cmp(diffNoTurn) == 0 {
  // è¿™ä¸æ˜¯æˆ‘ä»¬çš„è½®æ¬¡æ¥ç­¾åï¼Œdelay
  wiggle := time.Duration(len(snap.Signers)/2+1) * wiggleTime // wiggleTime = 500 * time.Millisecond // éšæœºæ¨å»¶ï¼Œä»è€Œå…è®¸å¹¶å‘ç­¾åï¼ˆé’ˆå¯¹æ¯ä¸ªç­¾åè€…ï¼‰
  delay += time.Duration(rand.Int63n(int64(wiggle)))

  log.Trace(&quot;Out-of-turn signing requested&quot;, &quot;wiggle&quot;, common.PrettyDuration(wiggle))
 }
 log.Trace(&quot;Waiting for slot to sign and propagate&quot;, &quot;delay&quot;, common.PrettyDuration(delay))

 select {
 case &lt;-stop:
  return nil, nil
 case &lt;-time.After(delay):
 }
 // æ ¸å¿ƒå·¥ä½œï¼šå¼€å§‹ç­¾å
 sighash, err := signFn(accounts.Account{Address: signer}, sigHash(header).Bytes())// signFnå‡½æ•°è§ä¸‹æ–¹
 if err != nil {
  return nil, err
 }
 copy(header.Extra[len(header.Extra)-extraSeal:], sighash)//å°†ç­¾åç»“æœæ›¿æ¢åŒºå—å¤´çš„Extraå­—æ®µï¼ˆä¸“é—¨æ”¯æŒè®°å½•é¢å¤–ä¿¡æ¯çš„ï¼‰

 return block.WithSeal(header), nil //é€šè¿‡åŒºå—å¤´é‡æ–°ç»„è£…ä¸€ä¸ªåŒºå—
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Cliqueå¯¹è±¡çš„åˆ†æ</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>// Cliqueæ˜¯POAå…±è¯†å¼•æ“ï¼Œè®¡åˆ’åœ¨Ropstenæ”»å‡»ä»¥åï¼Œç”¨æ¥æ”¯æŒä»¥å¤ªåŠç§æµ‹è¯•é“¾testnetï¼ˆä¹Ÿå¯ä»¥è‡ªå·±æ­å»ºè”ç›Ÿé“¾æˆ–è€…ç§æœ‰é“¾ï¼‰
type Clique struct {
 config *params.CliqueConfig // å…±è¯†å¼•æ“é…ç½®å‚æ•°ï¼Œè§ä¸‹æ–¹CliqueConfigæºç ä»‹ç»
 db     ethdb.Database       // æ•°æ®åº“ï¼Œç”¨æ¥å­˜å‚¨ä»¥åŠè·å–å¿«ç…§æ£€æŸ¥ç‚¹

 recents    *lru.ARCCache // æœ€è¿‘åŒºå—çš„å¿«ç…§ï¼Œç”¨æ¥åŠ é€Ÿå¿«ç…§é‡ç»„
 signatures *lru.ARCCache // æœ€è¿‘åŒºå—çš„ç­¾åï¼Œç”¨æ¥åŠ é€ŸæŒ–çŸ¿

 proposals map[common.Address]bool // ç›®å‰æˆ‘ä»¬æ­£åœ¨æ¨åŠ¨çš„ææ¡ˆæ¸…å•ï¼Œå­˜çš„æ˜¯åœ°å€å’Œå¸ƒå°”å€¼çš„é”®å€¼å¯¹æ˜ å°„

 signer common.Address // ç­¾åè€…çš„ä»¥å¤ªåŠåœ°å€
 signFn SignerFn       // ç­¾åæ–¹æ³•ï¼Œç”¨æ¥æˆæƒå“ˆå¸Œ
 lock   sync.RWMutex   // é”ï¼Œä¿æŠ¤ç­¾åå­—æ®µ
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>CliqueConfigæºç åˆ†æ</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>// CliqueConfigæ˜¯POAæŒ–çŸ¿çš„å…±è¯†å¼•æ“çš„é…ç½®å­—æ®µã€‚
type CliqueConfig struct {
 Period uint64 `json:&quot;period&quot;` // åœ¨åŒºå—ä¹‹é—´æ‰§è¡Œçš„ç§’æ•°(å¯ä»¥ç†è§£ä¸ºè·ç¦»ä¸Šä¸€å—å‡ºå—åçš„æµé€æ—¶é—´ç§’æ•°)
 Epoch  uint64 `json:&quot;epoch&quot;`  // Epoch[&#39;iËpÉ’k]é•¿åº¦ï¼Œé‡ç½®æŠ•ç¥¨å’Œæ£€æŸ¥ç‚¹
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>snapshotå‡½æ•°åˆ†æ</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>// snapshotå‡½æ•°å¯é€šè¿‡ç»™å®šç‚¹è·å–è®¤è¯å¿«ç…§
func (c *Clique) snapshot(chain consensus.ChainReader, number uint64, hash common.Hash, parents []*types.Header) (*Snapshot, error) {
 // åœ¨å†…å­˜æˆ–ç£ç›˜ä¸Šæœç´¢ä¸€ä¸ªå¿«ç…§ä»¥æ£€æŸ¥æ£€æŸ¥ç‚¹ã€‚
 var (
  headers []*types.Header// åŒºå—å¤´
  snap    *Snapshot// å¿«ç…§å¯¹è±¡ï¼Œè§ä¸‹æ–¹
 )
 for snap == nil {
  // å¦‚æœæ‰¾åˆ°ä¸€ä¸ªå†…å­˜é‡Œçš„å¿«ç…§ï¼Œä½¿ç”¨ä»¥ä¸‹æ–¹æ¡ˆï¼š
  if s, ok := c.recents.Get(hash); ok {
   snap = s.(*Snapshot)
   break
  }
  // å¦‚æœä¸€ä¸ªåœ¨ç£ç›˜æ£€æŸ¥ç‚¹çš„å¿«ç…§è¢«æ‰¾åˆ°ï¼Œä½¿ç”¨ä»¥ä¸‹æ–¹æ¡ˆï¼š
  if number%checkpointInterval == 0 {// checkpointInterval = 1024 // åŒºå—å·ï¼Œåœ¨æ•°æ®åº“ä¸­ä¿å­˜æŠ•ç¥¨å¿«ç…§çš„åŒºå—ã€‚
   if s, err := loadSnapshot(c.config, c.signatures, c.db, hash); err == nil {// loadSnapshotå‡½æ•°è§ä¸‹æ–¹
    log.Trace(&quot;Loaded voting snapshot form disk&quot;, &quot;number&quot;, number, &quot;hash&quot;, hash)
    snap = s
    break
   }
  }
  // å¦‚æœæˆ‘ä»¬åœ¨åˆ›ä¸–å—ï¼Œåˆ™åšä¸€ä¸ªå¿«ç…§
  if number == 0 {
   genesis := chain.GetHeaderByNumber(0)
   if err := c.VerifyHeader(chain, genesis, false); err != nil {
    return nil, err
   }
   signers := make([]common.Address, (len(genesis.Extra)-extraVanity-extraSeal)/common.AddressLength)
   for i := 0; i &lt; len(signers); i++ {
    copy(signers[i][:], genesis.Extra[extraVanity+i*common.AddressLength:])
   }
   snap = newSnapshot(c.config, c.signatures, 0, genesis.Hash(), signers)// åˆ›å»ºä¸€ä¸ªæ–°çš„å¿«ç…§çš„å‡½æ•°ï¼Œè§ä¸‹æ–¹
   if err := snap.store(c.db); err != nil {
    return nil, err
   }
   log.Trace(&quot;Stored genesis voting snapshot to disk&quot;)
   break
  }
  // æ²¡æœ‰é’ˆå¯¹è¿™ä¸ªåŒºå—å¤´çš„å¿«ç…§ï¼Œåˆ™æ”¶é›†åŒºå—å¤´å¹¶å‘åç§»åŠ¨
  var header *types.Header
  if len(parents) &gt; 0 {
   // å¦‚æœæˆ‘ä»¬æœ‰æ˜ç¡®çš„çˆ¶ç±»ï¼Œä»è¿™é‡Œå¼ºåˆ¶æŒ‘æ‹£å‡ºæ¥ã€‚
   header = parents[len(parents)-1]
   if header.Hash() != hash || header.Number.Uint64() != number {
    return nil, consensus.ErrUnknownAncestor
   }
   parents = parents[:len(parents)-1]
  } else {
   // å¦‚æœæ²¡æœ‰æ˜ç¡®çˆ¶ç±»ï¼ˆæˆ–è€…æ²¡æœ‰æ›´å¤šçš„ï¼‰ï¼Œåˆ™è½¬åˆ°æ•°æ®åº“
   header = chain.GetHeader(hash, number)
   if header == nil {
    return nil, consensus.ErrUnknownAncestor
   }
  }
  headers = append(headers, header)
  number, hash = number-1, header.ParentHash
 }
 // æ‰¾åˆ°äº†å…ˆå‰çš„å¿«ç…§ï¼Œé‚£ä¹ˆå°†æ‰€æœ‰pendingçš„åŒºå—å¤´éƒ½æ”¾åœ¨å®ƒçš„ä¸Šé¢ã€‚
 for i := 0; i &lt; len(headers)/2; i++ {
  headers[i], headers[len(headers)-1-i] = headers[len(headers)-1-i], headers[i]
 }
 snap, err := snap.apply(headers)//é€šè¿‡åŒºå—å¤´ç”Ÿæˆä¸€ä¸ªæ–°çš„snapshotå¯¹è±¡
 if err != nil {
  return nil, err
 }
 c.recents.Add(snap.Hash, snap)//å°†å½“å‰å¿«ç…§åŒºå—çš„hashå­˜åˆ°recentsä¸­ã€‚

 // å¦‚æœæˆ‘ä»¬ç”Ÿæˆäº†ä¸€ä¸ªæ–°çš„æ£€æŸ¥ç‚¹å¿«ç…§ï¼Œä¿å­˜åˆ°ç£ç›˜ä¸Šã€‚
 if snap.Number%checkpointInterval == 0 &amp;&amp; len(headers) &gt; 0 {
  if err = snap.store(c.db); err != nil {
   return nil, err
  }
  log.Trace(&quot;Stored voting snapshot to disk&quot;, &quot;number&quot;, snap.Number, &quot;hash&quot;, snap.Hash)
 }
 return snap, err
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Snapshotå¯¹è±¡æºç åˆ†æï¼š</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>// Snapshotå¯¹è±¡æ˜¯åœ¨ç»™å®šç‚¹çš„ä¸€ä¸ªè®¤è¯æŠ•ç¥¨çš„çŠ¶æ€
type Snapshot struct {
 config   *params.CliqueConfig // é…ç½®å‚æ•°
 sigcache *lru.ARCCache        // ç­¾åç¼“å­˜ï¼Œæœ€è¿‘çš„åŒºå—ç­¾ååŠ é€Ÿæ¢å¤ã€‚

 Number  uint64                      `json:&quot;number&quot;`  // å¿«ç…§å»ºç«‹çš„åŒºå—å·
 Hash    common.Hash                 `json:&quot;hash&quot;`    // å¿«ç…§å»ºç«‹çš„åŒºå—å“ˆå¸Œ
 Signers map[common.Address]struct{} `json:&quot;signers&quot;` // å½“ä¸‹è®¤è¯ç­¾åè€…çš„é›†åˆ
 Recents map[uint64]common.Address   `json:&quot;recents&quot;` // æœ€è¿‘ç­¾ååŒºå—åœ°å€çš„é›†åˆ
 Votes   []*Vote                     `json:&quot;votes&quot;`   // æŒ‰æ—¶é—´é¡ºåºæ’åˆ—çš„æŠ•ç¥¨åå•ã€‚
 Tally   map[common.Address]Tally    `json:&quot;tally&quot;`   // å½“å‰çš„æŠ•ç¥¨ç»“æœï¼Œé¿å…é‡æ–°è®¡ç®—ã€‚
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>loadSnapshotå‡½æ•°æºç åˆ†æï¼š</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>// loadSnapshotå‡½æ•°ç”¨æ¥ä»æ•°æ®åº“ä¸­åŠ è½½ä¸€ä¸ªç°å­˜çš„å¿«ç…§ï¼Œå‚æ•°åˆ—è¡¨ä¸­å¾ˆå¤šéƒ½æ˜¯Snapshotå¯¹è±¡çš„å…³é”®å­—æ®µå±æ€§ã€‚
func loadSnapshot(config *params.CliqueConfig, sigcache *lru.ARCCache, db ethdb.Database, hash common.Hash) (*Snapshot, error) {
 blob, err := db.Get(append([]byte(&quot;clique-&quot;), hash[:]...))// ethdbä½¿ç”¨çš„æ˜¯leveldbï¼Œå¯¹å¤–å¼€æ”¾æ¥å£Dababaseè§ä¸‹æ–¹
 if err != nil {
  return nil, err
 }
 snap := new(Snapshot)
 if err := json.Unmarshal(blob, snap); err != nil {
  return nil, err
 }
 snap.config = config
 snap.sigcache = sigcache

 return snap, nil
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ethdbæ•°æ®åº“å¯¹å¤–å¼€æ”¾æ¥å£ï¼š</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>// Databaseæ¥å£åŒ…è£¹äº†æ‰€æœ‰çš„æ•°æ®åº“ç›¸å…³æ“ä½œï¼Œæ‰€æœ‰çš„æ–¹æ³•éƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚
type Database interface {
 Putter
 Get(key []byte) ([]byte, error)//é€šè¿‡æŸkeyè·å–å€¼
 Has(key []byte) (bool, error)//æŸkeyæ˜¯å¦åŒ…å«æœ‰æ•ˆå€¼
 Delete(key []byte) error
 Close()
 NewBatch() Batch
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>newSnapshotå‡½æ•°æºç ï¼š</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>// newSnapshotå‡½æ•°åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„å¿«ç…§ï¼Œé€šè¿‡ç»™å‡ºçš„ç‰¹å®šçš„å¯åŠ¨å‚æ•°ã€‚è¿™ä¸ªæ–¹æ³•æ²¡æœ‰åˆå§‹åŒ–æœ€è¿‘ç­¾åè€…çš„é›†åˆï¼Œæ‰€ä»¥åªæœ‰ä½¿ç”¨åˆ›ä¸–å—ã€‚
func newSnapshot(config *params.CliqueConfig, sigcache *lru.ARCCache, number uint64, hash common.Hash, signers []common.Address) *Snapshot {
 snap := &amp;Snapshot{// å°±æ˜¯ç»„è£…ä¸€ä¸ªSnapshotå¯¹è±¡ï¼Œå®‰è£…ç›¸åº”å‚æ•°
  config:   config,
  sigcache: sigcache,
  Number:   number,
  Hash:     hash,
  Signers:  make(map[common.Address]struct{}),
  Recents:  make(map[uint64]common.Address),
  Tally:    make(map[common.Address]Tally),
 }
 for _, signer := range signers {
  snap.Signers[signer] = struct{}{}
 }
 return snap
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>signFnå‡½æ•°ï¼š</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>// SignerFnæ˜¯ä¸€ä¸ªç­¾åè€…çš„å›è°ƒå‡½æ•°ï¼Œç”¨æ¥è¯·æ±‚ä¸€ä¸ªèƒ½å¤Ÿè¢«åå°è´¦æˆ·ç­¾åç”Ÿæˆçš„å“ˆå¸Œ
type SignerFn func(accounts.Account, []byte) ([]byte, error)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>cliqueå¸¸é‡é…ç½®ï¼š</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>blockPeriod = uint64(15)    // cliqueè§„å®šï¼Œä¸¤ä¸ªåŒºå—çš„ç”Ÿæˆæ—¶é—´è‡³å°‘é—´éš”15ç§’ï¼Œtimestampç±»å‹ã€‚
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="cliqueåº•å±‚æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#cliqueåº•å±‚æœºåˆ¶" aria-hidden="true">#</a> Cliqueåº•å±‚æœºåˆ¶</h2><p>åœ¨è¿›å…¥å…±è¯†å¼•æ“ä¹‹å‰ï¼Œå½“å‰ç»“ç‚¹å·²ç»ç”Ÿæˆäº†ä¸€ä¸ªå®Œæ•´çš„åŒºå—ï¼ŒåŒ…æ‹¬åŒºå—å¤´å’Œå¯†å°çš„äº¤æ˜“åˆ—è¡¨ï¼Œç„¶åè¿›å…¥sealå‡½æ•°ï¼Œé€šè¿‡ethashæˆ–è€…cliqueç®—æ³•å¼•æ“æ¥æ“ä½œå‡ºå—ç¡®æƒã€‚æœ¬æ–‡é‡ç‚¹è®²è¿°äº†é’ˆå¯¹cliqueç®—æ³•çš„æºç åˆ†æï¼Œcliqueç®—æ³•åŸºäºPOAå…±è¯†ï¼Œæ˜¯åœ¨ç»“ç‚¹ä¸­æ‰¾å‡ºæœ‰æƒåŠ›çš„å‡ ä¸ªâ€œè¶…çº§ç»“ç‚¹â€ï¼Œåªæœ‰è¿™äº›ç»“ç‚¹å¯ä»¥ç”Ÿæˆåˆæ³•åŒºå—ï¼Œå…¶ä»–ç»“ç‚¹çš„å‡ºå—éƒ½ä¼šç›´æ¥ä¸¢å¼ƒã€‚</p><h3 id="ä¸€-cliqueæ˜¯å¦‚ä½•ç¡®å®šç­¾åè€…ä»¥åŠç­¾åæ–¹æ³•çš„" tabindex="-1"><a class="header-anchor" href="#ä¸€-cliqueæ˜¯å¦‚ä½•ç¡®å®šç­¾åè€…ä»¥åŠç­¾åæ–¹æ³•çš„" aria-hidden="true">#</a> ä¸€ï¼šcliqueæ˜¯å¦‚ä½•ç¡®å®šç­¾åè€…ä»¥åŠç­¾åæ–¹æ³•çš„ï¼Ÿ</h3><p>æˆ‘åœ¨cliqueæ–‡ä»¶ä¸­æœç´¢ï¼Œå‘ç°æœ‰ä¸€ä¸ªæ–¹æ³•åšäº†è¿™ä¸ªå·¥ä½œï¼š</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>// Authorizeå‡½æ•°æ³¨å…¥å…±è¯†å¼•æ“cliqueä¸€ä¸ªç§é’¥åœ°å€ï¼ˆç­¾åè€…ï¼‰ä»¥åŠç­¾åæ–¹æ³•signFnï¼Œç”¨æ¥æŒ–çŸ¿æ–°å—
func (c *Clique) Authorize(signer common.Address, signFn SignerFn) {
 c.lock.Lock()
 defer c.lock.Unlock()

 c.signer = signer
 c.signFn = signFn
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é‚£ä¹ˆç»§ç»­æœç´¢ï¼Œè¯¥å‡½æ•°æ˜¯åœ¨ä½•æ—¶è¢«è°ƒç”¨çš„ï¼Œæ‰¾åˆ°äº†ä½äº/eth/backend.goä¸­çš„å‡½æ•°StartMiningï¼š</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>func (s *Ethereum) StartMining(local bool) error {
 eb, err := s.Etherbase()// ç”¨æˆ·åœ°å€
 if err != nil {
  log.Error(&quot;Cannot start mining without etherbase&quot;, &quot;err&quot;, err)//æœªæ‰¾åˆ°ä»¥å¤ªè´¦æˆ·åœ°å€ï¼ŒæŠ¥é”™
  return fmt.Errorf(&quot;etherbase missing: %v&quot;, err)
 }
 // å¦‚æœæ˜¯cliqueå…±è¯†ç®—æ³•ï¼Œåˆ™èµ°ifåˆ†æ”¯ï¼Œå¦‚æœæ˜¯ethashåˆ™è·³è¿‡ifã€‚
 if clique, ok := s.engine.(*clique.Clique); ok {// Comma-okæ–­è¨€è¯­æ³•è§ä¸‹æ–¹åˆ†æã€‚
  wallet, err := s.accountManager.Find(accounts.Account{Address: eb})// é€šè¿‡ç”¨æˆ·åœ°å€è·å¾—walletå¯¹è±¡
  if wallet == nil || err != nil {
   log.Error(&quot;Etherbase account unavailable locally&quot;, &quot;err&quot;, err)
   return fmt.Errorf(&quot;signer missing: %v&quot;, err)
  }
  clique.Authorize(eb, wallet.SignHash)//åœ¨è¿™é‡Œï¼æ³¨å…¥äº†ç­¾åè€…ä»¥åŠé€šè¿‡walletå¯¹è±¡è·å–åˆ°ç­¾åæ–¹æ³•
 }
 if local {
  // å¦‚æœæœ¬åœ°CPUæŒ–çŸ¿å·²å¯åŠ¨ï¼Œæˆ‘ä»¬å¯ä»¥ç¦æ­¢æ³¨å…¥æœºåˆ¶ä»¥åŠ é€ŸåŒæ­¥æ—¶é—´ã€‚
  // CPUæŒ–çŸ¿åœ¨ä¸»ç½‘æ˜¯è’è¯çš„ï¼Œæ‰€ä»¥æ²¡æœ‰äººèƒ½ç¢°åˆ°è¿™ä¸ªè·¯å¾„ï¼Œç„¶è€Œä¸€æ—¦CPUæŒ–çŸ¿åŒæ­¥æ ‡å¿—å®Œæˆä»¥åï¼Œå°†ä¿è¯ç§ç½‘å·¥ä½œä¹Ÿåœ¨ä¸€ä¸ªç‹¬ç«‹çŸ¿å·¥ç»“ç‚¹ã€‚
  atomic.StoreUint32(&amp;s.protocolManager.acceptTxs, 1)
 }
 go s.miner.Start(eb)//å¹¶å‘å¯åŠ¨æŒ–çŸ¿å·¥ä½œ
 return nil
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æœ€ç»ˆï¼Œé€šè¿‡miner.Start(eb)ï¼Œè°ƒç”¨åˆ°work -&gt; agent -&gt; CPUAgent -&gt; update -&gt; sealï¼Œå›åˆ°æœ€ä¸Šæ–¹æˆ‘ä»¬çš„å…¥å£ã€‚</p><blockquote><p>è¿™é‡Œè¦è¡¥å……ä¸€ç‚¹ï¼Œ<a href="http://www.cnblogs.com/Evsward/p/miner.html" target="_blank" rel="noopener noreferrer">æŒ–çŸ¿æœºåˆ¶<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>æ˜¯ä»miner.start()ä½œä¸ºå…¥å£å¼€å§‹åˆ†æçš„ï¼Œè€Œä¸Šé¢çš„StartMiningå‡½æ•°æ˜¯åœ¨miner.start()ä¹‹å‰çš„ã€‚è¿™æ ·å°±æŠŠæ•´ä¸ªè¿™ä¸€æ¡çº¿ä¸²èµ·æ¥äº†ã€‚</p></blockquote><h3 id="goè¯­æ³•è¡¥å……-comma-okæ–­è¨€" tabindex="-1"><a class="header-anchor" href="#goè¯­æ³•è¡¥å……-comma-okæ–­è¨€" aria-hidden="true">#</a> Goè¯­æ³•è¡¥å……ï¼šComma-okæ–­è¨€</h3><blockquote><p>if clique, ok := s.engine.(*clique.Clique); ok {</p></blockquote><p>è¿™æ®µè¯­å¥å¾ˆä»¤äººè¿·æƒ‘ï¼Œç»è¿‡æœæŸ¥ï¼Œä»¥ä¸Šè¯­æ³•è¢«ç§°ä½œComma-okæ–­è¨€ã€‚</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>value, ok = element.(T)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>valueæ˜¯elementå˜é‡çš„å€¼ï¼Œokæ˜¯å¸ƒå°”ç±»å‹ç”¨æ¥è¡¨è¾¾æ–­è¨€ç»“æœï¼Œelementæ˜¯æ¥å£å˜é‡ï¼ŒTæ˜¯æ–­è¨€ç±»å‹ã€‚</p><p>å¥—å…¥ä»¥ä¸Šä»£ç æ®µï¼Œç¿»è¯‘è¿‡æ¥å³ï¼š</p><blockquote><p>å¦‚æœs.engineæ˜¯Cliqueç±»å‹ï¼Œåˆ™okä¸ºtrueï¼ŒåŒæ—¶cliqueå°±ç­‰äºs.engineã€‚</p></blockquote><h3 id="äºŒ-snapshotèµ·åˆ°çš„ä½œç”¨æ˜¯ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#äºŒ-snapshotèµ·åˆ°çš„ä½œç”¨æ˜¯ä»€ä¹ˆ" aria-hidden="true">#</a> äºŒï¼šSnapshotèµ·åˆ°çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>Snapshotå¯¹è±¡åœ¨Sealæ–¹æ³•ä¸­æ˜¯é€šè¿‡è°ƒç”¨snapshotæ„é€ å‡½æ•°æ¥è·å–åˆ°çš„ã€‚è€Œsnapshotæ„é€ å‡½æ•°å†…éƒ¨æœ‰è¾ƒé•¿çš„å‡½æ•°ä½“ï¼ŒåŒ…æ‹¬newSnapshotæ–¹æ³•ä»¥åŠloadSnapshotæ–¹æ³•çš„å¤„ç†ã€‚ä»è¿™ä¸ªåˆ†ææ¥çœ‹ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥çŸ¥é“Snapshotæ˜¯å¿«ç…§ï¼Œä¹Ÿæ˜¯ç¼“å­˜çš„ä¸€ç§æœºåˆ¶ï¼ŒåŒæ—¶å®ƒä¹Ÿä¸ä»…ä»…æ˜¯ç¼“å­˜ï¼Œå› ä¸ºå®ƒå­˜å‚¨äº†æœ€è¿‘ç­¾åè€…çš„mapé›†åˆã€‚</p><blockquote><p>Snapshotå¯ä»¥ä»å†…å­˜ï¼ˆå³ç¨‹åºä¸­çš„å˜é‡ï¼‰æˆ–æ˜¯ç£ç›˜ä¸Šï¼ˆå³é€šè¿‡æ•°æ®åº“leveldbï¼‰è·å–æˆ–è€…å­˜å‚¨ï¼Œå®é™…ä¸Šè¿™å°±æ˜¯äºŒçº§ç¼“å­˜çš„æ¦‚å¿µäº†ã€‚</p></blockquote><h3 id="ä¸‰-è®¤è¯ç»“ç‚¹çš„å‡ºå—æœºä¼šå‡ç­‰" tabindex="-1"><a class="header-anchor" href="#ä¸‰-è®¤è¯ç»“ç‚¹çš„å‡ºå—æœºä¼šå‡ç­‰" aria-hidden="true">#</a> ä¸‰ï¼šè®¤è¯ç»“ç‚¹çš„å‡ºå—æœºä¼šå‡ç­‰</h3><p>é¦–å…ˆå°†ä¸Šæ–‡Sealæ–¹æ³•çš„æºç é—ç•™ä»£ç æ®µå±•ç¤ºå¦‚ä¸‹ã€‚</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>for seen, recent := range snap.Recents {
 if recent == signer {
  if limit := uint64(len(snap.Signers)/2 + 1); number &lt; limit || seen &gt; number-limit {
   log.Info(&quot;Signed recently, must wait for others&quot;)
   &lt;-stop
   return nil, nil
  }
 }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å…¶ä¸­</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>if recent == signer {
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å¦‚æœå½“å‰ç»“ç‚¹æœ€è¿‘ç­¾åè¿‡ï¼Œåˆ™è·³è¿‡ï¼Œä¸ºä¿è¯<strong>æœºä¼šå‡ç­‰</strong>ï¼Œé¿å…æŸä¸ªè®¤è¯ç»“ç‚¹å¯ä»¥è¿ç»­å‡ºå—ï¼Œä»è€Œä½œæ¶ã€‚</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>if limit := uint64(len(snap.Signers)/2 + 1); number &lt; limit || seen &gt; number-limit {
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å®é™…ä¸Šåˆ°äº†è¿™é‡Œå°±å·²ç»åœ¨å†³å®šå‡ºå—æƒäº†ã€‚æˆ‘ä»¬ä¾æ¬¡æ¥çœ‹ï¼Œ</p><ul><li>snap.Signersæ˜¯æ‰€æœ‰çš„è®¤è¯ç»“ç‚¹ã€‚</li><li>limitçš„å€¼æ˜¯æ‰€æœ‰è®¤è¯ç»“ç‚¹çš„æ•°é‡çš„ä¸€åŠåŠ 1ï¼Œä¹Ÿå°±æ˜¯è¯´å¯ä»¥ä¿è¯limit&gt;50%å¥½çš„è®¤è¯ç»“ç‚¹ä¸ªæ•°ï¼ˆå®‰å…¨æ€§è€ƒè™‘ï¼šæŒæ¡å¤§äº50%çš„æ§åˆ¶æƒï¼‰ã€‚<strong>ç»“åˆä¸Šé¢çš„æœºä¼šå‡ç­‰ï¼Œcliqueè¦æ±‚è®¤è¯ç»“ç‚¹åœ¨æ¯è½®limitä¸ªåŒºå—ä¸­åªèƒ½ç”Ÿæˆä¸€ä¸ªåŒºå—ã€‚</strong></li><li>numberæ˜¯å½“å‰åŒºå—å·</li><li>seenæ˜¯ â€œfor seen, recent := range snap.Recents {â€ ä¸­Recentsçš„indexï¼Œä»0å¼€å§‹ï¼Œæœ€å¤§å€¼ä¸ºRecentsçš„æ€»æ•°-1ã€‚</li></ul><p>æ¥ç€ï¼Œæˆ‘ä»¬æ¥åˆ†ææ§åˆ¶ç¨‹åºä¸­æ­¢çš„æ¡ä»¶è¡¨è¾¾å¼ï¼š</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>number &lt; limit || seen &gt; number-limit
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>number &lt; limit, å¦‚æœåŒºå—é«˜åº¦å°äºlimit</li><li>seen &gt; number - limitï¼Œç¼“å­˜ä¸­æœ€è¿‘ç­¾å‘è€…åºå·å·²ç»è¶…è¿‡äº†åŒºå—é«˜åº¦ä¸limitä¹‹å·®ã€‚number-limitæ˜¯æœ€å¤šçš„åèŠ‚ç‚¹ï¼Œç´¢å¼•seenå¤§äºåèŠ‚ç‚¹ä¹Ÿè¦ä¸­æ–­ï¼ˆ<strong>TODO: numberåŒºå—é«˜åº¦ä¸è®¤è¯ç»“ç‚¹çš„å…³ç³»</strong>ï¼‰</li></ul><p>åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œä¼šä¸­æ–­ç¨‹åºï¼Œåœæ­¢ç­¾åä»¥åŠå‡ºå—æ“ä½œã€‚</p><h3 id="å››-å‡ºå—éš¾åº¦" tabindex="-1"><a class="header-anchor" href="#å››-å‡ºå—éš¾åº¦" aria-hidden="true">#</a> å››ï¼šå‡ºå—éš¾åº¦</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>// inturnå‡½æ•°é€šè¿‡ç»™å®šçš„åŒºå—é«˜åº¦å’Œç­¾å‘è€…è¿”å›è¯¥ç­¾å‘è€…æ˜¯å¦åœ¨è½®æ¬¡å†…
func (s *Snapshot) inturn(number uint64, signer common.Address) bool {
    // æ–¹æ³•ä½“çš„å†…å®¹å°±æ˜¯åŒºå—é«˜åº¦ä¸è®¤è¯ç­¾å‘è€…é›†åˆé•¿åº¦çš„ä½™æ•°æ˜¯å¦ç­‰äºè¯¥ç­¾å‘è€…çš„ä¸‹æ ‡å€¼
 signers, offset := s.signers(), 0
 for offset &lt; len(signers) &amp;&amp; signers[offset] != signer {
  offset++
 }
 return (number % uint64(len(signers))) == uint64(offset)
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>ä¸€å¥è¯ï¼Œcliqueè¦æ±‚ç­¾å‘è€…å¿…é¡»æŒ‰ç…§å…¶åœ¨snapshotä¸­çš„è®¤è¯ç­¾å‘è€…é›†åˆæŒ‰ç…§å­—å…¸æ’åºçš„é¡ºåºå‡ºå—ã€‚</p></blockquote><p>ç¬¦åˆä»¥ä¸Šæ¡ä»¶çš„è¯ï¼Œéš¾åº¦ä¸º2ï¼Œå¦åˆ™ä¸º1ã€‚</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>diffInTurn = big.NewInt(2) // ç­¾ååœ¨è½®æ¬¡å†…çš„åŒºå—éš¾åº¦ä¸º2ã€‚
diffNoTurn = big.NewInt(1) // ç­¾åæœªåœ¨è½®æ¬¡å†…çš„åŒºå—éš¾åº¦ä¸º1ã€‚
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>cliqueçš„å‡ºå—éš¾åº¦æ¯”è¾ƒå®¹æ˜“ç†è§£ï¼Œè¿™æ˜¯åœ¨POWä¸­å¤§ä¹¦ç‰¹ä¹¦çš„éƒ¨åˆ†ä½†åœ¨cliqueä¸­å´ååˆ†ç®€å•ï¼Œå½“inturnçš„ç»“ç‚¹ç¦»çº¿æ—¶ï¼Œå…¶ä»–ç»“ç‚¹ä¼šæ¥ç«äº‰ï¼Œéš¾åº¦å€¼é™ä¸º1ã€‚ç„¶è€Œæ­£å¸¸å‡ºå—æ—¶ï¼Œlimitä¸­çš„æ‰€æœ‰è®¤è¯ç»“ç‚¹åŒ…æ‹¬ä¸€ä¸ªinturnå’Œå…¶ä»–noturnçš„ç»“ç‚¹ï¼Œcliqueæ˜¯é‡‡ç”¨äº†ç»™noturnåŠ å»¶è¿Ÿæ—¶é—´çš„æ–¹å¼æ¥æ”¯æŒinturné¦–å…ˆå‡ºå—ï¼Œé¿å…noturnçš„ç»“ç‚¹æ— è°“ç”ŸæˆåŒºå—ã€‚è¿™éƒ¨åˆ†ä»£ç åœ¨ä¸‹é¢å†è´´ä¸€æ¬¡ã€‚</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>wiggle := time.Duration(len(snap.Signers)/2+1) * wiggleTime // wiggleTime = 500 * time.Millisecond // éšæœºæ¨å»¶ï¼Œä»è€Œå…è®¸å¹¶å‘ç­¾åï¼ˆé’ˆå¯¹æ¯ä¸ªç­¾åè€…ï¼‰
delay += time.Duration(rand.Int63n(int64(wiggle)))
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>cliqueè®¤å¯éš¾åº¦å€¼æœ€é«˜çš„é“¾ä¸ºä¸»é“¾ï¼Œæ‰€ä»¥å®Œå…¨inturnç»“ç‚¹å‡ºçš„å—ç»„æˆçš„é“¾ä¼šæ˜¯æœ€ç†æƒ³çš„ä¸»é“¾ã€‚</p></blockquote><h3 id="äº”-åŒºå—æ ¡éªŒ" tabindex="-1"><a class="header-anchor" href="#äº”-åŒºå—æ ¡éªŒ" aria-hidden="true">#</a> äº”ï¼šåŒºå—æ ¡éªŒ</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>// åŒæ ·ä½äºcliqueæ–‡ä»¶ä¸­çš„verifySealå‡½æ•°ï¼Œé¡¾åæ€ä¹‰æ˜¯ç»“ç‚¹ç”¨æ¥æ ¡éªŒåˆ«çš„ç»“ç‚¹å¹¿æ’­è¿‡æ¥çš„åŒºå—ä¿¡æ¯çš„ã€‚
func (c *Clique) verifySeal(chain consensus.ChainReader, header *types.Header, parents []*types.Header) error {
 // åˆ›ä¸–å—çš„è¯ä¸æ ¡éªŒ
 number := header.Number.Uint64()
 if number == 0 {
  return errUnknownBlock
 }
 // å–åˆ°æ‰€éœ€snapshotå¯¹è±¡ï¼Œç”¨æ¥æ ¡éªŒåŒºå—å¤´å¹¶ä¸”å°†å…¶ç¼“å­˜ã€‚
 snap, err := c.snapshot(chain, number-1, header.ParentHash, parents)
 if err != nil {
  return err
 }

 // å¤„ç†æˆæƒç§˜é’¥ï¼Œæ£€æŸ¥æ˜¯å¦è¿èƒŒè®¤è¯ç­¾åè€…é›†åˆ
 signer, err := ecrecover(header, c.signatures)// ä»åŒºå—å¤´ä¸­è§£å¯†å‡ºExtraå­—æ®µï¼Œæ‰¾åˆ°ç­¾åå­—ç¬¦ä¸²ï¼Œè·å¾—ç­¾åè€…åœ°å€ä¿¡æ¯ã€‚å¯ä»¥è·³è½¬åˆ°ä¸‹é¢ecrecoverå‡½æ•°çš„æºç åˆ†æã€‚
 if err != nil {
  return err
 }
 if _, ok := snap.Signers[signer]; !ok {
  return errUnauthorized
 }
    // ä¸Sealç›¸åŒçš„å¤„ç†ï¼Œæœºä¼šå‡ç­‰
 for seen, recent := range snap.Recents {
  if recent == signer {
   if limit := uint64(len(snap.Signers)/2 + 1); seen &gt; number-limit {
    return errUnauthorized
   }
  }
 }
 // åŒºåˆ†æ˜¯å¦inturnï¼Œè®¾ç½®åŒºå—å›°éš¾åº¦ï¼Œä¸Šé¢ä¹Ÿä»‹ç»è¿‡äº†ã€‚
 inturn := snap.inturn(header.Number.Uint64(), signer)
 if inturn &amp;&amp; header.Difficulty.Cmp(diffInTurn) != 0 {
  return errInvalidDifficulty
 }
 if !inturn &amp;&amp; header.Difficulty.Cmp(diffNoTurn) != 0 {
  return errInvalidDifficulty
 }
 return nil
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ecrecoverå‡½æ•°çš„æºç åˆ†æï¼š</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>// ecrecoverå‡½æ•°ä»ä¸€ä¸ªç­¾åçš„åŒºå—å¤´ä¸­è§£å‹å‡ºä»¥å¤ªåŠè´¦æˆ·åœ°å€
func ecrecover(header *types.Header, sigcache *lru.ARCCache) (common.Address, error) {
 // å¦‚æœç­¾åå·²ç»è¢«ç¼“å­˜ï¼Œè¿”å›å®ƒã€‚
 hash := header.Hash()
 if address, known := sigcache.Get(hash); known {
  return address.(common.Address), nil
 }
 // ä»åŒºå—å¤´çš„Extraå­—æ®µå–å¾—ç­¾åå†…å®¹ã€‚
 if len(header.Extra) &lt; extraSeal {
  return common.Address{}, errMissingSignature
 }
 signature := header.Extra[len(header.Extra)-extraSeal:]

 // é€šè¿‡å¯†ç å­¦æŠ€æœ¯ä»ç­¾åå†…å®¹ä¸­è§£å¯†å‡ºå…¬é’¥å’Œä»¥å¤ªåŠåœ°å€ã€‚
 pubkey, err := crypto.Ecrecover(sigHash(header).Bytes(), signature)// å…·ä½“æºç è§ä¸‹æ–¹
 if err != nil {
  return common.Address{}, err
 }
 var signer common.Address
 copy(signer[:], crypto.Keccak256(pubkey[1:])[12:])//å°†å…¬é’¥åˆ©ç”¨keccak256è§£å¯†èµ‹å€¼ç»™signerã€‚

 sigcache.Add(hash, signer)//åŠ å…¥ç¼“å­˜
 return signer, nil
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>cryptoåŒ…çš„Ecrecoverå‡½æ•°ï¼š</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>func Ecrecover(hash, sig []byte) ([]byte, error) {
 return secp256k1.RecoverPubkey(hash, sig)
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Ecrecoverå‡½æ•°æ˜¯ä½¿ç”¨secp256k1æ¥è§£å¯†å…¬é’¥ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬ä»VerifySealå‡½æ•°åæ¨ï¼Œæ‰¾å‡ºè°ƒç”¨è¯¥å‡½æ•°çš„ä½ç½®åœ¨miner/remote_agent.goï¼Œ</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>// SubmitWorkå‡½æ•°å°è¯•æ³¨å…¥ä¸€ä¸ªpowè§£å†³æ–¹æ¡ˆï¼ˆå…±è¯†å¼•æ“ï¼‰åˆ°è¿œç¨‹ä»£ç†ï¼Œè¿”å›è¿™ä¸ªè§£å†³æ–¹æ¡ˆæ˜¯å¦è¢«æ¥å—ã€‚ï¼ˆä¸èƒ½åŒæ—¶æ˜¯ä¸€ä¸ªåçš„powä¹Ÿä¸èƒ½æœ‰å…¶ä»–ä»»ä½•é”™è¯¯ï¼Œä¾‹å¦‚æ²¡æœ‰å·¥ä½œè¢«pending
func (a *RemoteAgent) SubmitWork(nonce types.BlockNonce, mixDigest, hash common.Hash) bool {
 a.mu.Lock()
 defer a.mu.Unlock()

 // ä¿è¯è¢«æäº¤çš„å·¥ä½œä¸æ˜¯ç©º
 work := a.work[hash]
 if work == nil {
  log.Info(&quot;Work submitted but none pending&quot;, &quot;hash&quot;, hash)
  return false
 }
 // ä¿è¯å¼•æ“æ˜¯çœŸå®æœ‰æ•ˆçš„ã€‚
 result := work.Block.Header()
 result.Nonce = nonce
 result.MixDigest = mixDigest

 if err := a.engine.VerifySeal(a.chain, result); err != nil {//åœ¨è¿™é‡Œï¼ŒVerifySealæ–¹æ³•è¢«è°ƒç”¨ã€‚
  log.Warn(&quot;Invalid proof-of-work submitted&quot;, &quot;hash&quot;, hash, &quot;err&quot;, err)
  return false
 }
 block := work.Block.WithSeal(result)

 // è§£å†³æ–¹æ¡ˆçœ‹ä¸Šå»æ˜¯æœ‰æ•ˆçš„ï¼Œè¿”å›åˆ°çŸ¿å·¥å¹¶ä¸”é€šçŸ¥æ¥å—ç»“æœã€‚
 a.returnCh &lt;- &amp;Result{work, block}
 delete(a.work, hash)

 return true
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªSubmitWorkä½äºæŒ–çŸ¿çš„pkgä¸­ï¼Œä¸»è¦å·¥ä½œæ˜¯å¯¹workçš„æ ¡éªŒï¼ŒåŒ…æ‹¬workæœ¬èº«æ˜¯å¦ä¸ºç©ºï¼Œworkä¸­çš„åŒºå—å¤´ä»¥åŠåŒºå—å¤´ä¸­åŒ…å«çš„å­—æ®µçš„æœ‰æ•ˆæ€§ï¼Œç„¶åæ˜¯å¯¹åŒºå—å¤´çš„VerifySealï¼ˆè¯¥å‡½æ•°çš„åŠŸèƒ½åœ¨ä¸Šé¢å·²ç»ä»‹ç»åˆ°äº†ï¼Œä¸»è¦æ˜¯å¯¹åŒºå—ç­¾åè€…çš„è®¤è¯ï¼ŒåŒºå—éš¾åº¦å€¼çš„ç¡®è®¤ï¼‰</p><p>ç»§ç»­åæ¨æ‰¾åˆ°SubmitWorkå‡½æ•°è¢«è°ƒç”¨çš„ä½ç½®ï¼š</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>// SubmitWorkå‡½æ•°èƒ½å¤Ÿè¢«å¤–éƒ¨çŸ¿å·¥ç”¨æ¥æäº¤ä»–ä»¬çš„POWã€‚
func (api *PublicMinerAPI) SubmitWork(nonce types.BlockNonce, solution, digest common.Hash) bool {
 return api.agent.SubmitWork(nonce, digest, solution)
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ€»ç»“</strong></p><p>åŒºå—çš„æ ¡éªŒæ˜¯å¤–éƒ¨ç»“ç‚¹è‡ªåŠ¨æ‰§è¡ŒPublicMinerAPIçš„SubmitWorkæ–¹æ³•ï¼Œä»è€Œå±‚å±‚è°ƒç”¨ï¼Œé€šè¿‡æ£€æŸ¥åŒºå—å¤´å†…çš„ç­¾åå†…å®¹ï¼Œé€šè¿‡secp256k1æ–¹æ³•æ¢å¤å…¬é’¥ï¼Œç„¶ååˆ©ç”¨Keccak256å°†å…¬é’¥åŠ å¯†ä¸ºä¸€ä¸ªä»¥å¤ªåœ°å€ä½œä¸ºç­¾ååœ°å€ï¼Œè·å¾—ç­¾ååœ°å€ä»¥åï¼Œå»æœ¬åœ°è®¤è¯ç»“ç‚¹ç¼“å­˜ä¸­æ£€æŸ¥ï¼Œçœ‹è¯¥ç­¾ååœ°å€æ˜¯å¦ç¬¦åˆè¦æ±‚ã€‚æœ€ç»ˆåªè¦é€šè¿‡å±‚å±‚æ ¡éªŒï¼Œå°±ä¸ä¼šæŠ¥å‡ºerrUnauthorizedçš„é”™è¯¯ã€‚</p><blockquote><p>æ³¨æ„ï¼šç­¾åè€…åœ°å€common.Addressåœ¨Sealæ—¶è¢«ç­¾åsignatureå­˜åœ¨åŒºå—å¤´çš„Extraå­—æ®µä¸­ï¼Œç„¶ååœ¨VerifySealä¸­è¢«ä»åŒºå—å¤´ä¸­å–å‡ºç­¾åsignatureã€‚è¯¥ç­¾åçš„è§£å¯†æ–¹å¼æ¯”è¾ƒå¤æ‚ï¼šè¦å…ˆé€šè¿‡secp256k1æ¢å¤ä¸€ä¸ªå…¬é’¥ï¼Œç„¶ååˆ©ç”¨è¿™ä¸ªå…¬é’¥å’ŒKeccak256åŠ å¯†å‡ºç­¾åè€…åœ°å€common.Addressã€‚</p></blockquote><p>common.Addressæœ¬èº«å°±æ˜¯ç»“ç‚¹å…¬é’¥çš„Keccak256åŠ å¯†ç»“æœã€‚è¯·å‚ç…§common/types.goï¼š</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>// Hexå‡½æ•°è¿”å›äº†ä¸€ä¸ªåå…­ç¦æ­¢çš„å­—ç¬¦ä¸²ï¼Œä»£è¡¨äº†ä»¥å¤ªåŠåœ°å€ã€‚
func (a Address) Hex() string {
 unchecksummed := hex.EncodeToString(a[:])
 sha := sha3.NewKeccak256()//è¿™é‡Œå°±ä¸å±•å¼€äº†ï¼Œå¯ä»¥çœ‹å‡ºæ˜¯é€šè¿‡Keccak256æ–¹æ³•å°†æœªæ£€æŸ¥çš„æ˜æ–‡AddressåŠ å¯†ä¸ºä¸€ä¸ªæ ‡å‡†ä»¥å¤ªåŠåœ°å€
 sha.Write([]byte(unchecksummed))
 hash := sha.Sum(nil)

 result := []byte(unchecksummed)
 for i := 0; i &lt; len(result); i++ {
  hashByte := hash[i/2]
  if i%2 == 0 {
   hashByte = hashByte &gt;&gt; 4
  } else {
   hashByte &amp;= 0xf
  }
  if result[i] &gt; &#39;9&#39; &amp;&amp; hashByte &gt; 7 {
   result[i] -= 32
  }
 }
 return &quot;0x&quot; + string(result)
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å…­-åŸºäºæŠ•ç¥¨çš„è®¤è¯ç»“ç‚¹çš„è¿è¡Œæœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#å…­-åŸºäºæŠ•ç¥¨çš„è®¤è¯ç»“ç‚¹çš„è¿è¡Œæœºåˆ¶" aria-hidden="true">#</a> å…­ï¼š åŸºäºæŠ•ç¥¨çš„è®¤è¯ç»“ç‚¹çš„è¿è¡Œæœºåˆ¶</h3><p>ä¸Šé¢æˆ‘ä»¬åˆ†æäº†cliqueçš„è®¤è¯ç»“ç‚¹çš„å‡ºå—ï¼Œæ ¡éªŒç­‰ç»†èŠ‚ï¼Œé‚£ä¹ˆè¿™é‡Œå¼•å‡ºç»ˆæé—®é¢˜ï¼šå¦‚ä½•ç¡®è®¤ä¸€ä¸ªæ™®é€šç»“ç‚¹æ˜¯å¦æ˜¯è®¤è¯ç»“ç‚¹å‘¢ï¼Ÿ</p><blockquote><p>ç­”ï¼šcliqueæ˜¯åŸºäºæŠ•ç¥¨æœºåˆ¶æ¥ç¡®è®¤è®¤è¯ç»“ç‚¹çš„ã€‚</p></blockquote><p>å…ˆæ¥çœ‹æŠ•ç¥¨å®ä½“ç±»ï¼Œå­˜åœ¨äºsnapshotæºç ä¸­ã€‚</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>// Voteä»£è¡¨äº†ä¸€ä¸ªç‹¬ç«‹çš„æŠ•ç¥¨ï¼Œè¿™ä¸ªæŠ•ç¥¨å¯ä»¥æˆæƒä¸€ä¸ªç­¾åè€…ï¼Œæ›´æ”¹æˆæƒåˆ—è¡¨ã€‚
type Vote struct {
 Signer    common.Address `json:&quot;signer&quot;`    // å·²æˆæƒçš„ç­¾åè€…ï¼ˆé€šè¿‡æŠ•ç¥¨ï¼‰
 Block     uint64         `json:&quot;block&quot;`     // æŠ•ç¥¨åŒºå—å·
 Address   common.Address `json:&quot;address&quot;`   // è¢«æŠ•ç¥¨çš„è´¦æˆ·ï¼Œä¿®æ”¹å®ƒçš„æˆæƒ
 Authorize bool           `json:&quot;authorize&quot;` // å¯¹ä¸€ä¸ªè¢«æŠ•ç¥¨è´¦æˆ·æ˜¯å¦æˆæƒæˆ–è§£æˆæƒ
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªVoteæ˜¯å­˜åœ¨äºSnapshotçš„å±æ€§å­—æ®µä¸­ï¼Œæ‰€ä»¥æŠ•ç¥¨æœºåˆ¶ç¦»ä¸å¼€Snapshotï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œå†æ¬¡å°†Snapshotå®ä½“æºç é‡æ–°åˆ†æä¸€éï¼Œä¸Šé¢æ³¨é‡Šè¿‡çš„å†…å®¹æˆ‘ä¸å†å¤è¿°ï¼Œè€Œæ˜¯ç›´æ¥å…³æ³¨åœ¨æŠ•ç¥¨æœºåˆ¶ç›¸å…³å­—æ®µå†…å®¹ä¸Šã€‚</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>type Snapshot struct {
 config   *params.CliqueConfig
 sigcache *lru.ARCCache       

 Number  uint64                      `json:&quot;number&quot;`  
 Hash    common.Hash                 `json:&quot;hash&quot;`    
 Signers map[common.Address]struct{} `json:&quot;signers&quot;` // è®¤è¯èŠ‚ç‚¹é›†åˆ
 Recents map[uint64]common.Address   `json:&quot;recents&quot;` 
 Votes   []*Vote                     `json:&quot;votes&quot;`   // ä¸Šé¢çš„Voteå¯¹è±¡æ•°ç»„
 Tally   map[common.Address]Tally    `json:&quot;tally&quot;`   // ä¹Ÿæ˜¯ä¸€ä¸ªè‡ªå®šä¹‰ç±»å‹ï¼Œè§ä¸‹æ–¹
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Tallyç»“æ„ä½“ï¼š</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>// Tallyæ˜¯ä¸€ä¸ªç®€å•çš„ç”¨æ¥ä¿å­˜å½“å‰æŠ•ç¥¨åˆ†æ•°çš„è®¡åˆ†å™¨
type Tally struct {
 Authorize bool `json:&quot;authorize&quot;` // æˆæƒtrueæˆ–ç§»é™¤false
 Votes     int  `json:&quot;votes&quot;`     // è¯¥ææ¡ˆå·²è·ç¥¨æ•°
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦å¤–Cliqueå®ä½“ä¸­è¿˜æœ‰ä¸ªæœ‰äº‰è®®çš„å­—æ®µproposalsï¼Œå½“æ—¶å¹¶æ²¡æœ‰åˆ†ææ¸…æ¥šï¼Œä½•è°“ææ¡ˆï¼Ÿ</p><blockquote><p>proposalæ˜¯å¯ä»¥é€šè¿‡rpcç”³è¯·åŠ å…¥æˆ–ç§»é™¤ä¸€ä¸ªè®¤è¯èŠ‚ç‚¹ï¼Œç»“æ„ä¸ºå¾…æ“ä½œåœ°å€ï¼ˆèŠ‚ç‚¹åœ°å€ï¼‰å’ŒçŠ¶æ€ï¼ˆåŠ å…¥æˆ–ç§»é™¤ï¼‰</p></blockquote><h4 id="æŠ•ç¥¨ä¸­æŸäº›æ¦‚å¿µçš„ç¡®å®š" tabindex="-1"><a class="header-anchor" href="#æŠ•ç¥¨ä¸­æŸäº›æ¦‚å¿µçš„ç¡®å®š" aria-hidden="true">#</a> æŠ•ç¥¨ä¸­æŸäº›æ¦‚å¿µçš„ç¡®å®š</h4><ul><li>æŠ•ç¥¨çš„èŒƒå›´æ˜¯åœ¨å§”å‘˜ä¼šï¼Œå§”å‘˜ä¼šçš„æ„æ€å°±æ˜¯æ‰€æœ‰çŸ¿å·¥ã€‚</li><li>æ¦‚å¿µä»‹ç»ï¼šcheckpointï¼ŒcheckpointInterval = 1024 ï¼Œæ¯è¿‡1024ä¸ªåŒºå—ï¼Œåˆ™ä¿å­˜snapshotåˆ°æ•°æ®åº“</li><li>æ¦‚å¿µä»‹ç»ï¼šEpochï¼Œä¸ethashä¸€æ ·ï¼Œä¸€ä¸ªEpochæ˜¯ä¸‰ä¸‡ä¸ªåŒºå—</li></ul><h4 id="æŠ•ç¥¨æµç¨‹" tabindex="-1"><a class="header-anchor" href="#æŠ•ç¥¨æµç¨‹" aria-hidden="true">#</a> æŠ•ç¥¨æµç¨‹</h4><ul><li>é¦–å…ˆå§”å‘˜ä¼šæŸä¸ªæˆå‘˜ï¼ˆå³èŠ‚ç‚¹çŸ¿å·¥ï¼‰é€šè¿‡rpcè°ƒç”¨consensus/clique/api.goä¸­çš„proposeæ–¹æ³•</li></ul><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>// Proposeæ³¨å…¥ä¸€ä¸ªæ–°çš„æˆæƒææ¡ˆï¼Œå¯ä»¥æˆæƒä¸€ä¸ªç­¾åè€…æˆ–è€…ç§»é™¤ä¸€ä¸ªã€‚
func (api *API) Propose(address common.Address, auth bool) {
 api.clique.lock.Lock()
 defer api.clique.lock.Unlock()

 api.clique.proposals[address] = auth// true:æˆæƒï¼Œfalse:ç§»é™¤
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>ä¸Šé¢rpcæäº¤è¿‡æ¥çš„proposeä¼šå†™å…¥Clique.proposalsé›†åˆä¸­ã€‚</li><li>åœ¨æŒ–çŸ¿å¼€å§‹ä»¥åï¼Œä¼šåœ¨miner.start()ä¸­æäº¤ä¸€ä¸ªcommitNewWorkï¼Œå…¶ä¸­æ¶‰åŠåˆ°å‡†å¤‡åŒºå—å¤´Prepareçš„æ–¹æ³•ï¼Œæˆ‘ä»¬è¿›å…¥åˆ°cliqueçš„å®ç°ï¼Œå…¶ä¸­æ¶‰åŠåˆ°å¯¹ä¸Šé¢çš„Clique.proposalsçš„å¤„ç†ï¼š</li></ul><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>// å¦‚æœå­˜åœ¨pendingçš„proposalsï¼Œåˆ™æŠ•ç¥¨
if len(addresses) &gt; 0 {
 header.Coinbase = addresses[rand.Intn(len(addresses))]//å°†æŠ•ç¥¨èŠ‚ç‚¹çš„åœ°å€èµ‹å€¼ç»™åŒºå—å¤´çš„Coinbaseå­—æ®µã€‚
 // ä¸‹é¢æ˜¯é€šè¿‡ææ¡ˆå†…å®¹æ¥ç»„è£…åŒºå—å¤´çš„éšæœºæ•°å­—æ®µã€‚
 if c.proposals[header.Coinbase] {
  copy(header.Nonce[:], nonceAuthVote)
 } else {
  copy(header.Nonce[:], nonceDropVote)
 }
}

// nonceAuthVoteå’ŒnonceDropVoteå¸¸é‡çš„å£°æ˜ä¸åˆå§‹åŒ–
nonceAuthVote = hexutil.MustDecode(&quot;0xffffffffffffffff&quot;) // æˆæƒç­¾åè€…çš„å¿…è¦éšæœºæ•°
nonceDropVote = hexutil.MustDecode(&quot;0x0000000000000000&quot;) // ç§»é™¤ç­¾åè€…çš„å¿…è¦éšæœºæ•°
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>æ•´ä¸ªåŒºå—ç»„è£…å¥½ä»¥åï¼ˆå…¶ä»–çš„å†…å®¹ä¸å†å¤è¿°ï¼‰ï¼Œä¼šè¢«å¹¿æ’­åˆ°å¤–éƒ¨ç»“ç‚¹æ ¡éªŒï¼Œå¦‚æœæ²¡æœ‰é—®é¢˜è¯¥å—è¢«æˆåŠŸå‡ºäº†ï¼Œåˆ™åŒºå—å¤´ä¸­çš„è¿™ä¸ªææ¡ˆä¹Ÿä¼šè¢«è®°å½•åœ¨ä¸»é“¾ä¸Šã€‚</li><li>åŒºå—åœ¨ç”Ÿæˆæ—¶ï¼Œä¼šåˆ›å»ºSnapshotï¼Œåœ¨snapshotæ„é€ å‡½æ•°ä¸­ï¼Œä¼šæ¶‰åŠåˆ°å¯¹proposalçš„å¤„ç†applyæ–¹æ³•ã€‚</li></ul><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>// applyé€šè¿‡æ¥å—ä¸€ä¸ªç»™å®šåŒºå—å¤´åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„æˆæƒ
func (s *Snapshot) apply(headers []*types.Header) (*Snapshot, error) {
 if len(headers) == 0 {
  return s, nil
 }
 for i := 0; i &lt; len(headers)-1; i++ {
  if headers[i+1].Number.Uint64() != headers[i].Number.Uint64()+1 {
   return nil, errInvalidVotingChain
  }
 }
 if headers[0].Number.Uint64() != s.Number+1 {
  return nil, errInvalidVotingChain
 }
 snap := s.copy()
    // æŠ•ç¥¨çš„å¤„ç†æ ¸å¿ƒä»£ç 
 for _, header := range headers {
  // Remove any votes on checkpoint blocks
  number := header.Number.Uint64()
  // å¦‚æœåŒºå—é«˜åº¦æ­£å¥½åœ¨Epochç»“æŸï¼Œåˆ™æ¸…ç©ºæŠ•ç¥¨å’Œè®¡åˆ†å™¨
  if number%s.config.Epoch == 0 {
   snap.Votes = nil
   snap.Tally = make(map[common.Address]Tally)
  }
  if limit := uint64(len(snap.Signers)/2 + 1); number &gt;= limit {
   delete(snap.Recents, number-limit)
  }
  // ä»åŒºå—å¤´ä¸­è§£å¯†å‡ºæ¥ç­¾åè€…åœ°å€
  signer, err := ecrecover(header, s.sigcache)
  if err != nil {
   return nil, err
  }
  if _, ok := snap.Signers[signer]; !ok {
   return nil, errUnauthorized
  }
  for _, recent := range snap.Recents {
   if recent == signer {
    return nil, errUnauthorized
   }
  }
  snap.Recents[number] = signer

  // åŒºå—å¤´è®¤è¯ï¼Œä¸ç®¡è¯¥ç­¾åè€…ä¹‹å‰çš„ä»»ä½•æŠ•ç¥¨
  for i, vote := range snap.Votes {
   if vote.Signer == signer &amp;&amp; vote.Address == header.Coinbase {
    // ä»ç¼“å­˜è®¡æ•°å™¨ä¸­ç§»é™¤è¯¥æŠ•ç¥¨
    snap.uncast(vote.Address, vote.Authorize)

    // ä»æŒ‰æ—¶é—´æ’åºçš„åˆ—è¡¨ä¸­ç§»é™¤æŠ•ç¥¨
    snap.Votes = append(snap.Votes[:i], snap.Votes[i+1:]...)
    break // only one vote allowed
   }
  }
  // ä»ç­¾åè€…ä¸­è®¡æ•°æ–°çš„æŠ•ç¥¨
  var authorize bool
  switch {
  case bytes.Equal(header.Nonce[:], nonceAuthVote):
   authorize = true
  case bytes.Equal(header.Nonce[:], nonceDropVote):
   authorize = false
  default:
   return nil, errInvalidVote
  }
  if snap.cast(header.Coinbase, authorize) {
   snap.Votes = append(snap.Votes, &amp;Vote{
    Signer:    signer,
    Block:     number,
    Address:   header.Coinbase,
    Authorize: authorize,
   })
  }
  // åˆ¤æ–­ç¥¨æ•°æ˜¯å¦è¶…è¿‡ä¸€åŠçš„æŠ•ç¥¨è€…ï¼Œå¦‚æœæŠ•ç¥¨é€šè¿‡ï¼Œæ›´æ–°ç­¾åè€…åˆ—è¡¨
  if tally := snap.Tally[header.Coinbase]; tally.Votes &gt; len(snap.Signers)/2 {
   if tally.Authorize {
    snap.Signers[header.Coinbase] = struct{}{}
   } else {
    delete(snap.Signers, header.Coinbase)

    if limit := uint64(len(snap.Signers)/2 + 1); number &gt;= limit {
     delete(snap.Recents, number-limit)
    }
    for i := 0; i &lt; len(snap.Votes); i++ {
     if snap.Votes[i].Signer == header.Coinbase {
      snap.uncast(snap.Votes[i].Address, snap.Votes[i].Authorize)

      snap.Votes = append(snap.Votes[:i], snap.Votes[i+1:]...)

      i--
     }
    }
   }
   // ä¸ç®¡ä¹‹å‰çš„ä»»ä½•æŠ•ç¥¨ï¼Œç›´æ¥æ”¹å˜è´¦æˆ·
   for i := 0; i &lt; len(snap.Votes); i++ {
    if snap.Votes[i].Address == header.Coinbase {
     snap.Votes = append(snap.Votes[:i], snap.Votes[i+1:]...)
     i--
    }
   }
   delete(snap.Tally, header.Coinbase)
  }
 }
 snap.Number += uint64(len(headers))
 snap.Hash = headers[len(headers)-1].Hash()

 return snap, nil
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å…³é”®æ§åˆ¶çš„ä»£ç æ˜¯tally.Votes &gt; len(snap.Signers)/2ï¼Œæ„æ€æ˜¯è®¡åˆ†å™¨ä¸­çš„ç¥¨æ•°å¤§äºä¸€åŠçš„ç­¾åè€…ï¼Œå°±è¡¨ç¤ºè¯¥æŠ•ç¥¨é€šè¿‡ï¼Œä¸‹é¢å°±æ˜¯è¦æ›´æ”¹snapshotä¸­çš„è®¤è¯ç­¾åè€…åˆ—è¡¨ç¼“å­˜ï¼ŒåŒæ—¶è¦åŒæ­¥ç»™å…¶ä»–èŠ‚ç‚¹ï¼Œå¹¶åˆ é™¤è¯¥æŠ•ç¥¨ç›¸å…³ä¿¡æ¯ã€‚</p><h2 id="æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“" aria-hidden="true">#</a> æ€»ç»“</h2><p>æœ¬ä»¥ä¸ºcliqueæ¯”è¾ƒç®€å•ï¼Œä¸å¿…è°ƒæŸ¥è¿™ä¹ˆé•¿ï¼Œç„¶è€ŒPOAçš„å…±è¯†ç®—æ³•è¿˜æ˜¯æ¯”è¾ƒæœ‰éš¾åº¦çš„ï¼Œå®ƒå’ŒPOWæ˜¯åŸºäºå®Œå…¨ä¸åŒçš„ä¸¤ç§åœºæ™¯çš„å®ç°æ–¹å¼ï¼Œå‡ºå—æ–¹å¼ä¹Ÿå®Œå…¨ä¸åŒã€‚ä¸‹é¢æˆ‘å°è¯•ç”¨ç®€çŸ­çš„è¯­è¨€æ¥æ€»ç»“Cliqueçš„å…±è¯†æœºåˆ¶ã€‚</p><blockquote><p>cliqueå…±è¯†æ˜¯åŸºäºå§”å‘˜ä¼šé€‰ä¸¾è®¤è¯èŠ‚ç‚¹æ¥ç¡®è®¤å‡ºå—æƒåŠ›çš„æ–¹å¼å®ç°çš„ã€‚æŠ•ç¥¨æ–¹å¼é€šè¿‡rpcè¯·æ±‚proposeï¼ŒsnapshotäºŒçº§ç¼“å­˜æœºåˆ¶ï¼Œå”±ç¥¨ï¼Œæ‰§è¡ŒæŠ•ç¥¨ç»“æœã€‚è®¤è¯èŠ‚ç‚¹å‡ºå—æœºä¼šå‡ç­‰ï¼Œå›°éš¾åº¦é€šè¿‡è½®æ¬¡ï¼ˆæ˜¯å¦æŒ‰ç…§ç¼“å­˜è®¤è¯é¡ºåºå‡ºå—ï¼‰ç¡®å®šï¼ŒåŒºå—å¤´Extraå­˜å‚¨ç­¾åï¼Œkeccak256åŠ å¯†ä»¥å¤ªåœ°å€ï¼Œsecp256k1è§£å¯†ç­¾åä¸ºå…¬é’¥ï¼Œé€šè¿‡è®¤è¯ç»“ç‚¹å‡ºå—çš„é€»è¾‘å¯ä»¥åæ¨åŒºå—æ ¡éªŒã€‚</p></blockquote><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å¯¹POAå…±è¯†æœºåˆ¶ï¼Œä»¥åŠä»¥å¤ªåŠcliqueçš„å®ç°æœ‰äº†æ·±åˆ»çš„ç†è§£ä¸è®¤è¯†ï¼Œç›¸ä¿¡å¦‚æœè®©æˆ‘ä»¬å»å®ç°ä¸€å¥—POAï¼Œä¹Ÿæ˜¯å®Œå…¨æœ‰èƒ½åŠ›çš„ã€‚å¤§å®¶åœ¨é˜…è¯»æœ¬æ–‡æ—¶æœ‰ä»»ä½•ç–‘é—®å‡å¯ç•™è¨€ç»™æˆ‘ï¼Œæˆ‘ä¸€å®šä¼šåŠæ—¶å›å¤ã€‚</p><hr><h2 id="æ€»ç»“-å‚è€ƒ" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-å‚è€ƒ" aria-hidden="true">#</a> æ€»ç»“&amp;å‚è€ƒ</h2><blockquote><p><a href="https://eth.wiki/concepts/ethash/design-rationale" target="_blank" rel="noopener noreferrer">https://eth.wiki/concepts/ethash/design-rationale<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><a href="https://eth.wiki/concepts/ethash/dag" target="_blank" rel="noopener noreferrer">https://eth.wiki/concepts/ethash/dag<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><a href="https://www.vijaypradeep.com/blog/2017-04-28-ethereums-memory-hardness-explained/" target="_blank" rel="noopener noreferrer">https://www.vijaypradeep.com/blog/2017-04-28-ethereums-memory-hardness-explained/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></blockquote></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/token01/token01.github.io/edit/master/docs/blockchain/Male_chain_research/ethereum/Etheric_fang_clique_algorithm.md" rel="noopener noreferrer" target="_blank" aria-label="ç¼–è¾‘æ­¤é¡µ" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->ç¼–è¾‘æ­¤é¡µ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item update-time"><span class="label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><span class="info">2022/12/12 14:43:36</span></div><!----></footer><!----><div class="waline-wrapper" darkmode="false" style="display:block;"><div data-waline provider="Waline"><div class="wl-comment"><!--v-if--><div class="wl-panel"><div class="wl-header item3"><!--[--><div class="wl-header-item"><label for="nick">æ˜µç§°</label><input id="wl-nick" class="wl-input wl-nick" name="nick" type="text" value></div><div class="wl-header-item"><label for="mail">é‚®ç®±</label><input id="wl-mail" class="wl-input wl-mail" name="mail" type="email" value></div><div class="wl-header-item"><label for="link">ç½‘å€</label><input id="wl-link" class="wl-input wl-link" name="link" type="text" value></div><!--]--></div><textarea id="wl-edit" class="wl-editor" placeholder="è¯·ç•™è¨€ã€‚(å¡«å†™é‚®ç®±å¯åœ¨è¢«å›å¤æ—¶æ”¶åˆ°é‚®ä»¶æé†’)"></textarea><div class="wl-preview" style="display:none;"><hr><h4>é¢„è§ˆ:</h4><!-- eslint-disable-next-line vue/no-v-html --><div class="wl-content"></div></div><div class="wl-footer"><div class="wl-actions"><a href="https://guides.github.com/features/mastering-markdown/" title="Markdown Guide" aria-label="Markdown is supported" class="wl-action" target="_blank" rel="noreferrer"><svg width="16" height="16" ariaHidden="true"><path d="M14.85 3H1.15C.52 3 0 3.52 0 4.15v7.69C0 12.48.52 13 1.15 13h13.69c.64 0 1.15-.52 1.15-1.15v-7.7C16 3.52 15.48 3 14.85 3zM9 11H7V8L5.5 9.92 4 8v3H2V5h2l1.5 2L7 5h2v6zm2.99.5L9.5 8H11V5h2v3h1.5l-2.51 3.5z" fill="currentColor"></path></svg></a><button class="wl-action" title="è¡¨æƒ…" style="display:none;"><svg viewBox="0 0 1024 1024" width="24" height="24"><path d="M563.2 463.3 677 540c1.7 1.2 3.7 1.8 5.8 1.8.7 0 1.4-.1 2-.2 2.7-.5 5.1-2.1 6.6-4.4l25.3-37.8c1.5-2.3 2.1-5.1 1.6-7.8s-2.1-5.1-4.4-6.6l-73.6-49.1 73.6-49.1c2.3-1.5 3.9-3.9 4.4-6.6.5-2.7 0-5.5-1.6-7.8l-25.3-37.8a10.1 10.1 0 0 0-6.6-4.4c-.7-.1-1.3-.2-2-.2-2.1 0-4.1.6-5.8 1.8l-113.8 76.6c-9.2 6.2-14.7 16.4-14.7 27.5.1 11 5.5 21.3 14.7 27.4zM387 348.8h-45.5c-5.7 0-10.4 4.7-10.4 10.4v153.3c0 5.7 4.7 10.4 10.4 10.4H387c5.7 0 10.4-4.7 10.4-10.4V359.2c0-5.7-4.7-10.4-10.4-10.4zm333.8 241.3-41-20a10.3 10.3 0 0 0-8.1-.5c-2.6.9-4.8 2.9-5.9 5.4-30.1 64.9-93.1 109.1-164.4 115.2-5.7.5-9.9 5.5-9.5 11.2l3.9 45.5c.5 5.3 5 9.5 10.3 9.5h.9c94.8-8 178.5-66.5 218.6-152.7 2.4-5 .3-11.2-4.8-13.6zm186-186.1c-11.9-42-30.5-81.4-55.2-117.1-24.1-34.9-53.5-65.6-87.5-91.2-33.9-25.6-71.5-45.5-111.6-59.2-41.2-14-84.1-21.1-127.8-21.1h-1.2c-75.4 0-148.8 21.4-212.5 61.7-63.7 40.3-114.3 97.6-146.5 165.8-32.2 68.1-44.3 143.6-35.1 218.4 9.3 74.8 39.4 145 87.3 203.3.1.2.3.3.4.5l36.2 38.4c1.1 1.2 2.5 2.1 3.9 2.6 73.3 66.7 168.2 103.5 267.5 103.5 73.3 0 145.2-20.3 207.7-58.7 37.3-22.9 70.3-51.5 98.1-85 27.1-32.7 48.7-69.5 64.2-109.1 15.5-39.7 24.4-81.3 26.6-123.8 2.4-43.6-2.5-87-14.5-129zm-60.5 181.1c-8.3 37-22.8 72-43 104-19.7 31.1-44.3 58.6-73.1 81.7-28.8 23.1-61 41-95.7 53.4-35.6 12.7-72.9 19.1-110.9 19.1-82.6 0-161.7-30.6-222.8-86.2l-34.1-35.8c-23.9-29.3-42.4-62.2-55.1-97.7-12.4-34.7-18.8-71-19.2-107.9-.4-36.9 5.4-73.3 17.1-108.2 12-35.8 30-69.2 53.4-99.1 31.7-40.4 71.1-72 117.2-94.1 44.5-21.3 94-32.6 143.4-32.6 49.3 0 97 10.8 141.8 32 34.3 16.3 65.3 38.1 92 64.8 26.1 26 47.5 56 63.6 89.2 16.2 33.2 26.6 68.5 31 105.1 4.6 37.5 2.7 75.3-5.6 112.3z" fill="currentColor"></path></svg></button><button class="wl-action" title="è¡¨æƒ…åŒ…"><svg width="24" height="24" fill="currentcolor" viewBox="0 0 24 24"><path style="transform: translateY(0.5px)" d="M18.968 10.5H15.968V11.484H17.984V12.984H15.968V15H14.468V9H18.968V10.5V10.5ZM8.984 9C9.26533 9 9.49967 9.09367 9.687 9.281C9.87433 9.46833 9.968 9.70267 9.968 9.984V10.5H6.499V13.5H8.468V12H9.968V14.016C9.968 14.2973 9.87433 14.5317 9.687 14.719C9.49967 14.9063 9.26533 15 8.984 15H5.984C5.70267 15 5.46833 14.9063 5.281 14.719C5.09367 14.5317 5 14.2973 5 14.016V9.985C5 9.70367 5.09367 9.46933 5.281 9.282C5.46833 9.09467 5.70267 9.001 5.984 9.001H8.984V9ZM11.468 9H12.968V15H11.468V9V9Z"></path><path d="M18.5 3H5.75C3.6875 3 2 4.6875 2 6.75V18C2 20.0625 3.6875 21.75 5.75 21.75H18.5C20.5625 21.75 22.25 20.0625 22.25 18V6.75C22.25 4.6875 20.5625 3 18.5 3ZM20.75 18C20.75 19.2375 19.7375 20.25 18.5 20.25H5.75C4.5125 20.25 3.5 19.2375 3.5 18V6.75C3.5 5.5125 4.5125 4.5 5.75 4.5H18.5C19.7375 4.5 20.75 5.5125 20.75 6.75V18Z"></path></svg></button><input id="wl-image-upload" class="upload" type="file" accept=".png,.jpg,.jpeg,.webp,.bmp,.gif"><label for="wl-image-upload" class="wl-action" title="ä¸Šä¼ å›¾ç‰‡"><svg viewBox="0 0 1024 1024" width="24" height="24"><path d="M784 112H240c-88 0-160 72-160 160v480c0 88 72 160 160 160h544c88 0 160-72 160-160V272c0-88-72-160-160-160zm96 640c0 52.8-43.2 96-96 96H240c-52.8 0-96-43.2-96-96V272c0-52.8 43.2-96 96-96h544c52.8 0 96 43.2 96 96v480z" fill="currentColor"></path><path d="M352 480c52.8 0 96-43.2 96-96s-43.2-96-96-96-96 43.2-96 96 43.2 96 96 96zm0-128c17.6 0 32 14.4 32 32s-14.4 32-32 32-32-14.4-32-32 14.4-32 32-32zm462.4 379.2-3.2-3.2-177.6-177.6c-25.6-25.6-65.6-25.6-91.2 0l-80 80-36.8-36.8c-25.6-25.6-65.6-25.6-91.2 0L200 728c-4.8 6.4-8 14.4-8 24 0 17.6 14.4 32 32 32 9.6 0 16-3.2 22.4-9.6L380.8 640l134.4 134.4c6.4 6.4 14.4 9.6 24 9.6 17.6 0 32-14.4 32-32 0-9.6-4.8-17.6-9.6-24l-52.8-52.8 80-80L769.6 776c6.4 4.8 12.8 8 20.8 8 17.6 0 32-14.4 32-32 0-8-3.2-16-8-20.8z" fill="currentColor"></path></svg></label><button class="wl-action" title="é¢„è§ˆ"><svg viewBox="0 0 1024 1024" width="24" height="24"><path d="M710.816 654.301c70.323-96.639 61.084-230.578-23.705-314.843-46.098-46.098-107.183-71.109-172.28-71.109-65.008 0-126.092 25.444-172.28 71.109-45.227 46.098-70.756 107.183-70.756 172.106 0 64.923 25.444 126.007 71.194 172.106 46.099 46.098 107.184 71.109 172.28 71.109 51.414 0 100.648-16.212 142.824-47.404l126.53 126.006c7.058 7.06 16.297 10.979 26.406 10.979 10.105 0 19.343-3.919 26.402-10.979 14.467-14.467 14.467-38.172 0-52.723L710.816 654.301zm-315.107-23.265c-65.88-65.88-65.88-172.54 0-238.42 32.069-32.07 74.245-49.149 119.471-49.149 45.227 0 87.407 17.603 119.472 49.149 65.88 65.879 65.88 172.539 0 238.42-63.612 63.178-175.242 63.178-238.943 0zm0 0" fill="currentColor"></path><path d="M703.319 121.603H321.03c-109.8 0-199.469 89.146-199.469 199.38v382.034c0 109.796 89.236 199.38 199.469 199.38h207.397c20.653 0 37.384-16.645 37.384-37.299 0-20.649-16.731-37.296-37.384-37.296H321.03c-68.582 0-124.352-55.77-124.352-124.267V321.421c0-68.496 55.77-124.267 124.352-124.267h382.289c68.582 0 124.352 55.771 124.352 124.267V524.72c0 20.654 16.736 37.299 37.385 37.299 20.654 0 37.384-16.645 37.384-37.299V320.549c-.085-109.8-89.321-198.946-199.121-198.946zm0 0" fill="currentColor"></path></svg></button></div><div class="wl-info"><div class="wl-text-number">0 <!--v-if--> Â å­—</div><button class="wl-btn">ç™»å½•</button><button class="wl-btn primary" title="Cmd|Ctrl + Enter"><!--[-->æäº¤<!--]--></button></div><div class="wl-gif-popup"><input type="text" placeholder="æœç´¢è¡¨æƒ…åŒ…"><div class="wl-gallery" style="gap:6px;"><!--[--><!--]--></div><div class="wl-loading"><svg width="30" height="30" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid"><circle cx="50" cy="50" fill="none" stroke="currentColor" strokeWidth="4" r="40" stroke-dasharray="85 30"><animateTransform attributeName="transform" type="rotate" repeatCount="indefinite" dur="1s" values="0 50 50;360 50 50" keyTimes="0;1"></animateTransform></circle></svg></div></div><div class="wl-emoji-popup"><!--[--><!--]--><!--v-if--></div></div></div><!--v-if--></div><div class="wl-meta-head"><div class="wl-count"><!--v-if--> è¯„è®º</div><ul class="wl-sort"><!--[--><li class="active">æŒ‰æ­£åº</li><li class="">æŒ‰å€’åº</li><li class="">æŒ‰çƒ­åº¦</li><!--]--></ul></div><div class="wl-cards"><!--[--><!--]--></div><!--[--><div class="wl-loading"><svg width="30" height="30" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid"><circle cx="50" cy="50" fill="none" stroke="currentColor" strokeWidth="4" r="40" stroke-dasharray="85 30"><animateTransform attributeName="transform" type="rotate" repeatCount="indefinite" dur="1s" values="0 50 50;360 50 50" keyTimes="0;1"></animateTransform></circle></svg></div><!--]--><!-- Copyright Information --><div class="wl-power"> Powered by <a href="https://github.com/walinejs/waline" target="_blank" rel="noreferrer"> Waline </a> v2.9.1</div></div></div><!----><!--]--></main><!--]--><footer class="footer-wrapper"><div class="footer"></div><div class="copyright">Copyright Â© 2022 Abel sun</div></footer><!--]--></div><!--]--><!----><!----><!--]--></div>
    <script type="module" src="/assets/app.d50e5263.js" defer></script>
  </body>
</html>
