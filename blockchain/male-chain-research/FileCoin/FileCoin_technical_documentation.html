@@ -1,58 +0,0 @@
<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="keywords" content="web3.0 åŒºå—é“¾ åŸºç¡€çŸ¥è¯† P2Pç½‘ç»œ"><meta property="og:url" content="https://bytecodes.tech/blockchain/male-chain-research/FileCoin/FileCoin_technical_documentation.html"><meta property="og:site_name" content="å‡¤å‡°æ¶…æ§ƒè¿›é˜¶ä¹‹è·¯"><meta property="og:title" content="fileCoinæŠ€æœ¯æ–‡æ¡£"><meta property="og:description" content="å‡¤å‡°æ¶…æ§ƒè¿›é˜¶ä¹‹è·¯ web3.0 åŒºå—é“¾ åŒºå—é“¾åŸºç¡€çŸ¥è¯†"><meta property="og:type" content="article"><meta property="og:updated_time" content="2022-12-25T02:12:30.000Z"><meta property="og:locale" content="zh-CN"><meta property="article:tag" content="fileCoin"><meta property="article:modified_time" content="2022-12-25T02:12:30.000Z"><meta name="robots" content="all"><meta name="author" content="Abelsun"><meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate"><meta http-equiv="Pragma" content="no-cache"><meta http-equiv="Expires" content="0"><meta name="apple-mobile-web-app-capable" content="yes"><script>
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?5230ac143650bf5eb3c14f3fb9b1d3ec";
          var s = document.getElementsByTagName("script")[0]; 
          s.parentNode.insertBefore(hm, s);
        })();
      </script><link rel="stylesheet" href="//at.alicdn.com/t/font_3180624_7cy10l7jqqh.css"><link rel="icon" href="/favicon.ico"><link rel="icon" href="/assets/icon/chrome-mask-512.png" type="image/png" sizes="512x512"><link rel="icon" href="/assets/icon/chrome-mask-192.png" type="image/png" sizes="192x192"><link rel="icon" href="/assets/icon/chrome-512.png" type="image/png" sizes="512x512"><link rel="icon" href="/assets/icon/chrome-192.png" type="image/png" sizes="192x192"><link rel="manifest" href="/manifest.webmanifest" crossorigin="use-credentials"><meta name="theme-color" content="#096dd9"><link rel="apple-touch-icon" href="/assets/icon/apple-icon-152.png"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="msapplication-TileImage" content="/assets/icon/ms-icon-144.png"><meta name="msapplication-TileColor" content="#ffffff"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"><title>fileCoinæŠ€æœ¯æ–‡æ¡£ | å‡¤å‡°æ¶…æ§ƒè¿›é˜¶ä¹‹è·¯</title><meta name="description" content="å‡¤å‡°æ¶…æ§ƒè¿›é˜¶ä¹‹è·¯ web3.0 åŒºå—é“¾ åŒºå—é“¾åŸºç¡€çŸ¥è¯†">
    <meta name="keywords" content="è‡ªæˆ‘æå‡,æ•ˆç‡æå‡,å¼€æºå·¥å…·,å­¦ä¹ ç¬”è®°" />
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background-color: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="stylesheet" href="/assets/style.9613470c.css">
    <link rel="modulepreload" href="/assets/app.18744acf.js"><link rel="modulepreload" href="/assets/FileCoin_technical_documentation.html.9c56d8d8.js"><link rel="modulepreload" href="/assets/_plugin-vue_export-helper.cdc0426e.js"><link rel="modulepreload" href="/assets/FileCoin_technical_documentation.html.7bfb955d.js">
    <!-- çœ‹æ¿å¨˜åŒºå— -->
    <link href="https://lf9-cdn-tos.bytecdntp.com/cdn/expire-1-y/font-awesome/6.0.0/css/all.min.css" type="text/css" rel="stylesheet" />
    <script src="/live2d-widget/autoload.js"></script>
    <!-- End çœ‹æ¿å¨˜åŒºå— -->
    <!-- Matomo æ­¤åŒºå—ä¸ºç»Ÿè®¡ä»£ç ï¼Œè¯·åˆ é™¤-->
    <script>
      <head>
  <!-- ... -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/@waline/client@v2/dist/waline.css"
  />
  <!-- ... -->
</head>
<body>
  <!-- ... -->
  <div id="waline"></div>
  <script type="module">
    import { init } from 'https://unpkg.com/@waline/client@v2/dist/waline.mjs';

    init({
      el: '#waline',
      serverURL: 'https://your-domain.vercel.app',
    });
  </script>
</body>

    </script>
    <!-- End Matomo Code æ­¤åŒºå—ä¸ºç»Ÿè®¡ä»£ç ï¼Œè¯·åˆ é™¤-->
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">Skip to content</a><!--]--><div class="theme-container has-toc"><!--[--><!--[--><header class="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><a href="/" class="brand"><img class="logo" src="/assets/icon/logo.png" alt="å‡¤å‡°æ¶…æ§ƒè¿›é˜¶ä¹‹è·¯"><!----><span class="site-name hide-in-pad">å‡¤å‡°æ¶…æ§ƒè¿›é˜¶ä¹‹è·¯</span></a><!----></div><div class="navbar-center"><!----><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/blog.html" class="nav-link" aria-label="åšå®¢"><span class="icon iconfont icon-gaishu"></span>åšå®¢<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="è¯­è¨€|å¹³å°"><span class="title"><span class="icon iconfont icon-language"></span>è¯­è¨€|å¹³å°</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/language/android/android-call-js.html" class="nav-link" aria-label="Android"><span class="icon iconfont icon-creative"></span>Android<!----></a></li><li class="dropdown-item"><a href="/language/python/python-advantage.html" class="nav-link" aria-label="python"><span class="icon iconfont icon-creative"></span>python<!----></a></li><li class="dropdown-item"><a href="/language/weixin/wx-package-Optimization.html" class="nav-link" aria-label="å¾®ä¿¡"><span class="icon iconfont icon-creative"></span>å¾®ä¿¡<!----></a></li><li class="dropdown-item"><a href="/language/go/01.base" class="nav-link" aria-label="go"><span class="icon iconfont icon-creative"></span>go<!----></a></li><li class="dropdown-item"><a href="/language/rust/readme" class="nav-link" aria-label="rust"><span class="icon iconfont icon-creative"></span>rust<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Java"><span class="title"><span class="icon iconfont icon-java"></span>Java</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/java/base/Java-basis-oop.html" class="nav-link" aria-label="JavaåŸºç¡€"><!---->JavaåŸºç¡€<!----></a></li><li class="dropdown-item"><a href="/java/io/java-io-overview.html" class="nav-link" aria-label="Java IO"><!---->Java IO<!----></a></li><li class="dropdown-item"><a href="/java/collection/java-collection-overview.html" class="nav-link" aria-label="Javaé›†åˆ"><!---->Javaé›†åˆ<!----></a></li><li class="dropdown-item"><a href="/java/thread/java-thread-x-theorty.html" class="nav-link" aria-label="Javaå¹¶å‘"><!---->Javaå¹¶å‘<!----></a></li><li class="dropdown-item"><a href="/java/java8/java8-lambda.html" class="nav-link" aria-label="Java8"><!---->Java8<!----></a></li><li class="dropdown-item"><a href="/java/jvm/jvm-overview.html" class="nav-link" aria-label="JVM"><!---->JVM<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="æ•°æ®åº“"><span class="title"><span class="icon iconfont icon-mysql"></span>æ•°æ®åº“</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/db/sql/sql-x-basic.html" class="nav-link" aria-label="æ•°æ®åº“åŸºç¡€/SQLåŸºç¡€"><!---->æ•°æ®åº“åŸºç¡€/SQLåŸºç¡€<!----></a></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>Sqlæ•°æ®åº“</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/db/mysql/sql-mysql-overview.html" class="nav-link" aria-label="Mysql"><!---->Mysql<!----></a></li><li class="dropdown-subitem"><a href="/db/oracle/oracle-b-sequence.html" class="nav-link" aria-label="Oracle"><!---->Oracle<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>NoSqlæ•°æ®åº“</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/db/redis/db-redis-introduce.html" class="nav-link" aria-label="Redis"><!---->Redis<!----></a></li><li class="dropdown-subitem"><a href="/db/mongodb/mongodb-started.html" class="nav-link" aria-label="MongoDb"><!---->MongoDb<!----></a></li><li class="dropdown-subitem"><a href="/db/es/elasticsearch-x-introduce-1.html" class="nav-link" aria-label="Elasticsearch"><!---->Elasticsearch<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="æ¡†æ¶|ä¾èµ–"><span class="title"><span class="icon iconfont icon-frame"></span>æ¡†æ¶|ä¾èµ–</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>Spring</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/dependencies/spring/spring-overview.html" class="nav-link" aria-label="Spring"><!---->Spring<!----></a></li><li class="dropdown-subitem"><a href="/dependencies/spring-boot/springboot-x-overview.html" class="nav-link" aria-label="SpringBoot"><!---->SpringBoot<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>ORM</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/dependencies/mybatis/mybatis-y-arch.html" class="nav-link" aria-label="Mybatis"><!---->Mybatis<!----></a></li><li class="dropdown-subitem"><a href="/dependencies/mybatis-plus/mybatis-plus-x-gen-code.html" class="nav-link" aria-label="Mybatis-Plus"><!---->Mybatis-Plus<!----></a></li></ul></li><li class="dropdown-item"><a href="/dependencies/office/office-x-aspose.html" class="nav-link" aria-label="Officeæ–‡æ¡£æ“ä½œ"><!---->Officeæ–‡æ¡£æ“ä½œ<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="å¼€å‘|æµ‹è¯•"><span class="title"><span class="icon iconfont icon-debug"></span>å¼€å‘|æµ‹è¯•</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/develop/devlibrary/dev-lib-lombok.html" class="nav-link" aria-label="å¼€å‘-å¸¸ç”¨ç±»åº“"><span class="icon iconfont icon-creative"></span>å¼€å‘-å¸¸ç”¨ç±»åº“<!----></a></li><li class="dropdown-item"><a href="/develop/security/dev-security-x-injection.html" class="nav-link" aria-label="å¼€å‘-å®‰å…¨"><span class="icon iconfont icon-creative"></span>å¼€å‘-å®‰å…¨<!----></a></li><li class="dropdown-item"><a href="/develop/optimization/optimization-x-interface-optimization.html" class="nav-link" aria-label="å¼€å‘ - ä¼˜åŒ–"><span class="icon iconfont icon-creative"></span>å¼€å‘ - ä¼˜åŒ–<!----></a></li><li class="dropdown-item"><a href="/develop/style/dev-qt-code-style.html" class="nav-link" aria-label="å¼€å‘ - è§„èŒƒ/é£æ ¼"><span class="icon iconfont icon-creative"></span>å¼€å‘ - è§„èŒƒ/é£æ ¼<!----></a></li><li class="dropdown-item"><a href="/develop/test/ut-overview" class="nav-link" aria-label="æµ‹è¯•"><span class="icon iconfont icon-creative"></span>æµ‹è¯•<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="è½¯ä»¶|éƒ¨ç½²"><span class="title"><span class="icon iconfont icon-software"></span>è½¯ä»¶|éƒ¨ç½²</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/deploy/docker/docker-basic-overview.html" class="nav-link" aria-label="Docker"><span class="icon iconfont icon-creative"></span>Docker<!----></a></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>æ¶ˆæ¯é˜Ÿåˆ—</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/deploy/mq/mq-a-overview.html" class="nav-link" aria-label="æ¶ˆæ¯é˜Ÿåˆ—"><!---->æ¶ˆæ¯é˜Ÿåˆ—<!----></a></li><li class="dropdown-subitem"><a href="/deploy/mq-rabbitmq/rabbitmq-x-overview.html" class="nav-link" aria-label="RabbitMQ"><!---->RabbitMQ<!----></a></li><li class="dropdown-subitem"><a href="/deploy/mq-kafka/kafka-x-overview.html" class="nav-link" aria-label="Kafka"><!---->Kafka<!----></a></li></ul></li><li class="dropdown-item"><a href="/deploy/skywalking/skywalking-x-principle.html" class="nav-link" aria-label="Skywalking"><span class="icon iconfont icon-creative"></span>Skywalking<!----></a></li><li class="dropdown-item"><a href="/deploy/linux/linux-j-monitor-overview.html" class="nav-link" aria-label="Linux"><span class="icon iconfont icon-creative"></span>Linux<!----></a></li><li class="dropdown-item"><a href="/deploy/jenkins/jenkins-overview.html" class="nav-link" aria-label="Jenkins"><span class="icon iconfont icon-creative"></span>Jenkins<!----></a></li><li class="dropdown-item"><a href="/deploy/nginx/nginx-x-overview.html" class="nav-link" aria-label="Nginx"><span class="icon iconfont icon-creative"></span>Nginx<!----></a></li><li class="dropdown-item"><a href="/deploy/deploy/docker-basic-overview" class="nav-link" aria-label="éƒ¨ç½²"><span class="icon iconfont icon-creative"></span>éƒ¨ç½²<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="æ¶æ„|ç³»ç»Ÿ"><span class="title"><span class="icon iconfont icon-strong"></span>æ¶æ„|ç³»ç»Ÿ</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/arch/base/arch-basic.html" class="nav-link" aria-label="æ¶æ„åŸºç¡€"><span class="icon iconfont icon-creative"></span>æ¶æ„åŸºç¡€<!----></a></li><li class="dropdown-item"><a href="/arch/distributed/arch-id.html" class="nav-link" aria-label="åˆ†å¸ƒå¼ç³»ç»Ÿ"><span class="icon iconfont icon-creative"></span>åˆ†å¸ƒå¼ç³»ç»Ÿ<!----></a></li><li class="dropdown-item"><a href="/arch/microservices/ms-overview.html" class="nav-link" aria-label="å¾®æœåŠ¡"><span class="icon iconfont icon-creative"></span>å¾®æœåŠ¡<!----></a></li><li class="dropdown-item"><a href="/arch/minio/minio-concept.html" class="nav-link" aria-label="å¯¹è±¡å­˜å‚¨-Minio"><span class="icon iconfont icon-creative"></span>å¯¹è±¡å­˜å‚¨-Minio<!----></a></li><li class="dropdown-item"><a href="/arch/manage-system/manage-system-technical-selection.html" class="nav-link" aria-label="åå°ç®¡ç†ç³»ç»Ÿ"><span class="icon iconfont icon-creative"></span>åå°ç®¡ç†ç³»ç»Ÿ<!----></a></li><li class="dropdown-item"><a href="/arch/mall/mall-sku.html" class="nav-link" aria-label="å•†åŸè®¾è®¡"><span class="icon iconfont icon-creative"></span>å•†åŸè®¾è®¡<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="åŒºå—é“¾"><span class="title"><span class="icon iconfont icon-bitbucket"></span>åŒºå—é“¾</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/blockchain/basic-logic/The_white_paper_the_currency.html" class="nav-link" aria-label="åŒºå—é“¾ç™½çš®ä¹¦"><span class="icon iconfont icon-creative"></span>åŒºå—é“¾ç™½çš®ä¹¦<!----></a></li><li class="dropdown-item"><a href="/blockchain/component/Introduction_to_libp2p_autoNAT_network.html" class="nav-link" aria-label="åŒºå—é“¾ç»„ä»¶"><span class="icon iconfont icon-creative"></span>åŒºå—é“¾ç»„ä»¶<!----></a></li><li class="dropdown-item"><a href="/blockchain/male-chain-research/ethereum/0.Rounding.html" class="nav-link" aria-label="ä¸»æµåŒºå—é“¾ç ”ç©¶"><span class="icon iconfont icon-creative"></span>ä¸»æµåŒºå—é“¾ç ”ç©¶<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="æ‚é¡¹|æ€è€ƒ"><span class="title"><span class="icon iconfont icon-anonymous"></span>æ‚é¡¹|æ€è€ƒ</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/think/deepImpression/redis-bigdata-slow-problem.html" class="nav-link" aria-label="Bugè®°å½•"><span class="icon iconfont icon-creative"></span>Bugè®°å½•<!----></a></li><li class="dropdown-item"><a href="/think/optimization/optimization-x-frequent-operation-db.html" class="nav-link" aria-label="ä¼˜åŒ–"><span class="icon iconfont icon-creative"></span>ä¼˜åŒ–<!----></a></li><li class="dropdown-item"><a href="/think/misc/misc-x-middleware.html" class="nav-link" aria-label="æ‚é¡¹"><span class="icon iconfont icon-creative"></span>æ‚é¡¹<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="è‡ªæˆ‘è®°å½•"><span class="title"><span class="icon iconfont icon-anonymous"></span>è‡ªæˆ‘è®°å½•</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/self/good-article/use-rss-email-read.html" class="nav-link" aria-label="å¥½æ–‡åˆ†äº«"><span class="icon iconfont icon-creative"></span>å¥½æ–‡åˆ†äº«<!----></a></li></ul></button></div></div></nav><!----></div><div class="navbar-right"><!----><div class="nav-item"><a class="repo-link" href="https://github.com/token01/token01.github.io" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button class="outlook-button" tabindex="-1" ariahidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="outlook-dropdown"><!----></div></button></div><div id="docsearch-container"></div><!----><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><a href="/blockchain/" class="nav-link sidebar-link sidebar-page" aria-label="å‰è¨€"><!---->å‰è¨€<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable active"><!----><span class="title">ä¸»æµåŒºå—é“¾ç ”ç©¶</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">cosmosåŒºå—é“¾</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable active"><!----><span class="title">FileCoin</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><!--[--><a aria-current="page" href="/blockchain/male-chain-research/FileCoin/FileCoin_technical_documentation.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="fileCoinæŠ€æœ¯æ–‡æ¡£"><!---->fileCoinæŠ€æœ¯æ–‡æ¡£<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/blockchain/male-chain-research/FileCoin/FileCoin_technical_documentation.html#_1-2-æ¶æ„å›¾" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.2 æ¶æ„å›¾"><!---->1.2 æ¶æ„å›¾<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blockchain/male-chain-research/FileCoin/FileCoin_technical_documentation.html#_1-3-å…³é”®å†…å®¹" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.3 å…³é”®å†…å®¹"><!---->1.3 å…³é”®å†…å®¹<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blockchain/male-chain-research/FileCoin/FileCoin_technical_documentation.html#_1-4-filecoin-vm" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.4 FileCoin VM"><!---->1.4 FileCoin VM<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blockchain/male-chain-research/FileCoin/FileCoin_technical_documentation.html#_1-5-ç³»ç»Ÿåˆ†è§£" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.5 ç³»ç»Ÿåˆ†è§£"><!---->1.5 ç³»ç»Ÿåˆ†è§£<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/blockchain/male-chain-research/FileCoin/FileCoin_technical_documentation.html#_1-5-1-ç³»ç»Ÿæ˜¯ä»€ä¹ˆ-å¦‚ä½•å·¥ä½œ" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.5.1 ç³»ç»Ÿæ˜¯ä»€ä¹ˆï¼Œå¦‚ä½•å·¥ä½œ"><!---->1.5.1 ç³»ç»Ÿæ˜¯ä»€ä¹ˆï¼Œå¦‚ä½•å·¥ä½œ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blockchain/male-chain-research/FileCoin/FileCoin_technical_documentation.html#_1-5-2-å®ç°ç³»ç»Ÿ" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.5.2 å®ç°ç³»ç»Ÿ"><!---->1.5.2 å®ç°ç³»ç»Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blockchain/male-chain-research/FileCoin/FileCoin_technical_documentation.html#_2-1-filecoinèŠ‚ç‚¹" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.1 FilecoinèŠ‚ç‚¹"><!---->2.1 FilecoinèŠ‚ç‚¹<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/blockchain/male-chain-research/FileCoin/FileCoin_technical_documentation.html#_2-1-1èŠ‚ç‚¹ç±»å‹" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.1.1èŠ‚ç‚¹ç±»å‹"><!---->2.1.1èŠ‚ç‚¹ç±»å‹<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blockchain/male-chain-research/FileCoin/FileCoin_technical_documentation.html#_2-1-2èŠ‚ç‚¹å­˜å‚¨åº“" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.1.2èŠ‚ç‚¹å­˜å‚¨åº“"><!---->2.1.2èŠ‚ç‚¹å­˜å‚¨åº“<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blockchain/male-chain-research/FileCoin/FileCoin_technical_documentation.html#_2-1-3-ç½‘ç»œæ¥å£" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.1.3 ç½‘ç»œæ¥å£"><!---->2.1.3 ç½‘ç»œæ¥å£<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blockchain/male-chain-research/FileCoin/FileCoin_technical_documentation.html#_2-1-4æ—¶é’Ÿ" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.1.4æ—¶é’Ÿ"><!---->2.1.4æ—¶é’Ÿ<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blockchain/male-chain-research/FileCoin/FileCoin_technical_documentation.html#_2-2æ–‡ä»¶å’Œæ•°æ®" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.2æ–‡ä»¶å’Œæ•°æ®"><!---->2.2æ–‡ä»¶å’Œæ•°æ®<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/blockchain/male-chain-research/FileCoin/FileCoin_technical_documentation.html#_2-2-1æ–‡ä»¶" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.2.1æ–‡ä»¶"><!---->2.2.1æ–‡ä»¶<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blockchain/male-chain-research/FileCoin/FileCoin_technical_documentation.html#_2-2-2æ–‡ä»¶å¸ç‰‡" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.2.2æ–‡ä»¶å¸ç‰‡"><!---->2.2.2æ–‡ä»¶å¸ç‰‡<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blockchain/male-chain-research/FileCoin/FileCoin_technical_documentation.html#_2-2-3filecoinä¸­çš„æ•°æ®ä¼ è¾“" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.2.3Filecoinä¸­çš„æ•°æ®ä¼ è¾“"><!---->2.2.3Filecoinä¸­çš„æ•°æ®ä¼ è¾“<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blockchain/male-chain-research/FileCoin/FileCoin_technical_documentation.html#_2-2-4æ•°æ®æ ¼å¼å’Œåºåˆ—åŒ–" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.2.4æ•°æ®æ ¼å¼å’Œåºåˆ—åŒ–"><!---->2.2.4æ•°æ®æ ¼å¼å’Œåºåˆ—åŒ–<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blockchain/male-chain-research/FileCoin/FileCoin_technical_documentation.html#_2-3è™šæ‹Ÿæœº" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.3è™šæ‹Ÿæœº"><!---->2.3è™šæ‹Ÿæœº<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/blockchain/male-chain-research/FileCoin/FileCoin_technical_documentation.html#_2-3-1vm-actoræ¥å£" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.3.1VM Actoræ¥å£"><!---->2.3.1VM Actoræ¥å£<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blockchain/male-chain-research/FileCoin/FileCoin_technical_documentation.html#_2-3-2çŠ¶æ€æ ‘" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.3.2çŠ¶æ€æ ‘"><!---->2.3.2çŠ¶æ€æ ‘<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blockchain/male-chain-research/FileCoin/FileCoin_technical_documentation.html#_2-3-3vmæ¶ˆæ¯-actoræ–¹æ³•è°ƒç”¨" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.3.3VMæ¶ˆæ¯-Actoræ–¹æ³•è°ƒç”¨"><!---->2.3.3VMæ¶ˆæ¯-Actoræ–¹æ³•è°ƒç”¨<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blockchain/male-chain-research/FileCoin/FileCoin_technical_documentation.html#_2-3-4vmè¿è¡Œæ—¶ç¯å¢ƒ-åœ¨vmå†…éƒ¨" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.3.4VMè¿è¡Œæ—¶ç¯å¢ƒï¼ˆåœ¨VMå†…éƒ¨ï¼‰"><!---->2.3.4VMè¿è¡Œæ—¶ç¯å¢ƒï¼ˆåœ¨VMå†…éƒ¨ï¼‰<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blockchain/male-chain-research/FileCoin/FileCoin_technical_documentation.html#_2-3-5ç…¤æ°”è´¹" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.3.5ç…¤æ°”è´¹"><!---->2.3.5ç…¤æ°”è´¹<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blockchain/male-chain-research/FileCoin/FileCoin_technical_documentation.html#_2-3-6ç³»ç»Ÿè§’è‰²" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.3.6ç³»ç»Ÿè§’è‰²"><!---->2.3.6ç³»ç»Ÿè§’è‰²<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blockchain/male-chain-research/FileCoin/FileCoin_technical_documentation.html#_2-3-7vmè§£é‡Šå™¨-æ¶ˆæ¯è°ƒç”¨-å¤–éƒ¨vm" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.3.7VMè§£é‡Šå™¨-æ¶ˆæ¯è°ƒç”¨ï¼ˆå¤–éƒ¨VMï¼‰"><!---->2.3.7VMè§£é‡Šå™¨-æ¶ˆæ¯è°ƒç”¨ï¼ˆå¤–éƒ¨VMï¼‰<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blockchain/male-chain-research/FileCoin/FileCoin_technical_documentation.html#_2-4åŒºå—é“¾" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.4åŒºå—é“¾"><!---->2.4åŒºå—é“¾<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/blockchain/male-chain-research/FileCoin/FileCoin_technical_documentation.html#_2-4-1ç§¯æœ¨" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.4.1ç§¯æœ¨"><!---->2.4.1ç§¯æœ¨<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blockchain/male-chain-research/FileCoin/FileCoin_technical_documentation.html#_2-4-ä¿¡æ¯æ± " class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.4.ä¿¡æ¯æ± "><!---->2.4.ä¿¡æ¯æ± <!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blockchain/male-chain-research/FileCoin/FileCoin_technical_documentation.html#_2-4-3é“¾åŒæ­¥" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.4.3é“¾åŒæ­¥"><!---->2.4.3é“¾åŒæ­¥<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/blockchain/male-chain-research/FileCoin/FileCoin_technical_documentation.html#_2-4-å‚¨èƒ½å…±è¯†" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.4.å‚¨èƒ½å…±è¯†"><!---->2.4.å‚¨èƒ½å…±è¯†<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li></ul><!--]--></li><li><!--[--><a href="/blockchain/male-chain-research/FileCoin/Introduction_to_FileCoin_economic_model.html" class="nav-link sidebar-link sidebar-page" aria-label="æµ…è°ˆFileCoin|ç»æµæ¨¡å‹"><!---->æµ…è°ˆFileCoin|ç»æµæ¨¡å‹<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">hyperleger fabric</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">IPFS</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">tendermint</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">ä»¥å¤ªåŠåŒºå—é“¾</span><span class="arrow right"></span></button><!----></section><!--]--></li></ul></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">åŒºå—é“¾ç»„ä»¶</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">åŸºç¡€çŸ¥è¯†</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">æ™ºèƒ½åˆçº¦</span><span class="arrow right"></span></button><!----></section><!--]--></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->fileCoinæŠ€æœ¯æ–‡æ¡£</h1><div class="page-info"><span class="author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="down" localizeddate="2022å¹´12æœˆ25æ—¥" isoriginal="false" pageview="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="author-item" href="/about-the-author/" target="_blank" rel="noopener noreferrer">Abel sun</a></span><span property="author" content="Abel sun"></span></span><!----><span class="date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="down" isoriginal="false" pageview="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span>2022å¹´12æœˆ25æ—¥</span><meta property="datePublished" content="2022-12-25T02:12:30.000Z"></span><span class="category-info" aria-label="åˆ†ç±»ğŸŒˆ" data-balloon-pos="down" localizeddate="2022å¹´12æœˆ25æ—¥" isoriginal="false" pageview="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><ul class="categories-wrapper"><li class="category category5 clickable" role="navigation">åŒºå—é“¾</li><meta property="articleSection" content="åŒºå—é“¾"></ul></span><span aria-label="æ ‡ç­¾ğŸ·" data-balloon-pos="down" localizeddate="2022å¹´12æœˆ25æ—¥" isoriginal="false" pageview="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><ul class="tags-wrapper"><li class="tag tag2 clickable" role="navigation">fileCoin</li></ul><meta property="keywords" content="fileCoin"></span><span class="words-info" aria-label="å­—æ•°ğŸ” " data-balloon-pos="down" localizeddate="2022å¹´12æœˆ25æ—¥" isoriginal="false" pageview="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon word-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="word icon"><path d="M518.217 432.64V73.143A73.143 73.143 0 01603.43 1.097a512 512 0 01419.474 419.474 73.143 73.143 0 01-72.046 85.212H591.36a73.143 73.143 0 01-73.143-73.143z"></path><path d="M493.714 566.857h340.297a73.143 73.143 0 0173.143 85.577A457.143 457.143 0 11371.566 117.76a73.143 73.143 0 0185.577 73.143v339.383a36.571 36.571 0 0036.571 36.571z"></path></svg><span>çº¦ 36271 å­—</span><meta property="wordCount" content="36271"></span><span class="reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="down" localizeddate="2022å¹´12æœˆ25æ—¥" isoriginal="false" pageview="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 121 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT121M"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">æ­¤é¡µå†…å®¹</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blockchain/male-chain-research/FileCoin/FileCoin_technical_documentation.html#_1-2-æ¶æ„å›¾" class="router-link-active router-link-exact-active toc-link level2">1.2 æ¶æ„å›¾</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blockchain/male-chain-research/FileCoin/FileCoin_technical_documentation.html#_1-3-å…³é”®å†…å®¹" class="router-link-active router-link-exact-active toc-link level2">1.3 å…³é”®å†…å®¹</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blockchain/male-chain-research/FileCoin/FileCoin_technical_documentation.html#_1-4-filecoin-vm" class="router-link-active router-link-exact-active toc-link level2">1.4 FileCoin VM</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blockchain/male-chain-research/FileCoin/FileCoin_technical_documentation.html#_1-5-ç³»ç»Ÿåˆ†è§£" class="router-link-active router-link-exact-active toc-link level2">1.5 ç³»ç»Ÿåˆ†è§£</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blockchain/male-chain-research/FileCoin/FileCoin_technical_documentation.html#_1-5-1-ç³»ç»Ÿæ˜¯ä»€ä¹ˆ-å¦‚ä½•å·¥ä½œ" class="router-link-active router-link-exact-active toc-link level3">1.5.1 ç³»ç»Ÿæ˜¯ä»€ä¹ˆï¼Œå¦‚ä½•å·¥ä½œ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blockchain/male-chain-research/FileCoin/FileCoin_technical_documentation.html#_1-5-2-å®ç°ç³»ç»Ÿ" class="router-link-active router-link-exact-active toc-link level3">1.5.2 å®ç°ç³»ç»Ÿ</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blockchain/male-chain-research/FileCoin/FileCoin_technical_documentation.html#_2-1-filecoinèŠ‚ç‚¹" class="router-link-active router-link-exact-active toc-link level2">2.1 FilecoinèŠ‚ç‚¹</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blockchain/male-chain-research/FileCoin/FileCoin_technical_documentation.html#_2-1-1èŠ‚ç‚¹ç±»å‹" class="router-link-active router-link-exact-active toc-link level3">2.1.1èŠ‚ç‚¹ç±»å‹</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blockchain/male-chain-research/FileCoin/FileCoin_technical_documentation.html#_2-1-2èŠ‚ç‚¹å­˜å‚¨åº“" class="router-link-active router-link-exact-active toc-link level3">2.1.2èŠ‚ç‚¹å­˜å‚¨åº“</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blockchain/male-chain-research/FileCoin/FileCoin_technical_documentation.html#_2-1-3-ç½‘ç»œæ¥å£" class="router-link-active router-link-exact-active toc-link level3">2.1.3 ç½‘ç»œæ¥å£</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blockchain/male-chain-research/FileCoin/FileCoin_technical_documentation.html#_2-1-4æ—¶é’Ÿ" class="router-link-active router-link-exact-active toc-link level3">2.1.4æ—¶é’Ÿ</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blockchain/male-chain-research/FileCoin/FileCoin_technical_documentation.html#_2-2æ–‡ä»¶å’Œæ•°æ®" class="router-link-active router-link-exact-active toc-link level2">2.2æ–‡ä»¶å’Œæ•°æ®</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blockchain/male-chain-research/FileCoin/FileCoin_technical_documentation.html#_2-2-1æ–‡ä»¶" class="router-link-active router-link-exact-active toc-link level3">2.2.1æ–‡ä»¶</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blockchain/male-chain-research/FileCoin/FileCoin_technical_documentation.html#_2-2-2æ–‡ä»¶å¸ç‰‡" class="router-link-active router-link-exact-active toc-link level3">2.2.2æ–‡ä»¶å¸ç‰‡</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blockchain/male-chain-research/FileCoin/FileCoin_technical_documentation.html#_2-2-3filecoinä¸­çš„æ•°æ®ä¼ è¾“" class="router-link-active router-link-exact-active toc-link level3">2.2.3Filecoinä¸­çš„æ•°æ®ä¼ è¾“</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blockchain/male-chain-research/FileCoin/FileCoin_technical_documentation.html#_2-2-4æ•°æ®æ ¼å¼å’Œåºåˆ—åŒ–" class="router-link-active router-link-exact-active toc-link level3">2.2.4æ•°æ®æ ¼å¼å’Œåºåˆ—åŒ–</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blockchain/male-chain-research/FileCoin/FileCoin_technical_documentation.html#_2-3è™šæ‹Ÿæœº" class="router-link-active router-link-exact-active toc-link level2">2.3è™šæ‹Ÿæœº</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blockchain/male-chain-research/FileCoin/FileCoin_technical_documentation.html#_2-3-1vm-actoræ¥å£" class="router-link-active router-link-exact-active toc-link level3">2.3.1VM Actoræ¥å£</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blockchain/male-chain-research/FileCoin/FileCoin_technical_documentation.html#_2-3-2çŠ¶æ€æ ‘" class="router-link-active router-link-exact-active toc-link level3">2.3.2çŠ¶æ€æ ‘</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blockchain/male-chain-research/FileCoin/FileCoin_technical_documentation.html#_2-3-3vmæ¶ˆæ¯-actoræ–¹æ³•è°ƒç”¨" class="router-link-active router-link-exact-active toc-link level3">2.3.3VMæ¶ˆæ¯-Actoræ–¹æ³•è°ƒç”¨</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blockchain/male-chain-research/FileCoin/FileCoin_technical_documentation.html#_2-3-4vmè¿è¡Œæ—¶ç¯å¢ƒ-åœ¨vmå†…éƒ¨" class="router-link-active router-link-exact-active toc-link level3">2.3.4VMè¿è¡Œæ—¶ç¯å¢ƒï¼ˆåœ¨VMå†…éƒ¨ï¼‰</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blockchain/male-chain-research/FileCoin/FileCoin_technical_documentation.html#_2-3-5ç…¤æ°”è´¹" class="router-link-active router-link-exact-active toc-link level3">2.3.5ç…¤æ°”è´¹</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blockchain/male-chain-research/FileCoin/FileCoin_technical_documentation.html#_2-3-6ç³»ç»Ÿè§’è‰²" class="router-link-active router-link-exact-active toc-link level3">2.3.6ç³»ç»Ÿè§’è‰²</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blockchain/male-chain-research/FileCoin/FileCoin_technical_documentation.html#_2-3-7vmè§£é‡Šå™¨-æ¶ˆæ¯è°ƒç”¨-å¤–éƒ¨vm" class="router-link-active router-link-exact-active toc-link level3">2.3.7VMè§£é‡Šå™¨-æ¶ˆæ¯è°ƒç”¨ï¼ˆå¤–éƒ¨VMï¼‰</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blockchain/male-chain-research/FileCoin/FileCoin_technical_documentation.html#_2-4åŒºå—é“¾" class="router-link-active router-link-exact-active toc-link level2">2.4åŒºå—é“¾</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/blockchain/male-chain-research/FileCoin/FileCoin_technical_documentation.html#_2-4-1ç§¯æœ¨" class="router-link-active router-link-exact-active toc-link level3">2.4.1ç§¯æœ¨</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blockchain/male-chain-research/FileCoin/FileCoin_technical_documentation.html#_2-4-ä¿¡æ¯æ± " class="router-link-active router-link-exact-active toc-link level3">2.4.ä¿¡æ¯æ± </a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blockchain/male-chain-research/FileCoin/FileCoin_technical_documentation.html#_2-4-3é“¾åŒæ­¥" class="router-link-active router-link-exact-active toc-link level3">2.4.3é“¾åŒæ­¥</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/blockchain/male-chain-research/FileCoin/FileCoin_technical_documentation.html#_2-4-å‚¨èƒ½å…±è¯†" class="router-link-active router-link-exact-active toc-link level3">2.4.å‚¨èƒ½å…±è¯†</a></li><!----><!--]--></ul><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><blockquote><p>ç¿»è¯‘è‡ªï¼š<a href="https://spec.filecoin.io/#section-systems.filecoin_vm.interpreter" target="_blank" rel="noopener noreferrer">https://spec.filecoin.io/#section-systems.filecoin_vm.interpreter<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></blockquote><h1 id="_1-ä»‹ç»" tabindex="-1"><a class="header-anchor" href="#_1-ä»‹ç»" aria-hidden="true">#</a> 1. ä»‹ç»</h1><p>Filecoinæ˜¯ä¸€ä¸ªåŸºäºåŒºå—é“¾æœºåˆ¶çš„åˆ†å¸ƒå¼å­˜å‚¨ç½‘ç»œã€‚FilecoinçŸ¿å·¥å¯ä»¥é€‰æ‹©ä¸ºç½‘ç»œæä¾›å­˜å‚¨å®¹é‡ï¼Œä»è€Œé€šè¿‡å®šæœŸç”ŸæˆåŠ å¯†è¯æ˜æ¥è·å¾—FilecoinåŠ å¯†è´§å¸(FIL)çš„å•ä½ï¼Œè¯æ˜ä»–ä»¬æ­£åœ¨æä¾›æŒ‡å®šçš„å®¹é‡ã€‚æ­¤å¤–ï¼ŒFilecoinå…è®¸å„æ–¹é€šè¿‡FilecoinåŒºå—é“¾ä¸Šçš„å…±äº«åˆ†ç±»è´¦è®°å½•çš„äº¤æ˜“æ¥äº¤æ¢Filecoinè´§å¸ã€‚ç„¶è€Œï¼ŒFilecoinå¹¶æ²¡æœ‰ä½¿ç”¨å·¥ä½œé‡è¯æ˜æ¥ç»´æŠ¤é“¾ä¸Šçš„å…±è¯†ï¼Œè€Œæ˜¯ä½¿ç”¨äº†å­˜å‚¨è¯æ˜æœ¬èº«:ä¸€ä¸ªçŸ¿å·¥åœ¨å…±è¯†åè®®ä¸­çš„èƒ½åŠ›ä¸å®ƒæä¾›çš„å­˜å‚¨é‡æˆæ¯”ä¾‹ã€‚</p><p>FilecoinåŒºå—é“¾ä¸ä»…ç»´æŠ¤Filecoinäº¤æ˜“å’Œè´¦æˆ·çš„åˆ†ç±»è´¦æœ¬ï¼Œè¿˜å®ç°äº†Filecoin VMï¼Œè¿™æ˜¯ä¸€ä¸ªå¯å¤åˆ¶çš„çŠ¶æ€æœºï¼Œåœ¨ç½‘ç»œä¸Šçš„å‚ä¸è€…ä¹‹é—´æ‰§è¡Œå„ç§åŠ å¯†åˆçº¦å’Œå¸‚åœºæœºåˆ¶ã€‚è¿™äº›åˆçº¦åŒ…æ‹¬å­˜å‚¨äº¤æ˜“ï¼Œå®¢æˆ·å‘çŸ¿å·¥æ”¯ä»˜FILè´§å¸ï¼Œä»¥æ¢å–å­˜å‚¨å®¢æˆ·è¯·æ±‚çš„ç‰¹å®šæ–‡ä»¶æ•°æ®ã€‚é€šè¿‡Filecoin VMçš„åˆ†å¸ƒå¼å®ç°ï¼Œå­˜å‚¨äº¤æ˜“å’Œå…¶ä»–è®°å½•åœ¨é“¾ä¸Šçš„åˆçº¦æœºåˆ¶å°†éšç€æ—¶é—´çš„æ¨ç§»ç»§ç»­å¤„ç†ï¼Œè€Œä¸éœ€è¦åŸå§‹å„æ–¹(å¦‚è¯·æ±‚æ•°æ®å­˜å‚¨çš„å®¢æˆ·ç«¯)çš„è¿›ä¸€æ­¥äº¤äº’ã€‚</p><h2 id="_1-2-æ¶æ„å›¾" tabindex="-1"><a class="header-anchor" href="#_1-2-æ¶æ„å›¾" aria-hidden="true">#</a> 1.2 æ¶æ„å›¾</h2><p>ActorçŠ¶æ€å›¾ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gn7sf9164mj31r10u0jza.jpg" alt="image-20210201094233728"></p><h2 id="_1-3-å…³é”®å†…å®¹" tabindex="-1"><a class="header-anchor" href="#_1-3-å…³é”®å†…å®¹" aria-hidden="true">#</a> 1.3 å…³é”®å†…å®¹</h2><ul><li><strong>Data structures</strong>æ˜¯å¸¦æœ‰è¯­ä¹‰æ ‡è®°çš„æ•°æ®æˆå‘˜(ä¾‹å¦‚ï¼Œç»“æ„ã€æ¥å£æˆ–æšä¸¾)çš„é›†åˆã€‚</li><li><strong>Function</strong>æ˜¯ä¸ä¾èµ–äºå¤–éƒ¨çŠ¶æ€çš„è®¡ç®—è¿‡ç¨‹(ä¾‹å¦‚ï¼Œæ•°å­¦å‡½æ•°æˆ–ä¸å¼•ç”¨å…¨å±€å˜é‡çš„ç¼–ç¨‹è¯­è¨€å‡½æ•°)</li><li><strong>Components</strong>æ˜¯ä¸€ç»„åŠŸèƒ½ï¼Œåœ¨å®ç°ç»“æ„ä¸­è¢«è¡¨ç¤ºä¸ºå•ä¸ªè½¯ä»¶å•å…ƒã€‚æ ¹æ®è¯­è¨€å’Œç‰¹å®šç»„ä»¶çš„é€‰æ‹©ï¼Œè¿™å¯èƒ½å¯¹åº”äºå•ä¸ªè½¯ä»¶æ¨¡å—ã€è¿è¡Œä¸»å¾ªç¯çš„çº¿ç¨‹æˆ–è¿›ç¨‹ã€ç£ç›˜æ”¯æŒçš„æ•°æ®åº“æˆ–å„ç§å…¶ä»–è®¾è®¡é€‰æ‹©ã€‚ä¾‹å¦‚ï¼ŒChainSyncæ˜¯ä¸€ä¸ªç»„ä»¶:å®ƒå¯ä»¥è¢«å®ç°ä¸ºä¸€ä¸ªè¿›ç¨‹æˆ–çº¿ç¨‹è¿è¡Œå•ä¸ªæŒ‡å®šçš„ä¸»å¾ªç¯ï¼Œå®ƒç­‰å¾…ç½‘ç»œæ¶ˆæ¯ï¼Œå¹¶é€šè¿‡è®°å½•å’Œ/æˆ–è½¬å‘å—æ•°æ®æ¥å“åº”ã€‚</li><li><strong>api</strong>æ˜¯å°†æ¶ˆæ¯ä¼ é€’ç»™ç»„ä»¶çš„æ¥å£ã€‚ä¸€ä¸ªç»™å®šå­åè®®çš„å®¢æˆ·ç«¯è§†å›¾ï¼Œä¾‹å¦‚å‘ä¸€ä¸ªminerèŠ‚ç‚¹çš„Storage Providerç»„ä»¶è¯·æ±‚åœ¨å­˜å‚¨å¸‚åœºä¸­å­˜å‚¨æ–‡ä»¶ï¼Œå¯èƒ½éœ€è¦æ‰§è¡Œä¸€ç³»åˆ—çš„APIè¯·æ±‚ã€‚</li><li><strong>Nodes</strong>æ˜¯ä¸åè®®äº¤äº’çš„å®Œæ•´çš„è½¯ä»¶å’Œç¡¬ä»¶ç³»ç»Ÿã€‚ä¸€ä¸ªèŠ‚ç‚¹å¯èƒ½ä¼šä¸æ–­åœ°è¿è¡Œä¸Šè¿°å‡ ä¸ªç»„ä»¶ï¼Œå‚ä¸å¤šä¸ªå­ç³»ç»Ÿï¼Œå¹¶åœ¨æœ¬åœ°å’Œ/æˆ–é€šè¿‡ç½‘ç»œå…¬å¼€apiï¼Œè¿™å–å†³äºèŠ‚ç‚¹é…ç½®ã€‚æœ¯è¯­â€œå®Œæ•´èŠ‚ç‚¹â€æ˜¯æŒ‡è¿è¡Œä¸Šè¿°æ‰€æœ‰ç»„ä»¶å¹¶æ”¯æŒè§„èŒƒä¸­è¯¦ç»†æè¿°çš„æ‰€æœ‰apiçš„ç³»ç»Ÿã€‚</li><li><strong>Subsystems</strong>æ˜¯æ•´ä¸ªFilecoinåè®®çš„æ¦‚å¿µåˆ’åˆ†ï¼Œè¦ä¹ˆæ˜¯æŒ‰ç…§å®Œæ•´çš„åè®®(å¦‚å­˜å‚¨å¸‚åœºæˆ–æ£€ç´¢å¸‚åœº)ï¼Œè¦ä¹ˆæ˜¯æŒ‰ç…§åŠŸèƒ½(å¦‚VM - Virtual Machine)ã€‚å®ƒä»¬ä¸ä¸€å®šå¯¹åº”äºä»»ä½•ç‰¹å®šçš„èŠ‚ç‚¹æˆ–è½¯ä»¶ç»„ä»¶ã€‚</li><li><strong>Actor</strong>æ˜¯ä½“ç°åœ¨Filecoin VMçŠ¶æ€ä¸­çš„è™šæ‹Ÿå®ä½“ã€‚åè®®å‚ä¸è€…ç±»ä¼¼äºæ™ºèƒ½åˆçº¦çš„å‚ä¸è€…;å‚ä¸è€…æºå¸¦FILè´§å¸ä½™é¢ï¼Œå¹¶å¯ä»¥é€šè¿‡VMçš„æ“ä½œä¸å…¶ä»–å‚ä¸è€…äº¤äº’ï¼Œä½†å¹¶ä¸ä¸€å®šå¯¹åº”äºä»»ä½•ç‰¹å®šçš„èŠ‚ç‚¹æˆ–è½¯ä»¶ç»„ä»¶ã€‚</li></ul><h2 id="_1-4-filecoin-vm" tabindex="-1"><a class="header-anchor" href="#_1-4-filecoin-vm" aria-hidden="true">#</a> 1.4 FileCoin VM</h2><p>Filecoinçš„å¤§å¤šæ•°ç”¨æˆ·æ‰€é¢å¯¹çš„åŠŸèƒ½(æ”¯ä»˜ã€å­˜å‚¨å¸‚åœºã€èƒ½é‡è¡¨ç­‰)æ˜¯é€šè¿‡Filecoinè™šæ‹Ÿæœº(Filecoin VM)ç®¡ç†çš„ã€‚è¯¥ç½‘ç»œç”Ÿæˆä¸€ç³»åˆ—åŒºå—ï¼Œå¹¶åŒæ„å“ªä¸ªåŒºå—é“¾æ˜¯æ­£ç¡®çš„ã€‚æ¯ä¸ªå—åŒ…å«ä¸€ç³»åˆ—ç§°ä¸ºæ¶ˆæ¯çš„çŠ¶æ€è½¬æ¢ï¼Œä»¥åŠåº”ç”¨è¿™äº›æ¶ˆæ¯åçš„å½“å‰å…¨å±€çŠ¶æ€æ£€æŸ¥ç‚¹ã€‚</p><p>è¿™é‡Œçš„å…¨å±€çŠ¶æ€ç”±ä¸€ç»„å‚ä¸è€…ï¼ˆ<strong>Actor</strong>ï¼‰ç»„æˆï¼Œæ¯ä¸ªå‚ä¸è€…éƒ½æœ‰è‡ªå·±çš„ç§æœ‰çŠ¶æ€ã€‚</p><p>ä¸€ä¸ªå‚ä¸è€…æ˜¯Filecoinç­‰ä»·äºä»¥å¤ªåŠçš„æ™ºèƒ½åˆçº¦ï¼Œå®ƒæœ¬è´¨ä¸Šæ˜¯Filecoinç½‘ç»œä¸­çš„ä¸€ä¸ªâ€œå¯¹è±¡â€ï¼Œå…·æœ‰çŠ¶æ€å’Œä¸€ç»„å¯ä»¥ç”¨æ¥ä¸ä¹‹äº¤äº’çš„æ–¹æ³•ã€‚æ¯ä¸ªå‚ä¸è€…éƒ½æœ‰ä¸€ä¸ªFilecoin balanceï¼Œä¸€ä¸ªçŠ¶æ€æŒ‡é’ˆï¼Œä¸€ä¸ªä»£ç CID(å‘Šè¯‰ç³»ç»Ÿå‚ä¸è€…æ˜¯ä»€ä¹ˆç±»å‹çš„å‚ä¸è€…)ï¼Œä»¥åŠä¸€ä¸ªnonce(è·Ÿè¸ªå‚ä¸è€…å‘é€çš„æ¶ˆæ¯æ•°é‡)ã€‚</p><p>åœ¨å‚ä¸è€…ä¸Šè°ƒç”¨æ–¹æ³•æœ‰ä¸¤ç§é€”å¾„ã€‚é¦–å…ˆï¼Œè¦ä½œä¸ºç³»ç»Ÿçš„å¤–éƒ¨å‚ä¸è€…(ä¹Ÿå°±æ˜¯ä½¿ç”¨Filecoinçš„æ™®é€šç”¨æˆ·)è°ƒç”¨æ–¹æ³•ï¼Œæ‚¨å¿…é¡»å‘ç½‘ç»œå‘é€ä¸€ä¸ªç­¾åæ¶ˆæ¯ï¼Œå¹¶å‘åŒ…å«æ‚¨çš„æ¶ˆæ¯çš„çŸ¿å·¥æ”¯ä»˜è´¹ç”¨ã€‚æ¶ˆæ¯ä¸Šçš„ç­¾åå¿…é¡»ä¸ä¸€ä¸ªå¸æˆ·ç›¸åŒ¹é…ï¼Œè¯¥å¸æˆ·æœ‰è¶³å¤Ÿçš„Filecoinæ¥æ”¯ä»˜æ¶ˆæ¯çš„æ‰§è¡Œè´¹ç”¨ã€‚è¿™é‡Œçš„è´¹ç”¨ç›¸å½“äºæ¯”ç‰¹å¸å’Œä»¥å¤ªåŠçš„äº¤æ˜“è´¹ç”¨ï¼Œå®ƒä¸å¤„ç†æ¶ˆæ¯æ‰€åšçš„å·¥ä½œæˆæ¯”ä¾‹(æ¯”ç‰¹å¸æŒ‰å­—èŠ‚ä¸ºæ¶ˆæ¯å®šä»·ï¼Œä»¥å¤ªåŠä½¿ç”¨â€œgasâ€çš„æ¦‚å¿µã€‚æˆ‘ä»¬ä¹Ÿç”¨gas)ã€‚</p><p>å…¶æ¬¡ï¼Œå‚ä¸è€…å¯ä»¥åœ¨è°ƒç”¨å…¶æ–¹æ³•ä¹‹ä¸€çš„è¿‡ç¨‹ä¸­è°ƒç”¨å¦ä¸€ä¸ªå‚ä¸è€…çš„æ–¹æ³•ã€‚ç„¶è€Œï¼Œå”¯ä¸€å¯èƒ½å‘ç”Ÿè¿™ç§æƒ…å†µçš„æ—¶å€™æ˜¯æŸä¸ªå‚ä¸è€…è¢«å¤–éƒ¨ç”¨æˆ·æ¶ˆæ¯è°ƒç”¨çš„ç»“æœ(æ³¨æ„:ç”¨æˆ·è°ƒç”¨çš„å‚ä¸è€…å¯èƒ½è°ƒç”¨å¦ä¸€ä¸ªå‚ä¸è€…ï¼Œç„¶åè°ƒç”¨å¦ä¸€ä¸ªå‚ä¸è€…ï¼Œåœ¨æ‰§è¡Œèƒ½å¤Ÿæ‰¿å—çš„å±‚æ¬¡ä¸Šå°½å¯èƒ½å¤š)ã€‚</p><p>å…·ä½“å®ç°è¯·å‚è§è™šæ‹Ÿæœºå­ç³»ç»Ÿã€‚</p><h2 id="_1-5-ç³»ç»Ÿåˆ†è§£" tabindex="-1"><a class="header-anchor" href="#_1-5-ç³»ç»Ÿåˆ†è§£" aria-hidden="true">#</a> 1.5 ç³»ç»Ÿåˆ†è§£</h2><h3 id="_1-5-1-ç³»ç»Ÿæ˜¯ä»€ä¹ˆ-å¦‚ä½•å·¥ä½œ" tabindex="-1"><a class="header-anchor" href="#_1-5-1-ç³»ç»Ÿæ˜¯ä»€ä¹ˆ-å¦‚ä½•å·¥ä½œ" aria-hidden="true">#</a> 1.5.1 ç³»ç»Ÿæ˜¯ä»€ä¹ˆï¼Œå¦‚ä½•å·¥ä½œ</h3><p>Filecoinå°†åŠŸèƒ½è§£è€¦å¹¶æ¨¡å—åŒ–åˆ°æ¾æ•£è¿æ¥çš„ç³»ç»Ÿä¸­ã€‚æ¯ä¸ªç³»ç»Ÿéƒ½å¢åŠ äº†é‡è¦çš„åŠŸèƒ½ï¼Œé€šå¸¸æ˜¯ä¸ºäº†å®ç°ä¸€ç»„é‡è¦ä¸”ç´§å¯†ç›¸å…³çš„ç›®æ ‡ã€‚</p><p>ä¾‹å¦‚ï¼ŒåŒºå—é“¾ç³»ç»Ÿæä¾›äº†å—ã€Tipsetå’Œé“¾ç­‰ç»“æ„ï¼Œå¹¶æä¾›äº†å—åŒæ­¥ã€å—ä¼ æ’­ã€å—éªŒè¯ã€é“¾é€‰æ‹©å’Œé“¾è®¿é—®ç­‰åŠŸèƒ½ã€‚è¿™ä¸æ–‡ä»¶ã€ç‰‡æ®µã€ç‰‡æ®µå‡†å¤‡å’Œæ•°æ®ä¼ è¾“æ˜¯åˆ†å¼€çš„ã€‚è¿™ä¸¤ä¸ªç³»ç»Ÿéƒ½ä¸å¸‚åœºåˆ†ç¦»ï¼Œå¸‚åœºæä¾›è®¢å•ã€äº¤æ˜“ã€å¸‚åœºå¯è§æ€§å’Œäº¤æ˜“ç»“ç®—ã€‚</p><h4 id="_1-5-1-1-ä¸ºä»€ä¹ˆç³»ç»Ÿè§£è€¦æœ‰ç”¨" tabindex="-1"><a class="header-anchor" href="#_1-5-1-1-ä¸ºä»€ä¹ˆç³»ç»Ÿè§£è€¦æœ‰ç”¨" aria-hidden="true">#</a> 1.5.1.1 ä¸ºä»€ä¹ˆç³»ç»Ÿè§£è€¦æœ‰ç”¨?</h4><p>ç†ç”±å¦‚ä¸‹ï¼š</p><ul><li>**å®æ–½è¾¹ç•Œï¼š**å¯ä»¥æ„å»ºä»…å®æ–½ä¸€éƒ¨åˆ†ç³»ç»Ÿçš„Filecoinå®æ–½ã€‚è¿™å¯¹äº<em>å®ç°å¤šæ ·æ€§</em>ç‰¹åˆ«æœ‰ç”¨ï¼šæˆ‘ä»¬éœ€è¦è®¸å¤šå®‰å…¨å…³é”®ç³»ç»Ÿï¼ˆä¾‹å¦‚ï¼ŒåŒºå—é“¾ï¼‰çš„å®ç°ï¼Œä½†ä¸éœ€è¦è®¸å¤šå¯ä»¥åˆ†ç¦»çš„ç³»ç»Ÿå®ç°ã€‚</li><li>**è¿è¡Œæ—¶è§£è€¦ï¼š**ç³»ç»Ÿè§£è€¦ä½¿æ„å»ºå’Œè¿è¡Œå°†ç³»ç»Ÿéš”ç¦»åˆ°å•ç‹¬ç¨‹åºç”šè‡³å•ç‹¬ç‰©ç†è®¡ç®—æœºä¸­çš„FilecoinèŠ‚ç‚¹å˜å¾—æ›´åŠ å®¹æ˜“ã€‚</li><li>**å®‰å…¨éš”ç¦»ï¼š**æŸäº›ç³»ç»Ÿæ¯”å…¶ä»–ç³»ç»Ÿéœ€è¦æ›´é«˜çš„æ“ä½œå®‰å…¨æ€§ã€‚ç³»ç»Ÿè§£è€¦ä½¿å®ç°èƒ½å¤Ÿæ»¡è¶³å…¶å®‰å…¨æ€§å’ŒåŠŸèƒ½æ€§éœ€æ±‚ã€‚ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­æ˜¯å°†åŒºå—é“¾å¤„ç†ä¸æ•°æ®ä¼ è¾“åˆ†å¼€ã€‚</li><li>**å¯ä¼¸ç¼©æ€§ï¼š**ç³»ç»Ÿå’Œå„ç§ç”¨ä¾‹å¯èƒ½ä¼šä¸ºä¸åŒçš„æ“ä½œå‘˜å¸¦æ¥ä¸åŒçš„æ€§èƒ½è¦æ±‚ã€‚ç³»ç»Ÿè§£è€¦ä½¿è¿è¥å•†æ›´å®¹æ˜“æ²¿ç€ç³»ç»Ÿè¾¹ç•Œæ‰©å±•å…¶éƒ¨ç½²ã€‚</li></ul><h4 id="_1-5-1-2-filecoin-èŠ‚ç‚¹ä¸éœ€è¦æ‰€æœ‰ç³»ç»Ÿ" tabindex="-1"><a class="header-anchor" href="#_1-5-1-2-filecoin-èŠ‚ç‚¹ä¸éœ€è¦æ‰€æœ‰ç³»ç»Ÿ" aria-hidden="true">#</a> 1.5.1.2 FileCoin èŠ‚ç‚¹ä¸éœ€è¦æ‰€æœ‰ç³»ç»Ÿ</h4><ul><li>**å®æ–½è¾¹ç•Œï¼š**å¯ä»¥æ„å»ºä»…å®æ–½ä¸€éƒ¨åˆ†ç³»ç»Ÿçš„Filecoinå®æ–½ã€‚è¿™å¯¹äº<em>å®ç°å¤šæ ·æ€§</em>ç‰¹åˆ«æœ‰ç”¨ï¼šæˆ‘ä»¬éœ€è¦è®¸å¤šå®‰å…¨å…³é”®ç³»ç»Ÿï¼ˆä¾‹å¦‚ï¼ŒåŒºå—é“¾ï¼‰çš„å®ç°ï¼Œä½†ä¸éœ€è¦è®¸å¤šå¯ä»¥åˆ†ç¦»çš„ç³»ç»Ÿå®ç°ã€‚</li><li>**è¿è¡Œæ—¶è§£è€¦ï¼š**ç³»ç»Ÿè§£è€¦ä½¿æ„å»ºå’Œè¿è¡Œå°†ç³»ç»Ÿéš”ç¦»åˆ°å•ç‹¬ç¨‹åºç”šè‡³å•ç‹¬ç‰©ç†è®¡ç®—æœºä¸­çš„FilecoinèŠ‚ç‚¹å˜å¾—æ›´åŠ å®¹æ˜“ã€‚</li><li>**å®‰å…¨éš”ç¦»ï¼š**æŸäº›ç³»ç»Ÿæ¯”å…¶ä»–ç³»ç»Ÿéœ€è¦æ›´é«˜çš„æ“ä½œå®‰å…¨æ€§ã€‚ç³»ç»Ÿè§£è€¦ä½¿å®ç°èƒ½å¤Ÿæ»¡è¶³å…¶å®‰å…¨æ€§å’ŒåŠŸèƒ½æ€§éœ€æ±‚ã€‚ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­æ˜¯å°†åŒºå—é“¾å¤„ç†ä¸æ•°æ®ä¼ è¾“åˆ†å¼€ã€‚</li><li>**å¯ä¼¸ç¼©æ€§ï¼š**ç³»ç»Ÿå’Œå„ç§ç”¨ä¾‹å¯èƒ½ä¼šä¸ºä¸åŒçš„æ“ä½œå‘˜å¸¦æ¥ä¸åŒçš„æ€§èƒ½è¦æ±‚ã€‚ç³»ç»Ÿè§£è€¦ä½¿è¿è¥å•†æ›´å®¹æ˜“æ²¿ç€ç³»ç»Ÿè¾¹ç•Œæ‰©å±•å…¶éƒ¨ç½²ã€‚</li></ul><h4 id="_1-5-1-3-åˆ†ç¦»ç³»ç»Ÿ" tabindex="-1"><a class="header-anchor" href="#_1-5-1-3-åˆ†ç¦»ç³»ç»Ÿ" aria-hidden="true">#</a> 1.5.1.3 åˆ†ç¦»ç³»ç»Ÿ</h4><blockquote><p>æˆ‘ä»¬å¦‚ä½•ç¡®å®šä¸€ä¸ªç³»ç»Ÿä¸å¦ä¸€ä¸ªç³»ç»Ÿå±äºä»€ä¹ˆåŠŸèƒ½ï¼Ÿ</p></blockquote><p>åœ¨ç³»ç»Ÿä¹‹é—´åˆ’å®šç•Œé™æ˜¯å°†ç´§å¯†ç›¸å…³çš„åŠŸèƒ½ä¸æ— å…³éƒ¨åˆ†åˆ†å¼€çš„æŠ€æœ¯ã€‚ä»æŸç§æ„ä¹‰ä¸Šè¯´ï¼Œæˆ‘ä»¬å¯»æ±‚å°†ç´§å¯†é›†æˆçš„ç»„ä»¶ä¿ç•™åœ¨åŒä¸€ç³»ç»Ÿä¸­ï¼Œå¹¶è¿œç¦»å…¶ä»–æ— å…³çš„ç»„ä»¶ã€‚æœ‰æ—¶è¿™å¾ˆç®€å•ï¼Œè¾¹ç•Œè‡ªç„¶æ˜¯æ¥è‡ªæ•°æ®ç»“æ„æˆ–åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼Œå¾ˆå®¹æ˜“è§‚å¯Ÿåˆ°ï¼Œå®¢æˆ·å’ŒçŸ¿å·¥å½¼æ­¤åå•†äº¤æ˜“ä¸VMæ‰§è¡Œéå¸¸æ— å…³ã€‚</p><p>æœ‰æ—¶è¿™æ¯”è¾ƒå›°éš¾ï¼Œå¹¶ä¸”éœ€è¦æ•´ç†ï¼Œæ·»åŠ æˆ–åˆ é™¤æŠ½è±¡ã€‚ä¾‹å¦‚ï¼Œ<code>StoragePowerActor</code>å’Œå’Œä»¥å‰<code>StorageMarketActor</code>æ˜¯å•ä¸ª<code>Actor</code>ã€‚è¿™å¯¼è‡´äº†æ•´ä¸ª<code>StorageDeal</code>ç”Ÿäº§<code>StorageMarket</code>å¸‚åœºï¼Œå­˜å‚¨å¸‚åœºï¼Œéƒ¨é—¨å¯†å°ï¼ŒPoStç”Ÿæˆç­‰åŠŸèƒ½ä¹‹é—´çš„å·¨å¤§è€¦åˆã€‚çº ç»“è¿™ä¸¤ç»„ç›¸å…³åŠŸèƒ½éœ€è¦å°†ä¸€ä¸ªå‚ä¸è€…åˆ†æˆä¸¤ä¸ªã€‚</p><h4 id="_1-5-1-4-åœ¨ç³»ç»Ÿå†…éƒ¨åˆ†è§£" tabindex="-1"><a class="header-anchor" href="#_1-5-1-4-åœ¨ç³»ç»Ÿå†…éƒ¨åˆ†è§£" aria-hidden="true">#</a> 1.5.1.4 åœ¨ç³»ç»Ÿå†…éƒ¨åˆ†è§£</h4><p>ç³»ç»Ÿæœ¬èº«åˆ†è§£ä¸ºè¾ƒå°çš„å­å•å…ƒã€‚è¿™äº›æœ‰æ—¶ç§°ä¸ºâ€œå­ç³»ç»Ÿâ€ï¼Œä»¥é¿å…ä¸æ›´å¤§çš„ä¸€æµç³»ç»Ÿæ··æ·†ã€‚å­ç³»ç»Ÿæœ¬èº«å¯èƒ½ä¼šè¿›ä¸€æ­¥å´©æºƒã€‚æ­¤å¤„çš„å‘½åæœªä¸¥æ ¼æ‰§è¡Œï¼Œå› ä¸ºè¿™äº›ç»†åˆ†ä¸åè®®å’Œå®ç°å·¥ç¨‹æ–¹é¢çš„é—®é¢˜ç›¸æ¯”ï¼Œä¸ç”¨æˆ·åŠŸèƒ½æ›´ç›¸å…³ã€‚</p><h3 id="_1-5-2-å®ç°ç³»ç»Ÿ" tabindex="-1"><a class="header-anchor" href="#_1-5-2-å®ç°ç³»ç»Ÿ" aria-hidden="true">#</a> 1.5.2 å®ç°ç³»ç»Ÿ</h3><h4 id="_1-5-2-1-ç³»ç»Ÿè¦æ±‚" tabindex="-1"><a class="header-anchor" href="#_1-5-2-1-ç³»ç»Ÿè¦æ±‚" aria-hidden="true">#</a> 1.5.2.1 ç³»ç»Ÿè¦æ±‚</h4><p>ä¸ºäº†æ›´è½»æ¾åœ°å°†åŠŸèƒ½åˆ†ç¦»åˆ°ç³»ç»Ÿä¸­ï¼ŒFilecoinåè®®å‡å®šäº†ä¸€ç»„å¯ç”¨äºæ‰€æœ‰ç³»ç»Ÿçš„åŠŸèƒ½ã€‚æ­¤åŠŸèƒ½å¯ä»¥é€šè¿‡å„ç§æ–¹å¼çš„å®ç°æ¥å®ç°ï¼Œå¹¶ä¸”åº”å°†æ­¤å¤„çš„æŒ‡å—ä½œä¸ºå»ºè®®ï¼ˆåº”è¯¥ï¼‰ã€‚</p><p>æœ¬æ–‡æ¡£ä¸­å®šä¹‰çš„æ‰€æœ‰ç³»ç»Ÿéƒ½è¦æ±‚å…·å¤‡ä»¥ä¸‹æ¡ä»¶ï¼š</p><ul><li>ä»“åº“ï¼š <ul><li>**æœ¬åœ°çš„<code>IpldStore</code>ã€‚**ç”¨äºæ•°æ®ç»“æ„ï¼ˆå°å‹ç»“æ„åŒ–å¯¹è±¡ï¼‰çš„ä¸€å®šæ•°é‡çš„æŒä¹…æœ¬åœ°å­˜å‚¨ã€‚ç³»ç»ŸæœŸæœ›ä½¿ç”¨IpldStoreè¿›è¡Œåˆå§‹åŒ–ï¼Œåœ¨è¯¥ç³»ç»Ÿä¸­å­˜å‚¨å®ƒä»¬å¸Œæœ›åœ¨å´©æºƒä¸­æŒç»­å­˜åœ¨çš„æ•°æ®ç»“æ„ã€‚</li><li>**ç”¨æˆ·é…ç½®å€¼ã€‚**å°‘é‡ç”¨æˆ·å¯ç¼–è¾‘çš„é…ç½®å€¼ã€‚è¿™äº›åº”è¯¥ä½¿æœ€ç»ˆç”¨æˆ·æ˜“äºè®¿é—®ï¼ŒæŸ¥çœ‹å’Œç¼–è¾‘ã€‚</li><li>**æœ¬åœ°ï¼Œå®‰å…¨<code>KeyStore</code>ã€‚**ç”¨äºç”Ÿæˆå’Œä½¿ç”¨åŠ å¯†å¯†é’¥çš„å·¥å…·ï¼Œå¿…é¡»å¯¹FilecoinèŠ‚ç‚¹ä¿å¯†ã€‚ç³»ç»Ÿä¸åº”ç›´æ¥è®¿é—®å¯†é’¥ï¼Œè€Œåº”é€šè¿‡<code>KeyStore</code>æä¾›åŠ å¯†ï¼Œè§£å¯†ï¼Œç­¾åï¼ŒSigVerifyç­‰åŠŸèƒ½çš„æŠ½è±¡ï¼ˆå³ï¼‰è¿›è¡Œè®¿é—®ã€‚</li></ul></li><li>**æœ¬åœ°çš„<code>FileStore</code>ã€‚**æŸäº›æ–‡ä»¶çš„æŒä¹…æœ¬åœ°å­˜å‚¨ï¼ˆå¤§å­—èŠ‚æ•°ç»„ï¼‰ã€‚ç³»ç»ŸæœŸæœ›ä½¿ç”¨å­˜å‚¨å¤§æ–‡ä»¶çš„FileStoreè¿›è¡Œåˆå§‹åŒ–ã€‚æŸäº›ç³»ç»Ÿï¼ˆä¾‹å¦‚Marketsï¼‰å¯èƒ½éœ€è¦å­˜å‚¨å’Œåˆ é™¤å¤§é‡è¾ƒå°çš„æ–‡ä»¶ï¼ˆ1MB-10GBï¼‰ã€‚å…¶ä»–ç³»ç»Ÿï¼ˆä¾‹å¦‚å­˜å‚¨æŒ–æ˜ï¼‰å¯èƒ½éœ€è¦å­˜å‚¨å’Œåˆ é™¤å¤§é‡å¤§æ–‡ä»¶ï¼ˆ1GB-1TBï¼‰ã€‚</li><li>**ç½‘ç»œã€‚**å¤§å¤šæ•°ç³»ç»Ÿéœ€è¦è®¿é—®ç½‘ç»œï¼Œæ‰èƒ½è¿æ¥åˆ°å…¶ä»–FilecoinèŠ‚ç‚¹ä¸­çš„å¯¹åº”ç³»ç»Ÿã€‚ç³»ç»ŸæœŸæœ›ä½¿ç”¨å¯<code>libp2p.Node</code>åœ¨å…¶ä¸Šå®‰è£…è‡ªå·±çš„åè®®çš„è¿›è¡Œåˆå§‹åŒ–ã€‚</li><li>**æ—¶é’Ÿã€‚**æœ‰äº›ç³»ç»Ÿéœ€è¦è®¿é—®å½“å‰çš„ç½‘ç»œæ—¶é—´ï¼Œè€Œæœ‰äº›ç³»ç»Ÿçš„æ¼‚ç§»å®¹å·®è¾ƒä½ã€‚ç³»ç»ŸæœŸæœ›ä½¿ç”¨ä¸€ä¸ªæ—¶é’Ÿæ¥åˆå§‹åŒ–ï¼Œä»¥ä»ä¸­å¾—çŸ¥ç½‘ç»œæ—¶é—´ã€‚ä¸€äº›ç³»ç»Ÿï¼ˆå¦‚åŒºå—é“¾ï¼‰éœ€è¦å¾ˆå°‘çš„æ—¶é’Ÿæ¼‚ç§»ï¼Œå¹¶ä¸”éœ€è¦<em>å®‰å…¨çš„</em>æ—¶é—´ã€‚</li></ul><p>ä¸ºæ­¤ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>FilecoinNode</code>æ•°æ®ç»“æ„ï¼Œè¯¥æ•°æ®ç»“æ„åœ¨åˆå§‹åŒ–æ—¶ä¼ é€’ç»™æ‰€æœ‰ç³»ç»Ÿã€‚</p><h4 id="_1-5-2-2ç³»ç»Ÿé™åˆ¶" tabindex="-1"><a class="header-anchor" href="#_1-5-2-2ç³»ç»Ÿé™åˆ¶" aria-hidden="true">#</a> 1.5.2.2ç³»ç»Ÿé™åˆ¶</h4><p>æ­¤å¤–ï¼Œç³»ç»Ÿå¿…é¡»éµå®ˆä»¥ä¸‹é™åˆ¶ï¼š</p><ul><li>**éšæœºå´©æºƒã€‚**FilecoinèŠ‚ç‚¹å¯èƒ½éšæ—¶å´©æºƒã€‚é€šè¿‡å´©æºƒï¼Œç³»ç»Ÿå¿…é¡»æ˜¯å®‰å…¨ä¸”ä¸€è‡´çš„ã€‚è¿™ä¸»è¦æ˜¯é€šè¿‡é™åˆ¶æŒä¹…çŠ¶æ€çš„ä½¿ç”¨ï¼Œé€šè¿‡Ipldæ•°æ®ç»“æ„æŒä¹…åŒ–è¿™ç§çŠ¶æ€ï¼Œä»¥åŠé€šè¿‡ä½¿ç”¨æ£€æŸ¥çŠ¶æ€çš„åˆå§‹åŒ–ä¾‹ç¨‹ä»¥åŠå¯èƒ½çº æ­£é”™è¯¯æ¥å®ç°çš„ã€‚</li><li>**éš”ç¦»ã€‚**ç³»ç»Ÿå¿…é¡»é€šè¿‡å®šä¹‰è‰¯å¥½çš„éš”ç¦»æ¥å£è¿›è¡Œé€šä¿¡ã€‚ä»–ä»¬ä¸å¾—åœ¨å…±äº«å†…å­˜ç©ºé—´ä¸Šæ„å»ºå…³é”®åŠŸèƒ½ã€‚ï¼ˆæ³¨æ„ï¼šä¸ºäº†æé«˜æ€§èƒ½ï¼Œå…±äº«å†…å­˜æŠ½è±¡å¯ç”¨äºä¸ºIpldStoreï¼ŒFileStoreå’Œlibp2pä¾›ç”µï¼Œä½†æ˜¯ç³»ç»Ÿæœ¬èº«ä¸åº”è¯¥éœ€è¦å®ƒã€‚ï¼‰å®ƒè¿˜æ˜¾ç€ç®€åŒ–äº†åè®®ï¼Œå¹¶ä½¿å…¶æ›´æ˜“äºç†è§£ï¼Œåˆ†æï¼Œè°ƒè¯•å’Œæ›´æ”¹ã€‚</li><li>**æ— æ³•ç›´æ¥è®¿é—®ä¸»æœºæ“ä½œç³»ç»Ÿæ–‡ä»¶ç³»ç»Ÿæˆ–ç£ç›˜ã€‚**ç³»ç»Ÿæ— æ³•ç›´æ¥è®¿é—®ç£ç›˜ï¼Œè€Œæ˜¯é€šè¿‡FileStoreå’ŒIpldStoreæŠ½è±¡æ¥è¿›è¡Œã€‚è¿™å°†ä¸ºæœ€ç»ˆç”¨æˆ·ï¼ˆå°¤å…¶æ˜¯å­˜å‚¨çŸ¿å·¥å’Œå¤§é‡æ•°æ®çš„å®¢æˆ·ç«¯ï¼‰æä¾›é«˜åº¦çš„å¯ç§»æ¤æ€§å’Œçµæ´»æ€§ï¼Œè¿™éœ€è¦èƒ½å¤Ÿè½»æ¾æ›¿æ¢å…¶FilecoinèŠ‚ç‚¹è®¿é—®æœ¬åœ°å­˜å‚¨çš„æ–¹å¼ã€‚</li><li>**ä¸èƒ½ç›´æ¥è®¿é—®ä¸»æœºOSç½‘ç»œå †æ ˆæˆ–TCP / IPã€‚**ç³»ç»Ÿæ— æ³•ç›´æ¥è®¿é—®ç½‘ç»œ-å®ƒä»¬é€šè¿‡libp2påº“è¿›è¡Œè®¿é—®ã€‚ä¸å¾—æœ‰ä»»ä½•å…¶ä»–ç±»å‹çš„ç½‘ç»œè®¿é—®ã€‚è¿™æä¾›äº†è·¨å¹³å°å’Œç½‘ç»œåè®®çš„é«˜åº¦å¯ç§»æ¤æ€§ï¼Œä½¿FilecoinèŠ‚ç‚¹ï¼ˆåŠå…¶æ‰€æœ‰å…³é”®ç³»ç»Ÿï¼‰å¯ä»¥ä½¿ç”¨å„ç§åè®®ï¼ˆä¾‹å¦‚è“ç‰™ï¼ŒLANç­‰ï¼‰åœ¨å¤šç§è®¾ç½®ä¸‹è¿è¡Œã€‚</li></ul><h1 id="_2-ç³»ç»Ÿ" tabindex="-1"><a class="header-anchor" href="#_2-ç³»ç»Ÿ" aria-hidden="true">#</a> 2. ç³»ç»Ÿ</h1><p>åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†é€ä¸€è¯¦ç»†è¯´æ˜æ‰€æœ‰ç³»ç»Ÿç»„ä»¶ï¼Œä»¥æé«˜å…¶å¤æ‚æ€§å’Œ/æˆ–ä¸å…¶ä»–ç³»ç»Ÿç»„ä»¶çš„ç›¸äº’ä¾èµ–æ€§ã€‚ç»„ä»¶ä¹‹é—´çš„äº¤äº’ä»…åœ¨é€‚å½“çš„åœ°æ–¹ç®€è¦è®¨è®ºï¼Œä½†æ€»ä½“å·¥ä½œæµç¨‹åœ¨â€œç®€ä»‹â€éƒ¨åˆ†ç»™å‡ºã€‚ç‰¹åˆ«æ˜¯ï¼Œåœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬è®¨è®ºï¼š</p><ul><li>FilecoinèŠ‚ç‚¹ï¼šå‚ä¸Filecoinç½‘ç»œçš„ä¸åŒç±»å‹çš„èŠ‚ç‚¹ï¼Œä»¥åŠè¿™äº›èŠ‚ç‚¹è¿è¡Œçš„é‡è¦éƒ¨åˆ†å’Œè¿‡ç¨‹ï¼Œä¾‹å¦‚å¯†é’¥åº“å’ŒIPLDå­˜å‚¨ï¼Œä»¥åŠlibp2pçš„ç½‘ç»œæ¥å£ã€‚</li><li>æ–‡ä»¶å’Œæ•°æ®ï¼šFilecoinçš„æ•°æ®å•ä½ï¼Œä¾‹å¦‚â€œéƒ¨é—¨â€å’Œâ€œç¢ç‰‡â€ã€‚</li><li>è™šæ‹Ÿæœºï¼šFilecoin VMçš„å­ç»„ä»¶ï¼Œä¾‹å¦‚å‚ä¸è€…ï¼Œå³åœ¨FilecoinåŒºå—é“¾ä¸Šè¿è¡Œçš„æ™ºèƒ½åˆçº¦å’ŒçŠ¶æ€æ ‘ã€‚</li><li>åŒºå—é“¾ï¼šFilecoinåŒºå—é“¾çš„ä¸»è¦æ„å»ºå—ï¼Œä¾‹å¦‚æ¶ˆæ¯å’Œå—çš„ç»“æ„ï¼Œæ¶ˆæ¯æ± ï¼Œä»¥åŠèŠ‚ç‚¹é¦–æ¬¡åŠ å…¥ç½‘ç»œæ—¶å¦‚ä½•åŒæ­¥åŒºå—é“¾ã€‚</li><li>ä»¤ç‰Œï¼šé’±åŒ…æ‰€éœ€çš„ç»„ä»¶ã€‚</li><li>å­˜å‚¨æŒ–æ˜ï¼šå­˜å‚¨æŒ–æ˜çš„è¯¦ç»†ä¿¡æ¯ï¼Œå­˜å‚¨èƒ½åŠ›å…±è¯†ä»¥åŠå­˜å‚¨çŸ¿å·¥å¦‚ä½•è¯æ˜å­˜å‚¨ï¼ˆä¸æ¶‰åŠè¯æ˜çš„ç»†èŠ‚ï¼Œè¿™å°†åœ¨åé¢è®¨è®ºï¼‰ã€‚</li><li>å¸‚åœºï¼šå­˜å‚¨å’Œæ£€ç´¢å¸‚åœºï¼Œä¸»è¦æ˜¯è„±é“¾çš„è¿‡ç¨‹ï¼Œä½†å¯¹äºåˆ†æ•£å­˜å‚¨å¸‚åœºçš„å¹³ç¨³è¿è¡Œéå¸¸é‡è¦ã€‚</li></ul><h2 id="_2-1-filecoinèŠ‚ç‚¹" tabindex="-1"><a class="header-anchor" href="#_2-1-filecoinèŠ‚ç‚¹" aria-hidden="true">#</a> 2.1 <a href="https://spec.filecoin.io/#section-systems.filecoin_nodes" target="_blank" rel="noopener noreferrer">FilecoinèŠ‚ç‚¹<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h2><p>æœ¬èŠ‚é¦–å…ˆè®¨è®ºFilecoinèŠ‚ç‚¹çš„æ¦‚å¿µã€‚å°½ç®¡åœ¨Filecoinçš„Lotuså®ç°ä¸­ä¸åƒåœ¨å…¶ä»–åŒºå—é“¾ç½‘ç»œä¸­é‚£æ ·ä¸¥æ ¼å®šä¹‰ä¸åŒçš„èŠ‚ç‚¹ç±»å‹ï¼Œä½†æ˜¯ä¸åŒç±»å‹çš„èŠ‚ç‚¹åº”è¯¥å®ç°ä¸åŒçš„å±æ€§å’ŒåŠŸèƒ½ã€‚ç®€è€Œè¨€ä¹‹ï¼ŒåŸºäºèŠ‚ç‚¹æä¾›çš„<em>æœåŠ¡</em>é›†å¯¹å…¶è¿›è¡Œå®šä¹‰ã€‚</p><p>åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬è¿˜å°†è®¨è®ºä¸åœ¨FilecoinèŠ‚ç‚¹ä¸­å­˜å‚¨ç³»ç»Ÿæ–‡ä»¶æœ‰å…³çš„é—®é¢˜ã€‚è¯·æ³¨æ„ï¼Œåœ¨æœ¬èŠ‚ä¸­ï¼Œé€šè¿‡å­˜å‚¨ï¼Œæˆ‘ä»¬ä¸æ˜¯æŒ‡èŠ‚ç‚¹ä¸ºåœ¨ç½‘ç»œä¸­è¿›è¡ŒæŒ–æ˜è€Œæäº¤çš„å­˜å‚¨ï¼Œè€Œæ˜¯æŒ‡å®ƒéœ€è¦å¯ç”¨äºå¯†é’¥å’ŒIPLDæ•°æ®çš„æœ¬åœ°å­˜å‚¨åº“ã€‚</p><p>åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬è¿˜å°†è®¨è®ºç½‘ç»œæ¥å£ä»¥åŠèŠ‚ç‚¹ä¹‹é—´å¦‚ä½•æŸ¥æ‰¾å’Œè¿æ¥ï¼Œå¦‚ä½•ä½¿ç”¨libp2päº¤äº’å’Œä¼ æ’­æ¶ˆæ¯ä»¥åŠå¦‚ä½•è®¾ç½®èŠ‚ç‚¹çš„æ—¶é’Ÿã€‚</p><h3 id="_2-1-1èŠ‚ç‚¹ç±»å‹" tabindex="-1"><a class="header-anchor" href="#_2-1-1èŠ‚ç‚¹ç±»å‹" aria-hidden="true">#</a> 2.1.1<a href="https://spec.filecoin.io/#section-systems.filecoin_nodes.node_types" target="_blank" rel="noopener noreferrer">èŠ‚ç‚¹ç±»å‹<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h3><p>Filecoinç½‘ç»œä¸­çš„èŠ‚ç‚¹ä¸»è¦æ ¹æ®å…¶æä¾›çš„æœåŠ¡è¿›è¡Œæ ‡è¯†ã€‚å› æ­¤ï¼ŒèŠ‚ç‚¹çš„ç±»å‹å–å†³äºèŠ‚ç‚¹æä¾›çš„æœåŠ¡ã€‚Filecoinç½‘ç»œä¸­çš„ä¸€ç»„åŸºæœ¬æœåŠ¡åŒ…æ‹¬ï¼š</p><ul><li>é“¾éªŒè¯</li><li>ä»“å‚¨å¸‚åœºå®¢æˆ·</li><li>å­˜å‚¨å¸‚åœºæä¾›å•†</li><li>æ£€ç´¢å¸‚åœºå®¢æˆ·</li><li>æ£€ç´¢å¸‚åœºæä¾›è€…</li><li>ä»“å‚¨é‡‡çŸ¿</li></ul><p>å‚ä¸Filecoinç½‘ç»œçš„ä»»ä½•èŠ‚ç‚¹éƒ½åº”è‡³å°‘æä¾›<em>é“¾éªŒè¯</em>æœåŠ¡ã€‚æ ¹æ®èŠ‚ç‚¹åœ¨é“¾éªŒè¯ä¹‹ä¸Šæä¾›çš„é¢å¤–æœåŠ¡ï¼Œå®ƒä¼šè·å¾—ç›¸åº”çš„åŠŸèƒ½å’ŒèŠ‚ç‚¹ç±»å‹â€œæ ‡ç­¾â€ã€‚</p><p>å¯ä»¥ä½¿ç”¨ä¸»æœºä¸­çš„å­˜å‚¨åº“ï¼ˆç›®å½•ï¼‰ä»¥ä¸€å¯¹ä¸€å…³ç³»å®ç°èŠ‚ç‚¹-å³ï¼Œä¸€ä¸ªå­˜å‚¨åº“å±äºå•ä¸ªèŠ‚ç‚¹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€å°ä¸»æœºå¯ä»¥é€šè¿‡å…·æœ‰ç›¸åº”çš„å­˜å‚¨åº“æ¥å®ç°å¤šä¸ªFilecoinèŠ‚ç‚¹ã€‚</p><p>Filecoinå®ç°å¯ä»¥æ”¯æŒä»¥ä¸‹å­ç³»ç»Ÿæˆ–èŠ‚ç‚¹ç±»å‹ï¼š</p><ul><li><strong>é“¾éªŒè¯å™¨èŠ‚ç‚¹ï¼š<strong>è¿™æ˜¯èŠ‚ç‚¹åŠ å…¥Filecoinç½‘ç»œæ‰€éœ€çš„æœ€ä½åŠŸèƒ½ã€‚é™¤éå®ç°ä»¥ä¸‹æ‰€è¿°çš„</strong>å®¢æˆ·ç«¯èŠ‚ç‚¹</strong>åŠŸèƒ½ï¼Œå¦åˆ™è¿™ç§ç±»å‹çš„èŠ‚ç‚¹æ— æ³•åœ¨ç½‘ç»œä¸­å‘æŒ¥ç§¯æä½œç”¨ã€‚é“¾éªŒè¯å™¨èŠ‚ç‚¹é¦–æ¬¡åŠ å…¥ç½‘ç»œæ—¶å¿…é¡»åŒæ­¥é“¾ï¼ˆChainSyncï¼‰ï¼Œä»¥è¾¾æˆå½“å‰å…±è¯†ã€‚ä»é‚£æ—¶èµ·ï¼Œè¯¥èŠ‚ç‚¹å¿…é¡»ä¸æ–­è·å–é“¾ä¸­çš„ä»»ä½•é™„åŠ å†…å®¹ï¼ˆå³ï¼Œæ¥æ”¶æœ€æ–°çš„å—ï¼‰å¹¶éªŒè¯å®ƒä»¬æ˜¯å¦è¾¾åˆ°å…±è¯†çŠ¶æ€ã€‚</li><li><strong>å®¢æˆ·ç«¯èŠ‚ç‚¹ï¼š<strong>è¿™ç§ç±»å‹çš„èŠ‚ç‚¹å»ºç«‹åœ¨</strong>Chain VerifierèŠ‚ç‚¹</strong>ä¹‹ä¸Šï¼Œå¹¶ä¸”å¿…é¡»ç”±Filecoinç½‘ç»œä¸Šæ„å»ºçš„ä»»ä½•åº”ç”¨ç¨‹åºæ¥å®ç°ã€‚å¯ä»¥å°†å…¶è§†ä¸ºåŸºäºFilecoinçš„åº”ç”¨ç¨‹åºï¼ˆä¾‹å¦‚äº¤æ˜“æ‰€æˆ–åˆ†æ•£å­˜å‚¨åº”ç”¨ç¨‹åºï¼‰çš„ä¸»è¦åŸºç¡€ç»“æ„èŠ‚ç‚¹ï¼ˆè‡³å°‘å°±ä¸åŒºå—é“¾çš„äº¤äº’è€Œè¨€ï¼‰ã€‚è¯¥èŠ‚ç‚¹åº”å®ç°<em>å­˜å‚¨å¸‚åœºå’Œæ£€ç´¢å¸‚åœºå®¢æˆ·</em>æœåŠ¡ã€‚å®¢æˆ·ç«¯èŠ‚ç‚¹åº”ä¸å­˜å‚¨å’Œæ£€ç´¢å¸‚åœºè¿›è¡Œäº¤äº’ï¼Œå¹¶èƒ½å¤Ÿé€šè¿‡æ•°æ®ä¼ è¾“æ¨¡å—è¿›è¡Œæ•°æ®ä¼ è¾“ã€‚</li><li><strong>Retrieval Miner Nodeï¼ˆæ£€ç´¢çŸ¿å·¥èŠ‚ç‚¹ï¼‰ï¼š<strong>æ­¤èŠ‚ç‚¹ç±»å‹æ‰©å±•äº†</strong>Chain VerifierèŠ‚ç‚¹</strong>ä»¥æ·»åŠ <em>æ£€ç´¢çŸ¿å·¥</em>åŠŸèƒ½ï¼Œå³å‚ä¸äº†æ£€ç´¢å¸‚åœºã€‚è¿™æ ·ï¼Œæ­¤èŠ‚ç‚¹ç±»å‹éœ€è¦å®ç°<em>æ£€ç´¢å¸‚åœºæä¾›è€…</em>æœåŠ¡ï¼Œå¹¶èƒ½å¤Ÿé€šè¿‡æ•°æ®ä¼ è¾“æ¨¡å—è¿›è¡Œæ•°æ®ä¼ è¾“ã€‚</li><li>**Storage Miner Nodeï¼š**è¿™ç§ç±»å‹çš„èŠ‚ç‚¹å¿…é¡»å®ç°éªŒè¯ï¼Œåˆ›å»ºå’Œæ·»åŠ å—ä»¥æ‰©å±•åŒºå—é“¾æ‰€éœ€çš„æ‰€æœ‰å¿…éœ€åŠŸèƒ½ã€‚å®ƒåº”å®æ–½é“¾éªŒè¯ï¼Œå­˜å‚¨æŒ–æ˜å’Œå­˜å‚¨å¸‚åœºæä¾›å•†æœåŠ¡ï¼Œå¹¶èƒ½å¤Ÿé€šè¿‡æ•°æ®ä¼ è¾“æ¨¡å—è¿›è¡Œæ•°æ®ä¼ è¾“ã€‚</li></ul><h4 id="_2-1-1-1èŠ‚ç‚¹æ¥å£" tabindex="-1"><a class="header-anchor" href="#_2-1-1-1èŠ‚ç‚¹æ¥å£" aria-hidden="true">#</a> 2.1.1.1<a href="https://spec.filecoin.io/#section-systems.filecoin_nodes.node_types.node-interface" target="_blank" rel="noopener noreferrer">èŠ‚ç‚¹æ¥å£<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><p>å¯ä»¥åœ¨<a href="https://github.com/filecoin-project/lotus/blob/master/node/repo/interface.go" target="_blank" rel="noopener noreferrer">æ­¤å¤„<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>æ‰¾åˆ°Nodeæ¥å£çš„Lotuså®ç° ã€‚</p><h4 id="_2-1-1-2é“¾éªŒè¯å™¨èŠ‚ç‚¹" tabindex="-1"><a class="header-anchor" href="#_2-1-1-2é“¾éªŒè¯å™¨èŠ‚ç‚¹" aria-hidden="true">#</a> 2.1.1.2<a href="https://spec.filecoin.io/#section-systems.filecoin_nodes.node_types.chain-verifier-node" target="_blank" rel="noopener noreferrer">é“¾éªŒè¯å™¨èŠ‚ç‚¹<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> ChainVerifierNode <span class="token keyword">interface</span> <span class="token punctuation">{</span>
  FilecoinNode

  systems<span class="token punctuation">.</span>Blockchain
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥åœ¨<a href="https://github.com/filecoin-project/lotus/blob/master/node/impl/full.go" target="_blank" rel="noopener noreferrer">è¿™é‡Œ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>æ‰¾åˆ°Chain Verifier Nodeçš„Lotuså®ç° ã€‚</p><h4 id="_2-1-1-3å®¢æˆ·ç«¯èŠ‚ç‚¹" tabindex="-1"><a class="header-anchor" href="#_2-1-1-3å®¢æˆ·ç«¯èŠ‚ç‚¹" aria-hidden="true">#</a> 2.1.1.3<a href="https://spec.filecoin.io/#section-systems.filecoin_nodes.node_types.client-node" target="_blank" rel="noopener noreferrer">å®¢æˆ·ç«¯èŠ‚ç‚¹<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> ClientNode <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  FilecoinNode

  systems<span class="token punctuation">.</span>Blockchain
  markets<span class="token punctuation">.</span>StorageMarketClient
  markets<span class="token punctuation">.</span>RetrievalMarketClient
  markets<span class="token punctuation">.</span>DataTransfers
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®¢æˆ·ç«¯èŠ‚ç‚¹çš„Lotuså®ç°å¯ä»¥åœ¨<a href="https://github.com/filecoin-project/lotus/blob/master/node/impl/client/client.go" target="_blank" rel="noopener noreferrer">è¿™é‡Œ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>æ‰¾åˆ° ã€‚</p><h4 id="_2-1-1-4å­˜å‚¨çŸ¿å·¥èŠ‚ç‚¹" tabindex="-1"><a class="header-anchor" href="#_2-1-1-4å­˜å‚¨çŸ¿å·¥èŠ‚ç‚¹" aria-hidden="true">#</a> 2.1.1.4<a href="https://spec.filecoin.io/#section-systems.filecoin_nodes.node_types.storage-miner-node" target="_blank" rel="noopener noreferrer">å­˜å‚¨çŸ¿å·¥èŠ‚ç‚¹<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> StorageMinerNode <span class="token keyword">interface</span> <span class="token punctuation">{</span>
  FilecoinNode

  systems<span class="token punctuation">.</span>Blockchain
  systems<span class="token punctuation">.</span>Mining
  markets<span class="token punctuation">.</span>StorageMarketProvider
  markets<span class="token punctuation">.</span>DataTransfers
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥åœ¨<a href="https://github.com/filecoin-project/lotus/blob/master/node/impl/storminer.go" target="_blank" rel="noopener noreferrer">æ­¤å¤„<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>æ‰¾åˆ°Storage Miner Nodeçš„Lotuså®ç° ã€‚</p><h4 id="_2-1-1-5æ£€ç´¢çŸ¿å·¥èŠ‚ç‚¹" tabindex="-1"><a class="header-anchor" href="#_2-1-1-5æ£€ç´¢çŸ¿å·¥èŠ‚ç‚¹" aria-hidden="true">#</a> 2.1.1.5<a href="https://spec.filecoin.io/#section-systems.filecoin_nodes.node_types.retrieval-miner-node" target="_blank" rel="noopener noreferrer">æ£€ç´¢çŸ¿å·¥èŠ‚ç‚¹<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> RetrievalMinerNode <span class="token keyword">interface</span> <span class="token punctuation">{</span>
  FilecoinNode

  blockchain<span class="token punctuation">.</span>Blockchain
  markets<span class="token punctuation">.</span>RetrievalMarketProvider
  markets<span class="token punctuation">.</span>DataTransfers
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-1-1-6ä¸­ç»§èŠ‚ç‚¹" tabindex="-1"><a class="header-anchor" href="#_2-1-1-6ä¸­ç»§èŠ‚ç‚¹" aria-hidden="true">#</a> 2.1.1.6<a href="https://spec.filecoin.io/#section-systems.filecoin_nodes.node_types.relayer-node" target="_blank" rel="noopener noreferrer">ä¸­ç»§èŠ‚ç‚¹<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> RelayerNode <span class="token keyword">interface</span> <span class="token punctuation">{</span>
  FilecoinNode

  blockchain<span class="token punctuation">.</span>MessagePool
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-1-1-7èŠ‚ç‚¹é…ç½®" tabindex="-1"><a class="header-anchor" href="#_2-1-1-7èŠ‚ç‚¹é…ç½®" aria-hidden="true">#</a> 2.1.1.7<a href="https://spec.filecoin.io/#section-systems.filecoin_nodes.node_types.node-configuration" target="_blank" rel="noopener noreferrer">èŠ‚ç‚¹é…ç½®<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><p>å¯ä»¥åœ¨<a href="https://github.com/filecoin-project/lotus/blob/master/node/config/def.go" target="_blank" rel="noopener noreferrer">æ­¤å¤„<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>æ‰¾åˆ°Filecoin Nodeé…ç½®å€¼çš„Lotuså®ç° ã€‚</p><h3 id="_2-1-2èŠ‚ç‚¹å­˜å‚¨åº“" tabindex="-1"><a class="header-anchor" href="#_2-1-2èŠ‚ç‚¹å­˜å‚¨åº“" aria-hidden="true">#</a> 2.1.2<a href="https://spec.filecoin.io/#section-systems.filecoin_nodes.repository" target="_blank" rel="noopener noreferrer">èŠ‚ç‚¹å­˜å‚¨åº“<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h3><p>FilecoinèŠ‚ç‚¹å­˜å‚¨åº“åªæ˜¯ç³»ç»Ÿå’Œé“¾æ•°æ®çš„æœ¬åœ°å­˜å‚¨ã€‚å®ƒæ˜¯ä»»ä½•åŠŸèƒ½æ€§FilecoinèŠ‚ç‚¹éœ€è¦åœ¨æœ¬åœ°å­˜å‚¨ä»¥ä¾¿æ­£ç¡®è¿è¡Œçš„æ•°æ®çš„æŠ½è±¡ã€‚</p><p>è¯¥å­˜å‚¨åº“å¯ä¾›èŠ‚ç‚¹çš„ç³»ç»Ÿå’Œå­ç³»ç»Ÿè®¿é—®ï¼Œå¹¶ä¸”å¯ä»¥ä»èŠ‚ç‚¹çš„å­˜å‚¨åŒºåˆ†å¼€<code>FileStore</code>ã€‚</p><p>è¯¥å­˜å‚¨åº“å­˜å‚¨èŠ‚ç‚¹çš„å¯†é’¥ï¼Œæœ‰çŠ¶æ€å¯¹è±¡çš„IPLDæ•°æ®ç»“æ„ä»¥åŠèŠ‚ç‚¹é…ç½®è®¾ç½®ã€‚</p><p>FileStoreå­˜å‚¨åº“çš„Lotuså®ç°å¯ä»¥åœ¨<a href="https://github.com/filecoin-project/lotus/blob/master/node/repo/fsrepo.go" target="_blank" rel="noopener noreferrer">è¿™é‡Œ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>æ‰¾åˆ° ã€‚</p><h4 id="_2-1-2-1å¯†é’¥åº“" tabindex="-1"><a class="header-anchor" href="#_2-1-2-1å¯†é’¥åº“" aria-hidden="true">#</a> 2.1.2.1<a href="https://spec.filecoin.io/#section-systems.filecoin_nodes.repository.key_store" target="_blank" rel="noopener noreferrer">å¯†é’¥åº“<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><p>è¿™<code>Key Store</code>æ˜¯ä»»ä½•å®Œæ•´FilecoinèŠ‚ç‚¹ä¸­çš„åŸºæœ¬æŠ½è±¡ï¼Œç”¨äºå­˜å‚¨ä¸ç»™å®šçŸ¿å·¥çš„åœ°å€ï¼ˆè¯·å‚é˜…ä¸‹é¢çš„å®é™…å®šä¹‰ï¼‰å’Œä¸åŒçš„å·¥ä½œç¨‹åºï¼ˆçŸ¿å·¥åº”è¯¥é€‰æ‹©è¿è¡Œå¤šä¸ªå·¥ä½œç¨‹åºï¼‰å…³è”çš„å¯†é’¥å¯¹ã€‚</p><p>èŠ‚ç‚¹å®‰å…¨æ€§åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå–å†³äºä¿æŒè¿™äº›å¯†é’¥çš„å®‰å…¨æ€§ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¼ºçƒˆå»ºè®®ï¼š1ï¼‰å°†å¯†é’¥ä¸æ‰€æœ‰å­ç³»ç»Ÿåˆ†å¼€ï¼Œ2ï¼‰æ ¹æ®å…¶ä»–å­ç³»ç»Ÿçš„è¦æ±‚ä½¿ç”¨å•ç‹¬çš„å¯†é’¥å­˜å‚¨æ¥ç­¾ç½²è¯·æ±‚ï¼Œä»¥åŠ3ï¼‰ä¿ç•™æœªç”¨ä½œå†·åº“ä¸­æŒ–æ˜çš„é‚£äº›å¯†é’¥ã€‚</p><p>Filecoinå­˜å‚¨çŸ¿å·¥ä¾èµ–ä¸‰ä¸ªä¸»è¦ç»„æˆéƒ¨åˆ†ï¼š</p><ul><li>åœ¨è°ƒç”¨<code>registerMiner()</code>Storage Power Consensuså­ç³»ç»Ÿåï¼Œ<strong>å°†å­˜å‚¨çŸ¿å·¥</strong><em><strong>å‚ä¸è€…*****åœ°å€</strong>å”¯ä¸€åœ°åˆ†é…ç»™ç»™å®šçš„å­˜å‚¨çŸ¿å·¥</em><em>å‚ä¸è€…****åœ°å€</em>*ã€‚å®é™…ä¸Šï¼Œå­˜å‚¨çŸ¿å·¥æœ¬èº«æ²¡æœ‰åœ°å€ï¼Œè€Œæ˜¯ç”±ä¸å…¶ç»‘å®šçš„å‚ä¸è€…çš„åœ°å€æ¥æ ‡è¯†çš„ã€‚è¿™æ˜¯ç»™å®šå­˜å‚¨çŸ¿å·¥çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œå…¶ç”µæºå’Œå…¶ä»–å¯†é’¥å°†ä¸ä¹‹å…³è”ã€‚è¯¥<code>actor value</code>æŒ‡å®šä¸€ä¸ªå·²ç»åˆ›å»ºçš„çŸ¿å·¥æ¼”å‘˜çš„åœ°å€ã€‚</li><li><strong>æ‰€æœ‰è€…å¯†é’¥å¯¹</strong>ç”±çŸ¿å·¥åœ¨æ³¨å†Œä¹‹å‰æä¾›ï¼Œå¹¶ä¸”å…¶å…¬é’¥ä¸çŸ¿å·¥åœ°å€ç›¸å…³ã€‚æ‰€æœ‰è€…å¯†é’¥å¯¹å¯ç”¨äºç®¡ç†çŸ¿å·¥å’Œæå–èµ„é‡‘ã€‚</li><li><strong>å·¥äººå¯†é’¥å¯¹</strong>æ˜¯ä¸å­˜å‚¨çŸ¿å·¥å‚ä¸è€…åœ°å€å…³è”çš„å…¬å…±å¯†é’¥ã€‚å¯ç”±çŸ¿å·¥é€‰æ‹©å’Œæ›´æ”¹ã€‚è¾…åŠ©å¯†é’¥å¯¹ç”¨äºç­¾åå—ï¼Œä¹Ÿå¯ä»¥ç”¨äºç­¾åå…¶ä»–æ¶ˆæ¯ã€‚é‰´äºå®ƒæ˜¯<a href="https://spec.filecoin.io/#section-algorithms.crypto.vrf" target="_blank" rel="noopener noreferrer">å¯éªŒè¯éšæœºå‡½æ•°çš„<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ä¸€éƒ¨åˆ†ï¼Œå®ƒå¿…é¡»æ˜¯BLSå¯†é’¥å¯¹ ã€‚</li></ul><p>å¤šä¸ªå­˜å‚¨çŸ¿å·¥å‚ä¸è€…å¯ä»¥å…±äº«ä¸€ä¸ªæ‰€æœ‰è€…å…¬å…±å¯†é’¥ï¼Œä¹Ÿå¯ä»¥å…±äº«ä¸€ä¸ªå·¥äººå…¬å…±å¯†é’¥ã€‚</p><p>åœ¨<a href="https://spec.filecoin.io/#section-systems.filecoin_mining.storage_mining.storage_miner_actor" target="_blank" rel="noopener noreferrer">Storage Miner Actorä¸­<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>æŒ‡å®šäº†æ›´æ”¹é“¾ä¸Šå·¥ä½œç¨‹åºå¯†é’¥å¯¹ï¼ˆå³ä¸å­˜å‚¨çŸ¿å·¥actorå…³è”çš„å·¥ä½œäººå‘˜Keyï¼‰çš„è¿‡ç¨‹ ã€‚è¯·æ³¨æ„ï¼Œè¿™æ˜¯ä¸€ä¸ªä¸¤æ­¥è¿‡ç¨‹ã€‚é¦–å…ˆï¼ŒçŸ¿å·¥é€šè¿‡å‘é“¾å‘é€æ¶ˆæ¯æ¥è¿›è¡Œæ›´æ”¹ã€‚ç„¶åï¼ŒçŸ¿å·¥åœ¨éšæœºå›æº¯æ—¶é—´ä¹‹åç¡®è®¤å¯†é’¥æ›´æ”¹ã€‚æœ€åï¼Œåœ¨é¢å¤–çš„éšæœºå›æº¯æ—¶é—´ä¹‹åï¼ŒçŸ¿å·¥å°†å¼€å§‹ä½¿ç”¨æ–°å¯†é’¥å¯¹å—è¿›è¡Œç­¾åã€‚å­˜åœ¨æ­¤å»¶è¿Ÿæ˜¯ä¸ºäº†é˜²æ­¢è‡ªé€‚åº”å¯†é’¥é€‰æ‹©æ”»å‡»ã€‚</p><p>å¯†é’¥å®‰å…¨åœ¨Filecoinä¸­è‡³å…³é‡è¦ï¼Œæ¯ä¸ªåŒºå—é“¾ä¸­çš„å¯†é’¥ä¹Ÿæ˜¯å¦‚æ­¤ã€‚<strong>æ— æ³•å®‰å…¨åœ°å­˜å‚¨å’Œä½¿ç”¨å¯†é’¥æˆ–å°†ç§é’¥æš´éœ²ç»™å¯¹æ‰‹å¯èƒ½ä¼šå¯¼è‡´å¯¹æ‰‹æœ‰æƒä½¿ç”¨çŸ¿å·¥çš„èµ„é‡‘ã€‚</strong></p><h4 id="_2-1-2-2ipldå•†åº—" tabindex="-1"><a class="header-anchor" href="#_2-1-2-2ipldå•†åº—" aria-hidden="true">#</a> 2.1.2.2<a href="https://spec.filecoin.io/#section-systems.filecoin_nodes.repository.ipldstore" target="_blank" rel="noopener noreferrer">IPLDå•†åº—<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><p>æ˜Ÿé™…é“¾æ¥æ•°æ®ï¼ˆIPLDï¼‰æ˜¯ä¸€ç»„åº“ï¼Œè¿™äº›åº“å…è®¸è·¨ä¸åŒåˆ†å¸ƒå¼ç³»ç»Ÿå’Œåè®®çš„å†…å®¹å¯»å€æ•°æ®ç»“æ„äº’æ“ä½œã€‚å®ƒä¸ºåŸå§‹å¯†ç å“ˆå¸Œæä¾›äº†ä¸€ç§åŸºæœ¬çš„â€œé€šç”¨è¯­è¨€â€ï¼Œä½¿æ•°æ®ç»“æ„å¯ä»¥åœ¨ä¸¤ä¸ªç‹¬ç«‹çš„åè®®ä¹‹é—´è¢«å¯éªŒè¯åœ°å¼•ç”¨å’Œæ£€ç´¢ã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·å¯ä»¥åœ¨ä»¥å¤ªåŠäº¤æ˜“æˆ–æ™ºèƒ½åˆçº¦ä¸­å¼•ç”¨IPFSç›®å½•ã€‚</p><p>FilecoinèŠ‚ç‚¹çš„IPLDå­˜å‚¨æ˜¯ç”¨äºæ•£åˆ—é“¾æ¥æ•°æ®çš„æœ¬åœ°å­˜å‚¨ã€‚</p><p>IPLDåŸºæœ¬ä¸Šç”±ä¸‰å±‚ç»„æˆï¼š</p><ul><li>å—å±‚ï¼Œç€é‡äºå—æ ¼å¼å’Œå¯»å€ï¼Œå—å¦‚ä½•å¹¿å‘Šæˆ–è‡ªæè¿°å…¶ç¼–è§£ç å™¨</li><li>æ•°æ®æ¨¡å‹å±‚ï¼Œå®ƒå®šä¹‰äº†ä¸€ç»„å¿…é¡»åŒ…å«åœ¨ä»»ä½•å®ç°ä¸­çš„å¿…éœ€ç±»å‹-ä¸‹æ–‡å°†è¯¦ç»†è®¨è®ºã€‚</li><li>æ¨¡å¼å±‚ï¼Œå®ƒå…è®¸æ‰©å±•æ•°æ®æ¨¡å‹ä»¥ä¸æ›´å¤æ‚çš„ç»“æ„è¿›è¡Œäº¤äº’ï¼Œè€Œæ— éœ€è‡ªå®šä¹‰è½¬æ¢æŠ½è±¡ã€‚</li></ul><p>æœ‰å…³IPLDçš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§å…¶ <a href="https://github.com/ipld/specs" target="_blank" rel="noopener noreferrer">è§„èŒƒ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ã€‚</p><h5 id="_2-1-2-2-1æ•°æ®æ¨¡å‹" tabindex="-1"><a class="header-anchor" href="#_2-1-2-2-1æ•°æ®æ¨¡å‹" aria-hidden="true">#</a> 2.1.2.2.1<a href="https://spec.filecoin.io/#section-systems.filecoin_nodes.repository.ipldstore.the-data-model" target="_blank" rel="noopener noreferrer">æ•°æ®æ¨¡å‹<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h5><p>IPLDçš„æ ¸å¿ƒæ˜¯å®šä¹‰ç”¨äºè¡¨ç¤ºæ•°æ®çš„ <a href="https://github.com/ipld/specs/blob/master/data-model-layer/data-model.md" target="_blank" rel="noopener noreferrer">æ•°æ®æ¨¡å‹<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ã€‚æ•°æ®æ¨¡å‹æ—¨åœ¨é€šè¿‡å„ç§ç¼–ç¨‹è¯­è¨€è¿›è¡Œå®é™…å®ç°ï¼ŒåŒæ—¶ä¿æŒå¯¹å†…å®¹å¯»å€æ•°æ®çš„å¯ç”¨æ€§ä»¥åŠä¸è¯¥æ•°æ®äº¤äº’çš„å„ç§é€šç”¨å·¥å…·ã€‚</p><p>æ•°æ®æ¨¡å‹åŒ…æ‹¬ä¸€ç³»åˆ—æ ‡å‡†åŸºæœ¬ç±»å‹ï¼ˆæˆ–â€œç§ç±»â€ï¼‰ï¼Œä¾‹å¦‚å¸ƒå°”ï¼Œæ•´æ•°ï¼Œå­—ç¬¦ä¸²ï¼Œç©ºå€¼å’Œå­—èŠ‚æ•°ç»„ï¼Œä»¥åŠä¸¤ç§é€’å½’ç±»å‹ï¼šåˆ—è¡¨å’Œæ˜ å°„ã€‚ç”±äºIPLDæ˜¯ä¸ºå†…å®¹å¯»å€æ•°æ®è€Œè®¾è®¡çš„ï¼Œå› æ­¤IPLDåœ¨å…¶æ•°æ®æ¨¡å‹ä¸­è¿˜åŒ…å«â€œé“¾æ¥â€åŸè¯­ã€‚å®é™…ä¸Šï¼Œé“¾æ¥ä½¿ç”¨ <a href="https://github.com/multiformats/cid" target="_blank" rel="noopener noreferrer">CID<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>è§„èŒƒã€‚IPLDæ•°æ®è¢«ç»„ç»‡ä¸ºâ€œå—â€ï¼Œå…¶ä¸­ä¸€ä¸ªå—ç”±åŸå§‹ç¼–ç æ•°æ®åŠå…¶å†…å®¹åœ°å€æˆ–CIDè¡¨ç¤ºã€‚æ¯ä¸ªå†…å®¹å¯å¯»å€çš„æ•°æ®å—éƒ½å¯ä»¥è¡¨ç¤ºä¸ºä¸€ä¸ªå—ï¼Œå¹¶ä¸”å—å¯ä»¥ä¸€èµ·å½¢æˆä¸€ä¸ªç›¸å¹²å›¾æˆ– <a href="https://docs.ipfs.io/guides/concepts/merkle-dag/" target="_blank" rel="noopener noreferrer">Merkle DAG<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ã€‚</p><p>åº”ç”¨ç¨‹åºé€šè¿‡æ•°æ®æ¨¡å‹ä¸IPLDäº¤äº’ï¼Œè€ŒIPLDé€šè¿‡ä¸€ç»„ç¼–è§£ç å™¨å¤„ç†ç¼–ç»„å’Œè§£ç»„ã€‚IPLDç¼–è§£ç å™¨å¯èƒ½æ”¯æŒå®Œæ•´çš„æ•°æ®æ¨¡å‹æˆ–éƒ¨åˆ†æ•°æ®æ¨¡å‹ã€‚æ”¯æŒå®Œæ•´æ•°æ®æ¨¡å‹çš„ä¸¤ä¸ªç¼–è§£ç å™¨æ˜¯ <a href="https://github.com/ipld/specs/blob/master/block-layer/codecs/dag-cbor.md" target="_blank" rel="noopener noreferrer">DAG-CBOR<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>å’Œ <a href="https://github.com/ipld/specs/blob/master/block-layer/codecs/dag-json.md" target="_blank" rel="noopener noreferrer">DAG-JSON<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ã€‚è¿™äº›ç¼–è§£ç å™¨åˆ†åˆ«åŸºäºCBORå’ŒJSONåºåˆ—åŒ–æ ¼å¼ï¼Œä½†åŒ…æ‹¬å…è®¸å®ƒä»¬å°è£…IPLDæ•°æ®æ¨¡å‹ï¼ˆåŒ…æ‹¬å…¶é“¾æ¥ç±»å‹ï¼‰çš„è§„èŒƒåŒ–ä»¥åŠå¯åœ¨ä»»ä½•æ•°æ®é›†åŠå…¶å„è‡ªçš„å†…å®¹åœ°å€ï¼ˆæˆ–å“ˆå¸Œæ‘˜è¦ï¼‰ã€‚è¿™äº›è§„åˆ™åŒ…æ‹¬åœ¨å¯¹åœ°å›¾è¿›è¡Œç¼–ç æ—¶å¯¹é”®çš„ç‰¹å®šé¡ºåºè¿›è¡Œè§„å®šï¼Œæˆ–è€…åœ¨å­˜å‚¨æ—¶å¯¹æ•´æ•°ç±»å‹è¿›è¡Œå¤§å°è°ƒæ•´ã€‚</p><h5 id="_2-1-2-2-2-filecoinä¸­çš„ipld" tabindex="-1"><a class="header-anchor" href="#_2-1-2-2-2-filecoinä¸­çš„ipld" aria-hidden="true">#</a> 2.1.2.2.2 <a href="https://spec.filecoin.io/#section-systems.filecoin_nodes.repository.ipldstore.ipld-in-filecoin" target="_blank" rel="noopener noreferrer">Filecoinä¸­çš„IPLD<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h5><p>Filecoinç½‘ç»œä¸­æœ‰ä¸¤ç§æ–¹å¼ä½¿ç”¨IPLDï¼š</p><ul><li>æ‰€æœ‰ç³»ç»Ÿæ•°æ®ç»“æ„éƒ½ä½¿ç”¨DAG-CBORï¼ˆIPLDç¼–è§£ç å™¨ï¼‰å­˜å‚¨ã€‚DAG-CBORæ˜¯CBORçš„æ›´ä¸¥æ ¼å­é›†ï¼Œå…·æœ‰é¢„å®šä¹‰çš„æ ‡è®°æ–¹æ¡ˆï¼Œæ—¨åœ¨å­˜å‚¨ï¼Œæ£€ç´¢å’Œéå†æ•£åˆ—é“¾æ¥çš„æ•°æ®DAGã€‚ä¸CBORç›¸æ¯”ï¼ŒDAG-CBORå¯ä»¥ä¿è¯ç¡®å®šæ€§ã€‚</li><li>Filecoinç½‘ç»œä¸Šå­˜å‚¨çš„æ–‡ä»¶å’Œæ•°æ®ä¹Ÿä½¿ç”¨å„ç§IPLDç¼–è§£ç å™¨ï¼ˆä¸ä¸€å®šæ˜¯DAG-CBORï¼‰è¿›è¡Œå­˜å‚¨ã€‚</li></ul><p>IPLDåœ¨æ•°æ®ä¸Šæ–¹æä¾›äº†ä¸€è‡´ä¸”ä¸€è‡´çš„æŠ½è±¡ï¼Œä»è€Œä½¿Filecoinå¯ä»¥æ„å»ºå¤æ‚çš„å¤šå—æ•°æ®ç»“æ„ï¼ˆä¾‹å¦‚HAMTå’ŒAMTï¼‰å¹¶ä¸ä¹‹äº¤äº’ã€‚Filecoinä½¿ç”¨DAG-CBORç¼–è§£ç å™¨å¯¹å…¶æ•°æ®ç»“æ„è¿›è¡Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Œå¹¶ä½¿ç”¨IPLDæ•°æ®æ¨¡å‹ä¸è¯¥æ•°æ®è¿›è¡Œäº¤äº’ï¼Œå¹¶åœ¨æ­¤æ¨¡å‹ä¸Šæ„å»ºäº†å„ç§å·¥å…·ã€‚IPLDé€‰æ‹©å™¨è¿˜å¯ç”¨äºå¯»å€é“¾æ¥æ•°æ®ç»“æ„ä¸­çš„ç‰¹å®šèŠ‚ç‚¹ã€‚</p><h6 id="_2-1-2-2-2-1ipldstores" tabindex="-1"><a class="header-anchor" href="#_2-1-2-2-2-1ipldstores" aria-hidden="true">#</a> 2.1.2.2.2.1<a href="https://spec.filecoin.io/#section-systems.filecoin_nodes.repository.ipldstore.ipldstores" target="_blank" rel="noopener noreferrer">IpldStores<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h6><p>Filecoinç½‘ç»œä¸»è¦ä¾èµ–äºä¸¤ä¸ªä¸åŒçš„IPLD GraphStoreï¼š</p><ul><li>ä¸€ç§<code>ChainStore</code>å­˜å‚¨åŒºå—é“¾çš„æ•°æ®ï¼ŒåŒ…æ‹¬å—å¤´ï¼Œç›¸å…³æ¶ˆæ¯ç­‰ã€‚</li><li>ä¸€ç§<code>StateStore</code>å­˜å‚¨æ¥è‡ªç»™å®š<code>stateTree</code>åŒºå—é“¾çš„æœ‰æ•ˆè´Ÿè½½çŠ¶æ€ï¼Œæˆ–è€…å­˜å‚¨ç”±<a href="https://spec.filecoin.io/#section-systems.filecoin_vm" target="_blank" rel="noopener noreferrer">Filecoin VM<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>åº”ç”¨äºç»™å®šçŠ¶æ€çš„ç»™å®šé“¾ä¸­æ‰€æœ‰å—æ¶ˆæ¯çš„ <a href="https://spec.filecoin.io/#section-systems.filecoin_vm" target="_blank" rel="noopener noreferrer">ç»“æœ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ã€‚</li></ul><p>çš„<code>ChainStore</code>æ˜¯é€šè¿‡ä»ä»–ä»¬çš„åŒè¾ˆèŠ‚ç‚¹ä¸­çš„å¼•å¯¼é˜¶æ®µä¸‹è½½ <a href="https://spec.filecoin.io/#section-systems.filecoin_blockchain.chainsync" target="_blank" rel="noopener noreferrer">é“¾åŒæ­¥<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ï¼Œå¹¶ä¸”ç”±èŠ‚ç‚¹æ­¤åè¢«å­˜å‚¨ã€‚æ¯æ¬¡æ¥æ”¶åˆ°æ–°çš„å—æ—¶ï¼Œæˆ–è€…èŠ‚ç‚¹åŒæ­¥åˆ°æ–°çš„æœ€ä½³é“¾æ—¶ï¼Œå®ƒéƒ½ä¼šæ›´æ–°ã€‚</p><p>çš„<code>StateStore</code>æ˜¯é€šè¿‡åœ¨ç»™å®šçš„æ‰€æœ‰å—æ¶ˆæ¯çš„æ‰§è¡Œè®¡ç®—<code>ChainStore</code>ï¼Œå¹¶ä¸”ç”±èŠ‚ç‚¹æ­¤åè¢«å­˜å‚¨ã€‚<a href="https://spec.filecoin.io/#section-systems.filecoin_vm.interpreter" target="_blank" rel="noopener noreferrer">VMè§£é‡Šå™¨ä¼š<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ä½¿ç”¨æ¯ä¸ªæ–°ä¼ å…¥å—çš„å¤„ç†å¯¹å…¶è¿›è¡Œæ›´æ–° ï¼Œå¹¶ç›¸åº”åœ°ç”±åœ¨<a href="https://spec.filecoin.io/#section-systems.filecoin_blockchain.struct.block" target="_blank" rel="noopener noreferrer">å—æ ‡é¢˜<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> <code>ParentState</code>å­—æ®µä¸­åœ¨å…¶ä¸Šæ–¹ç”Ÿæˆçš„æ–°å—è¿›è¡Œå¼•ç”¨ ã€‚</p><h3 id="_2-1-3-ç½‘ç»œæ¥å£" tabindex="-1"><a class="header-anchor" href="#_2-1-3-ç½‘ç»œæ¥å£" aria-hidden="true">#</a> 2.1.3 ç½‘ç»œæ¥å£</h3><p>FilecoinèŠ‚ç‚¹ä½¿ç”¨libp2pç½‘ç»œå †æ ˆçš„å‡ ç§åè®®æ¥è¿›è¡Œå¯¹ç­‰æ–¹å‘ç°ï¼Œå¯¹ç­‰æ–¹è·¯ç”±ä»¥åŠå—å’Œæ¶ˆæ¯ä¼ æ’­ã€‚Libp2pæ˜¯ç”¨äºç‚¹å¯¹ç‚¹ç½‘ç»œçš„æ¨¡å—åŒ–ç½‘ç»œå †æ ˆã€‚å®ƒåŒ…æ‹¬å¤šç§åè®®å’Œæœºåˆ¶ï¼Œå¯å®ç°é«˜æ•ˆï¼Œå®‰å…¨å’Œæœ‰å¼¹æ€§çš„å¯¹ç­‰é€šä¿¡ã€‚Libp2pèŠ‚ç‚¹å½¼æ­¤ä¹‹é—´æ‰“å¼€è¿æ¥ï¼Œå¹¶åœ¨åŒä¸€è¿æ¥ä¸Šå®‰è£…ä¸åŒçš„åè®®æˆ–æµã€‚åœ¨æœ€åˆçš„æ¡æ‰‹ä¸­ï¼ŒèŠ‚ç‚¹äº¤æ¢å®ƒä»¬å„è‡ªæ”¯æŒçš„åè®®ï¼Œæ‰€æœ‰ä¸Filecoinç›¸å…³çš„åè®®éƒ½å°†å®‰è£…åœ¨<code>/fil/...</code>åè®®æ ‡è¯†ç¬¦ä¸‹ã€‚</p><p>libp2pçš„å®Œæ•´è§„èŒƒå¯ä»¥åœ¨<a href="https://github.com/libp2p/specs" target="_blank" rel="noopener noreferrer">https://github.com/libp2p/specsä¸­<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>æ‰¾åˆ° ã€‚è¿™æ˜¯Filecoinä½¿ç”¨çš„libp2påè®®çš„åˆ—è¡¨ã€‚</p><ul><li><strong>Graphsyncï¼š</strong> Graphsyncæ˜¯ä¸€ç§ç”¨äºåœ¨å¯¹ç­‰ç‚¹ä¹‹é—´åŒæ­¥å›¾çš„åè®®ã€‚å®ƒç”¨äºåœ¨FilecoinèŠ‚ç‚¹ä¹‹é—´å¼•ç”¨ï¼Œå¯»å€ï¼Œè¯·æ±‚å’Œä¼ è¾“åŒºå—é“¾å’Œç”¨æˆ·æ•°æ®ã€‚æ‰€è¿° <a href="https://github.com/ipld/specs/blob/master/block-layer/graphsync/graphsync.md" target="_blank" rel="noopener noreferrer">GraphSyncçš„è‰æ¡ˆè§„èŒƒ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>æä¾›çš„æ¦‚å¿µï¼Œæ¥å£å’Œç”±GraphSyncä½¿ç”¨çš„ç½‘ç»œæ¶ˆæ¯çš„æ›´å¤šç»†èŠ‚ã€‚åè®®IDæ²¡æœ‰Filecoinç‰¹å®šçš„ä¿®æ”¹ã€‚</li><li>**Gossipsubï¼š**ä½¿ç”¨åŸºäºGossipçš„pubsubåè®®ï¼ˆç¼©å†™ä¸º*GossipSubï¼‰ï¼Œ*é€šè¿‡Filecoinç½‘ç»œä¼ æ’­å—å¤´å’Œæ¶ˆæ¯ã€‚ä¸ä¼ ç»Ÿçš„pubsubåè®®ä¸€æ ·ï¼ŒèŠ‚ç‚¹è®¢é˜…ä¸»é¢˜å¹¶æ¥æ”¶åœ¨è¿™äº›ä¸»é¢˜ä¸Šå‘å¸ƒçš„æ¶ˆæ¯ã€‚å½“èŠ‚ç‚¹ä»å…¶è®¢é˜…çš„ä¸»é¢˜æ¥æ”¶æ¶ˆæ¯æ—¶ï¼Œå®ƒä»¬å°†è¿è¡ŒéªŒè¯è¿‡ç¨‹ï¼Œå¹¶ä¸”iï¼‰å°†æ¶ˆæ¯ä¼ é€’ç»™åº”ç”¨ç¨‹åºï¼› iiï¼‰å°†æ¶ˆæ¯è¿›ä¸€æ­¥è½¬å‘ç»™ä»–ä»¬çŸ¥é“å·²è®¢é˜…åŒä¸€ä¸»é¢˜çš„èŠ‚ç‚¹ã€‚æ­¤å¤–ï¼ŒFileCoinä¸­ä½¿ç”¨çš„GossipSub v1.1ç‰ˆæœ¬é€šè¿‡å®‰å…¨æœºåˆ¶è¿›è¡Œäº†å¢å¼ºï¼Œè¯¥æœºåˆ¶ä½¿åè®®å¯ä»¥æŠµå¾¡å®‰å…¨æ”»å‡»ã€‚è¯¥ <a href="https://github.com/libp2p/specs/tree/master/pubsub/gossipsub" target="_blank" rel="noopener noreferrer">GossipSubè§„æ ¼<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>æä¾›æœ‰å…³å…¶è®¾è®¡å’Œå®ç°çš„æ‰€æœ‰åè®®è¯¦ç»†ä¿¡æ¯ï¼Œä»¥åŠåè®®å‚æ•°çš„ç‰¹å®šè®¾ç½®ã€‚å°šæœªå¯¹åè®®IDè¿›è¡Œfilecoinçš„ç‰¹å®šä¿®æ”¹ã€‚ä½†æ˜¯è¯é¢˜æ ‡è¯†å¿…é¡»æ˜¯å½¢å¼<code>fil/blocks/&lt;network-name&gt;</code>å’Œ<code>fil/msgs/&lt;network-name&gt;</code></li><li><strong>Kademlia DHTï¼š</strong> Kademlia DHTæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼å“ˆå¸Œè¡¨ï¼Œåœ¨ç‰¹å®šèŠ‚ç‚¹çš„æœ€å¤§æŸ¥æ‰¾æ•°ä¸Šå…·æœ‰å¯¹æ•°èŒƒå›´ã€‚åœ¨Filecoinç½‘ç»œä¸­ï¼ŒKademlia DHTä¸»è¦ç”¨äºå¯¹ç­‰å‘ç°å’Œå¯¹ç­‰è·¯ç”±ã€‚ç‰¹åˆ«æ˜¯ï¼Œå½“ä¸€ä¸ªèŠ‚ç‚¹æƒ³è¦åœ¨Filecoinç½‘ç»œä¸­å­˜å‚¨æ•°æ®æ—¶ï¼Œå®ƒä»¬ä¼šè·å¾—ä¸€ä¸ªçŸ¿å·¥åˆ—è¡¨åŠå…¶èŠ‚ç‚¹ä¿¡æ¯ã€‚è¯¥èŠ‚ç‚¹ä¿¡æ¯ï¼ˆé™¤å…¶ä»–å¤–ï¼‰åŒ…æ‹¬çŸ¿å·¥çš„PeerIDã€‚ä¸ºäº†è¿æ¥åˆ°çŸ¿å·¥å¹¶äº¤æ¢æ•°æ®ï¼Œæƒ³è¦åœ¨ç½‘ç»œä¸­å­˜å‚¨æ•°æ®çš„èŠ‚ç‚¹å¿…é¡»æ‰¾åˆ°çŸ¿å·¥çš„å¤šåœ°å€ï¼Œä»–ä»¬é€šè¿‡æŸ¥è¯¢DHTæ¥å®ç°ã€‚æ‰€è¿° <a href="https://github.com/libp2p/go-libp2p-kad-dht" target="_blank" rel="noopener noreferrer">libp2på–€DHTè§„èŒƒ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>æä¾›äº†DHTç»“æ„çš„å®ç°ç»†èŠ‚ã€‚å¯¹äºFilecoinç½‘ç»œï¼Œåè®®IDçš„æ ¼å¼å¿…é¡»ä¸º<code>fil/&lt;network-name&gt;/kad/1.0.0</code>ã€‚</li><li>**å¼•å¯¼ç¨‹åºåˆ—è¡¨ï¼š**è¿™æ˜¯æ–°èŠ‚ç‚¹åœ¨åŠ å…¥ç½‘ç»œåå°è¯•è¿æ¥çš„èŠ‚ç‚¹åˆ—è¡¨ã€‚å¼•å¯¼èŠ‚ç‚¹åˆ—è¡¨åŠå…¶åœ°å€ç”±ç”¨æˆ·ï¼ˆå³åº”ç”¨ç¨‹åºï¼‰å®šä¹‰ã€‚</li><li>**å¯¹ç­‰äº¤æ¢ï¼š**æ­¤åè®®æ˜¯åœ¨Kademlia DHTä¸Šé¢è®¨è®ºçš„å¯¹ç­‰å‘ç°è¿‡ç¨‹çš„å®ç°ã€‚é€šè¿‡ä¸DHTè¿›è¡Œæ¥å£ï¼Œå®ƒä½¿å¯¹ç­‰ç‚¹å¯ä»¥æ‰¾åˆ°ç½‘ç»œä¸­å…¶ä»–å¯¹ç­‰ç‚¹çš„ä¿¡æ¯å’Œåœ°å€ï¼Œå¹¶ä¸ºè¦è¿æ¥çš„å¯¹ç­‰ç‚¹åˆ›å»ºå’Œå‘å‡ºæŸ¥è¯¢ã€‚</li></ul><h3 id="_2-1-4æ—¶é’Ÿ" tabindex="-1"><a class="header-anchor" href="#_2-1-4æ—¶é’Ÿ" aria-hidden="true">#</a> 2.1.4<a href="https://spec.filecoin.io/#section-systems.filecoin_nodes.clock" target="_blank" rel="noopener noreferrer">æ—¶é’Ÿ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h3><p>Filecoinå‡å®šç³»ç»Ÿå‚ä¸è€…ä¹‹é—´çš„æ—¶é’ŸåŒæ­¥è¾ƒå¼±ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç³»ç»Ÿä¾èµ–äºå‚ä¸è€…å¯ä»¥è®¿é—®å…¨å±€åŒæ­¥æ—¶é’Ÿï¼ˆå…è®¸æŸäº›æœ‰ç•Œåç§»ï¼‰ã€‚</p><p>Filecoinä¾é æ­¤ç³»ç»Ÿæ—¶é’Ÿæ¥ç¡®ä¿å…±è¯†ã€‚å…·ä½“æ¥è¯´ï¼Œæ—¶é’Ÿæ˜¯æ”¯æŒéªŒè¯è§„åˆ™æ‰€å¿…éœ€çš„ï¼ŒéªŒè¯è§„åˆ™å¯é˜²æ­¢å—ç”Ÿäº§è€…ä½¿ç”¨åè®®çš„æ—¶é—´æˆ³æ¥æŒ–æ˜å…·æœ‰æœªæ¥æ—¶é—´æˆ³çš„å—å¹¶æ›´é¢‘ç¹åœ°è¿è¡Œé¢†å¯¼è€…é€‰ä¸¾ã€‚</p><h4 id="_2-1-4-1æ—¶é’Ÿç”¨é€”" tabindex="-1"><a class="header-anchor" href="#_2-1-4-1æ—¶é’Ÿç”¨é€”" aria-hidden="true">#</a> 2.1.4.1<a href="https://spec.filecoin.io/#section-systems.filecoin_nodes.clock.clock-uses" target="_blank" rel="noopener noreferrer">æ—¶é’Ÿç”¨é€”<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><p>ä½¿ç”¨Filecoinç³»ç»Ÿæ—¶é’Ÿï¼š</p><ul><li>é€šè¿‡åŒæ­¥èŠ‚ç‚¹æ¥éªŒè¯ä¼ å…¥å—æ˜¯å¦åœ¨ç»™å®šæ—¶é—´æˆ³çš„é€‚å½“çºªå…ƒå†…è¢«æŒ–æ˜ï¼ˆè¯·å‚è§ <a href="https://spec.filecoin.io/#section-systems.filecoin_blockchain.struct.block.block-syntax-validation" target="_blank" rel="noopener noreferrer">å—éªŒè¯<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ï¼‰ã€‚è¿™æ˜¯å¯èƒ½çš„ï¼Œå› ä¸ºç³»ç»Ÿæ—¶é’Ÿå§‹ç»ˆå°†æ—¶é—´æ˜ å°„åˆ°å”¯ä¸€çš„çºªå…ƒå·ï¼Œè¯¥çºªå…ƒå·å®Œå…¨ç”±åˆ›ä¸–å—ä¸­çš„å¼€å§‹æ—¶é—´ç¡®å®šã€‚</li><li>é€šè¿‡åŒæ­¥èŠ‚ç‚¹ä»¥æ”¾ç½®æ¥è‡ªæœªæ¥çºªå…ƒçš„æ•°æ®å—</li><li>é€šè¿‡å…è®¸èŠ‚ç‚¹åœ¨ä¸‹ä¸€è½®å°è¯•é¢†å¯¼è€…é€‰ä¸¾ï¼ˆå¦‚æœåœ¨å½“å‰è½®ä¸­æ²¡æœ‰äººäº§ç”Ÿé˜»ç¢çš„æƒ…å†µä¸‹ï¼‰æ¥æŒ–æ˜èŠ‚ç‚¹ï¼Œä»¥ä¿æŒåè®®çš„æ´»è·ƒæ€§ï¼ˆè¯·å‚é˜… <a href="https://spec.filecoin.io/#section-systems.filecoin_blockchain.storage_power_consensus" target="_blank" rel="noopener noreferrer">å­˜å‚¨ç”µæºå…±è¯†<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ï¼‰ã€‚</li></ul><p>ä¸ºäº†å…è®¸çŸ¿å·¥æ‰§è¡Œä¸Šè¿°æ“ä½œï¼Œç³»ç»Ÿæ—¶é’Ÿå¿…é¡»ï¼š</p><ol><li>ç›¸å¯¹äºå…¶ä»–èŠ‚ç‚¹å…·æœ‰è¶³å¤Ÿä½çš„åç§»é‡ï¼Œä»¥ä½¿ä»å…¶ä»–èŠ‚ç‚¹çš„è§’åº¦æ¥çœ‹ï¼Œä¸ä¼šåœ¨è¢«è®¤ä¸ºæ˜¯æœªæ¥çºªå…ƒçš„çºªå…ƒä¸­å¼€é‡‡åŒºå—ï¼ˆè¿™äº›åŒºå—ç›´åˆ°æ ¹æ®<a href="https://spec.filecoin.io/#section-systems.filecoin_blockchain.struct.block.block-semantic-validation" target="_blank" rel="noopener noreferrer">éªŒè¯è§„åˆ™<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>çš„æ­£ç¡®çºªå…ƒ/æ—¶é—´æ‰è¢« <a href="https://spec.filecoin.io/#section-systems.filecoin_blockchain.struct.block.block-semantic-validation" target="_blank" rel="noopener noreferrer">éªŒè¯<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ï¼‰ã€‚</li><li>è®¾ç½®èŠ‚ç‚¹åˆå§‹åŒ–çš„æ—¶æœŸæ•°ç­‰äº <code>epoch = Floor[(current_time - genesis_time) / epoch_time]</code></li></ol><p>é¢„è®¡å…¶ä»–å­ç³»ç»Ÿå°†ä»<code>NewRound()</code>æ—¶é’Ÿå­ç³»ç»Ÿæ³¨å†Œåˆ°äº‹ä»¶ã€‚</p><h4 id="_2-1-4-2æ—¶é’Ÿè¦æ±‚" tabindex="-1"><a class="header-anchor" href="#_2-1-4-2æ—¶é’Ÿè¦æ±‚" aria-hidden="true">#</a> 2.1.4.2<a href="https://spec.filecoin.io/#section-systems.filecoin_nodes.clock.clock-requirements" target="_blank" rel="noopener noreferrer">æ—¶é’Ÿè¦æ±‚<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><p>ç”¨ä½œFilecoinåè®®ä¸€éƒ¨åˆ†çš„æ—¶é’Ÿåº”ä¿æŒåŒæ­¥ï¼Œä¸”åç§»å°äº1ç§’ï¼Œä»¥ä¾¿è¿›è¡Œé€‚å½“çš„éªŒè¯ã€‚</p><p>é¢„è®¡è®¡ç®—æœºçº§æ™¶ä½“çš„åå·®ä¸º <a href="https://www.hindawi.com/journals/jcnc/2008/583162/" target="_blank" rel="noopener noreferrer">1ppm<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ï¼ˆå³æ¯ç§’1å¾®ç§’ï¼Œæˆ–æ¯å‘¨0.6ç§’ï¼‰ã€‚å› æ­¤ï¼Œä¸ºäº†éµå®ˆä¸Šè¿°è¦æ±‚ï¼š</p><ul><li>èŠ‚ç‚¹åº”è¿è¡ŒNTPå®ˆæŠ¤ç¨‹åºï¼ˆä¾‹å¦‚timesyncdï¼Œntpdï¼Œchronydï¼‰ï¼Œä»¥ä½¿å…¶æ—¶é’Ÿä¸ä¸€ä¸ªæˆ–å¤šä¸ªå¯é çš„å¤–éƒ¨å¼•ç”¨ä¿æŒåŒæ­¥ã€‚ <ul><li>æˆ‘ä»¬å»ºè®®ä»¥ä¸‹æ¥æºï¼š <ul><li><strong><code>pool.ntp.org</code></strong>ï¼ˆ <a href="https://www.ntppool.org/en/use.html" target="_blank" rel="noopener noreferrer">è¯¦ç»†<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ï¼‰</li><li><code>time.cloudflare.com:1234</code>ï¼ˆ <a href="https://www.cloudflare.com/time/" target="_blank" rel="noopener noreferrer">è¯¦ç»†<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ï¼‰</li><li><code>time.google.com</code>ï¼ˆ <a href="https://developers.google.com/time" target="_blank" rel="noopener noreferrer">è¯¦ç»†<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ï¼‰</li><li><code>time.nist.gov</code>ï¼ˆ <a href="https://tf.nist.gov/tf-cgi/servers.cgi" target="_blank" rel="noopener noreferrer">è¯¦ç»†<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ï¼‰</li></ul></li></ul></li><li>è¾ƒå¤§çš„é‡‡çŸ¿ä½œä¸šå¯èƒ½ä¼šè€ƒè™‘ä½¿ç”¨å…·æœ‰GPSå‚è€ƒå’Œ/æˆ–é¢‘ç‡ç¨³å®šçš„å¤–éƒ¨æ—¶é’Ÿçš„æœ¬åœ°NTP / PTPæœåŠ¡å™¨ï¼Œä»¥æ”¹å–„è®¡æ—¶åŠŸèƒ½ã€‚</li></ul><p>é‡‡çŸ¿ä¸šåŠ¡æœ‰å¼ºçƒˆçš„åŠ¨æœºæ¥é˜²æ­¢æ—¶é’Ÿå‘å‰å€¾æ–œä¸€ä¸ªçºªå…ƒä»¥ä¸Šï¼Œä»¥é˜²æ­¢å—çŠ¶æäº¤è¢«æ‹’ç»ã€‚åŒæ ·ï¼Œä»–ä»¬æœ‰åŠ¨æœºé˜²æ­¢æ—¶é’Ÿåç¦»ä¸€ä¸ªä»¥ä¸Šçš„æ—¶é—´ï¼Œä»¥é¿å…å°†è‡ªå·±ä¸ç½‘ç»œä¸­çš„åŒæ­¥èŠ‚ç‚¹åˆ†å¼€ã€‚</p><h2 id="_2-2æ–‡ä»¶å’Œæ•°æ®" tabindex="-1"><a class="header-anchor" href="#_2-2æ–‡ä»¶å’Œæ•°æ®" aria-hidden="true">#</a> 2.2<a href="https://spec.filecoin.io/#section-systems.filecoin_files" target="_blank" rel="noopener noreferrer">æ–‡ä»¶å’Œæ•°æ®<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h2><p>Filecoinçš„ä¸»è¦ç›®çš„æ˜¯å­˜å‚¨å®¢æˆ·çš„æ–‡ä»¶å’Œæ•°æ®ã€‚æœ¬èŠ‚è¯¦ç»†ä»‹ç»ä¸å¤„ç†æ–‡ä»¶ï¼Œåˆ†å—ï¼Œç¼–ç ï¼Œå›¾å½¢è¡¨ç¤º<code>Pieces</code>ï¼Œï¼Œå­˜å‚¨æŠ½è±¡ç­‰ç›¸å…³çš„æ•°æ®ç»“æ„å’Œå·¥å…·ã€‚</p><h3 id="_2-2-1æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#_2-2-1æ–‡ä»¶" aria-hidden="true">#</a> 2.2.1<a href="https://spec.filecoin.io/#section-systems.filecoin_files.file" target="_blank" rel="noopener noreferrer">æ–‡ä»¶<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h3><p><a href="https://spec.filecoin.io/#example-" target="_blank" rel="noopener noreferrer">ä¾‹ï¼š<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// Path is an opaque locator for a file (e.g. in a unix-style filesystem).</span>
<span class="token keyword">type</span> Path <span class="token builtin">string</span>

<span class="token comment">// File is a variable length data container.</span>
<span class="token comment">// The File interface is modeled after a unix-style file, but abstracts the</span>
<span class="token comment">// underlying storage system.</span>
<span class="token keyword">type</span> File <span class="token keyword">interface</span> <span class="token punctuation">{</span>
    <span class="token function">Path</span><span class="token punctuation">(</span><span class="token punctuation">)</span>   Path
    <span class="token function">Size</span><span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token builtin">int</span>
    <span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token builtin">error</span>

    <span class="token comment">// Read reads from File into buf, starting at offset, and for size bytes.</span>
    <span class="token function">Read</span><span class="token punctuation">(</span>offset <span class="token builtin">int</span><span class="token punctuation">,</span> size <span class="token builtin">int</span><span class="token punctuation">,</span> buf Bytes<span class="token punctuation">)</span> <span class="token keyword">struct</span> <span class="token punctuation">{</span>size <span class="token builtin">int</span><span class="token punctuation">,</span> e <span class="token builtin">error</span><span class="token punctuation">}</span>

    <span class="token comment">// Write writes from buf into File, starting at offset, and for size bytes.</span>
    <span class="token function">Write</span><span class="token punctuation">(</span>offset <span class="token builtin">int</span><span class="token punctuation">,</span> size <span class="token builtin">int</span><span class="token punctuation">,</span> buf Bytes<span class="token punctuation">)</span> <span class="token keyword">struct</span> <span class="token punctuation">{</span>size <span class="token builtin">int</span><span class="token punctuation">,</span> e <span class="token builtin">error</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-2-1-1filestore-æ–‡ä»¶çš„æœ¬åœ°å­˜å‚¨" tabindex="-1"><a class="header-anchor" href="#_2-2-1-1filestore-æ–‡ä»¶çš„æœ¬åœ°å­˜å‚¨" aria-hidden="true">#</a> 2.2.1.1<a href="https://spec.filecoin.io/#section-systems.filecoin_files.file.filestore" target="_blank" rel="noopener noreferrer">FileStore-æ–‡ä»¶çš„æœ¬åœ°å­˜å‚¨<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><p>çš„<code>FileStore</code>æ˜¯ç”¨æ¥æŒ‡ä»»ä½•åº•å±‚ç³»ç»Ÿæˆ–è®¾å¤‡ï¼Œå…¶å°†Filecoinå…¶æ•°æ®å­˜å‚¨åˆ°ä¸€ä¸ªæŠ½è±¡ã€‚å®ƒåŸºäºUnixæ–‡ä»¶ç³»ç»Ÿè¯­ä¹‰ï¼Œå¹¶åŒ…å«çš„æ¦‚å¿µ<code>Paths</code>ã€‚åœ¨è¿™é‡Œä½¿ç”¨è¿™ç§æŠ½è±¡æ˜¯ä¸ºäº†ç¡®ä¿Filecoinçš„å®ç°ä½¿æœ€ç»ˆç”¨æˆ·å¯ä»¥è½»æ¾åœ°ä½¿ç”¨é€‚åˆä»–ä»¬éœ€æ±‚çš„åŸºç¡€æ›¿æ¢åº•å±‚å­˜å‚¨ç³»ç»Ÿã€‚æœ€ç®€å•çš„ç‰ˆæœ¬<code>FileStore</code>åªæ˜¯ä¸»æœºæ“ä½œç³»ç»Ÿçš„æ–‡ä»¶ç³»ç»Ÿã€‚</p><p><a href="https://spec.filecoin.io/#example-" target="_blank" rel="noopener noreferrer">ä¾‹ï¼š<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// FileStore is an object that can store and retrieve files by path.</span>
<span class="token keyword">type</span> FileStore <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    <span class="token function">Open</span><span class="token punctuation">(</span>p Path<span class="token punctuation">)</span>           union <span class="token punctuation">{</span>f File<span class="token punctuation">,</span> e <span class="token builtin">error</span><span class="token punctuation">}</span>
    <span class="token function">Create</span><span class="token punctuation">(</span>p Path<span class="token punctuation">)</span>         union <span class="token punctuation">{</span>f File<span class="token punctuation">,</span> e <span class="token builtin">error</span><span class="token punctuation">}</span>
    <span class="token function">Store</span><span class="token punctuation">(</span>p Path<span class="token punctuation">,</span> f File<span class="token punctuation">)</span>  <span class="token builtin">error</span>
    <span class="token function">Delete</span><span class="token punctuation">(</span>p Path<span class="token punctuation">)</span>         <span class="token builtin">error</span>

    <span class="token comment">// maybe add:</span>
    <span class="token comment">// Copy(SrcPath, DstPath)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_2-2-1-1-1å˜åŒ–çš„ç”¨æˆ·éœ€æ±‚" tabindex="-1"><a class="header-anchor" href="#_2-2-1-1-1å˜åŒ–çš„ç”¨æˆ·éœ€æ±‚" aria-hidden="true">#</a> 2.2.1.1.1<a href="https://spec.filecoin.io/#section-systems.filecoin_files.file.filestore.varying-user-needs" target="_blank" rel="noopener noreferrer">å˜åŒ–çš„ç”¨æˆ·éœ€æ±‚<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h5><p>Filecoinç”¨æˆ·çš„éœ€æ±‚å·®å¼‚å¾ˆå¤§ï¼Œè®¸å¤šç”¨æˆ·ï¼ˆå°¤å…¶æ˜¯çŸ¿å·¥ï¼‰å°†åœ¨Filecoinçš„ä¸‹æ–¹å’Œå‘¨å›´å®æ–½å¤æ‚çš„å­˜å‚¨æ¶æ„ã€‚<code>FileStore</code>è¿™é‡Œçš„æŠ½è±¡æ˜¯ä¸ºäº†ä½¿è¿™äº›å˜åŒ–çš„éœ€æ±‚æ˜“äºæ»¡è¶³ã€‚Filecoinåè®®ä¸­çš„æ‰€æœ‰æ–‡ä»¶å’Œæ‰‡åŒºæœ¬åœ°æ•°æ®å­˜å‚¨éƒ½æ˜¯é€šè¿‡æ­¤<code>FileStore</code>æ¥å£å®šä¹‰çš„ï¼Œè¿™ä½¿å®ç°æ˜“äºå®ç°å¯äº¤æ¢ï¼Œå¹¶ä¸”ä½¿æœ€ç»ˆç”¨æˆ·å¯ä»¥è½»æ¾é€‰æ‹©æ‰€é€‰æ‹©çš„ç³»ç»Ÿã€‚</p><h5 id="_2-2-1-1-2å®æ–½å®ä¾‹" tabindex="-1"><a class="header-anchor" href="#_2-2-1-1-2å®æ–½å®ä¾‹" aria-hidden="true">#</a> 2.2.1.1.2<a href="https://spec.filecoin.io/#section-systems.filecoin_files.file.filestore.implementation-examples" target="_blank" rel="noopener noreferrer">å®æ–½å®ä¾‹<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h5><p>è¯¥<code>FileStore</code>æ¥å£å¯ä»¥ç”±å¤šç§åå¤‡æ•°æ®å­˜å‚¨ç³»ç»Ÿæ¥å®ç°ã€‚ä¾‹å¦‚ï¼š</p><ul><li>ä¸»æœºæ“ä½œç³»ç»Ÿæ–‡ä»¶ç³»ç»Ÿ</li><li>ä»»ä½•Unix / Posixæ–‡ä»¶ç³»ç»Ÿ</li><li>RAIDæ”¯æŒçš„æ–‡ä»¶ç³»ç»Ÿ</li><li>è”ç½‘çš„åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼ˆNFSï¼ŒHDFSç­‰ï¼‰</li><li>IPFS</li><li>èµ„æ–™åº“</li><li>NASç³»ç»Ÿ</li><li>åŸå§‹ä¸²è¡Œæˆ–å—è®¾å¤‡</li><li>åŸå§‹ç¡¬ç›˜é©±åŠ¨å™¨ï¼ˆhddæ‰‡åŒºç­‰ï¼‰</li></ul><p>å®ç°åº”å®ç°å¯¹ä¸»æœºOSæ–‡ä»¶ç³»ç»Ÿçš„æ”¯æŒã€‚å®ç°å¯ä»¥å®ç°å¯¹å…¶ä»–å­˜å‚¨ç³»ç»Ÿçš„æ”¯æŒã€‚</p><h3 id="_2-2-2æ–‡ä»¶å¸ç‰‡" tabindex="-1"><a class="header-anchor" href="#_2-2-2æ–‡ä»¶å¸ç‰‡" aria-hidden="true">#</a> 2.2.2<a href="https://spec.filecoin.io/#section-systems.filecoin_files.piece" target="_blank" rel="noopener noreferrer">æ–‡ä»¶å¸ç‰‡<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h3><p>è¯¥<em>Filecoinç‰‡</em>æ˜¯ä¸»è¦çš„<em>è°ˆåˆ¤å•ä½</em>ä¸ºç”¨æˆ·å­˜å‚¨Filecoinç½‘ç»œä¸Šçš„æ•°æ®ã€‚Filecoin Piece<em>ä¸æ˜¯å­˜å‚¨å•ä½</em>ï¼Œå®ƒæ²¡æœ‰ç‰¹å®šå¤§å°ï¼Œä½†æ˜¯å—<em>Sector</em>å¤§å°çš„é™åˆ¶ã€‚Filecoinç‰‡æ®µçš„å¤§å°å¯ä»¥ä»»æ„ï¼Œä½†æ˜¯å¦‚æœç‰‡æ®µå¤§äºçŸ¿å·¥æ”¯æŒçš„æ‰‡åŒºçš„å¤§å°ï¼Œåˆ™å¿…é¡»å°†å…¶æ‹†åˆ†æˆæ›´å¤šçš„ç‰‡æ®µï¼Œä»¥ä½¿æ¯ä¸ªç‰‡æ®µéƒ½é€‚åˆä¸€ä¸ªæ‰‡åŒºã€‚</p><p>A<code>Piece</code>æ˜¯ä»£è¡¨açš„å…¨éƒ¨æˆ–ä¸€éƒ¨åˆ†çš„å¯¹è±¡ï¼Œ<code>File</code>ç”±<code>Storage Clients</code>å’Œ<code>Storage Miners</code>åœ¨ä¸­ä½¿ç”¨<code>Deals</code>ã€‚<code>Storage Clients</code>ç§Ÿç”¨<code>Storage Miners</code>å­˜æ”¾<code>Pieces</code>ã€‚</p><p>Pieceæ•°æ®ç»“æ„ç”¨äºè¯æ˜å­˜å‚¨ä»»æ„IPLDå›¾å’Œå®¢æˆ·ç«¯æ•°æ®ã€‚è¯¥å›¾æ˜¾ç¤ºäº†ä¸€ä¸ªéƒ¨ä»¶åŠå…¶è¯æ˜æ ‘çš„è¯¦ç»†ç»„æˆï¼ŒåŒ…æ‹¬å®Œæ•´çš„å’Œå¸¦å®½ä¼˜åŒ–çš„éƒ¨ä»¶æ•°æ®ç»“æ„ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gn7ulf31hej31900pmn9l.jpg" alt="image-20210201105729280"></p><h4 id="_2-2-2-1æ•°æ®è¡¨ç¤º" tabindex="-1"><a class="header-anchor" href="#_2-2-2-1æ•°æ®è¡¨ç¤º" aria-hidden="true">#</a> 2.2.2.1<a href="https://spec.filecoin.io/#section-systems.filecoin_files.piece.data-representation" target="_blank" rel="noopener noreferrer">æ•°æ®è¡¨ç¤º<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><p>é‡è¦çš„æ˜¯è¦å¼ºè°ƒï¼Œæäº¤ç»™Filecoinç½‘ç»œçš„æ•°æ®åœ¨ç»è¿‡è½¬æ¢ä¹‹åæ‰å˜æˆ<code>StorageProvider</code>å­˜å‚¨æ•°æ®çš„æ ¼å¼ã€‚</p><p>ä»ç”¨æˆ·å¼€å§‹å‡†å¤‡è¦å­˜å‚¨åœ¨Filecoinä¸­çš„æ–‡ä»¶åˆ°æä¾›è€…ç”Ÿæˆå­˜å‚¨åœ¨ä¸€ä¸ªéƒ¨é—¨ä¸­çš„æ‰€æœ‰ä½œå“æ ‡è¯†ç¬¦çš„è¿‡ç¨‹ï¼Œä¸‹é¢æ˜¯è¿‡ç¨‹ã€‚</p><p>å‰ä¸‰ä¸ªæ­¥éª¤åœ¨å®¢æˆ·ç«¯è¿›è¡Œã€‚</p><ol><li>å½“å®¢æˆ·æƒ³è¦åœ¨Filecoinç½‘ç»œä¸­å­˜å‚¨æ–‡ä»¶æ—¶ï¼Œä»–ä»¬é¦–å…ˆç”Ÿæˆæ–‡ä»¶çš„IPLD DAGã€‚è¡¨ç¤ºDAGæ ¹èŠ‚ç‚¹çš„å“ˆå¸Œæ˜¯IPFSæ ·å¼çš„CIDï¼Œç§°ä¸º<em>æœ‰æ•ˆè´Ÿè½½CID</em>ã€‚</li><li>ä¸ºäº†åˆ¶ä½œ<em>Filecoin Piece</em>ï¼ŒIPLD DAGè¢«åºåˆ—åŒ–ä¸º <a href="https://github.com/ipld/specs/blob/master/block-layer/content-addressable-archives.md#summary" target="_blank" rel="noopener noreferrer">â€œ Content-Addressable aRchiveâ€ï¼ˆã€‚carï¼‰<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶ä¸ºåŸå§‹å­—èŠ‚æ ¼å¼ã€‚CARæ–‡ä»¶æ˜¯ä¸€ä¸ªä¸é€æ˜çš„æ•°æ®å—ï¼Œå¯æ‰“åŒ…åœ¨ä¸€èµ·å¹¶ä¼ è¾“IPLDèŠ‚ç‚¹ã€‚è¯¥<em>æœ‰æ•ˆè½½è·CID</em>æ˜¯CAR&#39;edå’ŒæœªCAR&#39;edç»“æ„ä¹‹é—´å¸¸è§ã€‚å½“ç¨ååœ¨å­˜å‚¨å®¢æˆ·ç«¯å’Œå­˜å‚¨æä¾›è€…ä¹‹é—´ä¼ è¾“æ•°æ®æ—¶ï¼Œè¿™å°†åœ¨ç¨åçš„æ•°æ®æ£€ç´¢æœŸé—´æœ‰æ‰€å¸®åŠ©ã€‚</li><li>ç”Ÿæˆçš„.caræ–‡ä»¶ç”¨é¢å¤–çš„é›¶ä½<em>å¡«å……</em>ï¼Œä»¥ä½¿è¯¥æ–‡ä»¶å½¢æˆäºŒè¿›åˆ¶Merkleæ ‘ã€‚ä¸ºäº†è·å¾—å¹²å‡€çš„äºŒè¿›åˆ¶Merkleæ ‘ï¼Œ.caræ–‡ä»¶çš„å¤§å°å¿…é¡»ä¸º2ï¼ˆ^ 2ï¼‰çš„å¹‚ã€‚å¡«å……è¿‡ç¨‹ç§°ä¸º<code>Fr32 padding</code>ï¼Œå°†æ¯256ä½ä¸­çš„254ä½ä¸­çš„ä¸¤ï¼ˆ2ï¼‰ä¸ªé›¶ä½åŠ åˆ°è¾“å…¥æ–‡ä»¶ä¸­ã€‚ä¸‹ä¸€æ­¥ï¼Œå¡«å……è¿‡ç¨‹è·å–è¿‡ç¨‹çš„è¾“å‡ºï¼Œ<code>Fr32 padding</code>å¹¶æ‰¾åˆ°å…¶ä¸Šæ–¹çš„å¤§å°ï¼Œä»è€Œå¾—åˆ°2çš„å¹‚ã€‚<code>Fr32 padding</code>ä¸‹ä¸€ä¸ª2çš„å¹‚æ¬¡æ–¹çš„ç»“æœä¹‹é—´çš„å·®è·ç”¨é›¶å¡«å……ã€‚</li></ol><p>ä¸ºäº†è¯´æ˜è¿™äº›æ­¥éª¤èƒŒåçš„åŸå› ï¼Œé‡è¦çš„æ˜¯äº†è§£<code>StorageClient</code>å’Œä¹‹é—´çš„æ€»ä½“è°ˆåˆ¤è¿‡ç¨‹<code>StorageProvider</code>ã€‚CIDæˆ–CommPæ˜¯å®¢æˆ·ä¸å­˜å‚¨æä¾›å•†åå•†å¹¶åŒæ„çš„äº¤æ˜“ä¸­åŒ…å«çš„å†…å®¹ã€‚è¾¾æˆåè®®åï¼Œå®¢æˆ·ç«¯å°†æ–‡ä»¶å‘é€ç»™æä¾›è€…ï¼ˆä½¿ç”¨GraphSyncï¼‰ã€‚æä¾›è€…å¿…é¡»ä»æ¥æ”¶åˆ°çš„æ–‡ä»¶ä¸­æ„é€ å‡ºCARæ–‡ä»¶ï¼Œå¹¶ä»å…¶ä¸€ä¾§å¯¼å‡ºPiece CIDã€‚ä¸ºäº†é¿å…å®¢æˆ·å‘å•†å®šçš„æ–‡ä»¶å‘é€ä¸åŒçš„æ–‡ä»¶ï¼Œæä¾›è€…ç”Ÿæˆçš„ä»¶CIDå¿…é¡»ä¸å…ˆå‰åå•†çš„äº¤æ˜“ä¸­åŒ…å«çš„æ–‡ä»¶CIDç›¸åŒã€‚</p><p>ä»¥ä¸‹æ­¥éª¤åœ¨<code>StorageProvider</code>ä¸€ä¾§è¿›è¡Œï¼ˆé™¤äº†æ­¥éª¤4ï¼Œä¹Ÿå¯ä»¥åœ¨å®¢æˆ·ç«¯è¿›è¡Œï¼‰ã€‚</p><ol><li>ä¸€æ—¦<code>StorageProvider</code>æ¥æ”¶åˆ°æ¥è‡ªå®¢æˆ·ç«¯çš„æ–‡ä»¶ï¼Œä»–ä»¬å°±ä¼šä»Pieceçš„å“ˆå¸Œå€¼ï¼ˆå¡«å……çš„.caræ–‡ä»¶ï¼‰ä¸­è®¡ç®—å‡ºMerkleæ ¹ã€‚å¹²å‡€çš„äºŒå‰æ ‘Merkleæ ‘çš„ç»“æœæ ¹æ˜¯<strong>Piece CID</strong>ã€‚è¿™ä¹Ÿç§°ä¸º<em>CommP</em>æˆ–<em>è®¡ä»¶æ‰¿è¯º</em>ï¼Œå¦‚å‰æ‰€è¿°ï¼Œå¿…é¡»ä¸äº¤æ˜“ä¸­åŒ…å«çš„<em>æ‰¿è¯º</em>ç›¸åŒã€‚</li><li>è¯¥éƒ¨åˆ†ä¸å…¶ä»–äº¤æ˜“çš„æ•°æ®ä¸€èµ·åŒ…å«åœ¨ä¸€ä¸ªéƒ¨é—¨ä¸­ã€‚åœ¨<code>StorageProvider</code>éšåè®¡ç®—æ‰€æœ‰éƒ¨é—¨å†…ä»¶æ¢…å…‹å°”æ ¹ã€‚è¯¥æ ‘çš„æ ¹æ˜¯<em>CommD</em>ï¼ˆåˆç§°<em>æ•°æ®æ‰¿è¯º</em>æˆ–<code>UnsealedSectorCID</code>ï¼‰ã€‚</li><li>æ‰€è¿°<code>StorageProvider</code>ç„¶åå¯†å°è¯¥æ‰‡åŒºå¹¶ä¸”å°†æ‰€å¾—æ¢…å…‹å°”æ ¹çš„æ ¹æ˜¯<em>CommRLast</em>ã€‚</li><li>ç‰¹åˆ«æ˜¯å¤åˆ¶è¯æ˜ï¼ˆPoRepï¼‰ï¼Œç‰¹åˆ«æ˜¯SDRï¼Œä¼šç”Ÿæˆå¦ä¸€ä¸ªåä¸º<em>CommCçš„</em>Merkleæ ¹å“ˆå¸Œï¼Œä»¥è¯æ˜å·²æ­£ç¡®æ‰§è¡Œäº†æ‰¿è¯ºä¸º<em>CommD</em>çš„æ•°æ®çš„å¤åˆ¶ã€‚</li><li>æœ€åï¼Œ<em>CommR</em>ï¼ˆæˆ–<em>å¤åˆ¶æ‰¿è¯º</em>ï¼‰æ˜¯CommCçš„å“ˆå¸Œã€‚CommRLastã€‚</li></ol><p><strong>é‡è¦ç¬”è®°ï¼š</strong></p><ul><li><code>Fr32</code>æ˜¯å­—æ®µå…ƒç´ çš„32ä½è¡¨ç¤ºå½¢å¼ï¼ˆåœ¨æˆ‘ä»¬çš„æƒ…å†µä¸‹ä¸ºBLS12-381çš„ç®—æœ¯å­—æ®µï¼‰ã€‚ä¸ºäº†æ ¼å¼æ­£ç¡®ï¼Œç±»å‹å€¼<code>Fr32</code>å¿…é¡»<em>å®é™…ä¸Š</em>é€‚åˆè¯¥å­—æ®µï¼Œä½†æ˜¯ç±»å‹ç³»ç»Ÿä¸å¼ºåˆ¶æ‰§è¡Œè¯¥å€¼ã€‚å®ƒæ˜¯ä¸å˜é‡ï¼Œå¿…é¡»æ­£ç¡®ä½¿ç”¨æ‰èƒ½ä¿ç•™ã€‚åœ¨æ‰€è°“çš„æƒ…å†µä¸‹<code>Fr32 padding</code>ï¼Œä¸¤ä¸ªé›¶ä½è¢«æ’å…¥åˆ°ä¸€ä¸ªâ€œéœ€è¦â€æœ€å¤š254ä½æ‰èƒ½è¡¨ç¤ºçš„æ•°å­—ä¹‹åã€‚è¿™ä¿è¯äº†ç»“æœå°†ä¸º<code>Fr32</code>ï¼Œè€Œä¸ç®¡åˆå§‹254ä½çš„å€¼å¦‚ä½•ã€‚è¿™æ˜¯ä¸€ç§â€œä¿å®ˆâ€æŠ€æœ¯ï¼Œå› ä¸ºå¯¹äºæŸäº›åˆå§‹å€¼ï¼Œå®é™…ä¸Šåªéœ€è¦ä¸€ç‚¹é›¶å¡«å……ã€‚</li><li>ä¸Šé¢çš„æ­¥éª¤2å’Œ3æ˜¯ç‰¹å®šäºLotuså®ç°çš„ã€‚å¯ä»¥é€šè¿‡ä¸åŒçš„æ–¹å¼æ¥å®ç°ç›¸åŒçš„ç»“æœï¼Œä¾‹å¦‚ï¼Œæ— éœ€ä½¿ç”¨<code>Fr32</code>ä½å¡«å……ã€‚ä½†æ˜¯ï¼Œä»»ä½•å®ç°éƒ½å¿…é¡»ç¡®ä¿å¯¹åˆå§‹IPLD DAGè¿›è¡Œäº†åºåˆ—åŒ–å’Œå¡«å……ï¼Œä»¥ä¾¿æä¾›å¹²å‡€çš„äºŒå‰æ ‘ï¼Œå› æ­¤ï¼Œä»æ‰€å¾—æ•°æ®æ–‘ç‚¹ä¸­è®¡ç®—å‡ºMerkleæ ¹æ—¶ï¼Œå°†å¾—åˆ°ç›¸åŒçš„<strong>Piece CID</strong>ã€‚åªè¦æ˜¯è¿™ç§æƒ…å†µï¼Œå®ç°å¯èƒ½ä¼šåç¦»ä¸Šé¢çš„å‰ä¸‰ä¸ªæ­¥éª¤ã€‚</li><li>æœ€åï¼Œé‡è¦çš„æ˜¯æ·»åŠ ä¸<em>æœ‰æ•ˆè½½è·CID</em>ï¼ˆåœ¨ä¸Šé¢çš„å‰ä¸¤ä¸ªæ­¥éª¤ä¸­è®¨è®ºè¿‡ï¼‰å’Œæ•°æ®æ£€ç´¢è¿‡ç¨‹æœ‰å…³çš„æ³¨é‡Šã€‚æ£€ç´¢äº¤æ˜“æ ¹æ®<em>æœ‰æ•ˆè´Ÿè½½CID</em>è¿›è¡Œåå•†ã€‚è¾¾æˆæ£€ç´¢åè®®åï¼Œæ£€ç´¢çŸ¿å·¥å°†å¼€å§‹å°†æœªå¯†å°å’Œâ€œæœªCAR&#39;edâ€çš„æ–‡ä»¶å‘é€ç»™å®¢æˆ·ç«¯ã€‚ä¼ è¾“ä»IPLD Merkleæ ‘çš„æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œè¿™æ ·å®¢æˆ·ç«¯å¯ä»¥ä»ä¼ è¾“å¼€å§‹å°±éªŒè¯<em>æœ‰æ•ˆè´Ÿè½½CID</em>ï¼Œå¹¶éªŒè¯ä»–ä»¬æ¥æ”¶çš„æ–‡ä»¶æ˜¯ä»–ä»¬åœ¨äº¤æ˜“ä¸­åå•†çš„æ–‡ä»¶ï¼Œè€Œä¸æ˜¯éšæœºä½ã€‚</li></ul><h4 id="_2-2-2-2ä»¶å•†åº—" tabindex="-1"><a class="header-anchor" href="#_2-2-2-2ä»¶å•†åº—" aria-hidden="true">#</a> 2.2.2.2<a href="https://spec.filecoin.io/#section-systems.filecoin_files.piece.piecestore" target="_blank" rel="noopener noreferrer">ä»¶å•†åº—<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><p>è¯¥<code>PieceStore</code>æ¨¡å—å…è®¸ä»æœ¬åœ°å­˜å‚¨ä¸­å­˜å‚¨å’Œæ£€ç´¢ç¢ç‰‡ã€‚é›¶é…ä»¶å•†åº—çš„ä¸»è¦ç›®æ ‡æ˜¯å¸®åŠ© <a href="https://github.com/filecoin-project/go-fil-markets/blob/master/storagemarket" target="_blank" rel="noopener noreferrer">å­˜å‚¨<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>å’Œ <a href="https://github.com/filecoin-project/go-fil-markets/blob/master/retrievalmarket" target="_blank" rel="noopener noreferrer">æ£€ç´¢å¸‚åœº<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>æ¨¡å—æŸ¥æ‰¾å¯†å°æ•°æ®åœ¨éƒ¨é—¨å†…éƒ¨çš„ä½ç½®ã€‚å­˜å‚¨å¸‚åœºå†™å…¥æ•°æ®ï¼Œè€Œæ£€ç´¢å¸‚åœºè¯»å–æ•°æ®ï¼Œä»¥ä¾¿å‘é€ç»™æ£€ç´¢å®¢æˆ·ã€‚</p><p>åœ¨<a href="https://github.com/filecoin-project/go-fil-markets/tree/master/piecestore" target="_blank" rel="noopener noreferrer">æ­¤å¤„<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>å¯ä»¥æ‰¾åˆ°PieceStoreæ¨¡å—çš„å®ç° ã€‚</p><h3 id="_2-2-3filecoinä¸­çš„æ•°æ®ä¼ è¾“" tabindex="-1"><a class="header-anchor" href="#_2-2-3filecoinä¸­çš„æ•°æ®ä¼ è¾“" aria-hidden="true">#</a> 2.2.3<a href="https://spec.filecoin.io/#section-systems.filecoin_files.data_transfer" target="_blank" rel="noopener noreferrer">Filecoinä¸­çš„æ•°æ®ä¼ è¾“<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h3><p>çš„<em>æ•°æ®ä¼ è¾“åè®®</em>æ˜¯ç”¨äºä¼ è¾“çš„å…¨éƒ¨æˆ–ä¸€éƒ¨åˆ†çš„åè®®<code>Piece</code>è·¨è¶Šç½‘ç»œæ—¶å¤„ç†æ˜¯åˆ¶æˆã€‚æ•°æ®ä¼ è¾“æ¨¡å—çš„æ€»ä½“ç›®æ ‡æ˜¯ä½¿å…¶æˆä¸ºåº•å±‚ä¼ è¾“ä»‹è´¨çš„æŠ½è±¡ï¼Œé€šè¿‡è¯¥åº•å±‚ä¼ è¾“ä»‹è´¨åœ¨Filecoinç½‘ç»œä¸­ä¸åŒå„æ–¹ä¹‹é—´ä¼ è¾“æ•°æ®ã€‚å½“å‰ï¼Œç”¨äºå®é™…è¿›è¡Œæ•°æ®ä¼ è¾“çš„åº•å±‚ä»‹è´¨æˆ–åè®®æ˜¯GraphSyncã€‚è¿™æ ·ï¼Œå¯ä»¥å°†æ•°æ®ä¼ è¾“åè®®è§†ä¸ºåå•†åè®®ã€‚</p><p>æ•°æ®ä¼ è¾“åè®®æ—¢ç”¨äºå­˜å‚¨åˆç”¨äºæ£€ç´¢äº¤æ˜“ã€‚åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œæ•°æ®ä¼ è¾“è¯·æ±‚éƒ½æ˜¯ç”±å®¢æˆ·ç«¯å‘èµ·çš„ã€‚è¿™æ ·åšçš„ä¸»è¦åŸå› æ˜¯ï¼Œå®¢æˆ·ç«¯é€šå¸¸æ¯”NATè½åå¾ˆå¤šï¼Œå› æ­¤ä»å…¶ç«¯å¼€å§‹ä»»ä½•æ•°æ®ä¼ è¾“æ›´åŠ æ–¹ä¾¿ã€‚å¯¹äºå­˜å‚¨äº¤æ˜“ï¼Œæ•°æ®ä¼ è¾“è¯·æ±‚å°†ä½œä¸º<em>æ¨é€è¯·æ±‚</em>å¯åŠ¨ï¼Œä»¥å°†æ•°æ®å‘é€åˆ°å­˜å‚¨æä¾›å•†ã€‚åœ¨â€œæ£€ç´¢äº¤æ˜“â€çš„æƒ…å†µä¸‹ï¼Œæ•°æ®ä¼ è¾“è¯·æ±‚ä½œä¸º<em>æ‹‰å–è¯·æ±‚</em>å¯åŠ¨ï¼Œä»¥ç”±å­˜å‚¨æä¾›å•†æ£€ç´¢æ•°æ®ã€‚</p><p>å‘èµ·æ•°æ®ä¼ è¾“çš„è¯·æ±‚åŒ…æ‹¬å‡­è¯æˆ–ä»¤ç‰Œï¼ˆä¸è¦ä¸ä»˜æ¬¾æ¸ é“å‡­è¯æ··æ·†ï¼‰ï¼Œè¯¥å‡­è¯æˆ–ä»¤ç‰ŒæŒ‡å‘åŒæ–¹ä¹‹å‰å·²è¾¾æˆçš„ç‰¹å®šäº¤æ˜“ã€‚è¿™æ ·ä¸€æ¥ï¼Œå­˜å‚¨æä¾›å•†ä¾¿å¯ä»¥è¯†åˆ«è¯·æ±‚å¹¶å°†å…¶é“¾æ¥åˆ°å·²åŒæ„çš„äº¤æ˜“ï¼Œè€Œä¸ä¼šå¿½ç•¥è¯¥è¯·æ±‚ã€‚å¦‚ä¸‹æ‰€è¿°ï¼Œæ£€ç´¢äº¤æ˜“çš„æƒ…å†µå¯èƒ½ç•¥æœ‰ä¸åŒï¼Œåœ¨æ­¤æƒ…å†µä¸‹ï¼Œäº¤æ˜“æè®®å’Œæ•°æ®ä¼ è¾“è¯·æ±‚éƒ½å¯ä»¥ä¸€æ¬¡å‘é€ã€‚</p><h4 id="_2-2-3-1æ¨¡ç»„" tabindex="-1"><a class="header-anchor" href="#_2-2-3-1æ¨¡ç»„" aria-hidden="true">#</a> 2.2.3.1<a href="https://spec.filecoin.io/#section-systems.filecoin_files.data_transfer.modules" target="_blank" rel="noopener noreferrer">æ¨¡ç»„<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><p>è¯¥å›¾æ˜¾ç¤ºäº†æ•°æ®ä¼ è¾“åŠå…¶æ¨¡å—å¦‚ä½•ä¸å­˜å‚¨å’Œæ£€ç´¢å¸‚åœºç›¸åŒ¹é…ã€‚ç‰¹åˆ«è¦æ³¨æ„ï¼Œå¦‚ä½•å°†æ¥è‡ªå¸‚åœºçš„æ•°æ®ä¼ è¾“è¯·æ±‚éªŒè¯å™¨æ’å…¥â€œæ•°æ®ä¼ è¾“â€æ¨¡å—ï¼Œä½†å…¶ä»£ç å±äºå¸‚åœºç³»ç»Ÿã€‚</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gn7unqn5ipj31980pan1w.jpg" alt="image-20210201105943338"></p><h4 id="_2-2-3-2æœ¯è¯­" tabindex="-1"><a class="header-anchor" href="#_2-2-3-2æœ¯è¯­" aria-hidden="true">#</a> 2.2.3.2<a href="https://spec.filecoin.io/#section-systems.filecoin_files.data_transfer.terminology" target="_blank" rel="noopener noreferrer">æœ¯è¯­<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><ul><li><strong>æ¨é€è¯·æ±‚</strong>ï¼šå°†æ•°æ®å‘é€ç»™å¦ä¸€æ–¹çš„è¯·æ±‚-é€šå¸¸ç”±å®¢æˆ·ç«¯å‘èµ·ï¼Œä¸»è¦æ˜¯åœ¨å‘ç”Ÿå­˜å‚¨äº¤æ˜“çš„æƒ…å†µä¸‹ã€‚</li><li>æå–<strong>è¯·æ±‚</strong>ï¼šè¯·æ±‚å¯¹æ–¹å‘é€æ•°æ®çš„è¯·æ±‚-é€šå¸¸ç”±å®¢æˆ·å‘èµ·ï¼Œä¸»è¦æ˜¯åœ¨â€œæ£€ç´¢äº¤æ˜“â€çš„æƒ…å†µä¸‹ã€‚</li><li><strong>è¯·æ±‚è€…</strong>ï¼šå‘èµ·æ•°æ®ä¼ è¾“è¯·æ±‚çš„ä¸€æ–¹ï¼ˆæ— è®ºæ˜¯æ¨è¿˜æ˜¯æ‹‰ï¼‰-é€šå¸¸è‡³å°‘åœ¨Filecoinä¸­å½“å‰å®ç°çš„å®¢æˆ·ç«¯ï¼Œä»¥å…‹æœNATéå†é—®é¢˜ã€‚</li><li><strong>å“åº”è€…</strong>ï¼šæ¥æ”¶æ•°æ®ä¼ è¾“è¯·æ±‚çš„ä¸€æ–¹-é€šå¸¸æ˜¯å­˜å‚¨æä¾›è€…ã€‚</li><li><strong>æ•°æ®ä¼ è¾“å‡­è¯æˆ–ä»¤ç‰Œ</strong>ï¼šå›´ç»•å­˜å‚¨æˆ–æ£€ç´¢ç›¸å…³æ•°æ®çš„åŒ…è£…ï¼Œå¯ä»¥è¯†åˆ«å’ŒéªŒè¯å‘å¦ä¸€æ–¹çš„ä¼ è¾“è¯·æ±‚ã€‚</li><li><strong>è¯·æ±‚éªŒè¯å™¨</strong>ï¼šä»…å½“å“åº”è€…å¯ä»¥éªŒè¯è¯·æ±‚æ˜¯å¦ç›´æ¥ç»‘å®šåˆ°ç°æœ‰å­˜å‚¨æˆ–æ£€ç´¢äº¤æ˜“æ—¶ï¼Œæ•°æ®ä¼ è¾“æ¨¡å—æ‰å¯åŠ¨ä¼ è¾“ã€‚éªŒè¯ä¸ç”±æ•°æ®ä¼ è¾“æ¨¡å—æœ¬èº«æ‰§è¡Œã€‚å–è€Œä»£ä¹‹çš„æ˜¯ï¼Œè¯·æ±‚éªŒè¯å™¨æ£€æŸ¥æ•°æ®ä¼ è¾“å‡­å•ä»¥ç¡®å®šæ˜¯å¦å“åº”è¯·æ±‚æˆ–ä¸ç†ä¼šè¯·æ±‚ã€‚</li><li><strong>è¿è¾“è€…</strong>ï¼šåå•†å’Œç¡®è®¤è¯·æ±‚åï¼Œå®é™…çš„è½¬ç§»ç”±åŒæ–¹çš„è¿è¾“è€…ç®¡ç†ã€‚ä¼ è¾“å™¨æ˜¯æ•°æ®ä¼ è¾“æ¨¡å—çš„ä¸€éƒ¨åˆ†ï¼Œä½†ä¸åå•†è¿‡ç¨‹éš”ç¦»ã€‚å®ƒå¯ä»¥è®¿é—®åŸºç¡€å¯éªŒè¯çš„ä¼ è¾“åè®®ï¼Œå¹¶ä½¿ç”¨å®ƒæ¥å‘é€æ•°æ®å’Œè·Ÿè¸ªè¿›åº¦ã€‚</li><li><strong>è®¢æˆ·</strong>ï¼šä¸€ä¸ªå¤–éƒ¨ç»„ä»¶ï¼Œé€šè¿‡è®¢é˜…æ•°æ®ä¼ è¾“äº‹ä»¶ï¼ˆä¾‹å¦‚è¿›åº¦æˆ–å®Œæˆï¼‰æ¥ç›‘è§†æ•°æ®ä¼ è¾“çš„è¿›åº¦ã€‚</li><li><strong>GraphSync</strong>ï¼šä¼ è¾“ç¨‹åºä½¿ç”¨çš„é»˜è®¤åŸºç¡€ä¼ è¾“åè®®ã€‚å®Œæ•´çš„graphsyncè§„èŒƒå¯åœ¨<a href="https://github.com/ipld/specs/blob/master/block-layer/graphsync/graphsync.md" target="_blank" rel="noopener noreferrer">æ­¤å¤„<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>æ‰¾åˆ°</li></ul><h4 id="_2-2-3-3è¯·æ±‚é˜¶æ®µ" tabindex="-1"><a class="header-anchor" href="#_2-2-3-3è¯·æ±‚é˜¶æ®µ" aria-hidden="true">#</a> 2.2.3.3<a href="https://spec.filecoin.io/#section-systems.filecoin_files.data_transfer.request-phases" target="_blank" rel="noopener noreferrer">è¯·æ±‚é˜¶æ®µ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><p>ä»»ä½•æ•°æ®ä¼ è¾“éƒ½æœ‰ä¸¤ä¸ªåŸºæœ¬é˜¶æ®µï¼š</p><ol><li>åå•†ï¼šè¯·æ±‚è€…å’Œå“åº”è€…é€šè¿‡ä½¿ç”¨æ•°æ®ä¼ è¾“å‡­è¯éªŒè¯ä¼ è¾“æ¥åŒæ„ä¼ è¾“ã€‚</li><li>ä¼ è¾“ï¼šåå•†é˜¶æ®µå®Œæˆåï¼Œå®é™…ä¸Šå°±ä¼ è¾“äº†æ•°æ®ã€‚ç”¨äºè¿›è¡Œä¼ è¾“çš„é»˜è®¤åè®®æ˜¯Graphsyncã€‚</li></ol><p>è¯·æ³¨æ„ï¼Œâ€œåå•†â€å’Œâ€œè½¬ç§»â€é˜¶æ®µå¯ä»¥å‘ç”Ÿåœ¨å•ç‹¬çš„å¾€è¿”è¡Œç¨‹ä¸­ï¼Œä¹Ÿå¯èƒ½åœ¨ç›¸åŒçš„å¾€è¿”è¡Œç¨‹ä¸­å‘ç”Ÿï¼Œå…¶ä¸­è¯·æ±‚æ–¹é€šè¿‡å‘é€è¯·æ±‚éšå¼åœ°åŒæ„ï¼Œè€Œå“åº”æ–¹å¯ä»¥åŒæ„å¹¶ç«‹å³å‘é€æˆ–æ¥æ”¶æ•°æ®ã€‚è¯¥è¿‡ç¨‹æ˜¯åœ¨ä¸€æ¬¡è¿˜æ˜¯å¤šæ¬¡å¾€è¿”ä¸­è¿›è¡Œï¼Œéƒ¨åˆ†å–å†³äºè¯·æ±‚æ˜¯æ¨å¼è¯·æ±‚ï¼ˆå­˜å‚¨äº¤æ˜“ï¼‰è¿˜æ˜¯æ‹‰å–è¯·æ±‚ï¼ˆæ£€ç´¢äº¤æ˜“ï¼‰ï¼Œä»¥åŠæ•°æ®ä¼ è¾“åå•†è¿‡ç¨‹æ˜¯å¦èƒ½å¤Ÿæ‰§è¡Œå›åˆ°åº•å±‚çš„è¿è¾“æœºåˆ¶ä¸Šã€‚åœ¨ä½¿ç”¨GraphSyncä½œä¸ºä¼ è¾“æœºåˆ¶çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨<a href="https://github.com/ipld/specs/blob/master/block-layer/graphsync/graphsync.md#extensions" target="_blank" rel="noopener noreferrer">GraphSyncçš„å†…ç½®å¯æ‰©å±•æ€§<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>å°†æ•°æ®ä¼ è¾“è¯·æ±‚ä½œä¸ºå¯¹GraphSyncåè®® <a href="https://github.com/ipld/specs/blob/master/block-layer/graphsync/graphsync.md#extensions" target="_blank" rel="noopener noreferrer">çš„æ‰©å±•<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ã€‚å› æ­¤ï¼Œæ‹‰å–è¯·æ±‚ä»…éœ€è¦ä¸€æ¬¡å¾€è¿”ã€‚ä½†æ˜¯ï¼Œç”±äºGraphsyncæ˜¯ä¸ç›´æ¥æ”¯æŒ<code>push</code>ç±»å‹è¯·æ±‚çš„è¯·æ±‚/å“åº”åè®®ï¼Œå› æ­¤åœ¨Pushæƒ…å†µä¸‹ï¼Œåå•†æ˜¯é€šè¿‡æ•°æ®ä¼ è¾“è‡ªèº«çš„libp2påè®®åœ¨å•ç‹¬çš„è¯·æ±‚ä¸­è¿›è¡Œçš„<code>/fil/datatransfer/1.0.0</code>ã€‚å…¶ä»–æœªæ¥çš„è¿è¾“æœºåˆ¶å¯èƒ½ä¼šåŒæ—¶å¤„ç†â€œæ¨â€å’Œâ€œæ¨â€ï¼Œä¹Ÿå¯èƒ½ä¸ä¼šä¸€æ¬¡å¤„ç†ã€‚æ¥æ”¶åˆ°æ•°æ®ä¼ è¾“è¯·æ±‚åï¼Œæ•°æ®ä¼ è¾“æ¨¡å—ä¼šå¯¹å‡­è¯è¿›è¡Œè§£ç ï¼Œå¹¶å°†å…¶äº¤ä»˜ç»™è¯·æ±‚éªŒè¯å™¨ã€‚åœ¨å­˜å‚¨äº¤æ˜“ä¸­ï¼Œè¯·æ±‚éªŒè¯ç¨‹åºæ£€æŸ¥æ‰€åŒ…å«çš„äº¤æ˜“æ˜¯å¦æ˜¯æ”¶ä»¶äººä¹‹å‰å·²ç»åŒæ„çš„äº¤æ˜“ã€‚å¯¹äºæ£€ç´¢äº¤æ˜“ï¼Œè¯·æ±‚åŒ…æ‹¬æœ‰å…³æ£€ç´¢äº¤æ˜“æœ¬èº«çš„å»ºè®®ã€‚åªè¦è¯·æ±‚éªŒè¯è€…æ¥å—äº¤æ˜“å»ºè®®ï¼Œæ‰€æœ‰æ“ä½œéƒ½å°†ä½œä¸ºä¸€æ¬¡å¾€è¿”ç«‹å³å®Œæˆã€‚</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨å–å›çš„æƒ…å†µä¸‹ï¼Œæä¾›è€…å¯ä»¥æ¥å—äº¤æ˜“å’Œæ•°æ®ä¼ è¾“è¯·æ±‚ï¼Œä½†æ˜¯å¯ä»¥æš‚åœå–å›æœ¬èº«ä»¥æ‰§è¡Œå¯å°è¿‡ç¨‹ã€‚åœ¨å¼€å§‹å®é™…çš„æ•°æ®ä¼ è¾“ä¹‹å‰ï¼Œå­˜å‚¨æä¾›å•†å¿…é¡»è§£å°æ‰€æœ‰è¯·æ±‚çš„æ•°æ®ã€‚æ­¤å¤–ï¼Œå­˜å‚¨æä¾›å•†å¯ä»¥é€‰æ‹©åœ¨å¼€å§‹å¼€å°è¿‡ç¨‹ä¹‹å‰æš‚åœæ£€ç´¢æµç¨‹ï¼Œä»¥è¯·æ±‚å¼€å°ä»˜æ¬¾è¯·æ±‚ã€‚å­˜å‚¨ä¾›åº”å•†å¯ä»¥é€‰æ‹©è¦æ±‚æ”¯ä»˜è¿™ç¬”æ¬¾é¡¹ï¼Œä»¥æ”¯ä»˜ä¸å¯æ€è®®çš„è®¡ç®—æˆæœ¬ï¼Œå¹¶é¿å…æˆä¸ºè¡Œä¸ºä¸ç«¯çš„å®¢æˆ·çš„å—å®³è€…ã€‚</p><h4 id="_2-2-3-4-æµç¨‹ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#_2-2-3-4-æµç¨‹ç¤ºä¾‹" aria-hidden="true">#</a> 2.2.3.4 æµç¨‹ç¤ºä¾‹</h4><h5 id="_2-2-3-4-1-æ¨æµ" tabindex="-1"><a class="header-anchor" href="#_2-2-3-4-1-æ¨æµ" aria-hidden="true">#</a> 2.2.3.4.1 æ¨æµ</h5><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gn7urnqsigj31cs0owjuk.jpg" alt="image-20210201110343745"></p><ol><li>å½“è¯·æ±‚è€…æƒ³è¦å°†æ•°æ®å‘é€ç»™å¦ä¸€æ–¹æ—¶ï¼Œå®ƒä¼šå‘èµ·â€œæ¨â€ä¼ è¾“ã€‚</li><li>è¯·æ±‚è€…çš„æ•°æ®ä¼ è¾“æ¨¡å—å°†æŠŠæ¨é€è¯·æ±‚ä¸æ•°æ®ä¼ è¾“å‡­è¯ä¸€èµ·å‘é€ç»™å“åº”è€…ã€‚</li><li>å“åº”è€…çš„æ•°æ®ä¼ è¾“æ¨¡å—é€šè¿‡éªŒè¯å™¨éªŒè¯æ•°æ®ä¼ è¾“è¯·æ±‚ï¼Œè¯¥éªŒè¯å™¨æ˜¯å“åº”è€…æä¾›çš„ä¾èµ–é¡¹ã€‚</li><li>å“åº”è€…çš„æ•°æ®ä¼ è¾“æ¨¡å—é€šè¿‡å‘å‡ºGraphSyncè¯·æ±‚æ¥å¯åŠ¨ä¼ è¾“ã€‚</li><li>è¯·æ±‚è€…æ¥æ”¶GraphSyncè¯·æ±‚ï¼ŒéªŒè¯å®ƒæ˜¯å¦è¯†åˆ«å‡ºæ•°æ®ä¼ è¾“å¹¶å¼€å§‹å‘é€æ•°æ®ã€‚</li><li>å“åº”è€…æ¥æ”¶æ•°æ®å¹¶å¯ä»¥äº§ç”Ÿè¿›åº¦æŒ‡ç¤ºã€‚</li><li>å“åº”è€…å®Œæˆæ¥æ”¶æ•°æ®ï¼Œå¹¶é€šçŸ¥æ‰€æœ‰ä¾¦å¬å™¨ã€‚</li></ol><p>æ¨é€æµç¨‹éå¸¸é€‚åˆå­˜å‚¨äº¤æ˜“ï¼Œåœ¨å­˜å‚¨äº¤æ˜“ä¸­ï¼Œä¸€æ—¦æä¾›è€…è¡¨æ˜ä»–ä»¬æ‰“ç®—æ¥å—å¹¶å‘å¸ƒå®¢æˆ·çš„äº¤æ˜“å»ºè®®ï¼Œå®¢æˆ·ä¾¿ä¼šç«‹å³å¯åŠ¨æ•°æ®ä¼ è¾“ã€‚</p><h4 id="_2-2-3-5-æ‹‰æµ-å•ç¨‹å¾€è¿”" tabindex="-1"><a class="header-anchor" href="#_2-2-3-5-æ‹‰æµ-å•ç¨‹å¾€è¿”" aria-hidden="true">#</a> 2.2.3.5 æ‹‰æµ-å•ç¨‹å¾€è¿”</h4><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gn7usyj977j31a40pmtbe.jpg" alt="image-20210201110446569"></p><h4 id="_2-2-3-6åè®®" tabindex="-1"><a class="header-anchor" href="#_2-2-3-6åè®®" aria-hidden="true">#</a> 2.2.3.6<a href="https://spec.filecoin.io/#section-systems.filecoin_files.data_transfer.protocol" target="_blank" rel="noopener noreferrer">åè®®<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><p>å¯ä»¥é€šè¿‡æ•°æ®ä¼ è¾“åè®®ï¼ˆlibp2påè®®ç±»å‹ï¼‰åœ¨ç½‘ç»œä¸Šåå•†æ•°æ®ä¼ è¾“ã€‚</p><p>ä½¿ç”¨æ•°æ®ä¼ è¾“åè®®ä½œä¸ºç‹¬ç«‹çš„libp2pé€šè®¯æœºåˆ¶å¹¶ä¸æ˜¯ç¡¬æ€§è¦æ±‚-åªè¦åŒæ–¹éƒ½å®ç°äº†å¯ä»¥ä¸å¯¹æ–¹é€šä¿¡çš„æ•°æ®ä¼ è¾“å­ç³»ç»Ÿï¼Œä»»ä½•ä¼ è¾“æœºåˆ¶ï¼ˆåŒ…æ‹¬ç¦»çº¿æœºåˆ¶ï¼‰éƒ½æ˜¯å¯ä»¥æ¥å—çš„ã€‚</p><h4 id="_2-2-3-7æ•°æ®ç»“æ„" tabindex="-1"><a class="header-anchor" href="#_2-2-3-7æ•°æ®ç»“æ„" aria-hidden="true">#</a> 2.2.3.7<a href="https://spec.filecoin.io/#section-systems.filecoin_files.data_transfer.data-structures" target="_blank" rel="noopener noreferrer">æ•°æ®ç»“æ„<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><p><a href="https://spec.filecoin.io/#example-data-transfer-types" target="_blank" rel="noopener noreferrer">ç¤ºä¾‹ï¼šæ•°æ®ä¼ è¾“ç±»å‹<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">package</span> datatransfer

<span class="token keyword">import</span> <span class="token punctuation">(</span>
 <span class="token string">&quot;fmt&quot;</span>

 <span class="token string">&quot;github.com/ipfs/go-cid&quot;</span>
 <span class="token string">&quot;github.com/ipld/go-ipld-prime&quot;</span>
 <span class="token string">&quot;github.com/libp2p/go-libp2p-core/peer&quot;</span>

 <span class="token string">&quot;github.com/filecoin-project/go-data-transfer/encoding&quot;</span>
<span class="token punctuation">)</span>

<span class="token comment">//go:generate cbor-gen-for ChannelID</span>

<span class="token comment">// TypeIdentifier is a unique string identifier for a type of encodable object in a</span>
<span class="token comment">// registry</span>
<span class="token keyword">type</span> TypeIdentifier <span class="token builtin">string</span>

<span class="token comment">// EmptyTypeIdentifier means there is no voucher present</span>
<span class="token keyword">const</span> EmptyTypeIdentifier <span class="token operator">=</span> <span class="token function">TypeIdentifier</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span>

<span class="token comment">// Registerable is a type of object in a registry. It must be encodable and must</span>
<span class="token comment">// have a single method that uniquely identifies its type</span>
<span class="token keyword">type</span> Registerable <span class="token keyword">interface</span> <span class="token punctuation">{</span>
 encoding<span class="token punctuation">.</span>Encodable
 <span class="token comment">// Type is a unique string identifier for this voucher type</span>
 <span class="token function">Type</span><span class="token punctuation">(</span><span class="token punctuation">)</span> TypeIdentifier
<span class="token punctuation">}</span>

<span class="token comment">// Voucher is used to validate</span>
<span class="token comment">// a data transfer request against the underlying storage or retrieval deal</span>
<span class="token comment">// that precipitated it. The only requirement is a voucher can read and write</span>
<span class="token comment">// from bytes, and has a string identifier type</span>
<span class="token keyword">type</span> Voucher Registerable

<span class="token comment">// VoucherResult is used to provide option additional information about a</span>
<span class="token comment">// voucher being rejected or accepted</span>
<span class="token keyword">type</span> VoucherResult Registerable

<span class="token comment">// TransferID is an identifier for a data transfer, shared between</span>
<span class="token comment">// request/responder and unique to the requester</span>
<span class="token keyword">type</span> TransferID <span class="token builtin">uint64</span>

<span class="token comment">// ChannelID is a unique identifier for a channel, distinct by both the other</span>
<span class="token comment">// party&#39;s peer ID + the transfer ID</span>
<span class="token keyword">type</span> ChannelID <span class="token keyword">struct</span> <span class="token punctuation">{</span>
 Initiator peer<span class="token punctuation">.</span>ID
 Responder peer<span class="token punctuation">.</span>ID
 ID        TransferID
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>c ChannelID<span class="token punctuation">)</span> <span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
 <span class="token keyword">return</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;%s-%s-%d&quot;</span><span class="token punctuation">,</span> c<span class="token punctuation">.</span>Initiator<span class="token punctuation">,</span> c<span class="token punctuation">.</span>Responder<span class="token punctuation">,</span> c<span class="token punctuation">.</span>ID<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// OtherParty returns the peer on the other side of the request, depending</span>
<span class="token comment">// on whether this peer is the initiator or responder</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>c ChannelID<span class="token punctuation">)</span> <span class="token function">OtherParty</span><span class="token punctuation">(</span>thisPeer peer<span class="token punctuation">.</span>ID<span class="token punctuation">)</span> peer<span class="token punctuation">.</span>ID <span class="token punctuation">{</span>
 <span class="token keyword">if</span> thisPeer <span class="token operator">==</span> c<span class="token punctuation">.</span>Initiator <span class="token punctuation">{</span>
  <span class="token keyword">return</span> c<span class="token punctuation">.</span>Responder
 <span class="token punctuation">}</span>
 <span class="token keyword">return</span> c<span class="token punctuation">.</span>Initiator
<span class="token punctuation">}</span>

<span class="token comment">// Channel represents all the parameters for a single data transfer</span>
<span class="token keyword">type</span> Channel <span class="token keyword">interface</span> <span class="token punctuation">{</span>
 <span class="token comment">// TransferID returns the transfer id for this channel</span>
 <span class="token function">TransferID</span><span class="token punctuation">(</span><span class="token punctuation">)</span> TransferID

 <span class="token comment">// BaseCID returns the CID that is at the root of this data transfer</span>
 <span class="token function">BaseCID</span><span class="token punctuation">(</span><span class="token punctuation">)</span> cid<span class="token punctuation">.</span>Cid

 <span class="token comment">// Selector returns the IPLD selector for this data transfer (represented as</span>
 <span class="token comment">// an IPLD node)</span>
 <span class="token function">Selector</span><span class="token punctuation">(</span><span class="token punctuation">)</span> ipld<span class="token punctuation">.</span>Node

 <span class="token comment">// Voucher returns the voucher for this data transfer</span>
 <span class="token function">Voucher</span><span class="token punctuation">(</span><span class="token punctuation">)</span> Voucher

 <span class="token comment">// Sender returns the peer id for the node that is sending data</span>
 <span class="token function">Sender</span><span class="token punctuation">(</span><span class="token punctuation">)</span> peer<span class="token punctuation">.</span>ID

 <span class="token comment">// Recipient returns the peer id for the node that is receiving data</span>
 <span class="token function">Recipient</span><span class="token punctuation">(</span><span class="token punctuation">)</span> peer<span class="token punctuation">.</span>ID

 <span class="token comment">// TotalSize returns the total size for the data being transferred</span>
 <span class="token function">TotalSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">uint64</span>

 <span class="token comment">// IsPull returns whether this is a pull request</span>
 <span class="token function">IsPull</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">bool</span>

 <span class="token comment">// ChannelID returns the ChannelID for this request</span>
 <span class="token function">ChannelID</span><span class="token punctuation">(</span><span class="token punctuation">)</span> ChannelID

 <span class="token comment">// OtherPeer returns the counter party peer for this channel</span>
 <span class="token function">OtherPeer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> peer<span class="token punctuation">.</span>ID
<span class="token punctuation">}</span>

<span class="token comment">// ChannelState is channel parameters plus it&#39;s current state</span>
<span class="token keyword">type</span> ChannelState <span class="token keyword">interface</span> <span class="token punctuation">{</span>
 Channel

 <span class="token comment">// SelfPeer returns the peer this channel belongs to</span>
 <span class="token function">SelfPeer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> peer<span class="token punctuation">.</span>ID

 <span class="token comment">// Status is the current status of this channel</span>
 <span class="token function">Status</span><span class="token punctuation">(</span><span class="token punctuation">)</span> Status

 <span class="token comment">// Sent returns the number of bytes sent</span>
 <span class="token function">Sent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">uint64</span>

 <span class="token comment">// Received returns the number of bytes received</span>
 <span class="token function">Received</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">uint64</span>

 <span class="token comment">// Message offers additional information about the current status</span>
 <span class="token function">Message</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span>

 <span class="token comment">// Vouchers returns all vouchers sent on this channel</span>
 <span class="token function">Vouchers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>Voucher

 <span class="token comment">// VoucherResults are results of vouchers sent on the channel</span>
 <span class="token function">VoucherResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>VoucherResult

 <span class="token comment">// LastVoucher returns the last voucher sent on the channel</span>
 <span class="token function">LastVoucher</span><span class="token punctuation">(</span><span class="token punctuation">)</span> Voucher

 <span class="token comment">// LastVoucherResult returns the last voucher result sent on the channel</span>
 <span class="token function">LastVoucherResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span> VoucherResult

 <span class="token comment">// ReceivedCids returns the cids received so far on the channel</span>
 <span class="token function">ReceivedCids</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>cid<span class="token punctuation">.</span>Cid

 <span class="token comment">// Queued returns the number of bytes read from the node and queued for sending</span>
 <span class="token function">Queued</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">uint64</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a href="https://spec.filecoin.io/#example-data-transfer-statuses" target="_blank" rel="noopener noreferrer">ç¤ºä¾‹ï¼šæ•°æ®ä¼ è¾“çŠ¶æ€<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">package</span> datatransfer

<span class="token comment">// Status is the status of transfer for a given channel</span>
<span class="token keyword">type</span> Status <span class="token builtin">uint64</span>

<span class="token keyword">const</span> <span class="token punctuation">(</span>
 <span class="token comment">// Requested means a data transfer was requested by has not yet been approved</span>
 Requested Status <span class="token operator">=</span> <span class="token boolean">iota</span>

 <span class="token comment">// Ongoing means the data transfer is in progress</span>
 Ongoing

 <span class="token comment">// TransferFinished indicates the initiator is done sending/receiving</span>
 <span class="token comment">// data but is awaiting confirmation from the responder</span>
 TransferFinished

 <span class="token comment">// ResponderCompleted indicates the initiator received a message from the</span>
 <span class="token comment">// responder that it&#39;s completed</span>
 ResponderCompleted

 <span class="token comment">// Finalizing means the responder is awaiting a final message from the initator to</span>
 <span class="token comment">// consider the transfer done</span>
 Finalizing

 <span class="token comment">// Completing just means we have some final cleanup for a completed request</span>
 Completing

 <span class="token comment">// Completed means the data transfer is completed successfully</span>
 Completed

 <span class="token comment">// Failing just means we have some final cleanup for a failed request</span>
 Failing

 <span class="token comment">// Failed means the data transfer failed</span>
 Failed

 <span class="token comment">// Cancelling just means we have some final cleanup for a cancelled request</span>
 Cancelling

 <span class="token comment">// Cancelled means the data transfer ended prematurely</span>
 Cancelled

 <span class="token comment">// InitiatorPaused means the data sender has paused the channel (only the sender can unpause this)</span>
 InitiatorPaused

 <span class="token comment">// ResponderPaused means the data receiver has paused the channel (only the receiver can unpause this)</span>
 ResponderPaused

 <span class="token comment">// BothPaused means both sender and receiver have paused the channel seperately (both must unpause)</span>
 BothPaused

 <span class="token comment">// ResponderFinalizing is a unique state where the responder is awaiting a final voucher</span>
 ResponderFinalizing

 <span class="token comment">// ResponderFinalizingTransferFinished is a unique state where the responder is awaiting a final voucher</span>
 <span class="token comment">// and we have received all data</span>
 ResponderFinalizingTransferFinished

 <span class="token comment">// ChannelNotFoundError means the searched for data transfer does not exist</span>
 ChannelNotFoundError
<span class="token punctuation">)</span>

<span class="token comment">// Statuses are human readable names for data transfer states</span>
<span class="token keyword">var</span> Statuses <span class="token operator">=</span> <span class="token keyword">map</span><span class="token punctuation">[</span>Status<span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span>
 <span class="token comment">// Requested means a data transfer was requested by has not yet been approved</span>
 Requested<span class="token punctuation">:</span>                           <span class="token string">&quot;Requested&quot;</span><span class="token punctuation">,</span>
 Ongoing<span class="token punctuation">:</span>                             <span class="token string">&quot;Ongoing&quot;</span><span class="token punctuation">,</span>
 TransferFinished<span class="token punctuation">:</span>                    <span class="token string">&quot;TransferFinished&quot;</span><span class="token punctuation">,</span>
 ResponderCompleted<span class="token punctuation">:</span>                  <span class="token string">&quot;ResponderCompleted&quot;</span><span class="token punctuation">,</span>
 Finalizing<span class="token punctuation">:</span>                          <span class="token string">&quot;Finalizing&quot;</span><span class="token punctuation">,</span>
 Completing<span class="token punctuation">:</span>                          <span class="token string">&quot;Completing&quot;</span><span class="token punctuation">,</span>
 Completed<span class="token punctuation">:</span>                           <span class="token string">&quot;Completed&quot;</span><span class="token punctuation">,</span>
 Failing<span class="token punctuation">:</span>                             <span class="token string">&quot;Failing&quot;</span><span class="token punctuation">,</span>
 Failed<span class="token punctuation">:</span>                              <span class="token string">&quot;Failed&quot;</span><span class="token punctuation">,</span>
 Cancelling<span class="token punctuation">:</span>                          <span class="token string">&quot;Cancelling&quot;</span><span class="token punctuation">,</span>
 Cancelled<span class="token punctuation">:</span>                           <span class="token string">&quot;Cancelled&quot;</span><span class="token punctuation">,</span>
 InitiatorPaused<span class="token punctuation">:</span>                     <span class="token string">&quot;InitiatorPaused&quot;</span><span class="token punctuation">,</span>
 ResponderPaused<span class="token punctuation">:</span>                     <span class="token string">&quot;ResponderPaused&quot;</span><span class="token punctuation">,</span>
 BothPaused<span class="token punctuation">:</span>                          <span class="token string">&quot;BothPaused&quot;</span><span class="token punctuation">,</span>
 ResponderFinalizing<span class="token punctuation">:</span>                 <span class="token string">&quot;ResponderFinalizing&quot;</span><span class="token punctuation">,</span>
 ResponderFinalizingTransferFinished<span class="token punctuation">:</span> <span class="token string">&quot;ResponderFinalizingTransferFinished&quot;</span><span class="token punctuation">,</span>
 ChannelNotFoundError<span class="token punctuation">:</span>                <span class="token string">&quot;ChannelNotFoundError&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a href="https://spec.filecoin.io/#example-data-transfer-manager" target="_blank" rel="noopener noreferrer">ç¤ºä¾‹ï¼šæ•°æ®ä¼ è¾“ç®¡ç†å™¨<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>ç®¡ç†å™¨æ˜¯æ•°æ®ä¼ è¾“å­ç³»ç»Ÿçš„æ‰€æœ‰å®ç°æ‰€å‘ˆç°çš„æ ¸å¿ƒæ¥å£</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> Manager <span class="token keyword">interface</span> <span class="token punctuation">{</span>

 <span class="token comment">// Start initializes data transfer processing</span>
 <span class="token function">Start</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token builtin">error</span>

 <span class="token comment">// OnReady registers a listener for when the data transfer comes on line</span>
 <span class="token function">OnReady</span><span class="token punctuation">(</span>ReadyFunc<span class="token punctuation">)</span>

 <span class="token comment">// Stop terminates all data transfers and ends processing</span>
 <span class="token function">Stop</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token builtin">error</span>

 <span class="token comment">// RegisterVoucherType registers a validator for the given voucher type</span>
 <span class="token comment">// will error if voucher type does not implement voucher</span>
 <span class="token comment">// or if there is a voucher type registered with an identical identifier</span>
 <span class="token function">RegisterVoucherType</span><span class="token punctuation">(</span>voucherType Voucher<span class="token punctuation">,</span> validator RequestValidator<span class="token punctuation">)</span> <span class="token builtin">error</span>

 <span class="token comment">// RegisterRevalidator registers a revalidator for the given voucher type</span>
 <span class="token comment">// Note: this is the voucher type used to revalidate. It can share a name</span>
 <span class="token comment">// with the initial validator type and CAN be the same type, or a different type.</span>
 <span class="token comment">// The revalidator can simply be the sampe as the original request validator,</span>
 <span class="token comment">// or a different validator that satisfies the revalidator interface.</span>
 <span class="token function">RegisterRevalidator</span><span class="token punctuation">(</span>voucherType Voucher<span class="token punctuation">,</span> revalidator Revalidator<span class="token punctuation">)</span> <span class="token builtin">error</span>

 <span class="token comment">// RegisterVoucherResultType allows deserialization of a voucher result,</span>
 <span class="token comment">// so that a listener can read the metadata</span>
 <span class="token function">RegisterVoucherResultType</span><span class="token punctuation">(</span>resultType VoucherResult<span class="token punctuation">)</span> <span class="token builtin">error</span>

 <span class="token comment">// RegisterTransportConfigurer registers the given transport configurer to be run on requests with the given voucher</span>
 <span class="token comment">// type</span>
 <span class="token function">RegisterTransportConfigurer</span><span class="token punctuation">(</span>voucherType Voucher<span class="token punctuation">,</span> configurer TransportConfigurer<span class="token punctuation">)</span> <span class="token builtin">error</span>

 <span class="token comment">// open a data transfer that will send data to the recipient peer and</span>
 <span class="token comment">// transfer parts of the piece that match the selector</span>
 <span class="token function">OpenPushDataChannel</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> to peer<span class="token punctuation">.</span>ID<span class="token punctuation">,</span> voucher Voucher<span class="token punctuation">,</span> baseCid cid<span class="token punctuation">.</span>Cid<span class="token punctuation">,</span> selector ipld<span class="token punctuation">.</span>Node<span class="token punctuation">)</span> <span class="token punctuation">(</span>ChannelID<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>

 <span class="token comment">// open a data transfer that will request data from the sending peer and</span>
 <span class="token comment">// transfer parts of the piece that match the selector</span>
 <span class="token function">OpenPullDataChannel</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> to peer<span class="token punctuation">.</span>ID<span class="token punctuation">,</span> voucher Voucher<span class="token punctuation">,</span> baseCid cid<span class="token punctuation">.</span>Cid<span class="token punctuation">,</span> selector ipld<span class="token punctuation">.</span>Node<span class="token punctuation">)</span> <span class="token punctuation">(</span>ChannelID<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>

 <span class="token comment">// send an intermediate voucher as needed when the receiver sends a request for revalidation</span>
 <span class="token function">SendVoucher</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> chid ChannelID<span class="token punctuation">,</span> voucher Voucher<span class="token punctuation">)</span> <span class="token builtin">error</span>

 <span class="token comment">// close an open channel (effectively a cancel)</span>
 <span class="token function">CloseDataTransferChannel</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> chid ChannelID<span class="token punctuation">)</span> <span class="token builtin">error</span>

 <span class="token comment">// pause a data transfer channel (only allowed if transport supports it)</span>
 <span class="token function">PauseDataTransferChannel</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> chid ChannelID<span class="token punctuation">)</span> <span class="token builtin">error</span>

 <span class="token comment">// resume a data transfer channel (only allowed if transport supports it)</span>
 <span class="token function">ResumeDataTransferChannel</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> chid ChannelID<span class="token punctuation">)</span> <span class="token builtin">error</span>

 <span class="token comment">// get status of a transfer</span>
 <span class="token function">TransferChannelStatus</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> x ChannelID<span class="token punctuation">)</span> Status

 <span class="token comment">// get notified when certain types of events happen</span>
 <span class="token function">SubscribeToEvents</span><span class="token punctuation">(</span>subscriber Subscriber<span class="token punctuation">)</span> Unsubscribe

 <span class="token comment">// get all in progress transfers</span>
 <span class="token function">InProgressChannels</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span>ChannelID<span class="token punctuation">]</span>ChannelState<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>

 <span class="token comment">// RestartDataTransferChannel restarts an existing data transfer channel</span>
 <span class="token function">RestartDataTransferChannel</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> chid ChannelID<span class="token punctuation">)</span> <span class="token builtin">error</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-2-4æ•°æ®æ ¼å¼å’Œåºåˆ—åŒ–" tabindex="-1"><a class="header-anchor" href="#_2-2-4æ•°æ®æ ¼å¼å’Œåºåˆ—åŒ–" aria-hidden="true">#</a> 2.2.4<a href="https://spec.filecoin.io/#section-systems.filecoin_files.serialization" target="_blank" rel="noopener noreferrer">æ•°æ®æ ¼å¼å’Œåºåˆ—åŒ–<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h3><p>Filecoinè¯•å›¾åˆ©ç”¨æ‰€éœ€çš„æ•°æ®æ ¼å¼æ›´å°‘ï¼Œå¹¶é‡‡ç”¨è§„èŒƒåŒ–çš„åºåˆ—åŒ–è§„åˆ™ï¼Œä»¥é€šè¿‡ç®€å•æ€§æé«˜åè®®å®‰å…¨æ€§ï¼Œå¹¶å®ç°Filecoinåè®®å®ç°ä¹‹é—´çš„äº’æ“ä½œæ€§ã€‚</p><p>åœ¨<a href="https://github.com/filecoin-project/specs/issues/621" target="_blank" rel="noopener noreferrer">æ­¤å¤„äº†è§£æœ‰å…³CBORä½¿ç”¨æƒ…å†µ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>å’Œ <a href="https://github.com/filecoin-project/specs/issues/621" target="_blank" rel="noopener noreferrer">Filecoinä¸­çš„<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><a href="https://github.com/filecoin-project/specs/issues/615" target="_blank" rel="noopener noreferrer">intç±»å‹çš„<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>æ›´å¤šè®¾è®¡æ³¨æ„ <a href="https://github.com/filecoin-project/specs/issues/615" target="_blank" rel="noopener noreferrer">äº‹é¡¹<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ã€‚</p><h4 id="_2-2-4-1èµ„æ–™æ ¼å¼" tabindex="-1"><a class="header-anchor" href="#_2-2-4-1èµ„æ–™æ ¼å¼" aria-hidden="true">#</a> 2.2.4.1<a href="https://spec.filecoin.io/#section-systems.filecoin_files.serialization.data-formats" target="_blank" rel="noopener noreferrer">èµ„æ–™æ ¼å¼<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><p>Filecoinå†…å­˜ä¸­çš„æ•°æ®ç±»å‹é€šå¸¸å¾ˆç®€å•ã€‚å®ç°åº”æ”¯æŒä¸¤ç§æ•´æ•°ç±»å‹ï¼šIntï¼ˆè¡¨ç¤ºæœ¬æœº64ä½æ•´æ•°ï¼‰å’ŒBigIntï¼ˆè¡¨ç¤ºä»»æ„é•¿åº¦ï¼‰ï¼Œå¹¶é¿å…å¤„ç†æµ®ç‚¹æ•°ä»¥æœ€å¤§ç¨‹åº¦åœ°å‡å°‘è·¨ç¼–ç¨‹è¯­è¨€å’Œå®ç°çš„äº’æ“ä½œæ€§é—®é¢˜ã€‚</p><p>æ‚¨è¿˜å¯ä»¥åœ¨Filecoinåè®®ä¸­é˜…è¯»æœ‰å…³<a href="https://spec.filecoin.io/#section-algorithms.crypto.randomness" target="_blank" rel="noopener noreferrer">æ•°æ®æ ¼å¼çš„<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>æ›´å¤š <a href="https://spec.filecoin.io/#section-algorithms.crypto.randomness" target="_blank" rel="noopener noreferrer">ä¿¡æ¯ï¼Œä½œä¸ºéšæœºæ€§ç”Ÿæˆ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>çš„ä¸€éƒ¨åˆ†ã€‚</p><h4 id="_2-2-4-2åºåˆ—åŒ–" tabindex="-1"><a class="header-anchor" href="#_2-2-4-2åºåˆ—åŒ–" aria-hidden="true">#</a> 2.2.4.2<a href="https://spec.filecoin.io/#section-systems.filecoin_files.serialization.serialization" target="_blank" rel="noopener noreferrer">åºåˆ—åŒ–<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><p><code>Serialization</code>Filecoinä¸­çš„æ•°æ®å¯ç¡®ä¿ç”¨äºåºåˆ—åŒ–å†…å­˜ä¸­æ•°æ®çš„ä¸€è‡´æ ¼å¼ï¼Œä»¥è¿›è¡Œä¼ è¾“å’Œå­˜å‚¨ä¸­ä¼ è¾“ã€‚åºåˆ—åŒ–å¯¹äºFilecoinåè®®å®ç°ä¹‹é—´çš„åè®®å®‰å…¨æ€§å’Œäº’æ“ä½œæ€§è‡³å…³é‡è¦ï¼Œä»è€Œå¯ä»¥è·¨FilecoinèŠ‚ç‚¹è¿›è¡Œä¸€è‡´çš„çŠ¶æ€æ›´æ–°ã€‚</p><p>Filecoinä¸­çš„æ‰€æœ‰æ•°æ®ç»“æ„éƒ½æ˜¯ <a href="https://tools.ietf.org/html/rfc7049" target="_blank" rel="noopener noreferrer">CBOR<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>å…ƒç»„ç¼–ç çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨Filecoinç³»ç»Ÿä¸­ä½¿ç”¨çš„ä»»ä½•æ•°æ®ç»“æ„ï¼ˆæœ¬è§„èŒƒä¸­çš„ç»“æ„ï¼‰éƒ½åº”æŒ‰å£°æ˜é¡ºåºåºåˆ—åŒ–ä¸ºCBORæ•°ç»„ï¼Œå¹¶å¸¦æœ‰ä¸æ•°æ®ç»“æ„å­—æ®µç›¸å¯¹åº”çš„é¡¹ã€‚</p><p>ä½ å¯ä»¥æ‰¾åˆ°åœ¨CBORä¸»è¦æ•°æ®ç±»å‹çš„ç¼–ç ç»“æ„ <a href="https://tools.ietf.org/html/rfc7049#section-2.1" target="_blank" rel="noopener noreferrer">åœ¨è¿™é‡Œ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ã€‚</p><p>ä¸ºäº†è¯´æ˜èµ·è§ï¼Œå†…å­˜æ˜ å°„å°†ä»¥æŒ‰é¢„å®šé¡ºåºåˆ—å‡ºçš„é”®å’Œå€¼çš„CBORæ•°ç»„è¡¨ç¤ºã€‚åºåˆ—åŒ–æ ¼å¼çš„è¿‘æœŸæ›´æ–°å°†æ¶‰åŠé€‚å½“åœ°æ ‡è®°å­—æ®µï¼Œä»¥ç¡®ä¿éšç€åè®®çš„å‘å±•è€Œè¿›è¡Œé€‚å½“çš„åºåˆ—åŒ–/ååºåˆ—åŒ–ã€‚</p><h2 id="_2-3è™šæ‹Ÿæœº" tabindex="-1"><a class="header-anchor" href="#_2-3è™šæ‹Ÿæœº" aria-hidden="true">#</a> 2.3<a href="https://spec.filecoin.io/#section-systems.filecoin_vm" target="_blank" rel="noopener noreferrer">è™šæ‹Ÿæœº<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h2><p>FilecoinåŒºå—é“¾ä¸­çš„Actorç­‰åŒäºä»¥å¤ªåŠè™šæ‹Ÿæœºä¸­çš„æ™ºèƒ½åˆçº¦ã€‚</p><p>Filecoinè™šæ‹Ÿæœºï¼ˆVMï¼‰æ˜¯è´Ÿè´£æ‰§è¡Œæ‰€æœ‰å‚ä¸è€…ä»£ç çš„ç³»ç»Ÿç»„ä»¶ã€‚åœ¨Filecoin VMä¸Šæ‰§è¡Œå‚ä¸è€…ï¼ˆå³é“¾ä¸Šæ‰§è¡Œï¼‰ä¼šäº§ç”Ÿæ±½æ²¹è´¹ç”¨ã€‚</p><p>åœ¨Filecoin VMä¸Šåº”ç”¨ï¼ˆå³æ‰§è¡Œï¼‰çš„ä»»ä½•æ“ä½œéƒ½å°†ä»¥<em>çŠ¶æ€æ ‘</em>çš„å½¢å¼äº§ç”Ÿè¾“å‡ºï¼ˆå¦‚ä¸‹æ‰€è¿°ï¼‰ã€‚æœ€æ–°çš„<em>çŠ¶æ€æ ‘</em>æ˜¯FilecoinåŒºå—é“¾ä¸­å½“å‰çš„çœŸç›¸æ¥æºã€‚è¯¥<em>å›½æ ‘</em>æ˜¯ç”±CIDï¼Œå…¶å­˜å‚¨åœ¨IPLDåº—é‰´å®šã€‚</p><h3 id="_2-3-1vm-actoræ¥å£" tabindex="-1"><a class="header-anchor" href="#_2-3-1vm-actoræ¥å£" aria-hidden="true">#</a> 2.3.1<a href="https://spec.filecoin.io/#section-systems.filecoin_vm.actor" target="_blank" rel="noopener noreferrer">VM Actoræ¥å£<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h3><p>å¦‚ä¸Šæ‰€è¿°ï¼ŒActoræ˜¯ä»¥å¤ªåŠè™šæ‹Ÿæœºä¸­æ™ºèƒ½åˆçº¦çš„Filecoinç­‰æ•ˆé¡¹ã€‚å› æ­¤ï¼ŒActoræ˜¯ç³»ç»Ÿçš„æ ¸å¿ƒç»„ä»¶ã€‚FilecoinåŒºå—é“¾å½“å‰çŠ¶æ€çš„ä»»ä½•æ›´æ”¹éƒ½å¿…é¡»é€šè¿‡å‚ä¸è€…æ–¹æ³•è°ƒç”¨æ¥è§¦å‘ã€‚</p><p>æœ¬å°èŠ‚æè¿°Actorä¸Filecoinè™šæ‹Ÿæœºä¹‹é—´çš„<em>æ¥å£</em>ã€‚è¿™æ„å‘³ç€ä¸‹é¢æè¿°çš„å¤§å¤šæ•°å†…å®¹å¹¶ä¸ä¸¥æ ¼å±äºVMã€‚ç›¸åï¼Œé€»è¾‘ä½äºVMå’ŒActorsé€»è¾‘ä¹‹é—´çš„æ¥å£ä¸Šã€‚</p><p>æ€»å…±å…±æœ‰åä¸€ï¼ˆ11ï¼‰ç§ç±»å‹çš„<em>å†…ç½®</em>Actorï¼Œä½†å¹¶éæ‰€æœ‰ç±»å‹éƒ½ä¸VMäº¤äº’ã€‚ä¸€äº›Actorä¸ä¼šè°ƒç”¨å¯¹åŒºå—é“¾çš„StateTreeçš„æ›´æ”¹ï¼Œå› æ­¤ä¸éœ€è¦ä¸VMçš„æ¥å£ã€‚æˆ‘ä»¬ç¨åå°†åœ¨â€œç³»ç»Ÿå‚ä¸è€…â€å°èŠ‚ä¸­è®¨è®ºæ‰€æœ‰ç³»ç»Ÿå‚ä¸è€…çš„è¯¦ç»†ä¿¡æ¯ã€‚</p><p>è¯¥<em>æ¼”å‘˜åœ°å€</em>æ˜¯é€šè¿‡æ•£åˆ—å‘é€è€…çš„å…¬é’¥å’Œåˆ›å»ºéšæœºæ•°ç”Ÿæˆç¨³å®šçš„åœ°å€ã€‚åœ¨æ•´ä¸ªé“¾é‡ç»„ä¸­åº”è¯¥ä¿æŒç¨³å®šã€‚è¯¥<em>æ¼”å‘˜IDåœ°å€</em>ï¼Œå¦ä¸€æ–¹é¢ï¼Œæ˜¯ç´§å‡‘çš„ï¼Œä½†å¯ä»¥åœ¨é“¾é‡æ–°ç»„ç»‡çš„æƒ…å†µä¸‹æ›´æ”¹è‡ªåŠ¨é€’å¢åœ°å€ã€‚è¯è™½å¦‚æ­¤ï¼Œæ¼”å‘˜åˆ›å»ºååº”è¯¥ä½¿ç”¨<em>æ¼”å‘˜åœ°å€</em>ã€‚</p><p><a href="https://spec.filecoin.io/#example-" target="_blank" rel="noopener noreferrer">ä¾‹ï¼š<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">package</span> builtin

<span class="token keyword">import</span> <span class="token punctuation">(</span>
 addr <span class="token string">&quot;github.com/filecoin-project/go-address&quot;</span>
<span class="token punctuation">)</span>

<span class="token comment">// Addresses for singleton system actors.</span>
<span class="token keyword">var</span> <span class="token punctuation">(</span>
 <span class="token comment">// Distinguished AccountActor that is the source of system implicit messages.</span>
 SystemActorAddr           <span class="token operator">=</span> <span class="token function">mustMakeAddress</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
 InitActorAddr             <span class="token operator">=</span> <span class="token function">mustMakeAddress</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
 RewardActorAddr           <span class="token operator">=</span> <span class="token function">mustMakeAddress</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
 CronActorAddr             <span class="token operator">=</span> <span class="token function">mustMakeAddress</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
 StoragePowerActorAddr     <span class="token operator">=</span> <span class="token function">mustMakeAddress</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
 StorageMarketActorAddr    <span class="token operator">=</span> <span class="token function">mustMakeAddress</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
 VerifiedRegistryActorAddr <span class="token operator">=</span> <span class="token function">mustMakeAddress</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>
 <span class="token comment">// Distinguished AccountActor that is the destination of all burnt funds.</span>
 BurntFundsActorAddr <span class="token operator">=</span> <span class="token function">mustMakeAddress</span><span class="token punctuation">(</span><span class="token number">99</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>

<span class="token keyword">const</span> FirstNonSingletonActorId <span class="token operator">=</span> <span class="token number">100</span>

<span class="token keyword">func</span> <span class="token function">mustMakeAddress</span><span class="token punctuation">(</span>id <span class="token builtin">uint64</span><span class="token punctuation">)</span> addr<span class="token punctuation">.</span>Address <span class="token punctuation">{</span>
 address<span class="token punctuation">,</span> err <span class="token operator">:=</span> addr<span class="token punctuation">.</span><span class="token function">NewIDAddress</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
 <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  <span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
 <span class="token punctuation">}</span>
 <span class="token keyword">return</span> address
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¯¥<code>ActorState</code>ç»“æ„ç”±å‚ä¸è€…çš„ä½™é¢ï¼ˆæ ¹æ®è¯¥å‚ä¸è€…æŒæœ‰çš„ä»¤ç‰Œï¼‰ä»¥åŠä¸€ç»„ç”¨äºæŸ¥è¯¢ï¼Œæ£€æŸ¥é“¾çŠ¶æ€å¹¶ä¸ä¹‹äº¤äº’çš„çŠ¶æ€æ–¹æ³•ç»„æˆã€‚</p><h3 id="_2-3-2çŠ¶æ€æ ‘" tabindex="-1"><a class="header-anchor" href="#_2-3-2çŠ¶æ€æ ‘" aria-hidden="true">#</a> 2.3.2<a href="https://spec.filecoin.io/#section-systems.filecoin_vm.state_tree" target="_blank" rel="noopener noreferrer">çŠ¶æ€æ ‘<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h3><p>çŠ¶æ€æ ‘æ˜¯å¯¹FilecoinåŒºå—é“¾åº”ç”¨çš„ä»»ä½•æ“ä½œçš„æ‰§è¡Œè¾“å‡ºã€‚é“¾ä¸Šï¼ˆå³VMï¼‰çŠ¶æ€æ•°æ®ç»“æ„æ˜¯å°†åœ°å€ç»‘å®šåˆ°å‚ä¸è€…çŠ¶æ€çš„æ˜ å°„ï¼ˆä»¥æ•£åˆ—é˜µåˆ—æ˜ å°„Trie-HAMTçš„å½¢å¼ï¼‰ã€‚VMåœ¨æ¯æ¬¡æ‰§è¡Œactoræ–¹æ³•æ—¶éƒ½ä¼šè°ƒç”¨å½“å‰çš„State Treeå‡½æ•°ã€‚</p><p><a href="https://spec.filecoin.io/#example-statetree" target="_blank" rel="noopener noreferrer">ç¤ºä¾‹ï¼šStateTree<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>StateTreeå­˜å‚¨å‚ä¸è€…çš„IDã€‚</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> StateTree <span class="token keyword">struct</span> <span class="token punctuation">{</span>
 root        adt<span class="token punctuation">.</span>Map
 version     types<span class="token punctuation">.</span>StateTreeVersion
 info        cid<span class="token punctuation">.</span>Cid
 Store       cbor<span class="token punctuation">.</span>IpldStore
 lookupIDFun <span class="token keyword">func</span><span class="token punctuation">(</span>address<span class="token punctuation">.</span>Address<span class="token punctuation">)</span> <span class="token punctuation">(</span>address<span class="token punctuation">.</span>Address<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>

 snaps <span class="token operator">*</span>stateSnaps
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-3-3vmæ¶ˆæ¯-actoræ–¹æ³•è°ƒç”¨" tabindex="-1"><a class="header-anchor" href="#_2-3-3vmæ¶ˆæ¯-actoræ–¹æ³•è°ƒç”¨" aria-hidden="true">#</a> 2.3.3<a href="https://spec.filecoin.io/#section-systems.filecoin_vm.message" target="_blank" rel="noopener noreferrer">VMæ¶ˆæ¯-Actoræ–¹æ³•è°ƒç”¨<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h3><p>æ¶ˆæ¯æ˜¯ä¸¤ä¸ªå‚ä¸è€…ä¹‹é—´è¿›è¡Œé€šä¿¡çš„å•ä½ï¼Œå› æ­¤æ˜¯çŠ¶æ€å˜åŒ–çš„æ ¹æœ¬åŸå› ã€‚ä¸€æ¡æ¶ˆæ¯ç»“åˆäº†ï¼š</p><ul><li>ä»å‘é€æ–¹è½¬ç§»åˆ°æ¥æ”¶æ–¹çš„ä»¤ç‰Œé‡‘é¢ï¼Œä»¥åŠ</li><li>å…·æœ‰åœ¨æ¥æ”¶æ–¹ä¸Šè°ƒç”¨çš„å‚æ•°çš„æ–¹æ³•ï¼ˆå¯é€‰/åœ¨é€‚ç”¨çš„æƒ…å†µä¸‹ï¼‰ã€‚</li></ul><p>æ¼”å‘˜ä»£ç å¯ä»¥åœ¨å¤„ç†æ”¶åˆ°çš„æ¶ˆæ¯æ—¶å‘å…¶ä»–æ¼”å‘˜å‘é€å…¶ä»–æ¶ˆæ¯ã€‚æ¶ˆæ¯æ˜¯åŒæ­¥å¤„ç†çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå‚ä¸è€…åœ¨æ¢å¤æ§åˆ¶ä¹‹å‰ç­‰å¾…å‘é€çš„æ¶ˆæ¯å®Œæˆã€‚</p><p>æ¶ˆæ¯çš„å¤„ç†æ¶ˆè€—äº†è®¡ç®—å’Œå­˜å‚¨å•ä½ï¼Œä¸¤è€…å‡ä»¥gasè¡¨ç¤ºã€‚æ¶ˆæ¯çš„<em>æ°”ä½“é™åˆ¶</em>ä¸ºå¤„ç†è¯¥æ¶ˆæ¯æä¾›äº†æ‰€éœ€çš„è®¡ç®—ä¸Šé™ã€‚æ¶ˆæ¯çš„å‘ä»¶äººä»¥å…¶ç¡®å®šçš„æ±½æ²¹ä»·æ ¼æ¥æ”¯ä»˜æ¶ˆæ¯æ‰§è¡Œæ‰€æ¶ˆè€—çš„æ°”ä½“å•ä½ï¼ˆåŒ…æ‹¬æ‰€æœ‰åµŒå¥—çš„æ¶ˆæ¯ï¼‰ã€‚åŒºå—ç”Ÿäº§è€…é€‰æ‹©è¦åŒ…å«åœ¨åŒºå—ä¸­çš„æ¶ˆæ¯ï¼Œå¹¶æ ¹æ®æ¯ä¸ªæ¶ˆæ¯çš„æ±½æ²¹ä»·æ ¼å’Œæ¶ˆè€—é‡è·å¾—å¥–åŠ±ï¼Œä»è€Œå½¢æˆå¸‚åœºã€‚</p><h4 id="_2-3-3-1æ¶ˆæ¯è¯­æ³•éªŒè¯" tabindex="-1"><a class="header-anchor" href="#_2-3-3-1æ¶ˆæ¯è¯­æ³•éªŒè¯" aria-hidden="true">#</a> 2.3.3.1<a href="https://spec.filecoin.io/#section-systems.filecoin_vm.message.message-syntax-validation" target="_blank" rel="noopener noreferrer">æ¶ˆæ¯è¯­æ³•éªŒè¯<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><p>è¯­æ³•æ— æ•ˆçš„æ¶ˆæ¯ä¸å¾—ä¼ è¾“ï¼Œä¿ç•™åœ¨æ¶ˆæ¯æ± ä¸­æˆ–åŒ…å«åœ¨å—ä¸­ã€‚å¦‚æœæ”¶åˆ°æ— æ•ˆæ¶ˆæ¯ï¼Œåˆ™åº”å°†å…¶ä¸¢å¼ƒï¼Œå¹¶ä¸”ä¸è¦è¿›ä¸€æ­¥ä¼ æ’­ã€‚</p><p>å½“å•ç‹¬å‘é€æ—¶ï¼ˆåœ¨åŒ…å«åœ¨å—ä¸­ä¹‹å‰ï¼‰<code>SignedMessage</code>ï¼Œæ— è®ºä½¿ç”¨å“ªç§ç­¾åæ–¹æ¡ˆï¼Œéƒ½å°†æ¶ˆæ¯æ‰“åŒ…ä¸º ã€‚æœ‰æ•ˆçš„ç­¾åé‚®ä»¶çš„åºåˆ—åŒ–æ€»å¤§å°ä¸å¤§äº<code>message.MessageMaxSize</code>ã€‚</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> SignedMessage <span class="token keyword">struct</span> <span class="token punctuation">{</span>
 Message   Message
 Signature crypto<span class="token punctuation">.</span>Signature
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¯­æ³•ä¸Šæœ‰æ•ˆçš„<code>UnsignedMessage</code>ï¼š</p><ul><li>å…·æœ‰æ ¼å¼æ­£ç¡®çš„éç©º<code>To</code>åœ°å€ï¼Œ</li><li>å…·æœ‰æ ¼å¼æ­£ç¡®çš„éç©º<code>From</code>åœ°å€ï¼Œ</li><li>å…·æœ‰<code>Value</code>ä¸å°äºé›¶ä¸”ä¸å¤§äºä»¤ç‰Œæ€»ä¾›ç»™ï¼ˆ<code>2e9 * 1e18</code>ï¼‰ï¼Œå¹¶ä¸”</li><li>å…·æœ‰éè´Ÿæ•°<code>GasPrice</code>ï¼Œ</li><li>å…·æœ‰<code>GasLimit</code>è‡³å°‘ç­‰äºä¸æ¶ˆæ¯çš„åºåˆ—åŒ–å­—èŠ‚å…³è”çš„æ°”ä½“æ¶ˆè€—çš„å€¼ï¼Œ</li><li>å…·æœ‰<code>GasLimit</code>ä¸å¤§äºåŒºå—æ°”ä½“é™åˆ¶ç½‘ç»œå‚æ•°çš„å€¼ã€‚</li></ul><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> Message <span class="token keyword">struct</span> <span class="token punctuation">{</span>
 <span class="token comment">// Version of this message (has to be non-negative)</span>
 Version <span class="token builtin">uint64</span>

 <span class="token comment">// Address of the receiving actor.</span>
 To   address<span class="token punctuation">.</span>Address
 <span class="token comment">// Address of the sending actor.</span>
 From address<span class="token punctuation">.</span>Address

 CallSeqNum <span class="token builtin">uint64</span>

 <span class="token comment">// Value to transfer from sender&#39;s to receiver&#39;s balance.</span>
 Value BigInt

 <span class="token comment">// GasPrice is a Gas-to-FIL cost</span>
 GasPrice BigInt
 <span class="token comment">// Maximum Gas to be spent on the processing of this message</span>
 GasLimit <span class="token builtin">int64</span>

 <span class="token comment">// Optional method to invoke on receiver, zero for a plain value transfer.</span>
 Method abi<span class="token punctuation">.</span>MethodNum
 <span class="token comment">//Serialized parameters to the method.</span>
 Params <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åº”è¯¥æœ‰å‡ ä¸ªåŠŸèƒ½å¯ä»¥ä»ä¸­æå–ä¿¡æ¯<code>Message struct</code>ï¼Œä¾‹å¦‚å‘ä»¶äººå’Œæ”¶ä»¶äººåœ°å€ï¼Œè¦è½¬ç§»çš„å€¼ï¼Œæ‰§è¡Œæ¶ˆæ¯æ‰€éœ€çš„èµ„é‡‘ä»¥åŠæ¶ˆæ¯çš„CIDã€‚</p><p>å‡å®šæ¶ˆæ¯æœ€ç»ˆåº”åŒ…å«åœ¨ä¸€ä¸ªå—ä¸­å¹¶æ·»åŠ åˆ°åŒºå—é“¾ä¸­ï¼Œåˆ™åº”æ£€æŸ¥æ¶ˆæ¯çš„å‘é€è€…å’Œæ¥æ”¶è€…çš„æ¶ˆæ¯æœ‰æ•ˆæ€§ï¼Œè¯¥å€¼ï¼ˆåº”ä¸ºéè´Ÿå€¼ï¼Œå¹¶ä¸”å§‹ç»ˆå°äºå¾ªç¯ä¾›åº”ï¼‰ï¼Œå¤©ç„¶æ°”ä»·æ ¼ï¼ˆè¯¥ä»·æ ¼åˆåº”ä¸ºéè´Ÿæ•°ï¼‰ä¸”<code>BlockGasLimit</code>è¯¥ä»·æ ¼ä¸åº”å¤§äºè¯¥åŒºå—çš„å¤©ç„¶æ°”é™é¢ã€‚</p><h4 id="_2-3-3-2æ¶ˆæ¯è¯­ä¹‰éªŒè¯" tabindex="-1"><a class="header-anchor" href="#_2-3-3-2æ¶ˆæ¯è¯­ä¹‰éªŒè¯" aria-hidden="true">#</a> 2.3.3.2<a href="https://spec.filecoin.io/#section-systems.filecoin_vm.message.message-semantic-validation" target="_blank" rel="noopener noreferrer">æ¶ˆæ¯è¯­ä¹‰éªŒè¯<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><p>è¯­ä¹‰éªŒè¯æ˜¯æŒ‡éœ€è¦æ¶ˆæ¯æœ¬èº«ä¹‹å¤–çš„ä¿¡æ¯çš„éªŒè¯ã€‚</p><p>è¯­ä¹‰ä¸Šæœ‰æ•ˆçš„<code>SignedMessage</code>å¿…é¡»å¸¦æœ‰ç­¾åï¼Œè¯¥ç­¾åå¯éªŒè¯æœ‰æ•ˆè½½è·æ˜¯å¦å·²è¢«<code>From</code>åœ°å€æ ‡è¯†çš„å¸æˆ·æ‰§è¡Œè€…çš„å…¬é’¥ç­¾åã€‚è¯·æ³¨æ„ï¼Œå½“<code>From</code>åœ°å€æ˜¯IDåœ°å€æ—¶ï¼Œå¿…é¡»åœ¨å—æ‰€æ ‡è¯†çš„çˆ¶çŠ¶æ€ä¸‹çš„å‘é€å¸æˆ·å‚ä¸è€…çš„çŠ¶æ€ä¸‹æŸ¥æ‰¾å…¬é’¥ã€‚</p><p>æ³¨æ„ï¼šå‘é€æ–¹å¿…é¡»<em>ä»¥</em>åŒ…å«æ¶ˆæ¯<em>çš„å—</em>æ‰€<em>æ ‡è¯†çš„çˆ¶çº§çŠ¶æ€</em>å­˜åœ¨ã€‚è¿™æ„å‘³ç€å•ä¸ªå—åŒ…å«åˆ›å»ºæ–°å¸æˆ·actorçš„æ¶ˆæ¯å’Œæ¥è‡ªåŒä¸€actorçš„æ¶ˆæ¯æ˜¯æ— æ•ˆçš„ã€‚æ¥è‡ªè¯¥å‚ä¸è€…çš„ç¬¬ä¸€æ¡æ¶ˆæ¯å¿…é¡»ç­‰åˆ°ä¸‹ä¸€ä¸ªçºªå…ƒã€‚æ¶ˆæ¯æ± å¯èƒ½ä¼šæ’é™¤æ¥è‡ªå‚ä¸è€…çš„ï¼Œå°šæœªå¤„äºé“¾çŠ¶çŠ¶æ€çš„æ¶ˆæ¯ã€‚</p><p>æ¶ˆæ¯æ²¡æœ‰è¿›ä¸€æ­¥çš„è¯­ä¹‰éªŒè¯ï¼Œå¯èƒ½å¯¼è‡´åŒ…å«è¯¥æ¶ˆæ¯çš„å—æ— æ•ˆã€‚æ¯ä¸ªè¯­æ³•æœ‰æ•ˆä¸”æ­£ç¡®ç­¾åçš„æ¶ˆæ¯éƒ½å¯ä»¥åŒ…å«åœ¨ä¸€ä¸ªå—ä¸­ï¼Œå¹¶ä¼šä»æ‰§è¡Œä¸­äº§ç”Ÿä¸€ä¸ªæ”¶æ®ã€‚å…¶ä¸­<code>MessageReceipt sturct</code>åŒ…æ‹¬ä»¥ä¸‹å†…å®¹ï¼š</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> MessageReceipt <span class="token keyword">struct</span> <span class="token punctuation">{</span>
 ExitCode exitcode<span class="token punctuation">.</span>ExitCode
 Return   <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span>
 GasUsed  <span class="token builtin">int64</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½†æ˜¯ï¼Œæ¶ˆæ¯å¯èƒ½æ— æ³•æ‰§è¡Œåˆ°å®Œæˆï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒä¸ä¼šè§¦å‘æ‰€éœ€çš„çŠ¶æ€æ›´æ”¹ã€‚</p><p>è¿™ç§â€œæ— æ¶ˆæ¯è¯­ä¹‰éªŒè¯â€ç­–ç•¥çš„åŸå› æ˜¯ï¼Œåœ¨æ¶ˆæ¯<em>ä½œä¸ºæç¤ºé›†çš„ä¸€éƒ¨åˆ†</em>æ‰§è¡Œä¹‹å‰ï¼Œå°†ä¸çŸ¥é“æ¶ˆæ¯å°†åº”ç”¨äºçš„çŠ¶æ€ã€‚å—ç”Ÿäº§è€…ä¸çŸ¥é“åœ¨æç¤ºé›†ä¸­æ˜¯å¦æœ‰å¦ä¸€ä¸ªå—ä¼šåœ¨å®ƒä¹‹å‰ï¼Œå› æ­¤ä»å£°æ˜çš„çˆ¶çŠ¶æ€æ›´æ”¹äº†è¯¥å—æ¶ˆæ¯å°†åº”ç”¨åˆ°çš„çŠ¶æ€ã€‚</p><p><a href="https://spec.filecoin.io/#example-" target="_blank" rel="noopener noreferrer">ä¾‹ï¼š<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">package</span> types

<span class="token keyword">import</span> <span class="token punctuation">(</span>
 <span class="token string">&quot;bytes&quot;</span>
 <span class="token string">&quot;encoding/json&quot;</span>
 <span class="token string">&quot;fmt&quot;</span>

 <span class="token string">&quot;github.com/filecoin-project/go-state-types/abi&quot;</span>
 <span class="token string">&quot;github.com/filecoin-project/go-state-types/big&quot;</span>
 <span class="token string">&quot;github.com/filecoin-project/lotus/build&quot;</span>
 block <span class="token string">&quot;github.com/ipfs/go-block-format&quot;</span>
 <span class="token string">&quot;github.com/ipfs/go-cid&quot;</span>
 xerrors <span class="token string">&quot;golang.org/x/xerrors&quot;</span>

 <span class="token string">&quot;github.com/filecoin-project/go-address&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">const</span> MessageVersion <span class="token operator">=</span> <span class="token number">0</span>

<span class="token keyword">type</span> ChainMsg <span class="token keyword">interface</span> <span class="token punctuation">{</span>
 <span class="token function">Cid</span><span class="token punctuation">(</span><span class="token punctuation">)</span> cid<span class="token punctuation">.</span>Cid
 <span class="token function">VMMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span>Message
 <span class="token function">ToStorageBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>block<span class="token punctuation">.</span>Block<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
 <span class="token comment">// FIXME: This is the *message* length, this name is misleading.</span>
 <span class="token function">ChainLength</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">int</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> Message <span class="token keyword">struct</span> <span class="token punctuation">{</span>
 Version <span class="token builtin">uint64</span>

 To   address<span class="token punctuation">.</span>Address
 From address<span class="token punctuation">.</span>Address

 Nonce <span class="token builtin">uint64</span>

 Value abi<span class="token punctuation">.</span>TokenAmount

 GasLimit   <span class="token builtin">int64</span>
 GasFeeCap  abi<span class="token punctuation">.</span>TokenAmount
 GasPremium abi<span class="token punctuation">.</span>TokenAmount

 Method abi<span class="token punctuation">.</span>MethodNum
 Params <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>m <span class="token operator">*</span>Message<span class="token punctuation">)</span> <span class="token function">Caller</span><span class="token punctuation">(</span><span class="token punctuation">)</span> address<span class="token punctuation">.</span>Address <span class="token punctuation">{</span>
 <span class="token keyword">return</span> m<span class="token punctuation">.</span>From
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>m <span class="token operator">*</span>Message<span class="token punctuation">)</span> <span class="token function">Receiver</span><span class="token punctuation">(</span><span class="token punctuation">)</span> address<span class="token punctuation">.</span>Address <span class="token punctuation">{</span>
 <span class="token keyword">return</span> m<span class="token punctuation">.</span>To
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>m <span class="token operator">*</span>Message<span class="token punctuation">)</span> <span class="token function">ValueReceived</span><span class="token punctuation">(</span><span class="token punctuation">)</span> abi<span class="token punctuation">.</span>TokenAmount <span class="token punctuation">{</span>
 <span class="token keyword">return</span> m<span class="token punctuation">.</span>Value
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">DecodeMessage</span><span class="token punctuation">(</span>b <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>Message<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword">var</span> msg Message
 <span class="token keyword">if</span> err <span class="token operator">:=</span> msg<span class="token punctuation">.</span><span class="token function">UnmarshalCBOR</span><span class="token punctuation">(</span>bytes<span class="token punctuation">.</span><span class="token function">NewReader</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
 <span class="token punctuation">}</span>

 <span class="token keyword">if</span> msg<span class="token punctuation">.</span>Version <span class="token operator">!=</span> MessageVersion <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;decoded message had incorrect version (%d)&quot;</span><span class="token punctuation">,</span> msg<span class="token punctuation">.</span>Version<span class="token punctuation">)</span>
 <span class="token punctuation">}</span>

 <span class="token keyword">return</span> <span class="token operator">&amp;</span>msg<span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>m <span class="token operator">*</span>Message<span class="token punctuation">)</span> <span class="token function">Serialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 buf <span class="token operator">:=</span> <span class="token function">new</span><span class="token punctuation">(</span>bytes<span class="token punctuation">.</span>Buffer<span class="token punctuation">)</span>
 <span class="token keyword">if</span> err <span class="token operator">:=</span> m<span class="token punctuation">.</span><span class="token function">MarshalCBOR</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
 <span class="token punctuation">}</span>
 <span class="token keyword">return</span> buf<span class="token punctuation">.</span><span class="token function">Bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>m <span class="token operator">*</span>Message<span class="token punctuation">)</span> <span class="token function">ChainLength</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{</span>
 ser<span class="token punctuation">,</span> err <span class="token operator">:=</span> m<span class="token punctuation">.</span><span class="token function">Serialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
 <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  <span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
 <span class="token punctuation">}</span>
 <span class="token keyword">return</span> <span class="token function">len</span><span class="token punctuation">(</span>ser<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>m <span class="token operator">*</span>Message<span class="token punctuation">)</span> <span class="token function">ToStorageBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>block<span class="token punctuation">.</span>Block<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 data<span class="token punctuation">,</span> err <span class="token operator">:=</span> m<span class="token punctuation">.</span><span class="token function">Serialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
 <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
 <span class="token punctuation">}</span>

 c<span class="token punctuation">,</span> err <span class="token operator">:=</span> abi<span class="token punctuation">.</span>CidBuilder<span class="token punctuation">.</span><span class="token function">Sum</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
 <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
 <span class="token punctuation">}</span>

 <span class="token keyword">return</span> block<span class="token punctuation">.</span><span class="token function">NewBlockWithCid</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> c<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>m <span class="token operator">*</span>Message<span class="token punctuation">)</span> <span class="token function">Cid</span><span class="token punctuation">(</span><span class="token punctuation">)</span> cid<span class="token punctuation">.</span>Cid <span class="token punctuation">{</span>
 b<span class="token punctuation">,</span> err <span class="token operator">:=</span> m<span class="token punctuation">.</span><span class="token function">ToStorageBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
 <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  <span class="token function">panic</span><span class="token punctuation">(</span>fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;failed to marshal message: %s&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// I think this is maybe sketchy, what happens if we try to serialize a message with an undefined address in it?</span>
 <span class="token punctuation">}</span>

 <span class="token keyword">return</span> b<span class="token punctuation">.</span><span class="token function">Cid</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> mCid <span class="token keyword">struct</span> <span class="token punctuation">{</span>
 <span class="token operator">*</span>RawMessage
 CID cid<span class="token punctuation">.</span>Cid
<span class="token punctuation">}</span>

<span class="token keyword">type</span> RawMessage Message

<span class="token keyword">func</span> <span class="token punctuation">(</span>m <span class="token operator">*</span>Message<span class="token punctuation">)</span> <span class="token function">MarshalJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword">return</span> json<span class="token punctuation">.</span><span class="token function">Marshal</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mCid<span class="token punctuation">{</span>
  RawMessage<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token operator">*</span>RawMessage<span class="token punctuation">)</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">,</span>
  CID<span class="token punctuation">:</span>        m<span class="token punctuation">.</span><span class="token function">Cid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>m <span class="token operator">*</span>Message<span class="token punctuation">)</span> <span class="token function">RequiredFunds</span><span class="token punctuation">(</span><span class="token punctuation">)</span> BigInt <span class="token punctuation">{</span>
 <span class="token keyword">return</span> <span class="token function">BigMul</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>GasFeeCap<span class="token punctuation">,</span> <span class="token function">NewInt</span><span class="token punctuation">(</span><span class="token function">uint64</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>GasLimit<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>m <span class="token operator">*</span>Message<span class="token punctuation">)</span> <span class="token function">VMMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span>Message <span class="token punctuation">{</span>
 <span class="token keyword">return</span> m
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>m <span class="token operator">*</span>Message<span class="token punctuation">)</span> <span class="token function">Equals</span><span class="token punctuation">(</span>o <span class="token operator">*</span>Message<span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span>
 <span class="token keyword">return</span> m<span class="token punctuation">.</span><span class="token function">Cid</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> o<span class="token punctuation">.</span><span class="token function">Cid</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>m <span class="token operator">*</span>Message<span class="token punctuation">)</span> <span class="token function">EqualCall</span><span class="token punctuation">(</span>o <span class="token operator">*</span>Message<span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span>
 m1 <span class="token operator">:=</span> <span class="token operator">*</span>m
 m2 <span class="token operator">:=</span> <span class="token operator">*</span>o

 m1<span class="token punctuation">.</span>GasLimit<span class="token punctuation">,</span> m2<span class="token punctuation">.</span>GasLimit <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span>
 m1<span class="token punctuation">.</span>GasFeeCap<span class="token punctuation">,</span> m2<span class="token punctuation">.</span>GasFeeCap <span class="token operator">=</span> big<span class="token punctuation">.</span><span class="token function">Zero</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> big<span class="token punctuation">.</span><span class="token function">Zero</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
 m1<span class="token punctuation">.</span>GasPremium<span class="token punctuation">,</span> m2<span class="token punctuation">.</span>GasPremium <span class="token operator">=</span> big<span class="token punctuation">.</span><span class="token function">Zero</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> big<span class="token punctuation">.</span><span class="token function">Zero</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

 <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token operator">&amp;</span>m1<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Equals</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>m2<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>m <span class="token operator">*</span>Message<span class="token punctuation">)</span> <span class="token function">ValidForBlockInclusion</span><span class="token punctuation">(</span>minGas <span class="token builtin">int64</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
 <span class="token keyword">if</span> m<span class="token punctuation">.</span>Version <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> xerrors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;&#39;Version&#39; unsupported&quot;</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span>

 <span class="token keyword">if</span> m<span class="token punctuation">.</span>To <span class="token operator">==</span> address<span class="token punctuation">.</span>Undef <span class="token punctuation">{</span>
  <span class="token keyword">return</span> xerrors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;&#39;To&#39; address cannot be empty&quot;</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span>

 <span class="token keyword">if</span> m<span class="token punctuation">.</span>From <span class="token operator">==</span> address<span class="token punctuation">.</span>Undef <span class="token punctuation">{</span>
  <span class="token keyword">return</span> xerrors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;&#39;From&#39; address cannot be empty&quot;</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span>

 <span class="token keyword">if</span> m<span class="token punctuation">.</span>Value<span class="token punctuation">.</span>Int <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> xerrors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;&#39;Value&#39; cannot be nil&quot;</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span>

 <span class="token keyword">if</span> m<span class="token punctuation">.</span>Value<span class="token punctuation">.</span><span class="token function">LessThan</span><span class="token punctuation">(</span>big<span class="token punctuation">.</span><span class="token function">Zero</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> xerrors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;&#39;Value&#39; field cannot be negative&quot;</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span>

 <span class="token keyword">if</span> m<span class="token punctuation">.</span>Value<span class="token punctuation">.</span><span class="token function">GreaterThan</span><span class="token punctuation">(</span>TotalFilecoinInt<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> xerrors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;&#39;Value&#39; field cannot be greater than total filecoin supply&quot;</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span>

 <span class="token keyword">if</span> m<span class="token punctuation">.</span>GasFeeCap<span class="token punctuation">.</span>Int <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> xerrors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;&#39;GasFeeCap&#39; cannot be nil&quot;</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span>

 <span class="token keyword">if</span> m<span class="token punctuation">.</span>GasFeeCap<span class="token punctuation">.</span><span class="token function">LessThan</span><span class="token punctuation">(</span>big<span class="token punctuation">.</span><span class="token function">Zero</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> xerrors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;&#39;GasFeeCap&#39; field cannot be negative&quot;</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span>

 <span class="token keyword">if</span> m<span class="token punctuation">.</span>GasPremium<span class="token punctuation">.</span>Int <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> xerrors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;&#39;GasPremium&#39; cannot be nil&quot;</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span>

 <span class="token keyword">if</span> m<span class="token punctuation">.</span>GasPremium<span class="token punctuation">.</span><span class="token function">LessThan</span><span class="token punctuation">(</span>big<span class="token punctuation">.</span><span class="token function">Zero</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> xerrors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;&#39;GasPremium&#39; field cannot be negative&quot;</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span>

 <span class="token keyword">if</span> m<span class="token punctuation">.</span>GasPremium<span class="token punctuation">.</span><span class="token function">GreaterThan</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>GasFeeCap<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> xerrors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;&#39;GasFeeCap&#39; less than &#39;GasPremium&#39;&quot;</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span>

 <span class="token keyword">if</span> m<span class="token punctuation">.</span>GasLimit <span class="token operator">&gt;</span> build<span class="token punctuation">.</span>BlockGasLimit <span class="token punctuation">{</span>
  <span class="token keyword">return</span> xerrors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;&#39;GasLimit&#39; field cannot be greater than a block&#39;s gas limit&quot;</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span>

 <span class="token comment">// since prices might vary with time, this is technically semantic validation</span>
 <span class="token keyword">if</span> m<span class="token punctuation">.</span>GasLimit <span class="token operator">&lt;</span> minGas <span class="token punctuation">{</span>
  <span class="token keyword">return</span> xerrors<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;&#39;GasLimit&#39; field cannot be less than the cost of storing a message on chain %d &lt; %d&quot;</span><span class="token punctuation">,</span> m<span class="token punctuation">.</span>GasLimit<span class="token punctuation">,</span> minGas<span class="token punctuation">)</span>
 <span class="token punctuation">}</span>

 <span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> TestGasLimit <span class="token operator">=</span> <span class="token number">100e6</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-3-4vmè¿è¡Œæ—¶ç¯å¢ƒ-åœ¨vmå†…éƒ¨" tabindex="-1"><a class="header-anchor" href="#_2-3-4vmè¿è¡Œæ—¶ç¯å¢ƒ-åœ¨vmå†…éƒ¨" aria-hidden="true">#</a> 2.3.4<a href="https://spec.filecoin.io/#section-systems.filecoin_vm.runtime" target="_blank" rel="noopener noreferrer">VMè¿è¡Œæ—¶ç¯å¢ƒï¼ˆåœ¨VMå†…éƒ¨ï¼‰<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h3><h4 id="_2-3-4-1æ”¶æ®" tabindex="-1"><a class="header-anchor" href="#_2-3-4-1æ”¶æ®" aria-hidden="true">#</a> 2.3.4.1<a href="https://spec.filecoin.io/#section-systems.filecoin_vm.runtime.receipts" target="_blank" rel="noopener noreferrer">æ”¶æ®<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><p>ç”²<code>MessageReceipt</code>åŒ…å«ä¸€ä¸ªé¡¶å±‚æ¶ˆæ¯æ‰§è¡Œçš„ç»“æœã€‚æ¯ä¸ªè¯­æ³•æœ‰æ•ˆä¸”æ­£ç¡®ç­¾åçš„æ¶ˆæ¯éƒ½å¯ä»¥åŒ…å«åœ¨ä¸€ä¸ªå—ä¸­ï¼Œå¹¶ä¼šä»æ‰§è¡Œä¸­äº§ç”Ÿä¸€ä¸ªæ”¶æ®ã€‚</p><p>è¯­æ³•æœ‰æ•ˆçš„æ”¶æ®å…·æœ‰ï¼š</p><ul><li>ä¸€ä¸ªéè´Ÿ<code>ExitCode</code>ï¼Œ</li><li><code>Return</code>ä»…å½“é€€å‡ºä»£ç ä¸ºé›¶æ—¶ï¼Œæ‰ä¸ºéç©ºå€¼ï¼›å¹¶ä¸”</li><li>éè´Ÿæ•°<code>GasUsed</code>ã€‚</li></ul><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> MessageReceipt <span class="token keyword">struct</span> <span class="token punctuation">{</span>
 ExitCode exitcode<span class="token punctuation">.</span>ExitCode
 Return   <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span>
 GasUsed  <span class="token builtin">int64</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-3-4-2vm-runtime-æ¼”å‘˜ç•Œé¢" tabindex="-1"><a class="header-anchor" href="#_2-3-4-2vm-runtime-æ¼”å‘˜ç•Œé¢" aria-hidden="true">#</a> 2.3.4.2<a href="https://spec.filecoin.io/#section-systems.filecoin_vm.runtime.vmruntime-actors-interface" target="_blank" rel="noopener noreferrer"><code>vm/runtime</code> æ¼”å‘˜ç•Œé¢<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><p>æ¼”å‘˜æ¥å£çš„å®ç°å¯ä»¥åœ¨<a href="https://github.com/filecoin-project/specs-actors/blob/master/actors/runtime/runtime.go" target="_blank" rel="noopener noreferrer">è¿™é‡Œ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>æ‰¾åˆ°</p><h4 id="_2-3-4-3vm-runtime-è™šæ‹Ÿæœºå®æ–½" tabindex="-1"><a class="header-anchor" href="#_2-3-4-3vm-runtime-è™šæ‹Ÿæœºå®æ–½" aria-hidden="true">#</a> 2.3.4.3<a href="https://spec.filecoin.io/#section-systems.filecoin_vm.runtime.vmruntime-vm-implementation" target="_blank" rel="noopener noreferrer"><code>vm/runtime</code> è™šæ‹Ÿæœºå®æ–½<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><p>Filecoinè™šæ‹Ÿæœºè¿è¡Œæ—¶çš„Lotuså®ç°å¯åœ¨<a href="https://github.com/filecoin-project/lotus/blob/master/chain/vm/runtime.go" target="_blank" rel="noopener noreferrer">æ­¤å¤„<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>æ‰¾åˆ°</p><h4 id="_2-3-4-4é€€å‡ºç " tabindex="-1"><a class="header-anchor" href="#_2-3-4-4é€€å‡ºç " aria-hidden="true">#</a> 2.3.4.4<a href="https://spec.filecoin.io/#section-systems.filecoin_vm.runtime.exit-codes" target="_blank" rel="noopener noreferrer">é€€å‡ºç <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><p>æœ‰ä¸€äº›ç”±ä¸åŒå‚ä¸è€…å…±äº«çš„å¸¸è§è¿è¡Œæ—¶é€€å‡ºä»£ç ã€‚å®ƒä»¬çš„å®šä¹‰å¯ä»¥åœ¨<a href="https://github.com/filecoin-project/go-state-types/blob/master/exitcode/common.go" target="_blank" rel="noopener noreferrer">è¿™é‡Œ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>æ‰¾åˆ° ã€‚</p><h3 id="_2-3-5ç…¤æ°”è´¹" tabindex="-1"><a class="header-anchor" href="#_2-3-5ç…¤æ°”è´¹" aria-hidden="true">#</a> 2.3.5<a href="https://spec.filecoin.io/#section-systems.filecoin_vm.gas_fee" target="_blank" rel="noopener noreferrer">ç…¤æ°”è´¹<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h3><h4 id="_2-3-5-1æ¦‚è¦" tabindex="-1"><a class="header-anchor" href="#_2-3-5-1æ¦‚è¦" aria-hidden="true">#</a> 2.3.5.1<a href="https://spec.filecoin.io/#section-systems.filecoin_vm.gas_fee.summary" target="_blank" rel="noopener noreferrer">æ¦‚è¦<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><p>ä¸è®¸å¤šåŒºå—é“¾çš„ä¼ ç»Ÿæƒ…å†µä¸€æ ·ï¼ŒGasæ˜¯è¡¡é‡é“¾ä¸Šæ¶ˆæ¯æ“ä½œè¦æ‰§è¡Œå¤šå°‘æ¶ˆè€—çš„å­˜å‚¨å’Œ/æˆ–è®¡ç®—èµ„æºçš„åº¦é‡å•ä½ã€‚åœ¨è¾ƒé«˜çº§åˆ«ä¸Šï¼Œå®ƒçš„å·¥ä½œæ–¹å¼å¦‚ä¸‹ï¼šæ¶ˆæ¯å‘é€è€…æŒ‡å®šä»–ä»¬æ„¿æ„æ”¯ä»˜çš„æœ€é«˜é‡‘é¢ï¼Œä»¥ä¾¿æ¶ˆæ¯è¢«æ‰§è¡Œå¹¶åŒ…å«åœ¨å—ä¸­ã€‚è¿™æ˜¯æ ¹æ®æ€»çš„å¤©ç„¶æ°”å•ä½æ•°ï¼ˆ<code>GasLimit</code>ï¼‰ï¼ˆé€šå¸¸æœŸæœ›é«˜äºå®é™…<code>GasUsed</code>å•ä½ï¼‰å’Œæ¯å•ä½å¤©ç„¶æ°”çš„ä»·æ ¼ï¼ˆæˆ–è´¹ç”¨<code>GasFeeCap</code>ï¼‰æ¥æŒ‡å®šçš„ã€‚</p><p>ä¼ ç»Ÿä¸Šï¼Œ<code>GasUsed * GasFeeCap</code>å»ç”Ÿäº§çŸ¿å·¥ä½œä¸ºå¥–åŠ±ã€‚è¯¥äº§å“çš„ç»“æœè¢«è§†ä¸ºæ¶ˆæ¯åŒ…å«çš„ä¼˜å…ˆè´¹ç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ¶ˆæ¯ä»¥é™åºæ’åˆ—ï¼Œè€Œæ¶ˆæ¯æœ€é«˜çš„æ¶ˆæ¯<code>GasUsed * GasFeeCap</code>è¢«ä¼˜å…ˆè€ƒè™‘ï¼Œå› ä¸ºå®ƒä»¬ä¼šå‘çŸ¿å·¥è¿”å›æ›´å¤šçš„åˆ©æ¶¦ã€‚</p><p>ä½†æ˜¯ï¼Œå·²ç»è§‚å¯Ÿåˆ°ï¼Œ<code>GasUsed * GasFee</code>å‡ºäºä¸€äº›åŸå› ï¼Œè¿™ç§ï¼ˆæ”¯ä»˜ï¼‰ç­–ç•¥å¯¹äºå—ç”Ÿäº§çŸ¿å·¥æ˜¯æœ‰é—®é¢˜çš„ã€‚é¦–å…ˆï¼Œä¸€ä¸ªç”Ÿäº§åŒºå—çš„çŸ¿å·¥å¯èƒ½å…è´¹åŒ…å«ä¸€æ¡éå¸¸æ˜‚è´µçš„æ¶ˆæ¯ï¼ˆå°±æ‰€éœ€çš„é“¾èµ„æºè€Œè¨€ï¼‰ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé“¾æœ¬èº«éœ€è¦æ‰¿æ‹…æˆæœ¬ã€‚å…¶æ¬¡ï¼Œæ¶ˆæ¯å‘é€è€…å¯ä»¥ä»»æ„è®¾ç½®é«˜ä»·ï¼Œä½†å¯¹äºä½æˆæœ¬æ¶ˆæ¯ï¼ˆåŒæ ·ä»¥é“¾èµ„æºè€Œè¨€ï¼‰ï¼Œè¿™ä¼šå¯¼è‡´DoSæ¼æ´ã€‚</p><p>ä¸ºäº†å…‹æœè¿™ç§æƒ…å†µï¼ŒFilecoinåŒºå—é“¾å®šä¹‰äº†ä¸€ä¸ª<code>BaseFee</code>ï¼Œæ¯ä¸ªæ¶ˆæ¯éƒ½ä¼šå¯¹å…¶è¿›è¡Œåˆ»å½•ã€‚ç†ç”±æ˜¯ï¼Œè€ƒè™‘åˆ°å¤©ç„¶æ°”æ˜¯è¡¡é‡é“¾ä¸Šèµ„æºæ¶ˆè€—çš„ä¸€ç§æ‰‹æ®µï¼Œä¸å°†å…¶å¥–åŠ±ç»™çŸ¿å·¥ç›¸æ¯”ï¼Œå°†å…¶ç‡ƒçƒ§æ˜¯æœ‰æ„ä¹‰çš„ã€‚è¿™æ ·ï¼Œé¿å…äº†æ¥è‡ªçŸ¿å·¥çš„è´¹ç”¨æ“çºµã€‚å®ƒ<code>BaseFee</code>æ˜¯åŠ¨æ€çš„ï¼Œä¼šæ ¹æ®ç½‘ç»œæ‹¥å¡æƒ…å†µè‡ªåŠ¨è°ƒæ•´ã€‚è¿™ä¸€äº‹å®ä½¿ç½‘ç»œå¯ä»¥æŠµå¾¡åƒåœ¾é‚®ä»¶æ”»å‡»ã€‚é‰´äºåœ¨SPAMæ”»å‡»æœŸé—´ç½‘ç»œè´Ÿè½½ä¼šå¢åŠ ï¼Œå› æ­¤ï¼Œæ”»å‡»è€…æ— æ³•å°†SPAMæ¶ˆæ¯çš„å®Œæ•´å—é•¿æ—¶é—´ä¿ç•™<code>BaseFee</code>ã€‚</p><p>æœ€åï¼Œ<code>GasPremium</code>æ˜¯å‘ä»¶äººåŒ…æ‹¬çš„ä¼˜å…ˆè´¹ï¼Œä»¥æ¿€åŠ±çŸ¿å·¥é€‰æ‹©æœ€æœ‰åˆ©å¯å›¾çš„æ¶ˆæ¯ã€‚æ¢å¥è¯è¯´ï¼Œå¦‚æœæ¶ˆæ¯å‘ä»¶äººå¸Œæœ›æ›´å¿«åœ°åŒ…å«å…¶æ¶ˆæ¯ï¼Œåˆ™å¯ä»¥è®¾ç½®æ›´é«˜çš„<code>GasPremium</code>ã€‚</p><h4 id="_2-3-5-2å‚é‡" tabindex="-1"><a class="header-anchor" href="#_2-3-5-2å‚é‡" aria-hidden="true">#</a> 2.3.5.2<a href="https://spec.filecoin.io/#section-systems.filecoin_vm.gas_fee.parameters" target="_blank" rel="noopener noreferrer">å‚é‡<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><ul><li><code>GasUsed</code>æ˜¯æ‰§è¡Œä¸€æ¡æ¶ˆæ¯æ‰€æ¶ˆè€—çš„èµ„æºï¼ˆæˆ–æ°”ä½“å•ä½ï¼‰æ•°é‡çš„åº¦é‡ã€‚æ¯ç§æ°”ä½“å•ä½éƒ½ä»¥attoFILè¿›è¡Œæµ‹é‡ï¼Œå› æ­¤<code>GasUsed</code>æ˜¯ä»£è¡¨èƒ½è€—å•ä½çš„æ•°å­—ã€‚<code>GasUsed</code>ä¸æ¶ˆæ¯æ˜¯æ­£ç¡®æ‰§è¡Œè¿˜æ˜¯å¤±è´¥æ— å…³ã€‚</li><li><code>BaseFee</code>æ˜¯æ¯æ¬¡æ‰§è¡Œæ¶ˆæ¯æ—¶è¦ç‡ƒçƒ§ï¼ˆå‘é€åˆ°ä¸å¯æ¢å¤çš„åœ°å€ï¼‰çš„æ¯å•ä½å¤©ç„¶æ°”çš„è®¾å®šä»·æ ¼ï¼ˆä»¥attoFIL /å¤©ç„¶æ°”å•ä½è®¡é‡ï¼‰ã€‚çš„å€¼<code>BaseFee</code>æ˜¯åŠ¨æ€çš„ï¼Œå¹¶æ ¹æ®å½“å‰çš„ç½‘ç»œæ‹¥å¡å‚æ•°è¿›è¡Œè°ƒæ•´ã€‚ä¾‹å¦‚ï¼Œå½“ç½‘ç»œè¶…å‡º5Bæ°”ä½“é™åˆ¶ä½¿ç”¨é‡æ—¶ï¼Œ<code>BaseFee</code>å¢åŠ ï¼Œè€Œå½“æ°”ä½“é™åˆ¶ä½¿ç”¨é‡ä¸‹é™åˆ°5Bä»¥ä¸‹æ—¶ï¼Œæƒ…å†µç›¸åã€‚çš„<code>BaseFee</code>æ–½åŠ åˆ°æ¯ä¸ªå—åº”è¢«åŒ…æ‹¬åœ¨å—æœ¬èº«ã€‚åº”è¯¥æœ‰å¯èƒ½<code>BaseFee</code>ä»é“¾çš„é¡¶éƒ¨è·å¾—ç”µæµå€¼ã€‚çš„<code>BaseFee</code>æ¯å•ä½é€‚ç”¨<code>GasUsed</code>ï¼Œå› æ­¤ï¼Œæ°”ä½“çš„æ€»é‡çƒ§åˆ¶çš„æ¶ˆæ¯æ˜¯<code>BaseFee * GasUsed</code>ã€‚è¯·æ³¨æ„ï¼Œ<code>BaseFee</code>æ¯æ¡æ¶ˆæ¯éƒ½ä¼šäº§ç”Ÿï¼Œä½†æ˜¯åŒä¸€å—ä¸­æ‰€æœ‰æ¶ˆæ¯çš„å€¼éƒ½ç›¸åŒã€‚</li><li><code>GasLimit</code>ä»¥æ°”ä½“ä¸ºå•ä½è¿›è¡Œæµ‹é‡ï¼Œå¹¶ç”±æ¶ˆæ¯å‘é€è€…è®¾ç½®ã€‚å®ƒå¯¹åº”å…è®¸æ¶ˆæ¯æ‰§è¡Œåœ¨é“¾ä¸Šæ¶ˆè€—çš„æ°”ä½“é‡ï¼ˆå³æ°”ä½“å•ä½æ•°ï¼‰æ–½åŠ äº†ç¡¬æ€§é™åˆ¶ã€‚æ¶ˆæ¯è§¦å‘çš„æ¯ä¸ªåŸºæœ¬æ“ä½œéƒ½ä¼šæ¶ˆè€—æ°”ä½“ï¼Œè€Œæ¶ˆæ¯ç”¨å°½çš„æ¶ˆæ¯å°†å¤±è´¥ã€‚å½“æ¶ˆæ¯å¤±è´¥æ—¶ï¼Œç”±äºæ‰§è¡Œæ­¤æ¶ˆæ¯è€Œå¯¹çŠ¶æ€è¿›è¡Œçš„æ‰€æœ‰ä¿®æ”¹éƒ½å°†æ¢å¤ä¸ºå…ˆå‰çš„çŠ¶æ€ã€‚ä¸æ¶ˆæ¯æ‰§è¡Œæ˜¯å¦æˆåŠŸæ— å…³ï¼ŒçŸ¿å·¥å°†è·å¾—ä»–ä»¬æ‰§è¡Œæ¶ˆæ¯æ‰€æ¶ˆè€—çš„èµ„æºçš„å¥–åŠ±ï¼ˆè§<code>GasPremium</code>ä¸‹æ–‡ï¼‰ã€‚</li><li><code>GasFeeCap</code>æ˜¯æ¶ˆæ¯å‘ä»¶äººæ„¿æ„ä¸ºæ¯å•ä½å¤©ç„¶æ°”æ”¯ä»˜çš„æœ€é«˜ä»·æ ¼ï¼ˆä»¥attoFIL / gaså•ä½è¡¡é‡ï¼‰ã€‚å†åŠ ä¸Š<code>GasLimit</code>ï¼Œåˆ™<code>GasFeeCap</code>æ˜¯è®¾ç½®ä¸€ä¸ªå‘ä»¶äººå°†ä¸€ä¸ªæ¶ˆæ¯FILæ”¯ä»˜çš„æœ€é«˜é‡‘é¢ï¼šå‘ä»¶äººæ˜¯ä¿è¯ä¿¡æ¯ç»ä¸ä¼šä»¤ä»–ä»¬è¶…è¿‡<code>GasLimit * GasFeeCap</code>attoFILï¼ˆä¸åŒ…æ‹¬ä»»ä½•æº¢ä»·ï¼Œè¯¥ä¿¡æ¯åŒ…å«å…¶æ”¶ä»¶äººï¼‰ã€‚</li><li><code>GasPremium</code>æ˜¯æ¶ˆæ¯å‘é€è€…æ„¿æ„æ”¯ä»˜çš„æ¯å•ä½å¤©ç„¶æ°”ä»·æ ¼ï¼ˆä»¥attoFIL / gasè®¡é‡ï¼‰ï¼ˆåœ¨é¡¶éƒ¨<code>BaseFee</code>ï¼‰ä»¥â€œæç¤ºâ€å°†åŒ…å«è¯¥æ¶ˆæ¯çš„çŸ¿å·¥ã€‚ä¸€æ¡æ¶ˆæ¯é€šå¸¸å¯ä»¥<code>GasLimit * GasPremium</code>æœ‰æ•ˆåœ°ä½¿å®ƒçš„çŸ¿å·¥attoFIL <code>GasPremium = GasFeeCap - BaseFee</code>ã€‚è¯·æ³¨æ„ï¼Œä¸ç›¸å¯¹äº<code>GasPremium</code>åº”ç”¨äº<code>GasLimit</code>ï¼Œ<code>GasUsed</code>ä»¥ä½¿çŸ¿å·¥çš„æ¶ˆæ¯é€‰æ‹©æ›´åŠ ç›´æ¥ã€‚</li></ul><p><a href="https://spec.filecoin.io/#example-computegasoverestimationburn" target="_blank" rel="noopener noreferrer">ç¤ºä¾‹ï¼šComputeGasOverestimationBurn<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>ComputeGasOverestimationBurnè®¡ç®—è¦é€€æ¬¾çš„ç‡ƒæ°”é‡å’Œè¦ç‡ƒçƒ§çš„ç‡ƒæ°”é‡ç»“æœæ˜¯ï¼ˆé€€æ¬¾ï¼Œç‡ƒçƒ§ï¼‰</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">ComputeGasOverestimationBurn</span><span class="token punctuation">(</span>gasUsed<span class="token punctuation">,</span> gasLimit <span class="token builtin">int64</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">int64</span><span class="token punctuation">,</span> <span class="token builtin">int64</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword">if</span> gasUsed <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">,</span> gasLimit
 <span class="token punctuation">}</span>

 <span class="token comment">// over = gasLimit/gasUsed - 1 - 0.1</span>
 <span class="token comment">// over = min(over, 1)</span>
 <span class="token comment">// gasToBurn = (gasLimit - gasUsed) * over</span>

 <span class="token comment">// so to factor out division from `over`</span>
 <span class="token comment">// over*gasUsed = min(gasLimit - (11*gasUsed)/10, gasUsed)</span>
 <span class="token comment">// gasToBurn = ((gasLimit - gasUsed)*over*gasUsed) / gasUsed</span>
 over <span class="token operator">:=</span> gasLimit <span class="token operator">-</span> <span class="token punctuation">(</span>gasOveruseNum<span class="token operator">*</span>gasUsed<span class="token punctuation">)</span><span class="token operator">/</span>gasOveruseDenom
 <span class="token keyword">if</span> over <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> gasLimit <span class="token operator">-</span> gasUsed<span class="token punctuation">,</span> <span class="token number">0</span>
 <span class="token punctuation">}</span>

 <span class="token comment">// if we want sharper scaling it goes here:</span>
 <span class="token comment">// over *= 2</span>

 <span class="token keyword">if</span> over <span class="token operator">&gt;</span> gasUsed <span class="token punctuation">{</span>
  over <span class="token operator">=</span> gasUsed
 <span class="token punctuation">}</span>

 <span class="token comment">// needs bigint, as it overflows in pathological case gasLimit &gt; 2^32 gasUsed = gasLimit / 2</span>
 gasToBurn <span class="token operator">:=</span> big<span class="token punctuation">.</span><span class="token function">NewInt</span><span class="token punctuation">(</span>gasLimit <span class="token operator">-</span> gasUsed<span class="token punctuation">)</span>
 gasToBurn <span class="token operator">=</span> big<span class="token punctuation">.</span><span class="token function">Mul</span><span class="token punctuation">(</span>gasToBurn<span class="token punctuation">,</span> big<span class="token punctuation">.</span><span class="token function">NewInt</span><span class="token punctuation">(</span>over<span class="token punctuation">)</span><span class="token punctuation">)</span>
 gasToBurn <span class="token operator">=</span> big<span class="token punctuation">.</span><span class="token function">Div</span><span class="token punctuation">(</span>gasToBurn<span class="token punctuation">,</span> big<span class="token punctuation">.</span><span class="token function">NewInt</span><span class="token punctuation">(</span>gasUsed<span class="token punctuation">)</span><span class="token punctuation">)</span>

 <span class="token keyword">return</span> gasLimit <span class="token operator">-</span> gasUsed <span class="token operator">-</span> gasToBurn<span class="token punctuation">.</span><span class="token function">Int64</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> gasToBurn<span class="token punctuation">.</span><span class="token function">Int64</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a href="https://spec.filecoin.io/#example-computenextbasefee" target="_blank" rel="noopener noreferrer">ç¤ºä¾‹ï¼šComputeNextBaseFee<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">ComputeNextBaseFee</span><span class="token punctuation">(</span>baseFee types<span class="token punctuation">.</span>BigInt<span class="token punctuation">,</span> gasLimitUsed <span class="token builtin">int64</span><span class="token punctuation">,</span> noOfBlocks <span class="token builtin">int</span><span class="token punctuation">,</span> epoch abi<span class="token punctuation">.</span>ChainEpoch<span class="token punctuation">)</span> types<span class="token punctuation">.</span>BigInt <span class="token punctuation">{</span>
 <span class="token comment">// deta := gasLimitUsed/noOfBlocks - build.BlockGasTarget</span>
 <span class="token comment">// change := baseFee * deta / BlockGasTarget</span>
 <span class="token comment">// nextBaseFee = baseFee + change</span>
 <span class="token comment">// nextBaseFee = max(nextBaseFee, build.MinimumBaseFee)</span>

 <span class="token keyword">var</span> delta <span class="token builtin">int64</span>
 <span class="token keyword">if</span> epoch <span class="token operator">&gt;</span> build<span class="token punctuation">.</span>UpgradeSmokeHeight <span class="token punctuation">{</span>
  delta <span class="token operator">=</span> gasLimitUsed <span class="token operator">/</span> <span class="token function">int64</span><span class="token punctuation">(</span>noOfBlocks<span class="token punctuation">)</span>
  delta <span class="token operator">-=</span> build<span class="token punctuation">.</span>BlockGasTarget
 <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  delta <span class="token operator">=</span> build<span class="token punctuation">.</span>PackingEfficiencyDenom <span class="token operator">*</span> gasLimitUsed <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token function">int64</span><span class="token punctuation">(</span>noOfBlocks<span class="token punctuation">)</span> <span class="token operator">*</span> build<span class="token punctuation">.</span>PackingEfficiencyNum<span class="token punctuation">)</span>
  delta <span class="token operator">-=</span> build<span class="token punctuation">.</span>BlockGasTarget
 <span class="token punctuation">}</span>

 <span class="token comment">// cap change at 12.5% (BaseFeeMaxChangeDenom) by capping delta</span>
 <span class="token keyword">if</span> delta <span class="token operator">&gt;</span> build<span class="token punctuation">.</span>BlockGasTarget <span class="token punctuation">{</span>
  delta <span class="token operator">=</span> build<span class="token punctuation">.</span>BlockGasTarget
 <span class="token punctuation">}</span>
 <span class="token keyword">if</span> delta <span class="token operator">&lt;</span> <span class="token operator">-</span>build<span class="token punctuation">.</span>BlockGasTarget <span class="token punctuation">{</span>
  delta <span class="token operator">=</span> <span class="token operator">-</span>build<span class="token punctuation">.</span>BlockGasTarget
 <span class="token punctuation">}</span>

 change <span class="token operator">:=</span> big<span class="token punctuation">.</span><span class="token function">Mul</span><span class="token punctuation">(</span>baseFee<span class="token punctuation">,</span> big<span class="token punctuation">.</span><span class="token function">NewInt</span><span class="token punctuation">(</span>delta<span class="token punctuation">)</span><span class="token punctuation">)</span>
 change <span class="token operator">=</span> big<span class="token punctuation">.</span><span class="token function">Div</span><span class="token punctuation">(</span>change<span class="token punctuation">,</span> big<span class="token punctuation">.</span><span class="token function">NewInt</span><span class="token punctuation">(</span>build<span class="token punctuation">.</span>BlockGasTarget<span class="token punctuation">)</span><span class="token punctuation">)</span>
 change <span class="token operator">=</span> big<span class="token punctuation">.</span><span class="token function">Div</span><span class="token punctuation">(</span>change<span class="token punctuation">,</span> big<span class="token punctuation">.</span><span class="token function">NewInt</span><span class="token punctuation">(</span>build<span class="token punctuation">.</span>BaseFeeMaxChangeDenom<span class="token punctuation">)</span><span class="token punctuation">)</span>

 nextBaseFee <span class="token operator">:=</span> big<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>baseFee<span class="token punctuation">,</span> change<span class="token punctuation">)</span>
 <span class="token keyword">if</span> big<span class="token punctuation">.</span><span class="token function">Cmp</span><span class="token punctuation">(</span>nextBaseFee<span class="token punctuation">,</span> big<span class="token punctuation">.</span><span class="token function">NewInt</span><span class="token punctuation">(</span>build<span class="token punctuation">.</span>MinimumBaseFee<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token punctuation">{</span>
  nextBaseFee <span class="token operator">=</span> big<span class="token punctuation">.</span><span class="token function">NewInt</span><span class="token punctuation">(</span>build<span class="token punctuation">.</span>MinimumBaseFee<span class="token punctuation">)</span>
 <span class="token punctuation">}</span>
 <span class="token keyword">return</span> nextBaseFee
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-3-5-3æ³¨é‡Šä¸å«ä¹‰" tabindex="-1"><a class="header-anchor" href="#_2-3-5-3æ³¨é‡Šä¸å«ä¹‰" aria-hidden="true">#</a> 2.3.5.3<a href="https://spec.filecoin.io/#section-systems.filecoin_vm.gas_fee.notes--implications" target="_blank" rel="noopener noreferrer">æ³¨é‡Šä¸å«ä¹‰<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><ul><li>çš„å€¼<code>GasFeeCap</code>åº”å§‹ç»ˆé«˜äºç½‘ç»œçš„<code>BaseFee</code>ã€‚å¦‚æœæ¶ˆæ¯çš„<code>GasFeeCap</code>ä½äº<code>BaseFee</code>ï¼Œåˆ™å…¶ä½™éƒ¨åˆ†æ¥è‡ªçŸ¿å·¥ï¼ˆä½œä¸ºç½šæ¬¾ï¼‰ã€‚ç”±äºçŸ¿å·¥é€‰æ‹©çš„æ¶ˆæ¯çš„ä»·æ ¼ä½äº<code>BaseFee</code>ç½‘ç»œè´¹ç”¨ï¼ˆå³ï¼Œä¸åŒ…æ‹¬ç½‘ç»œè´¹ç”¨ï¼‰ï¼Œå› æ­¤å¯¹çŸ¿å·¥æ–½åŠ æ­¤ç½šæ¬¾ã€‚ç„¶è€Œï¼ŒçŸ¿å·¥å¯èƒ½è¦é€‰æ‹©ä¸€ä¸ªæ¶ˆæ¯ï¼Œå…¶<code>GasFeeCap</code>æ¯”å°<code>BaseFee</code>ï¼Œå¦‚æœåŒä¸€ä¸ªå‘ä»¶äººåœ¨é‚®ä»¶æ± ï¼Œå…¶å¦ä¸€æ¡æ¶ˆæ¯<code>GasFeeCap</code>æ¯”è¦å¤§å¾—å¤š<code>BaseFee</code>ã€‚å›æƒ³ä¸€ä¸‹ï¼Œå¦‚æœå­˜åœ¨å¤šä¸ªçŸ¿å·¥ï¼Œåˆ™çŸ¿å·¥åº”è¯¥ä»æ¶ˆæ¯æ± ä¸­é€‰æ‹©å‘ä»¶äººçš„æ‰€æœ‰æ¶ˆæ¯ã€‚ç†ç”±æ˜¯å¢åŠ ç¬¬äºŒæ¡æ¶ˆæ¯çš„è´¹ç”¨å°†å¼¥è¡¥ç¬¬ä¸€æ¡æ¶ˆæ¯çš„æŸå¤±ã€‚</li><li>å¦‚æœ<code>BaseFee + GasPremium</code>&gt; <code>GasFeeCap</code>ï¼Œåˆ™çŸ¿å·¥å¯èƒ½ä¸ä¼šè·å¾—å…¨éƒ¨<code>GasLimit * GasPremium</code>ä½œä¸ºå¥–åŠ±ã€‚</li><li>ä¸€æ¡æ¶ˆæ¯çš„èŠ±è´¹ä¸å¾—è¶…è¿‡<code>GasFeeCap * GasLimit</code>ã€‚ä»è¯¥é‡‘é¢ä¸­ï¼Œç½‘ç»œé¦–å…ˆ<code>BaseFee</code>è¢«æ”¯ä»˜ï¼ˆçƒ§æ‰ï¼‰ã€‚ä¹‹åï¼Œæœ€å¤š<code>GasLimit * GasPremium</code>å°†ç»™äºˆçŸ¿å·¥ä½œä¸ºå¥–åŠ±ã€‚</li><li>è€—å°½æ°”ä½“çš„æ¶ˆæ¯å¤±è´¥ï¼Œå¹¶æ˜¾ç¤ºâ€œè€—å°½æ°”ä½“â€é€€å‡ºä»£ç ã€‚<code>GasUsed * BaseFee</code>ä»å°†è¢«çƒ§æ¯ï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹<code>GasUsed = GasLimit</code>ï¼‰ï¼Œè€ŒçŸ¿å·¥ä»å°†å¾—åˆ°å¥–åŠ±<code>GasLimit * GasPremium</code>ã€‚è¿™æ˜¯å‡å®š<code>GasFeeCap &gt; BaseFee + GasPremium</code>ã€‚</li><li>è¾ƒä½çš„ä»·æ ¼<code>GasFeeCap</code>å¯èƒ½ä¼šå¯¼è‡´æ¶ˆæ¯æ»ç•™åœ¨æ¶ˆæ¯æ± ä¸­ï¼Œå› ä¸ºå¯¹äºä»»ä½•çŸ¿å·¥æ¥è¯´ï¼Œé€‰æ‹©å®ƒå¹¶å°†å…¶åŒ…å«åœ¨ä¸€ä¸ªå—ä¸­ï¼Œåœ¨åˆ©æ¶¦æ–¹é¢éƒ½ä¸å¤Ÿå¸å¼•äººã€‚å‘ç”Ÿè¿™ç§æƒ…å†µæ—¶ï¼Œå°†æœ‰ä¸€ä¸ªæ›´æ–°ç¨‹åºï¼Œä»¥<code>GasFeeCap</code>ä½¿æ¶ˆæ¯å¯¹çŸ¿å·¥æ›´å…·å¸å¼•åŠ›ã€‚å‘é€è€…å¯ä»¥å°†æ–°æ¶ˆæ¯æ¨é€åˆ°æ¶ˆæ¯æ± ï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥æ¶ˆæ¯æ± å°†ä¼ æ’­åˆ°å…¶ä»–çŸ¿å·¥çš„æ¶ˆæ¯æ± ï¼‰ï¼Œå…¶ä¸­ï¼šiï¼‰æ—§æ¶ˆæ¯å’Œæ–°æ¶ˆæ¯çš„æ ‡è¯†ç¬¦ç›¸åŒï¼ˆä¾‹å¦‚ï¼Œç›¸åŒ<code>Nonce</code>ï¼‰ï¼Œå¹¶ä¸”iiï¼‰<code>GasPremium</code>æ›´æ–°å¹¶å¢åŠ è‡³å°‘25ï¼…çš„å…ˆå‰å€¼ã€‚</li></ul><h3 id="_2-3-6ç³»ç»Ÿè§’è‰²" tabindex="-1"><a class="header-anchor" href="#_2-3-6ç³»ç»Ÿè§’è‰²" aria-hidden="true">#</a> 2.3.6<a href="https://spec.filecoin.io/#section-systems.filecoin_vm.sysactors" target="_blank" rel="noopener noreferrer">ç³»ç»Ÿè§’è‰²<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h3><p>æ€»å…±æœ‰åä¸€ï¼ˆ11ï¼‰ä¸ªå†…ç½®çš„System Actorï¼Œä½†æ˜¯å¹¶ä¸æ˜¯æ‰€æœ‰çš„Actoréƒ½ä¸VMäº¤äº’ã€‚æ¯ä¸ªæ¼”å‘˜éƒ½ç”±<em>ä»£ç ID</em>ï¼ˆæˆ–CIDï¼‰<em>æ ‡è¯†</em>ã€‚</p><p>VMå¤„ç†éœ€è¦ä¸¤ä¸ªç³»ç»Ÿå‚ä¸è€…ï¼š</p><ul><li>åœ¨ <a href="https://spec.filecoin.io/#section-systems.filecoin_vm.sysactors.initactor" target="_blank" rel="noopener noreferrer">InitActor<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ï¼Œåˆå§‹åŒ–æ–°çš„å‚ä¸è€…å’Œè®°å½•ç½‘ç»œåç§°ï¼Œ</li><li>åœ¨ <a href="https://spec.filecoin.io/#section-systems.filecoin_vm.sysactors.cronactor" target="_blank" rel="noopener noreferrer">CronActor<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ï¼Œï¼Œåœ¨æ¯ä¸ªæ—¶é—´æ®µè¿è¡Œå…³é”®åŠŸèƒ½çš„è°ƒåº¦æ¼”å‘˜ã€‚è¿˜æœ‰ä¸¤ä¸ªä¸VMäº¤äº’çš„å‚ä¸è€…ï¼š</li><li>è´Ÿè´£ç”¨æˆ·å¸æˆ·ï¼ˆéå•ä¸€å¸æˆ·ï¼‰çš„ <a href="https://spec.filecoin.io/#section-systems.filecoin_vm.sysactors.accountactor" target="_blank" rel="noopener noreferrer">AccountActor<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ï¼Œä»¥åŠ</li><li>è¯¥ <a href="https://spec.filecoin.io/#section-systems.filecoin_vm.sysactors.rewardactor" target="_blank" rel="noopener noreferrer">RewardActor<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>å—å¥–åŠ±å’Œä»¤ç‰Œå½’å±ï¼ˆå•ï¼‰ã€‚</li></ul><p>ä¸ç›´æ¥ä¸VMäº¤äº’çš„å…¶ä½™ä¸ƒï¼ˆ7ï¼‰ä¸ªå†…ç½®ç³»ç»Ÿè§’è‰²æ˜¯ï¼š</p><ul><li><code>StorageMarketActor</code>ï¼šè´Ÿè´£ç®¡ç†å­˜å‚¨å’Œæ£€ç´¢äº¤æ˜“[ <a href="https://github.com/filecoin-project/specs-actors/blob/master/actors/builtin/market/market_actor.go" target="_blank" rel="noopener noreferrer">Market Actor Repo<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> ]</li><li><code>StorageMinerActor</code>ï¼šè´Ÿè´£å¤„ç†é‡‡çŸ¿ä¸šåŠ¡å¹¶æ”¶é›†è¯æ®çš„<a href="https://github.com/filecoin-project/specs-actors/blob/master/actors/builtin/miner/miner_actor.go" target="_blank" rel="noopener noreferrer">æ¼”å‘˜<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>[ <a href="https://github.com/filecoin-project/specs-actors/blob/master/actors/builtin/miner/miner_actor.go" target="_blank" rel="noopener noreferrer">Storage Miner Actor Repo<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> ]</li><li><code>MultisigActor</code>ï¼ˆæˆ–Multi-Signature Wallet Actorï¼‰ï¼šè´Ÿè´£å¤„ç†æ¶‰åŠFilecoiné’±åŒ…çš„æ“ä½œ[ <a href="https://github.com/filecoin-project/specs-actors/blob/master/actors/builtin/multisig/multisig_actor.go" target="_blank" rel="noopener noreferrer">Multisig Actor Repo<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> ]</li><li><code>PaymentChannelActor</code>ï¼šè´Ÿè´£å»ºç«‹å’Œç»“ç®—ä¸æ”¯ä»˜æ¸ é“æœ‰å…³çš„èµ„é‡‘[ <a href="https://github.com/filecoin-project/specs-actors/blob/master/actors/builtin/paych/paych_actor.go" target="_blank" rel="noopener noreferrer">Paych Actor Repo<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> ]</li><li><code>StoragePowerActor</code>ï¼šè´Ÿè´£è·Ÿè¸ªæ¯ä¸ªå­˜å‚¨çŸ¿å·¥åˆ†é…çš„å­˜å‚¨åŠŸç‡[ <a href="https://github.com/filecoin-project/specs-actors/blob/master/actors/builtin/power/power_actor.go" target="_blank" rel="noopener noreferrer">Storage Power Actor<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> ]</li><li><code>VerifiedRegistryActor</code>ï¼šè´Ÿè´£ç®¡ç†å·²éªŒè¯çš„å®¢æˆ·[ <a href="https://github.com/filecoin-project/specs-actors/blob/master/actors/builtin/verifreg/verified_registry_actor.go" target="_blank" rel="noopener noreferrer">Verifreg Actor Repo<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> ]</li><li><code>SystemActor</code>ï¼šæ™®é€šç³»ç»Ÿæ¼”å‘˜[ <a href="https://github.com/filecoin-project/specs-actors/blob/master/actors/builtin/system/system_actor.go" target="_blank" rel="noopener noreferrer">System Actor Repo<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> ]</li></ul><h4 id="_2-3-6-1cronactor" tabindex="-1"><a class="header-anchor" href="#_2-3-6-1cronactor" aria-hidden="true">#</a> 2.3.6.1<a href="https://spec.filecoin.io/#section-systems.filecoin_vm.sysactors.cronactor" target="_blank" rel="noopener noreferrer">CronActor<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><p>å†…ç½®åœ¨åˆ›ä¸–çŠ¶æ€ä¸­ï¼Œ<code>CronActor</code>çš„åˆ†æ´¾è¡¨è°ƒç”¨<code>StoragePowerActor</code>å’Œ<code>StorageMarketActor</code>ï¼Œä»¥ç»´æŠ¤å†…éƒ¨çŠ¶æ€å¹¶å¤„ç†å»¶è¿Ÿçš„äº‹ä»¶ã€‚åœ¨ç½‘ç»œå‡çº§åï¼Œå®ƒåŸåˆ™ä¸Šå¯ä»¥è°ƒç”¨å…¶ä»–å‚ä¸è€…ã€‚</p><p><a href="https://spec.filecoin.io/#example-" target="_blank" rel="noopener noreferrer">ä¾‹ï¼š<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">package</span> cron

<span class="token keyword">import</span> <span class="token punctuation">(</span>
 <span class="token string">&quot;github.com/filecoin-project/go-state-types/abi&quot;</span>
 <span class="token string">&quot;github.com/filecoin-project/go-state-types/cbor&quot;</span>
 cron0 <span class="token string">&quot;github.com/filecoin-project/specs-actors/actors/builtin/cron&quot;</span>
 <span class="token string">&quot;github.com/ipfs/go-cid&quot;</span>

 <span class="token string">&quot;github.com/filecoin-project/specs-actors/v2/actors/builtin&quot;</span>
 <span class="token string">&quot;github.com/filecoin-project/specs-actors/v2/actors/runtime&quot;</span>
<span class="token punctuation">)</span>

<span class="token comment">// The cron actor is a built-in singleton that sends messages to other registered actors at the end of each epoch.</span>
<span class="token keyword">type</span> Actor <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>a Actor<span class="token punctuation">)</span> <span class="token function">Exports</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">{</span>
 <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span>
  builtin<span class="token punctuation">.</span>MethodConstructor<span class="token punctuation">:</span> a<span class="token punctuation">.</span>Constructor<span class="token punctuation">,</span>
  <span class="token number">2</span><span class="token punctuation">:</span>                         a<span class="token punctuation">.</span>EpochTick<span class="token punctuation">,</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>a Actor<span class="token punctuation">)</span> <span class="token function">Code</span><span class="token punctuation">(</span><span class="token punctuation">)</span> cid<span class="token punctuation">.</span>Cid <span class="token punctuation">{</span>
 <span class="token keyword">return</span> builtin<span class="token punctuation">.</span>CronActorCodeID
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>a Actor<span class="token punctuation">)</span> <span class="token function">IsSingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span>
 <span class="token keyword">return</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>a Actor<span class="token punctuation">)</span> <span class="token function">State</span><span class="token punctuation">(</span><span class="token punctuation">)</span> cbor<span class="token punctuation">.</span>Er <span class="token punctuation">{</span>
 <span class="token keyword">return</span> <span class="token function">new</span><span class="token punctuation">(</span>State<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> <span class="token boolean">_</span> runtime<span class="token punctuation">.</span>VMActor <span class="token operator">=</span> Actor<span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">//type ConstructorParams struct {</span>
<span class="token comment">// Entries []Entry</span>
<span class="token comment">//}</span>
<span class="token keyword">type</span> ConstructorParams <span class="token operator">=</span> cron0<span class="token punctuation">.</span>ConstructorParams

<span class="token keyword">type</span> EntryParam <span class="token operator">=</span> cron0<span class="token punctuation">.</span>Entry

<span class="token keyword">func</span> <span class="token punctuation">(</span>a Actor<span class="token punctuation">)</span> <span class="token function">Constructor</span><span class="token punctuation">(</span>rt runtime<span class="token punctuation">.</span>Runtime<span class="token punctuation">,</span> params <span class="token operator">*</span>ConstructorParams<span class="token punctuation">)</span> <span class="token operator">*</span>abi<span class="token punctuation">.</span>EmptyValue <span class="token punctuation">{</span>
 rt<span class="token punctuation">.</span><span class="token function">ValidateImmediateCallerIs</span><span class="token punctuation">(</span>builtin<span class="token punctuation">.</span>SystemActorAddr<span class="token punctuation">)</span>
 entries <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span>Entry<span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>params<span class="token punctuation">.</span>Entries<span class="token punctuation">)</span><span class="token punctuation">)</span>
 <span class="token keyword">for</span> i<span class="token punctuation">,</span> e <span class="token operator">:=</span> <span class="token keyword">range</span> params<span class="token punctuation">.</span>Entries <span class="token punctuation">{</span>
  entries<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">Entry</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token comment">// Identical</span>
 <span class="token punctuation">}</span>
 rt<span class="token punctuation">.</span><span class="token function">StateCreate</span><span class="token punctuation">(</span><span class="token function">ConstructState</span><span class="token punctuation">(</span>entries<span class="token punctuation">)</span><span class="token punctuation">)</span>
 <span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token comment">// Invoked by the system after all other messages in the epoch have been processed.</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>a Actor<span class="token punctuation">)</span> <span class="token function">EpochTick</span><span class="token punctuation">(</span>rt runtime<span class="token punctuation">.</span>Runtime<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">*</span>abi<span class="token punctuation">.</span>EmptyValue<span class="token punctuation">)</span> <span class="token operator">*</span>abi<span class="token punctuation">.</span>EmptyValue <span class="token punctuation">{</span>
 rt<span class="token punctuation">.</span><span class="token function">ValidateImmediateCallerIs</span><span class="token punctuation">(</span>builtin<span class="token punctuation">.</span>SystemActorAddr<span class="token punctuation">)</span>

 <span class="token keyword">var</span> st State
 rt<span class="token punctuation">.</span><span class="token function">StateReadonly</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>st<span class="token punctuation">)</span>
 <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> entry <span class="token operator">:=</span> <span class="token keyword">range</span> st<span class="token punctuation">.</span>Entries <span class="token punctuation">{</span>
  <span class="token boolean">_</span> <span class="token operator">=</span> rt<span class="token punctuation">.</span><span class="token function">Send</span><span class="token punctuation">(</span>entry<span class="token punctuation">.</span>Receiver<span class="token punctuation">,</span> entry<span class="token punctuation">.</span>MethodNum<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> abi<span class="token punctuation">.</span><span class="token function">NewTokenAmount</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>builtin<span class="token punctuation">.</span>Discard<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">// Any error and return value are ignored.</span>
 <span class="token punctuation">}</span>

 <span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-3-6-2åˆå§‹åŒ–æ¼”å‘˜" tabindex="-1"><a class="header-anchor" href="#_2-3-6-2åˆå§‹åŒ–æ¼”å‘˜" aria-hidden="true">#</a> 2.3.6.2<a href="https://spec.filecoin.io/#section-systems.filecoin_vm.sysactors.initactor" target="_blank" rel="noopener noreferrer">åˆå§‹åŒ–æ¼”å‘˜<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><p>å°†<code>InitActor</code>æœ‰å¯èƒ½åˆ›é€ æ–°çš„è§’è‰²ï¼Œä¾‹å¦‚ï¼Œé‚£äº›è¿›å…¥ç³»ç»Ÿçš„ç”µæºã€‚å®ƒç»´æŠ¤ç€ä¸€ä¸ªè¡¨ï¼Œç”¨äºå°†å…¬å…±å¯†é’¥å’Œä¸´æ—¶å‚ä¸è€…åœ°å€è§£æä¸ºå…¶è§„èŒƒçš„IDåœ°å€ã€‚æ— æ•ˆçš„CIDä¸åº”æäº¤ç»™çŠ¶æ€æ ‘ã€‚</p><p>è¯·æ³¨æ„ï¼Œåœ¨è¿›è¡Œé“¾é‡ç»„æ—¶ï¼Œè§„èŒƒIDåœ°å€ä¸ä¼šä¿ç•™ã€‚æ¼”å‘˜åœ°å€æˆ–å…¬é’¥åœ¨é“¾é‡ç»„åä»ç„¶æœ‰æ•ˆã€‚</p><p><a href="https://spec.filecoin.io/#example-" target="_blank" rel="noopener noreferrer">ä¾‹ï¼š<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">package</span> init

<span class="token keyword">import</span> <span class="token punctuation">(</span>
 addr <span class="token string">&quot;github.com/filecoin-project/go-address&quot;</span>
 <span class="token string">&quot;github.com/filecoin-project/go-state-types/abi&quot;</span>
 <span class="token string">&quot;github.com/filecoin-project/go-state-types/cbor&quot;</span>
 <span class="token string">&quot;github.com/filecoin-project/go-state-types/exitcode&quot;</span>
 init0 <span class="token string">&quot;github.com/filecoin-project/specs-actors/actors/builtin/init&quot;</span>
 cid <span class="token string">&quot;github.com/ipfs/go-cid&quot;</span>

 <span class="token string">&quot;github.com/filecoin-project/specs-actors/v2/actors/builtin&quot;</span>
 <span class="token string">&quot;github.com/filecoin-project/specs-actors/v2/actors/runtime&quot;</span>
 autil <span class="token string">&quot;github.com/filecoin-project/specs-actors/v2/actors/util&quot;</span>
 <span class="token string">&quot;github.com/filecoin-project/specs-actors/v2/actors/util/adt&quot;</span>
<span class="token punctuation">)</span>

<span class="token comment">// The init actor uniquely has the power to create new actors.</span>
<span class="token comment">// It maintains a table resolving pubkey and temporary actor addresses to the canonical ID-addresses.</span>
<span class="token keyword">type</span> Actor <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>a Actor<span class="token punctuation">)</span> <span class="token function">Exports</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">{</span>
 <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span>
  builtin<span class="token punctuation">.</span>MethodConstructor<span class="token punctuation">:</span> a<span class="token punctuation">.</span>Constructor<span class="token punctuation">,</span>
  <span class="token number">2</span><span class="token punctuation">:</span>                         a<span class="token punctuation">.</span>Exec<span class="token punctuation">,</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>a Actor<span class="token punctuation">)</span> <span class="token function">Code</span><span class="token punctuation">(</span><span class="token punctuation">)</span> cid<span class="token punctuation">.</span>Cid <span class="token punctuation">{</span>
 <span class="token keyword">return</span> builtin<span class="token punctuation">.</span>InitActorCodeID
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>a Actor<span class="token punctuation">)</span> <span class="token function">IsSingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span>
 <span class="token keyword">return</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>a Actor<span class="token punctuation">)</span> <span class="token function">State</span><span class="token punctuation">(</span><span class="token punctuation">)</span> cbor<span class="token punctuation">.</span>Er <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">new</span><span class="token punctuation">(</span>State<span class="token punctuation">)</span> <span class="token punctuation">}</span>

<span class="token keyword">var</span> <span class="token boolean">_</span> runtime<span class="token punctuation">.</span>VMActor <span class="token operator">=</span> Actor<span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">//type ConstructorParams struct {</span>
<span class="token comment">// NetworkName string</span>
<span class="token comment">//}</span>
<span class="token keyword">type</span> ConstructorParams <span class="token operator">=</span> init0<span class="token punctuation">.</span>ConstructorParams

<span class="token keyword">func</span> <span class="token punctuation">(</span>a Actor<span class="token punctuation">)</span> <span class="token function">Constructor</span><span class="token punctuation">(</span>rt runtime<span class="token punctuation">.</span>Runtime<span class="token punctuation">,</span> params <span class="token operator">*</span>ConstructorParams<span class="token punctuation">)</span> <span class="token operator">*</span>abi<span class="token punctuation">.</span>EmptyValue <span class="token punctuation">{</span>
 rt<span class="token punctuation">.</span><span class="token function">ValidateImmediateCallerIs</span><span class="token punctuation">(</span>builtin<span class="token punctuation">.</span>SystemActorAddr<span class="token punctuation">)</span>
 emptyMap<span class="token punctuation">,</span> err <span class="token operator">:=</span> adt<span class="token punctuation">.</span><span class="token function">MakeEmptyMap</span><span class="token punctuation">(</span>adt<span class="token punctuation">.</span><span class="token function">AsStore</span><span class="token punctuation">(</span>rt<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Root</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
 builtin<span class="token punctuation">.</span><span class="token function">RequireNoErr</span><span class="token punctuation">(</span>rt<span class="token punctuation">,</span> err<span class="token punctuation">,</span> exitcode<span class="token punctuation">.</span>ErrIllegalState<span class="token punctuation">,</span> <span class="token string">&quot;failed to construct state&quot;</span><span class="token punctuation">)</span>

 st <span class="token operator">:=</span> <span class="token function">ConstructState</span><span class="token punctuation">(</span>emptyMap<span class="token punctuation">,</span> params<span class="token punctuation">.</span>NetworkName<span class="token punctuation">)</span>
 rt<span class="token punctuation">.</span><span class="token function">StateCreate</span><span class="token punctuation">(</span>st<span class="token punctuation">)</span>
 <span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token comment">//type ExecParams struct {</span>
<span class="token comment">// CodeCID           cid.Cid `checked:&quot;true&quot;` // invalid CIDs won&#39;t get committed to the state tree</span>
<span class="token comment">// ConstructorParams []byte</span>
<span class="token comment">//}</span>
<span class="token keyword">type</span> ExecParams <span class="token operator">=</span> init0<span class="token punctuation">.</span>ExecParams

<span class="token comment">//type ExecReturn struct {</span>
<span class="token comment">// IDAddress     addr.Address // The canonical ID-based address for the actor.</span>
<span class="token comment">// RobustAddress addr.Address // A more expensive but re-org-safe address for the newly created actor.</span>
<span class="token comment">//}</span>
<span class="token keyword">type</span> ExecReturn <span class="token operator">=</span> init0<span class="token punctuation">.</span>ExecReturn

<span class="token keyword">func</span> <span class="token punctuation">(</span>a Actor<span class="token punctuation">)</span> <span class="token function">Exec</span><span class="token punctuation">(</span>rt runtime<span class="token punctuation">.</span>Runtime<span class="token punctuation">,</span> params <span class="token operator">*</span>ExecParams<span class="token punctuation">)</span> <span class="token operator">*</span>ExecReturn <span class="token punctuation">{</span>
 rt<span class="token punctuation">.</span><span class="token function">ValidateImmediateCallerAcceptAny</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
 callerCodeCID<span class="token punctuation">,</span> ok <span class="token operator">:=</span> rt<span class="token punctuation">.</span><span class="token function">GetActorCodeCID</span><span class="token punctuation">(</span>rt<span class="token punctuation">.</span><span class="token function">Caller</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 autil<span class="token punctuation">.</span><span class="token function">AssertMsg</span><span class="token punctuation">(</span>ok<span class="token punctuation">,</span> <span class="token string">&quot;no code for actor at %s&quot;</span><span class="token punctuation">,</span> rt<span class="token punctuation">.</span><span class="token function">Caller</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 <span class="token keyword">if</span> <span class="token operator">!</span><span class="token function">canExec</span><span class="token punctuation">(</span>callerCodeCID<span class="token punctuation">,</span> params<span class="token punctuation">.</span>CodeCID<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  rt<span class="token punctuation">.</span><span class="token function">Abortf</span><span class="token punctuation">(</span>exitcode<span class="token punctuation">.</span>ErrForbidden<span class="token punctuation">,</span> <span class="token string">&quot;caller type %v cannot exec actor type %v&quot;</span><span class="token punctuation">,</span> callerCodeCID<span class="token punctuation">,</span> params<span class="token punctuation">.</span>CodeCID<span class="token punctuation">)</span>
 <span class="token punctuation">}</span>

 <span class="token comment">// Compute a re-org-stable address.</span>
 <span class="token comment">// This address exists for use by messages coming from outside the system, in order to</span>
 <span class="token comment">// stably address the newly created actor even if a chain re-org causes it to end up with</span>
 <span class="token comment">// a different ID.</span>
 uniqueAddress <span class="token operator">:=</span> rt<span class="token punctuation">.</span><span class="token function">NewActorAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

 <span class="token comment">// Allocate an ID for this actor.</span>
 <span class="token comment">// Store mapping of pubkey or actor address to actor ID</span>
 <span class="token keyword">var</span> st State
 <span class="token keyword">var</span> idAddr addr<span class="token punctuation">.</span>Address
 rt<span class="token punctuation">.</span><span class="token function">StateTransaction</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>st<span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> err <span class="token builtin">error</span>
  idAddr<span class="token punctuation">,</span> err <span class="token operator">=</span> st<span class="token punctuation">.</span><span class="token function">MapAddressToNewID</span><span class="token punctuation">(</span>adt<span class="token punctuation">.</span><span class="token function">AsStore</span><span class="token punctuation">(</span>rt<span class="token punctuation">)</span><span class="token punctuation">,</span> uniqueAddress<span class="token punctuation">)</span>
  builtin<span class="token punctuation">.</span><span class="token function">RequireNoErr</span><span class="token punctuation">(</span>rt<span class="token punctuation">,</span> err<span class="token punctuation">,</span> exitcode<span class="token punctuation">.</span>ErrIllegalState<span class="token punctuation">,</span> <span class="token string">&quot;failed to allocate ID address&quot;</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span>

 <span class="token comment">// Create an empty actor.</span>
 rt<span class="token punctuation">.</span><span class="token function">CreateActor</span><span class="token punctuation">(</span>params<span class="token punctuation">.</span>CodeCID<span class="token punctuation">,</span> idAddr<span class="token punctuation">)</span>

 <span class="token comment">// Invoke constructor.</span>
 code <span class="token operator">:=</span> rt<span class="token punctuation">.</span><span class="token function">Send</span><span class="token punctuation">(</span>idAddr<span class="token punctuation">,</span> builtin<span class="token punctuation">.</span>MethodConstructor<span class="token punctuation">,</span> builtin<span class="token punctuation">.</span><span class="token function">CBORBytes</span><span class="token punctuation">(</span>params<span class="token punctuation">.</span>ConstructorParams<span class="token punctuation">)</span><span class="token punctuation">,</span> rt<span class="token punctuation">.</span><span class="token function">ValueReceived</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>builtin<span class="token punctuation">.</span>Discard<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
 builtin<span class="token punctuation">.</span><span class="token function">RequireSuccess</span><span class="token punctuation">(</span>rt<span class="token punctuation">,</span> code<span class="token punctuation">,</span> <span class="token string">&quot;constructor failed&quot;</span><span class="token punctuation">)</span>

 <span class="token keyword">return</span> <span class="token operator">&amp;</span>ExecReturn<span class="token punctuation">{</span>IDAddress<span class="token punctuation">:</span> idAddr<span class="token punctuation">,</span> RobustAddress<span class="token punctuation">:</span> uniqueAddress<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">canExec</span><span class="token punctuation">(</span>callerCodeID cid<span class="token punctuation">.</span>Cid<span class="token punctuation">,</span> execCodeID cid<span class="token punctuation">.</span>Cid<span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span>
 <span class="token keyword">switch</span> execCodeID <span class="token punctuation">{</span>
 <span class="token keyword">case</span> builtin<span class="token punctuation">.</span>StorageMinerActorCodeID<span class="token punctuation">:</span>
  <span class="token keyword">if</span> callerCodeID <span class="token operator">==</span> builtin<span class="token punctuation">.</span>StoragePowerActorCodeID <span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token boolean">false</span>
 <span class="token keyword">case</span> builtin<span class="token punctuation">.</span>PaymentChannelActorCodeID<span class="token punctuation">,</span> builtin<span class="token punctuation">.</span>MultisigActorCodeID<span class="token punctuation">:</span>
  <span class="token keyword">return</span> <span class="token boolean">true</span>
 <span class="token keyword">default</span><span class="token punctuation">:</span>
  <span class="token keyword">return</span> <span class="token boolean">false</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-3-6-3å¥–åŠ±æ¼”å‘˜" tabindex="-1"><a class="header-anchor" href="#_2-3-6-3å¥–åŠ±æ¼”å‘˜" aria-hidden="true">#</a> 2.3.6.3<a href="https://spec.filecoin.io/#section-systems.filecoin_vm.sysactors.rewardactor" target="_blank" rel="noopener noreferrer">å¥–åŠ±æ¼”å‘˜<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><p>çš„<code>RewardActor</code>å°±æ˜¯unminted Filecoinä»¤ç‰Œå°†è¢«ä¿ç•™ã€‚æ¼”å‘˜ç›´æ¥å°†å¥–åŠ±åˆ†é…ç»™çŸ¿å·¥æ¼”å‘˜ï¼Œä»–ä»¬è¢«é”å®šä»¥å½’å±ã€‚å½“å‰çºªå…ƒçš„å¥–åŠ±å€¼åœ¨çºªå…ƒæœ«é€šè¿‡cron tickæ›´æ–°ã€‚</p><p><a href="https://spec.filecoin.io/#example-" target="_blank" rel="noopener noreferrer">ä¾‹ï¼š<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">package</span> reward

<span class="token keyword">import</span> <span class="token punctuation">(</span>
 <span class="token string">&quot;github.com/filecoin-project/go-state-types/abi&quot;</span>
 <span class="token string">&quot;github.com/filecoin-project/go-state-types/big&quot;</span>
 <span class="token string">&quot;github.com/filecoin-project/go-state-types/cbor&quot;</span>
 <span class="token string">&quot;github.com/filecoin-project/go-state-types/exitcode&quot;</span>
 rtt <span class="token string">&quot;github.com/filecoin-project/go-state-types/rt&quot;</span>
 reward0 <span class="token string">&quot;github.com/filecoin-project/specs-actors/actors/builtin/reward&quot;</span>
 <span class="token string">&quot;github.com/ipfs/go-cid&quot;</span>

 <span class="token string">&quot;github.com/filecoin-project/specs-actors/v2/actors/builtin&quot;</span>
 <span class="token string">&quot;github.com/filecoin-project/specs-actors/v2/actors/runtime&quot;</span>
 <span class="token punctuation">.</span> <span class="token string">&quot;github.com/filecoin-project/specs-actors/v2/actors/util&quot;</span>
 <span class="token string">&quot;github.com/filecoin-project/specs-actors/v2/actors/util/smoothing&quot;</span>
<span class="token punctuation">)</span>

<span class="token comment">// PenaltyMultiplier is the factor miner penaltys are scaled up by</span>
<span class="token keyword">const</span> PenaltyMultiplier <span class="token operator">=</span> <span class="token number">3</span>

<span class="token keyword">type</span> Actor <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>a Actor<span class="token punctuation">)</span> <span class="token function">Exports</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">{</span>
 <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span>
  builtin<span class="token punctuation">.</span>MethodConstructor<span class="token punctuation">:</span> a<span class="token punctuation">.</span>Constructor<span class="token punctuation">,</span>
  <span class="token number">2</span><span class="token punctuation">:</span>                         a<span class="token punctuation">.</span>AwardBlockReward<span class="token punctuation">,</span>
  <span class="token number">3</span><span class="token punctuation">:</span>                         a<span class="token punctuation">.</span>ThisEpochReward<span class="token punctuation">,</span>
  <span class="token number">4</span><span class="token punctuation">:</span>                         a<span class="token punctuation">.</span>UpdateNetworkKPI<span class="token punctuation">,</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>a Actor<span class="token punctuation">)</span> <span class="token function">Code</span><span class="token punctuation">(</span><span class="token punctuation">)</span> cid<span class="token punctuation">.</span>Cid <span class="token punctuation">{</span>
 <span class="token keyword">return</span> builtin<span class="token punctuation">.</span>RewardActorCodeID
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>a Actor<span class="token punctuation">)</span> <span class="token function">IsSingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span>
 <span class="token keyword">return</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>a Actor<span class="token punctuation">)</span> <span class="token function">State</span><span class="token punctuation">(</span><span class="token punctuation">)</span> cbor<span class="token punctuation">.</span>Er <span class="token punctuation">{</span>
 <span class="token keyword">return</span> <span class="token function">new</span><span class="token punctuation">(</span>State<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> <span class="token boolean">_</span> runtime<span class="token punctuation">.</span>VMActor <span class="token operator">=</span> Actor<span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>a Actor<span class="token punctuation">)</span> <span class="token function">Constructor</span><span class="token punctuation">(</span>rt runtime<span class="token punctuation">.</span>Runtime<span class="token punctuation">,</span> currRealizedPower <span class="token operator">*</span>abi<span class="token punctuation">.</span>StoragePower<span class="token punctuation">)</span> <span class="token operator">*</span>abi<span class="token punctuation">.</span>EmptyValue <span class="token punctuation">{</span>
 rt<span class="token punctuation">.</span><span class="token function">ValidateImmediateCallerIs</span><span class="token punctuation">(</span>builtin<span class="token punctuation">.</span>SystemActorAddr<span class="token punctuation">)</span>

 <span class="token keyword">if</span> currRealizedPower <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  rt<span class="token punctuation">.</span><span class="token function">Abortf</span><span class="token punctuation">(</span>exitcode<span class="token punctuation">.</span>ErrIllegalArgument<span class="token punctuation">,</span> <span class="token string">&quot;argument should not be nil&quot;</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token boolean">nil</span> <span class="token comment">// linter does not understand abort exiting</span>
 <span class="token punctuation">}</span>
 st <span class="token operator">:=</span> <span class="token function">ConstructState</span><span class="token punctuation">(</span><span class="token operator">*</span>currRealizedPower<span class="token punctuation">)</span>
 rt<span class="token punctuation">.</span><span class="token function">StateCreate</span><span class="token punctuation">(</span>st<span class="token punctuation">)</span>
 <span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token comment">//type AwardBlockRewardParams struct {</span>
<span class="token comment">// Miner     address.Address</span>
<span class="token comment">// Penalty   abi.TokenAmount // penalty for including bad messages in a block, &gt;= 0</span>
<span class="token comment">// GasReward abi.TokenAmount // gas reward from all gas fees in a block, &gt;= 0</span>
<span class="token comment">// WinCount  int64           // number of reward units won, &gt; 0</span>
<span class="token comment">//}</span>
<span class="token keyword">type</span> AwardBlockRewardParams <span class="token operator">=</span> reward0<span class="token punctuation">.</span>AwardBlockRewardParams

<span class="token comment">// Awards a reward to a block producer.</span>
<span class="token comment">// This method is called only by the system actor, implicitly, as the last message in the evaluation of a block.</span>
<span class="token comment">// The system actor thus computes the parameters and attached value.</span>
<span class="token comment">//</span>
<span class="token comment">// The reward includes two components:</span>
<span class="token comment">// - the epoch block reward, computed and paid from the reward actor&#39;s balance,</span>
<span class="token comment">// - the block gas reward, expected to be transferred to the reward actor with this invocation.</span>
<span class="token comment">//</span>
<span class="token comment">// The reward is reduced before the residual is credited to the block producer, by:</span>
<span class="token comment">// - a penalty amount, provided as a parameter, which is burnt,</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>a Actor<span class="token punctuation">)</span> <span class="token function">AwardBlockReward</span><span class="token punctuation">(</span>rt runtime<span class="token punctuation">.</span>Runtime<span class="token punctuation">,</span> params <span class="token operator">*</span>AwardBlockRewardParams<span class="token punctuation">)</span> <span class="token operator">*</span>abi<span class="token punctuation">.</span>EmptyValue <span class="token punctuation">{</span>
 rt<span class="token punctuation">.</span><span class="token function">ValidateImmediateCallerIs</span><span class="token punctuation">(</span>builtin<span class="token punctuation">.</span>SystemActorAddr<span class="token punctuation">)</span>
 priorBalance <span class="token operator">:=</span> rt<span class="token punctuation">.</span><span class="token function">CurrentBalance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
 <span class="token keyword">if</span> params<span class="token punctuation">.</span>Penalty<span class="token punctuation">.</span><span class="token function">LessThan</span><span class="token punctuation">(</span>big<span class="token punctuation">.</span><span class="token function">Zero</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  rt<span class="token punctuation">.</span><span class="token function">Abortf</span><span class="token punctuation">(</span>exitcode<span class="token punctuation">.</span>ErrIllegalArgument<span class="token punctuation">,</span> <span class="token string">&quot;negative penalty %v&quot;</span><span class="token punctuation">,</span> params<span class="token punctuation">.</span>Penalty<span class="token punctuation">)</span>
 <span class="token punctuation">}</span>
 <span class="token keyword">if</span> params<span class="token punctuation">.</span>GasReward<span class="token punctuation">.</span><span class="token function">LessThan</span><span class="token punctuation">(</span>big<span class="token punctuation">.</span><span class="token function">Zero</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  rt<span class="token punctuation">.</span><span class="token function">Abortf</span><span class="token punctuation">(</span>exitcode<span class="token punctuation">.</span>ErrIllegalArgument<span class="token punctuation">,</span> <span class="token string">&quot;negative gas reward %v&quot;</span><span class="token punctuation">,</span> params<span class="token punctuation">.</span>GasReward<span class="token punctuation">)</span>
 <span class="token punctuation">}</span>
 <span class="token keyword">if</span> priorBalance<span class="token punctuation">.</span><span class="token function">LessThan</span><span class="token punctuation">(</span>params<span class="token punctuation">.</span>GasReward<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  rt<span class="token punctuation">.</span><span class="token function">Abortf</span><span class="token punctuation">(</span>exitcode<span class="token punctuation">.</span>ErrIllegalState<span class="token punctuation">,</span> <span class="token string">&quot;actor current balance %v insufficient to pay gas reward %v&quot;</span><span class="token punctuation">,</span>
   priorBalance<span class="token punctuation">,</span> params<span class="token punctuation">.</span>GasReward<span class="token punctuation">)</span>
 <span class="token punctuation">}</span>
 <span class="token keyword">if</span> params<span class="token punctuation">.</span>WinCount <span class="token operator">&lt;=</span> <span class="token number">0</span> <span class="token punctuation">{</span>
  rt<span class="token punctuation">.</span><span class="token function">Abortf</span><span class="token punctuation">(</span>exitcode<span class="token punctuation">.</span>ErrIllegalArgument<span class="token punctuation">,</span> <span class="token string">&quot;invalid win count %d&quot;</span><span class="token punctuation">,</span> params<span class="token punctuation">.</span>WinCount<span class="token punctuation">)</span>
 <span class="token punctuation">}</span>

 minerAddr<span class="token punctuation">,</span> ok <span class="token operator">:=</span> rt<span class="token punctuation">.</span><span class="token function">ResolveAddress</span><span class="token punctuation">(</span>params<span class="token punctuation">.</span>Miner<span class="token punctuation">)</span>
 <span class="token keyword">if</span> <span class="token operator">!</span>ok <span class="token punctuation">{</span>
  rt<span class="token punctuation">.</span><span class="token function">Abortf</span><span class="token punctuation">(</span>exitcode<span class="token punctuation">.</span>ErrNotFound<span class="token punctuation">,</span> <span class="token string">&quot;failed to resolve given owner address&quot;</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span>
 <span class="token comment">// The miner penalty is scaled up by a factor of PenaltyMultiplier</span>
 penalty <span class="token operator">:=</span> big<span class="token punctuation">.</span><span class="token function">Mul</span><span class="token punctuation">(</span>big<span class="token punctuation">.</span><span class="token function">NewInt</span><span class="token punctuation">(</span>PenaltyMultiplier<span class="token punctuation">)</span><span class="token punctuation">,</span> params<span class="token punctuation">.</span>Penalty<span class="token punctuation">)</span>
 totalReward <span class="token operator">:=</span> big<span class="token punctuation">.</span><span class="token function">Zero</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
 <span class="token keyword">var</span> st State
 rt<span class="token punctuation">.</span><span class="token function">StateTransaction</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>st<span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  blockReward <span class="token operator">:=</span> big<span class="token punctuation">.</span><span class="token function">Mul</span><span class="token punctuation">(</span>st<span class="token punctuation">.</span>ThisEpochReward<span class="token punctuation">,</span> big<span class="token punctuation">.</span><span class="token function">NewInt</span><span class="token punctuation">(</span>params<span class="token punctuation">.</span>WinCount<span class="token punctuation">)</span><span class="token punctuation">)</span>
  blockReward <span class="token operator">=</span> big<span class="token punctuation">.</span><span class="token function">Div</span><span class="token punctuation">(</span>blockReward<span class="token punctuation">,</span> big<span class="token punctuation">.</span><span class="token function">NewInt</span><span class="token punctuation">(</span>builtin<span class="token punctuation">.</span>ExpectedLeadersPerEpoch<span class="token punctuation">)</span><span class="token punctuation">)</span>
  totalReward <span class="token operator">=</span> big<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>blockReward<span class="token punctuation">,</span> params<span class="token punctuation">.</span>GasReward<span class="token punctuation">)</span>
  currBalance <span class="token operator">:=</span> rt<span class="token punctuation">.</span><span class="token function">CurrentBalance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> totalReward<span class="token punctuation">.</span><span class="token function">GreaterThan</span><span class="token punctuation">(</span>currBalance<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   rt<span class="token punctuation">.</span><span class="token function">Log</span><span class="token punctuation">(</span>rtt<span class="token punctuation">.</span>WARN<span class="token punctuation">,</span> <span class="token string">&quot;reward actor balance %d below totalReward expected %d, paying out rest of balance&quot;</span><span class="token punctuation">,</span> currBalance<span class="token punctuation">,</span> totalReward<span class="token punctuation">)</span>
   totalReward <span class="token operator">=</span> currBalance

   blockReward <span class="token operator">=</span> big<span class="token punctuation">.</span><span class="token function">Sub</span><span class="token punctuation">(</span>totalReward<span class="token punctuation">,</span> params<span class="token punctuation">.</span>GasReward<span class="token punctuation">)</span>
   <span class="token comment">// Since we have already asserted the balance is greater than gas reward blockReward is &gt;= 0</span>
   <span class="token function">AssertMsg</span><span class="token punctuation">(</span>blockReward<span class="token punctuation">.</span><span class="token function">GreaterThanEqual</span><span class="token punctuation">(</span>big<span class="token punctuation">.</span><span class="token function">Zero</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;programming error, block reward is %v below zero&quot;</span><span class="token punctuation">,</span> blockReward<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  st<span class="token punctuation">.</span>TotalStoragePowerReward <span class="token operator">=</span> big<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>st<span class="token punctuation">.</span>TotalStoragePowerReward<span class="token punctuation">,</span> blockReward<span class="token punctuation">)</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span>

 <span class="token function">AssertMsg</span><span class="token punctuation">(</span>totalReward<span class="token punctuation">.</span><span class="token function">LessThanEqual</span><span class="token punctuation">(</span>priorBalance<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;reward %v exceeds balance %v&quot;</span><span class="token punctuation">,</span> totalReward<span class="token punctuation">,</span> priorBalance<span class="token punctuation">)</span>

 <span class="token comment">// if this fails, we can assume the miner is responsible and avoid failing here.</span>
 rewardParams <span class="token operator">:=</span> builtin<span class="token punctuation">.</span>ApplyRewardParams<span class="token punctuation">{</span>
  Reward<span class="token punctuation">:</span>  totalReward<span class="token punctuation">,</span>
  Penalty<span class="token punctuation">:</span> penalty<span class="token punctuation">,</span>
 <span class="token punctuation">}</span>
 code <span class="token operator">:=</span> rt<span class="token punctuation">.</span><span class="token function">Send</span><span class="token punctuation">(</span>minerAddr<span class="token punctuation">,</span> builtin<span class="token punctuation">.</span>MethodsMiner<span class="token punctuation">.</span>ApplyRewards<span class="token punctuation">,</span> <span class="token operator">&amp;</span>rewardParams<span class="token punctuation">,</span> totalReward<span class="token punctuation">,</span> <span class="token operator">&amp;</span>builtin<span class="token punctuation">.</span>Discard<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
 <span class="token keyword">if</span> <span class="token operator">!</span>code<span class="token punctuation">.</span><span class="token function">IsSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  rt<span class="token punctuation">.</span><span class="token function">Log</span><span class="token punctuation">(</span>rtt<span class="token punctuation">.</span>ERROR<span class="token punctuation">,</span> <span class="token string">&quot;failed to send ApplyRewards call to the miner actor with funds: %v, code: %v&quot;</span><span class="token punctuation">,</span> totalReward<span class="token punctuation">,</span> code<span class="token punctuation">)</span>
  code <span class="token operator">:=</span> rt<span class="token punctuation">.</span><span class="token function">Send</span><span class="token punctuation">(</span>builtin<span class="token punctuation">.</span>BurntFundsActorAddr<span class="token punctuation">,</span> builtin<span class="token punctuation">.</span>MethodSend<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> totalReward<span class="token punctuation">,</span> <span class="token operator">&amp;</span>builtin<span class="token punctuation">.</span>Discard<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token operator">!</span>code<span class="token punctuation">.</span><span class="token function">IsSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   rt<span class="token punctuation">.</span><span class="token function">Log</span><span class="token punctuation">(</span>rtt<span class="token punctuation">.</span>ERROR<span class="token punctuation">,</span> <span class="token string">&quot;failed to send unsent reward to the burnt funds actor, code: %v&quot;</span><span class="token punctuation">,</span> code<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>

 <span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token comment">// Changed since v0:</span>
<span class="token comment">// - removed ThisEpochReward (unsmoothed)</span>
<span class="token keyword">type</span> ThisEpochRewardReturn <span class="token keyword">struct</span> <span class="token punctuation">{</span>
 ThisEpochRewardSmoothed smoothing<span class="token punctuation">.</span>FilterEstimate
 ThisEpochBaselinePower  abi<span class="token punctuation">.</span>StoragePower
<span class="token punctuation">}</span>

<span class="token comment">// The award value used for the current epoch, updated at the end of an epoch</span>
<span class="token comment">// through cron tick.  In the case previous epochs were null blocks this</span>
<span class="token comment">// is the reward value as calculated at the last non-null epoch.</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>a Actor<span class="token punctuation">)</span> <span class="token function">ThisEpochReward</span><span class="token punctuation">(</span>rt runtime<span class="token punctuation">.</span>Runtime<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">*</span>abi<span class="token punctuation">.</span>EmptyValue<span class="token punctuation">)</span> <span class="token operator">*</span>ThisEpochRewardReturn <span class="token punctuation">{</span>
 rt<span class="token punctuation">.</span><span class="token function">ValidateImmediateCallerAcceptAny</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

 <span class="token keyword">var</span> st State
 rt<span class="token punctuation">.</span><span class="token function">StateReadonly</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>st<span class="token punctuation">)</span>
 <span class="token keyword">return</span> <span class="token operator">&amp;</span>ThisEpochRewardReturn<span class="token punctuation">{</span>
  ThisEpochRewardSmoothed<span class="token punctuation">:</span> st<span class="token punctuation">.</span>ThisEpochRewardSmoothed<span class="token punctuation">,</span>
  ThisEpochBaselinePower<span class="token punctuation">:</span>  st<span class="token punctuation">.</span>ThisEpochBaselinePower<span class="token punctuation">,</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Called at the end of each epoch by the power actor (in turn by its cron hook).</span>
<span class="token comment">// This is only invoked for non-empty tipsets, but catches up any number of null</span>
<span class="token comment">// epochs to compute the next epoch reward.</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>a Actor<span class="token punctuation">)</span> <span class="token function">UpdateNetworkKPI</span><span class="token punctuation">(</span>rt runtime<span class="token punctuation">.</span>Runtime<span class="token punctuation">,</span> currRealizedPower <span class="token operator">*</span>abi<span class="token punctuation">.</span>StoragePower<span class="token punctuation">)</span> <span class="token operator">*</span>abi<span class="token punctuation">.</span>EmptyValue <span class="token punctuation">{</span>
 rt<span class="token punctuation">.</span><span class="token function">ValidateImmediateCallerIs</span><span class="token punctuation">(</span>builtin<span class="token punctuation">.</span>StoragePowerActorAddr<span class="token punctuation">)</span>
 <span class="token keyword">if</span> currRealizedPower <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  rt<span class="token punctuation">.</span><span class="token function">Abortf</span><span class="token punctuation">(</span>exitcode<span class="token punctuation">.</span>ErrIllegalArgument<span class="token punctuation">,</span> <span class="token string">&quot;arugment should not be nil&quot;</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span>

 <span class="token keyword">var</span> st State
 rt<span class="token punctuation">.</span><span class="token function">StateTransaction</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>st<span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  prev <span class="token operator">:=</span> st<span class="token punctuation">.</span>Epoch
  <span class="token comment">// if there were null runs catch up the computation until</span>
  <span class="token comment">// st.Epoch == rt.CurrEpoch()</span>
  <span class="token keyword">for</span> st<span class="token punctuation">.</span>Epoch <span class="token operator">&lt;</span> rt<span class="token punctuation">.</span><span class="token function">CurrEpoch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">// Update to next epoch to process null rounds</span>
   st<span class="token punctuation">.</span><span class="token function">updateToNextEpoch</span><span class="token punctuation">(</span><span class="token operator">*</span>currRealizedPower<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  st<span class="token punctuation">.</span><span class="token function">updateToNextEpochWithReward</span><span class="token punctuation">(</span><span class="token operator">*</span>currRealizedPower<span class="token punctuation">)</span>
  <span class="token comment">// only update smoothed estimates after updating reward and epoch</span>
  st<span class="token punctuation">.</span><span class="token function">updateSmoothedEstimates</span><span class="token punctuation">(</span>st<span class="token punctuation">.</span>Epoch <span class="token operator">-</span> prev<span class="token punctuation">)</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span>
 <span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-3-6-4accountactor" tabindex="-1"><a class="header-anchor" href="#_2-3-6-4accountactor" aria-hidden="true">#</a> 2.3.6.4<a href="https://spec.filecoin.io/#section-systems.filecoin_vm.sysactors.accountactor" target="_blank" rel="noopener noreferrer">AccountActor<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><p>è¯¥<code>AccountActor</code>è´Ÿè´£ç”¨æˆ·å¸æˆ·ã€‚å¸æˆ·å‚ä¸è€…ä¸æ˜¯ç”±åˆ›å»ºçš„<code>InitActor</code>ï¼Œä½†ç³»ç»Ÿä¼šè°ƒç”¨å…¶æ„é€ å‡½æ•°ã€‚é€šè¿‡å‘å…¬å…±å¯†é’¥æ ·å¼çš„åœ°å€å‘é€æ¶ˆæ¯æ¥åˆ›å»ºå¸æˆ·å‚ä¸è€…ã€‚åœ°å€å¿…é¡»ä¸º<code>BLS</code>æˆ–<code>SECP</code>ï¼Œå¦åˆ™åº”è¯¥å­˜åœ¨é€€å‡ºé”™è¯¯ã€‚å¸æˆ·å‚ä¸è€…æ­£åœ¨ä½¿ç”¨æ–°çš„å‚ä¸è€…åœ°å€æ›´æ–°çŠ¶æ€æ ‘ã€‚</p><p><a href="https://spec.filecoin.io/#example-" target="_blank" rel="noopener noreferrer">ä¾‹ï¼š<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">package</span> account

<span class="token keyword">import</span> <span class="token punctuation">(</span>
 addr <span class="token string">&quot;github.com/filecoin-project/go-address&quot;</span>
 <span class="token string">&quot;github.com/filecoin-project/go-state-types/abi&quot;</span>
 <span class="token string">&quot;github.com/filecoin-project/go-state-types/cbor&quot;</span>
 <span class="token string">&quot;github.com/filecoin-project/go-state-types/exitcode&quot;</span>
 <span class="token string">&quot;github.com/ipfs/go-cid&quot;</span>

 <span class="token string">&quot;github.com/filecoin-project/specs-actors/v2/actors/builtin&quot;</span>
 <span class="token string">&quot;github.com/filecoin-project/specs-actors/v2/actors/runtime&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> Actor <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>a Actor<span class="token punctuation">)</span> <span class="token function">Exports</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">{</span>
 <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span>
  <span class="token number">1</span><span class="token punctuation">:</span> a<span class="token punctuation">.</span>Constructor<span class="token punctuation">,</span>
  <span class="token number">2</span><span class="token punctuation">:</span> a<span class="token punctuation">.</span>PubkeyAddress<span class="token punctuation">,</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>a Actor<span class="token punctuation">)</span> <span class="token function">Code</span><span class="token punctuation">(</span><span class="token punctuation">)</span> cid<span class="token punctuation">.</span>Cid <span class="token punctuation">{</span>
 <span class="token keyword">return</span> builtin<span class="token punctuation">.</span>AccountActorCodeID
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>a Actor<span class="token punctuation">)</span> <span class="token function">State</span><span class="token punctuation">(</span><span class="token punctuation">)</span> cbor<span class="token punctuation">.</span>Er <span class="token punctuation">{</span>
 <span class="token keyword">return</span> <span class="token function">new</span><span class="token punctuation">(</span>State<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> <span class="token boolean">_</span> runtime<span class="token punctuation">.</span>VMActor <span class="token operator">=</span> Actor<span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">type</span> State <span class="token keyword">struct</span> <span class="token punctuation">{</span>
 Address addr<span class="token punctuation">.</span>Address
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>a Actor<span class="token punctuation">)</span> <span class="token function">Constructor</span><span class="token punctuation">(</span>rt runtime<span class="token punctuation">.</span>Runtime<span class="token punctuation">,</span> address <span class="token operator">*</span>addr<span class="token punctuation">.</span>Address<span class="token punctuation">)</span> <span class="token operator">*</span>abi<span class="token punctuation">.</span>EmptyValue <span class="token punctuation">{</span>
 <span class="token comment">// Account actors are created implicitly by sending a message to a pubkey-style address.</span>
 <span class="token comment">// This constructor is not invoked by the InitActor, but by the system.</span>
 rt<span class="token punctuation">.</span><span class="token function">ValidateImmediateCallerIs</span><span class="token punctuation">(</span>builtin<span class="token punctuation">.</span>SystemActorAddr<span class="token punctuation">)</span>
 <span class="token keyword">switch</span> address<span class="token punctuation">.</span><span class="token function">Protocol</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword">case</span> addr<span class="token punctuation">.</span>SECP256K1<span class="token punctuation">:</span>
 <span class="token keyword">case</span> addr<span class="token punctuation">.</span>BLS<span class="token punctuation">:</span>
  <span class="token keyword">break</span> <span class="token comment">// ok</span>
 <span class="token keyword">default</span><span class="token punctuation">:</span>
  rt<span class="token punctuation">.</span><span class="token function">Abortf</span><span class="token punctuation">(</span>exitcode<span class="token punctuation">.</span>ErrIllegalArgument<span class="token punctuation">,</span> <span class="token string">&quot;address must use BLS or SECP protocol, got %v&quot;</span><span class="token punctuation">,</span> address<span class="token punctuation">.</span><span class="token function">Protocol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span>
 st <span class="token operator">:=</span> State<span class="token punctuation">{</span>Address<span class="token punctuation">:</span> <span class="token operator">*</span>address<span class="token punctuation">}</span>
 rt<span class="token punctuation">.</span><span class="token function">StateCreate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>st<span class="token punctuation">)</span>
 <span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token comment">// Fetches the pubkey-type address from this actor.</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>a Actor<span class="token punctuation">)</span> <span class="token function">PubkeyAddress</span><span class="token punctuation">(</span>rt runtime<span class="token punctuation">.</span>Runtime<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">*</span>abi<span class="token punctuation">.</span>EmptyValue<span class="token punctuation">)</span> <span class="token operator">*</span>addr<span class="token punctuation">.</span>Address <span class="token punctuation">{</span>
 rt<span class="token punctuation">.</span><span class="token function">ValidateImmediateCallerAcceptAny</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
 <span class="token keyword">var</span> st State
 rt<span class="token punctuation">.</span><span class="token function">StateReadonly</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>st<span class="token punctuation">)</span>
 <span class="token keyword">return</span> <span class="token operator">&amp;</span>st<span class="token punctuation">.</span>Address
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-3-7vmè§£é‡Šå™¨-æ¶ˆæ¯è°ƒç”¨-å¤–éƒ¨vm" tabindex="-1"><a class="header-anchor" href="#_2-3-7vmè§£é‡Šå™¨-æ¶ˆæ¯è°ƒç”¨-å¤–éƒ¨vm" aria-hidden="true">#</a> 2.3.7<a href="https://spec.filecoin.io/#section-systems.filecoin_vm.interpreter" target="_blank" rel="noopener noreferrer">VMè§£é‡Šå™¨-æ¶ˆæ¯è°ƒç”¨ï¼ˆå¤–éƒ¨VMï¼‰<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h3><p>VMè§£é‡Šå™¨æ ¹æ®æç¤ºé›†åœ¨å…¶çˆ¶çŠ¶æ€ä¸Šçš„æç¤ºé›†åè°ƒæ¶ˆæ¯çš„æ‰§è¡Œï¼Œä»è€Œäº§ç”Ÿæ–°çŠ¶æ€å’Œä¸€ç³»åˆ—æ¶ˆæ¯å›æ‰§ã€‚æ­¤æ–°çŠ¶æ€çš„CIDå’Œæ”¶æ®é›†åˆçš„CIDåŒ…å«åœ¨åç»­çºªå…ƒçš„å—ä¸­ï¼Œè¿™äº›çºªå…ƒå¿…é¡»åŒæ„è¿™äº›CIDæ‰èƒ½å½¢æˆæ–°çš„æç¤ºé›†ã€‚</p><p>æ¯ä¸ªçŠ¶æ€æ›´æ”¹éƒ½ç”±æ¶ˆæ¯çš„æ‰§è¡Œæ¥é©±åŠ¨ã€‚æç¤ºé›†ä¸­æ‰€æœ‰å—ä¸­çš„æ¶ˆæ¯å¿…é¡»æ‰§è¡Œæ‰èƒ½äº§ç”Ÿä¸‹ä¸€ä¸ªçŠ¶æ€ã€‚æ¥è‡ªç¬¬ä¸€ä¸ªå—çš„æ‰€æœ‰æ¶ˆæ¯å‡åœ¨æŠ€å·§é›†ä¸­çš„ç¬¬äºŒä¸ªå’Œåç»­å—çš„æ¶ˆæ¯ä¹‹å‰æ‰§è¡Œã€‚å¯¹äºæ¯ä¸ªå—ï¼Œé¦–å…ˆæ‰§è¡ŒBLSèšåˆçš„æ¶ˆæ¯ï¼Œç„¶åæ‰§è¡ŒSECPç­¾åçš„æ¶ˆæ¯ã€‚</p><h4 id="_2-3-7-1éšå¼æ¶ˆæ¯" tabindex="-1"><a class="header-anchor" href="#_2-3-7-1éšå¼æ¶ˆæ¯" aria-hidden="true">#</a> 2.3.7.1<a href="https://spec.filecoin.io/#section-systems.filecoin_vm.interpreter.implicit-messages" target="_blank" rel="noopener noreferrer">éšå¼æ¶ˆæ¯<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><p>é™¤äº†æ˜¾å¼åŒ…å«åœ¨æ¯ä¸ªå—ä¸­çš„æ¶ˆæ¯ä¹‹å¤–ï¼Œéšå«æ¶ˆæ¯è¿˜ä¼šåœ¨æ¯ä¸ªæ—¶æœŸå¯¹çŠ¶æ€è¿›è¡Œä¸€äº›æ›´æ”¹ã€‚éšå¼æ¶ˆæ¯ä¸åœ¨èŠ‚ç‚¹ä¹‹é—´ä¼ è¾“ï¼Œè€Œæ˜¯ç”±è§£é‡Šå™¨åœ¨è¯„ä¼°æ—¶æ„é€ çš„ã€‚</p><p>å¯¹äºæç¤ºé›†ä¸­çš„æ¯ä¸ªå—ï¼Œéšå¼æ¶ˆæ¯ï¼š</p><ul><li>è°ƒç”¨åŒºå—ç”Ÿäº§è€…çš„çŸ¿å·¥æ¼”å‘˜æ¥å¤„ç†ï¼ˆå·²éªŒè¯çš„ï¼‰é€‰ä¸¾PoStæäº¤ï¼Œä½œä¸ºåŒºå—ä¸­çš„ç¬¬ä¸€æ¡æ¶ˆæ¯ï¼›</li><li>è°ƒç”¨å¥–åŠ±å‚ä¸è€…å°†åŒºå—å¥–åŠ±æ”¯ä»˜ç»™çŸ¿å·¥çš„æ‰€æœ‰è€…å¸æˆ·ï¼Œä½œä¸ºåŒºå—ä¸­çš„æœ€ç»ˆæ¶ˆæ¯ï¼›</li></ul><p>å¯¹äºæ¯ä¸ªæç¤ºé›†ï¼Œä¸€ä¸ªéšå¼æ¶ˆæ¯ï¼š</p><ul><li>è°ƒç”¨cron actoræ¥å¤„ç†è‡ªåŠ¨æ”¯ç¥¨å’Œä»˜æ¬¾ï¼Œä½œä¸ºæç¤ºé›†ä¸­çš„æœ€åä¸€æ¡æ¶ˆæ¯ã€‚</li></ul><p>æ‰€æœ‰éšå¼æ¶ˆæ¯çš„æ„é€ <code>From</code>åœ°å€éƒ½æ˜¯æ°å‡ºçš„ç³»ç»Ÿå¸æˆ·å‚ä¸è€…ã€‚ä»–ä»¬å°†æ±½æ²¹ä»·æ ¼æŒ‡å®šä¸ºé›¶ï¼Œä½†å¿…é¡»åŒ…å«åœ¨è®¡ç®—ä¸­ã€‚ä¸ºäº†è®¡ç®—æ–°çŠ¶æ€ï¼Œå®ƒä»¬å¿…é¡»æˆåŠŸï¼ˆé€€å‡ºä»£ç ä¸ºé›¶ï¼‰ã€‚éšå¼é‚®ä»¶çš„æ”¶æ®ä¸åŒ…æ‹¬åœ¨æ”¶æ®åˆ—è¡¨ä¸­ï¼›åªæœ‰æ˜ç¡®çš„æ¶ˆæ¯æ‰æœ‰æ˜ç¡®çš„å›æ‰§ã€‚</p><h4 id="_2-3-7-2ç…¤æ°”è´¹" tabindex="-1"><a class="header-anchor" href="#_2-3-7-2ç…¤æ°”è´¹" aria-hidden="true">#</a> 2.3.7.2<a href="https://spec.filecoin.io/#section-systems.filecoin_vm.interpreter.gas-payments" target="_blank" rel="noopener noreferrer">ç…¤æ°”è´¹<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><p>åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ¶ˆæ¯çš„å‘é€è€…å‘äº§ç”ŸåŒ…å«è¯¥æ¶ˆæ¯çš„å—çš„çŸ¿å·¥æ”¯ä»˜æ‰§è¡Œè¯¥æ¶ˆæ¯æ‰€éœ€çš„æ±½æ²¹è´¹ã€‚</p><p>æ‰§è¡Œè¯¥æ¶ˆæ¯åï¼Œæ¯æ¬¡æ‰§è¡Œè¯¥æ¶ˆæ¯æ‰€äº§ç”Ÿçš„æ±½æ²¹è´¹å°†ç«‹å³æ”¯ä»˜ç»™çŸ¿å·¥æ‰€æœ‰è€…å¸æˆ·ã€‚æ‰€è·å¾—çš„é›†ä½“å¥–åŠ±æˆ–æ±½æ²¹è´¹æ²¡æœ‰ä»»ä½•è´Ÿæ‹…ï¼šä¸¤è€…éƒ½å¯ä»¥ç«‹å³èŠ±è´¹ã€‚</p><h4 id="_2-3-7-3é‚®ä»¶é‡å¤" tabindex="-1"><a class="header-anchor" href="#_2-3-7-3é‚®ä»¶é‡å¤" aria-hidden="true">#</a> 2.3.7.3<a href="https://spec.filecoin.io/#section-systems.filecoin_vm.interpreter.duplicate-messages" target="_blank" rel="noopener noreferrer">é‚®ä»¶é‡å¤<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><p>ç”±äºä¸åŒçš„çŸ¿å·¥åœ¨åŒä¸€æ—¶æœŸäº§ç”ŸåŒºå—ï¼Œå› æ­¤å•ä¸ªæç¤ºé›†ä¸­çš„å¤šä¸ªåŒºå—å¯èƒ½åŒ…å«ç›¸åŒçš„æ¶ˆæ¯ï¼ˆç”±ç›¸åŒçš„CIDæ ‡è¯†ï¼‰ã€‚å‘ç”Ÿè¿™ç§æƒ…å†µæ—¶ï¼Œä»…åœ¨ç¬¬ä¸€æ¬¡æŒ‰æç¤ºé›†çš„è§„èŒƒé¡ºåºé‡åˆ°è¯¥æ¶ˆæ¯æ—¶æ‰å¯¹å…¶è¿›è¡Œå¤„ç†ã€‚æ¶ˆæ¯çš„åç»­å®ä¾‹å°†è¢«å¿½ç•¥ï¼Œä¸ä¼šå¯¼è‡´ä»»ä½•çŠ¶æ€çªå˜ï¼Œäº§ç”Ÿæ”¶æ®æˆ–å‘åŒºå—ç”Ÿäº§è€…æ”¯ä»˜è´¹ç”¨ã€‚</p><p>å› æ­¤ï¼Œæ€»ç»“äº†æç¤ºé›†çš„æ‰§è¡Œé¡ºåºï¼š</p><ul><li>ä¸ºç¬¬ä¸€å—æ”¯ä»˜å¥–åŠ±</li><li>å¤„ç†ç¬¬ä¸€å—çš„é€‰ä¸¾èŒä½</li><li>ç¬¬ä¸€ä¸ªå—çš„æ¶ˆæ¯ï¼ˆSECPä¹‹å‰çš„BLSï¼‰</li><li>æ”¯ä»˜ç¬¬äºŒå—å¥–åŠ±</li><li>å¤„ç†ç¬¬äºŒä¸ªåŒºå—çš„é€‰ä¸¾èŒä½</li><li>ç¬¬äºŒä¸ªå—çš„æ¶ˆæ¯ï¼ˆSECPä¹‹å‰çš„BLSï¼Œè·³è¿‡ä»»ä½•å·²ç»é‡åˆ°çš„æ¶ˆæ¯ï¼‰</li><li><code>[... subsequent blocks ...]</code></li><li>å®šæ—¶åˆ»åº¦</li></ul><h4 id="_2-3-7-4æ¶ˆæ¯æœ‰æ•ˆæ€§å’Œå¤±è´¥" tabindex="-1"><a class="header-anchor" href="#_2-3-7-4æ¶ˆæ¯æœ‰æ•ˆæ€§å’Œå¤±è´¥" aria-hidden="true">#</a> 2.3.7.4<a href="https://spec.filecoin.io/#section-systems.filecoin_vm.interpreter.message-validity-and-failure" target="_blank" rel="noopener noreferrer">æ¶ˆæ¯æœ‰æ•ˆæ€§å’Œå¤±è´¥<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><p>æœ‰æ•ˆå—ä¸­çš„æ¯ä¸ªæ¶ˆæ¯éƒ½å¯ä»¥è¢«å¤„ç†å¹¶äº§ç”Ÿæ”¶æ®ï¼ˆè¯·æ³¨æ„ï¼Œå—æœ‰æ•ˆæ€§è¡¨ç¤ºæ‰€æœ‰æ¶ˆæ¯åœ¨è¯­æ³•ä¸Šå‡æœ‰æ•ˆâ€“è¯·å‚é˜… <a href="https://spec.filecoin.io/#section-systems.filecoin_vm.message.message-syntax-validation" target="_blank" rel="noopener noreferrer">æ¶ˆæ¯è¯­æ³•<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>â€“å¹¶æ­£ç¡®ç­¾åï¼‰ã€‚ä½†æ˜¯ï¼Œæ‰§è¡ŒæˆåŠŸä¸å¦å–å†³äºæ¶ˆæ¯æ‰€åº”ç”¨çš„çŠ¶æ€ã€‚å¦‚æœæ¶ˆæ¯æ‰§è¡Œå¤±è´¥ï¼Œåˆ™ç›¸åº”çš„æ”¶æ®å°†æºå¸¦éé›¶çš„é€€å‡ºä»£ç ã€‚</p><p>å¦‚æœæ¶ˆæ¯ç”±äºå¯ä»¥åˆç†åœ°å½’å› äºçŸ¿å·¥çš„åŸå› è€Œå¤±è´¥ï¼ŒåŒ…æ‹¬åœ¨çˆ¶çŠ¶æ€ä¸­æ°¸è¿œä¸å¯èƒ½æˆåŠŸçš„æ¶ˆæ¯ï¼Œæˆ–è€…ç”±äºå‘ä»¶äººç¼ºä¹èµ„é‡‘æ¥æ”¯ä»˜æœ€å¤§æ¶ˆæ¯æˆæœ¬ï¼Œåˆ™çŸ¿å·¥å°†é€šè¿‡çƒ§é’±æ¥æ”¯ä»˜ç½šæ¬¾ç…¤æ°”è´¹ï¼ˆè€Œä¸æ˜¯å‘é€æ–¹å‘å¤§å®—çŸ¿å·¥æ”¯ä»˜çš„è´¹ç”¨ï¼‰ã€‚</p><p>æ¶ˆæ¯å¤±è´¥å¯¼è‡´çš„å”¯ä¸€çŠ¶æ€æ›´æ”¹æ˜¯ï¼š</p><ul><li>å‘é€æ–¹çš„å¢é‡<code>CallSeqNum</code>ï¼Œå¹¶ä»å‘é€æ–¹å‘åŒ…å«æ¶ˆæ¯çš„åŒºå—çŸ¿ä¸»æ”¯ä»˜æ±½æ²¹è´¹ï¼›è¦ä¹ˆ</li><li>ç½šæ¬¾ç­‰äºå¤±è´¥æ¶ˆæ¯çš„æ±½æ²¹è´¹ï¼Œç”±çŸ¿å·¥çƒ§æ‰ï¼ˆå‘ä»¶äººæœª<code>CallSeqNum</code>æ›´æ”¹ï¼‰ã€‚</li></ul><p>å¦‚æœå¤„äºç´§æ¥çš„å…ˆå‰çŠ¶æ€ï¼Œåˆ™æ¶ˆæ¯æ‰§è¡Œå°†å¤±è´¥ï¼š</p><ul><li>è¯¥<code>From</code>æ¼”å‘˜ä¸å­˜åœ¨äºè¯¥å·ï¼ˆå—åˆ°çŸ¿å·¥å¤„ç½šï¼‰ï¼Œ</li><li>è¯¥<code>From</code>æ¼”å‘˜æ˜¯ä¸æ˜¯å¸å·æ¼”å‘˜ï¼ˆçš„çŸ¿å·¥å¤„ç½šï¼‰ï¼Œ</li><li>è¯¥<code>CallSeqNum</code>æ¶ˆæ¯ä¸åŒ¹é…<code>CallSeqNum</code>çš„çš„<code>From</code>æ¼”å‘˜ï¼ˆçš„çŸ¿å·¥å¤„ç½šï¼‰ï¼Œ</li><li>çš„<code>From</code>æ¼”å‘˜ä¸å…·æœ‰è¶³å¤Ÿçš„å¹³è¡¡ï¼Œä»¥è¦†ç›–æ¶ˆæ¯çš„æ€»å’Œ<code>Value</code>åŠ ä¸Šæœ€å¤§æ°”ä½“æˆæœ¬ï¼Œ<code>GasLimit * GasPrice</code>ï¼ˆçŸ¿å·¥å¤„ç½šï¼‰ï¼Œ</li><li>è¯¥å‚ä¸è€…ä¸åœ¨<code>To</code>çŠ¶æ€ä¸­ï¼Œå¹¶ä¸”è¯¥<code>To</code>åœ°å€ä¸æ˜¯pubkeyæ ·å¼çš„åœ°å€ï¼Œ</li><li>è¯¥<code>To</code>actorå­˜åœ¨ï¼ˆæˆ–ä½œä¸ºå¸æˆ·éšå¼åˆ›å»ºï¼‰ï¼Œä½†æ˜¯æ²¡æœ‰å¯¹åº”äºéé›¶çš„æ–¹æ³•<code>MethodNum</code>ï¼Œ</li><li>ååºåˆ—åŒ–<code>Params</code>ä¸æ˜¯é•¿åº¦åŒ¹é…æ•°ç»„<code>To</code>actorçš„<code>MethodNum</code>æ–¹æ³•çš„æ•°ç»„ï¼Œ</li><li>ååºåˆ—åŒ–<code>Params</code>å¯¹äº<code>To</code>actorçš„<code>MethodNum</code>æ–¹æ³•æŒ‡å®šçš„ç±»å‹æ— æ•ˆï¼Œ</li><li>è¢«è°ƒç”¨çš„æ–¹æ³•æ¶ˆè€—çš„æ°”ä½“å¤šäº<code>GasLimit</code>å…è®¸çš„é‡ï¼Œ</li><li>è°ƒç”¨çš„æ–¹æ³•ä»¥éé›¶ä»£ç ï¼ˆé€šè¿‡<code>Runtime.Abort()</code>ï¼‰é€€å‡ºï¼Œæˆ–è€…</li><li>ç”±äºä¸Šè¿°ä»»ä½•åŸå› ï¼Œæ¥æ”¶æ–¹å‘é€çš„ä»»ä½•å†…éƒ¨æ¶ˆæ¯éƒ½ä¼šå¤±è´¥ã€‚</li></ul><p>è¯·æ³¨æ„ï¼Œå¦‚æœ<code>To</code>å‚ä¸è€…ä¸åœ¨çŠ¶æ€ä¸­å¹¶ä¸”è¯¥åœ°å€æ˜¯æœ‰æ•ˆ<code>H(pubkey)</code>åœ°å€ï¼Œåˆ™å®ƒå°†è¢«åˆ›å»ºä¸ºå¸æˆ·å‚ä¸è€…ã€‚</p><h2 id="_2-4åŒºå—é“¾" tabindex="-1"><a class="header-anchor" href="#_2-4åŒºå—é“¾" aria-hidden="true">#</a> 2.4<a href="https://spec.filecoin.io/#section-systems.filecoin_blockchain" target="_blank" rel="noopener noreferrer">åŒºå—é“¾<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h2><p>FilecoinåŒºå—é“¾æ˜¯ä¸€ç§åˆ†å¸ƒå¼è™šæ‹Ÿæœºï¼Œå¯ä»¥è¾¾æˆå…±è¯†ï¼Œå¤„ç†æ¶ˆæ¯ï¼Œè¿›è¡Œå­˜å‚¨å¸æˆ·å¹¶ç»´æŠ¤Filecoinåè®®ä¸­çš„å®‰å…¨æ€§ã€‚å®ƒæ˜¯é“¾æ¥Filecoinç³»ç»Ÿä¸­å„ç§å‚ä¸è€…çš„ä¸»è¦ç•Œé¢ã€‚</p><p>FilecoinåŒºå—é“¾ç³»ç»ŸåŒ…æ‹¬ï¼š</p><ul><li>ä¸€ä¸ª <a href="https://spec.filecoin.io/#section-systems.filecoin_blockchain.message_pool" target="_blank" rel="noopener noreferrer">æ¶ˆæ¯æ± <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>å­ç³»ç»ŸèŠ‚ç‚¹ä½¿ç”¨è·Ÿè¸ªå’Œæ¶ˆæ¯ä¼ æ’­çŸ¿å·¥å·²ç»å®£å¸ƒä»–ä»¬è¦åœ¨blockchainåŒ…æ‹¬ã€‚</li><li>ç”¨äºè§£é‡Šå’Œæ‰§è¡Œæ¶ˆæ¯ä»¥æ›´æ–°ç³»ç»ŸçŠ¶æ€çš„ <a href="https://spec.filecoin.io/#section-systems.filecoin_vm" target="_blank" rel="noopener noreferrer">è™šæ‹Ÿ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>æœºå­ç³»ç»Ÿã€‚</li><li>ä¸€ <a href="https://spec.filecoin.io/#section-systems.filecoin_vm.state_tree" target="_blank" rel="noopener noreferrer">å›½æ ‘<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ï¼Œå…¶ç®¡ç†çš„åˆ›å»ºå’ŒçŠ¶æ€çš„æ ‘æœ¨ï¼ˆç³»ç»ŸçŠ¶æ€ï¼‰ä»ç»™å®šçš„å­é“¾ç¡®å®šæ€§VMäº§ç”Ÿçš„ç»´æŠ¤å­ç³»ç»Ÿã€‚</li><li>ç”² <a href="https://spec.filecoin.io/#section-systems.filecoin_blockchain.chainsync" target="_blank" rel="noopener noreferrer">é“¾åŒæ­¥ï¼ˆChainSyncï¼‰<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> susbysteméªŒè¯æ¶ˆæ¯å—è¯¥è½¨é“å’Œä¼ æ’­ï¼Œä¿æŒå¥—å€™é€‰é“¾åœ¨å…¶ä¸Šå¯ä»¥çŸ¿å·¥å’ŒçŸ¿ä¸Šçš„ä¼ å…¥å—è¿è¡Œè¯­æ³•éªŒè¯ã€‚</li><li>ä¸€ä¸ª <a href="https://spec.filecoin.io/#section-systems.filecoin_blockchain.storage_power_consensus" target="_blank" rel="noopener noreferrer">å­˜å‚¨åŠŸç‡å…±è¯†<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>å­ç³»ç»Ÿï¼Œè¯¥å­ç³»ç»Ÿè·Ÿè¸ªç»™å®šé“¾çš„å­˜å‚¨çŠ¶æ€ï¼ˆå³ <a href="https://spec.filecoin.io/#section-systems.filecoin_mining.storage_mining" target="_blank" rel="noopener noreferrer">Storage Subystem<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ï¼‰ï¼Œå¹¶å¸®åŠ©åŒºå—é“¾ç³»ç»Ÿé€‰æ‹©è¦æ‰©å±•çš„å­é“¾å¹¶å°†å…¶åŒ…æ‹¬åœ¨å­é“¾ä¸­ã€‚</li></ul><p>åŒºå—é“¾ç³»ç»Ÿè¿˜åŒ…æ‹¬ï¼š</p><ul><li>ä¸€ä¸ª <a href="https://spec.filecoin.io/#section-systems.filecoin_blockchain.struct.chain_manager" target="_blank" rel="noopener noreferrer">é“¾ç»ç†<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ï¼Œå®ƒä¿æŒç»™å®šé“¾çš„çŠ¶æ€ï¼Œæä¾›è®¾æ–½ç­‰blockchainå­ç³»ç»Ÿå°†åœ¨é¡ºåºæŸ¥è¯¢æœ‰å…³æœ€æ–°çš„é“¾è·¯çŠ¶æ€æ¥è¿è¡Œï¼Œå¹¶ç¡®ä¿è¿›å…¥å—çº³å…¥é“¾ä¹‹å‰åœ¨è¯­ä¹‰éªŒè¯ã€‚</li><li>é˜¿ <a href="https://spec.filecoin.io/#section-systems.filecoin_blockchain.struct.block_producer" target="_blank" rel="noopener noreferrer">å—ç”Ÿäº§è€…<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>è¢«ç§°ä¸ºåœ¨ä¸€ä¸ªæˆåŠŸçš„é¢†å¯¼äººé€‰ä¸¾çš„äº‹ä»¶ï¼Œä»¥äº§ç”Ÿä¸€ä¸ªæ–°çš„å—ï¼Œå°†å…¶è½¬å‘åˆ°æ‰€è¿°åŒæ­¥è£…ç½®ä¸ºä¼ æ’­ä¹‹å‰æ‰©å±•å½“å‰æœ€é‡é“¾ã€‚</li></ul><p>ä»é«˜å±‚æ¬¡æ¥çœ‹ï¼ŒFilecoinåŒºå—é“¾é€šè¿‡è¿ç»­å‡ è½®çš„é¢†å¯¼äººé€‰ä¸¾è€Œå¢é•¿ï¼Œåœ¨é€‰ä¸¾ä¸­ï¼Œè®¸å¤šçŸ¿å·¥è¢«é€‰ä¸¾äº§ç”Ÿä¸€ä¸ªåŒºå—ï¼Œå°†å…¶çº³å…¥é“¾ä¸­å°†ä¸ºä»–ä»¬èµ¢å¾—åŒºå—å¥–åŠ±ã€‚Filecoinçš„åŒºå—é“¾ä¾é å­˜å‚¨èƒ½åŠ›è¿è¡Œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒçŸ¿å·¥é€šè¿‡å…¶å…±è¯†ç®—æ³•æ¥ç¡®å®šè¦å¼€é‡‡çš„å­é“¾å–å†³äºè¯¥å­é“¾çš„å­˜å‚¨é‡ã€‚åœ¨é«˜å±‚ï¼Œâ€œ <a href="https://spec.filecoin.io/#section-systems.filecoin_blockchain.storage_power_consensus" target="_blank" rel="noopener noreferrer">å­˜å‚¨åŠŸç‡å…±è¯†â€<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>å­ç³»ç»Ÿç»´æŠ¤ä¸€ä¸ª<em>åŠŸç‡è¡¨</em>ï¼Œè¯¥<em>è¡¨</em>è·Ÿè¸ª<a href="https://spec.filecoin.io/#section-systems.filecoin_mining.storage_mining" target="_blank" rel="noopener noreferrer">å­˜å‚¨çŸ¿å·¥å‚ä¸è€…<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>é€šè¿‡<em>éƒ¨é—¨æ‰¿è¯º</em>å’Œ<em>æ—¶ç©ºè¯æ˜ä¸º</em>ç½‘ç»œè´¡çŒ®çš„å­˜å‚¨é‡ ã€‚</p><h3 id="_2-4-1ç§¯æœ¨" tabindex="-1"><a class="header-anchor" href="#_2-4-1ç§¯æœ¨" aria-hidden="true">#</a> 2.4.1<a href="https://spec.filecoin.io/#section-systems.filecoin_blockchain.struct" target="_blank" rel="noopener noreferrer">ç§¯æœ¨<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h3><p>åŒºå—æ˜¯FilecoinåŒºå—é“¾çš„ä¸»è¦å•å…ƒï¼Œå¤§å¤šæ•°å…¶ä»–åŒºå—é“¾ä¹Ÿæ˜¯å¦‚æ­¤ã€‚é˜»æ­¢æ¶ˆæ¯ä¸æç¤ºé›†ç›´æ¥é“¾æ¥ï¼Œæç¤ºé›†æ˜¯é˜»æ­¢æ¶ˆæ¯çš„ç»„ï¼Œæœ¬èŠ‚ç¨åå°†å¯¹æ­¤è¿›è¡Œè¯¦ç»†ä»‹ç»ã€‚åœ¨ä¸‹æ–‡ä¸­ï¼Œæˆ‘ä»¬è®¨è®ºBlockæ¶ˆæ¯çš„ä¸»è¦ç»“æ„ä»¥åŠFilecoinåŒºå—é“¾ä¸­éªŒè¯Blockæ¶ˆæ¯çš„è¿‡ç¨‹ã€‚</p><h4 id="_2-4-1-1å—" tabindex="-1"><a class="header-anchor" href="#_2-4-1-1å—" aria-hidden="true">#</a> 2.4.1.1<a href="https://spec.filecoin.io/#section-systems.filecoin_blockchain.struct.block" target="_blank" rel="noopener noreferrer">å—<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><p>åŒºå—æ˜¯FilecoinåŒºå—é“¾çš„ä¸»è¦å•å…ƒã€‚</p><p>FilecoinåŒºå—é“¾ä¸­çš„Blockç»“æ„åŒ…æ‹¬ï¼šiï¼‰Block Headerï¼Œiiï¼‰Blockå†…çš„æ¶ˆæ¯åˆ—è¡¨ï¼Œä»¥åŠiiiï¼‰Signedæ¶ˆæ¯ã€‚è¿™åœ¨<code>FullBlock</code>æŠ½è±¡å†…éƒ¨è¡¨ç¤ºã€‚è¯¥æ¶ˆæ¯æŒ‡ç¤ºè¦åº”ç”¨çš„å¿…éœ€çš„ä¸€ç»„æ›´æ”¹ï¼Œä»¥è¾¾åˆ°é“¾çš„ç¡®å®šæ€§çŠ¶æ€ã€‚</p><p>è¯¥å—çš„Lotuså®ç°å…·æœ‰ä»¥ä¸‹å†…å®¹<code>struct</code>ï¼š</p><p><a href="https://spec.filecoin.io/#example-fullblock" target="_blank" rel="noopener noreferrer">ç¤ºä¾‹ï¼šFullBlock<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> FullBlock <span class="token keyword">struct</span> <span class="token punctuation">{</span>
 Header        <span class="token operator">*</span>BlockHeader
 BlsMessages   <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>Message
 SecpkMessages <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>SignedMessage
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p><strong>æ³¨æ„</strong> å—åœ¨åŠŸèƒ½ä¸Šä¸Filecoinåè®®ä¸­çš„å—å¤´ç›¸åŒã€‚è™½ç„¶å—æ ‡é¢˜åŒ…å«æŒ‡å‘å®Œæ•´ç³»ç»ŸçŠ¶æ€ï¼Œæ¶ˆæ¯å’Œæ¶ˆæ¯å›æ‰§çš„Merkleé“¾æ¥ï¼Œä½†å¯ä»¥å°†å—è§†ä¸ºè¯¥ä¿¡æ¯çš„å®Œæ•´é›†åˆï¼ˆä¸ä»…æ˜¯Merkleæ ¹ï¼Œè¿˜åŒ…æ‹¬çŠ¶æ€æ ‘çš„å®Œæ•´æ•°æ®ï¼Œæ¶ˆæ¯æ ‘ï¼Œæ”¶æ®æ ‘ç­‰ï¼‰ã€‚ç”±äºå®Œæ•´å—çš„å¤§å°å¾ˆå¤§ï¼Œå› æ­¤FilecoinåŒºå—é“¾ç”±å—å¤´è€Œä¸æ˜¯å®Œæ•´å—ç»„æˆã€‚æˆ‘ä»¬ç»å¸¸ä½¿ç”¨è¿™äº›æœ¯è¯­ï¼Œ<code>block</code>å¹¶ä¸”<code>block header</code>å¯ä»¥äº’æ¢ä½¿ç”¨ã€‚</p></blockquote><p>A<code>BlockHeader</code>æ˜¯å—çš„è§„èŒƒè¡¨ç¤ºã€‚BlockHeaderåœ¨çŸ¿å·¥èŠ‚ç‚¹ä¹‹é—´ä¼ æ’­ã€‚ä»blockcheaderæ¶ˆæ¯ä¸­ï¼ŒçŸ¿å·¥æ‹¥æœ‰æ‰€æœ‰å¿…éœ€çš„ä¿¡æ¯ï¼Œä»¥åº”ç”¨å…³è”<code>FullBlock</code>çš„çŠ¶æ€å¹¶æ›´æ–°é“¾ã€‚ä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼Œ<code>BlockHeader</code>ä¸‹é¢æ˜¾ç¤ºäº†éœ€è¦åŒ…å«çš„æœ€å°‘ä¿¡æ¯é¡¹é›†ï¼Œå…¶ä¸­åŒ…æ‹¬ï¼šçŸ¿å·¥çš„åœ°å€ï¼Œç¥¨è¯ï¼Œ <a href="https://spec.filecoin.io/#section-algorithms.pos.post" target="_blank" rel="noopener noreferrer">æ—¶ç©ºè¯æ˜<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ï¼Œæ­¤å—æ‰€åœ¨çš„çˆ¶æ¯çš„CIDä»IPLD DAGä»¥åŠæ¶ˆæ¯è‡ªèº«çš„CIDæ¼”å˜è€Œæ¥ã€‚</p><p>å—æ ‡å¤´çš„Lotuså®ç°å…·æœ‰ä»¥ä¸‹<code>struct</code>ï¼š</p><p><a href="https://spec.filecoin.io/#example-blockheader" target="_blank" rel="noopener noreferrer">ç¤ºä¾‹ï¼šBlockHeader<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> BlockHeader <span class="token keyword">struct</span> <span class="token punctuation">{</span>
 Miner address<span class="token punctuation">.</span>Address <span class="token comment">// 0</span>

 Ticket <span class="token operator">*</span>Ticket <span class="token comment">// 1</span>

 ElectionProof <span class="token operator">*</span>ElectionProof <span class="token comment">// 2</span>

 BeaconEntries <span class="token punctuation">[</span><span class="token punctuation">]</span>BeaconEntry <span class="token comment">// 3</span>

 WinPoStProof <span class="token punctuation">[</span><span class="token punctuation">]</span>proof2<span class="token punctuation">.</span>PoStProof <span class="token comment">// 4</span>

 Parents <span class="token punctuation">[</span><span class="token punctuation">]</span>cid<span class="token punctuation">.</span>Cid <span class="token comment">// 5</span>

 ParentWeight BigInt <span class="token comment">// 6</span>

 Height abi<span class="token punctuation">.</span>ChainEpoch <span class="token comment">// 7</span>

 ParentStateRoot cid<span class="token punctuation">.</span>Cid <span class="token comment">// 8</span>

 ParentMessageReceipts cid<span class="token punctuation">.</span>Cid <span class="token comment">// 8</span>

 Messages cid<span class="token punctuation">.</span>Cid <span class="token comment">// 10</span>

 BLSAggregate <span class="token operator">*</span>crypto<span class="token punctuation">.</span>Signature <span class="token comment">// 11</span>

 Timestamp <span class="token builtin">uint64</span> <span class="token comment">// 12</span>

 BlockSig <span class="token operator">*</span>crypto<span class="token punctuation">.</span>Signature <span class="token comment">// 13</span>

 ForkSignaling <span class="token builtin">uint64</span> <span class="token comment">// 14</span>

 <span class="token comment">// ParentBaseFee is the base fee after executing parent tipset</span>
 ParentBaseFee abi<span class="token punctuation">.</span>TokenAmount <span class="token comment">// 15</span>

 <span class="token comment">// internal</span>
 validated <span class="token builtin">bool</span> <span class="token comment">// true if the signature has been validated</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a href="https://spec.filecoin.io/#example-ticket" target="_blank" rel="noopener noreferrer">ç¤ºä¾‹ï¼šç¥¨è¯<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> Ticket <span class="token keyword">struct</span> <span class="token punctuation">{</span>
 VRFProof <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a href="https://spec.filecoin.io/#example-electionproof" target="_blank" rel="noopener noreferrer">ç¤ºä¾‹ï¼šElectionProof<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> ElectionProof <span class="token keyword">struct</span> <span class="token punctuation">{</span>
 WinCount <span class="token builtin">int64</span>
 VRFProof <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a href="https://spec.filecoin.io/#example-beaconentry" target="_blank" rel="noopener noreferrer">ç¤ºä¾‹ï¼šBeaconEntry<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> BeaconEntry <span class="token keyword">struct</span> <span class="token punctuation">{</span>
 Round <span class="token builtin">uint64</span>
 Data  <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¯¥<code>BlockHeader</code>ç»“æ„å¿…é¡»å¼•ç”¨å½“å‰å›åˆçš„TicketWinnerï¼Œä»¥ç¡®ä¿å°†æ­£ç¡®çš„è·èƒœè€…ä¼ é€’ç»™ <a href="https://spec.filecoin.io/#section-systems.filecoin_blockchain.chainsync" target="_blank" rel="noopener noreferrer">ChainSync<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ã€‚</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">IsTicketWinner</span><span class="token punctuation">(</span>vrfTicket <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> mypow BigInt<span class="token punctuation">,</span> totpow BigInt<span class="token punctuation">)</span> <span class="token builtin">bool</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>è¯¥<code>Message</code>ç»“æ„å¿…é¡»åŒ…æ‹¬æºï¼ˆ<code>From</code>ï¼‰å’Œç›®æ ‡ï¼ˆ<code>To</code>ï¼‰åœ°å€ï¼Œa<code>Nonce</code>å’Œ<code>GasPrice</code>ã€‚</p><p>æ¶ˆæ¯çš„Lotuså®ç°å…·æœ‰ä»¥ä¸‹ç»“æ„ï¼š</p><p><a href="https://spec.filecoin.io/#example-message" target="_blank" rel="noopener noreferrer">ç¤ºä¾‹ï¼šæ¶ˆæ¯<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> Message <span class="token keyword">struct</span> <span class="token punctuation">{</span>
 Version <span class="token builtin">uint64</span>

 To   address<span class="token punctuation">.</span>Address
 From address<span class="token punctuation">.</span>Address

 Nonce <span class="token builtin">uint64</span>

 Value abi<span class="token punctuation">.</span>TokenAmount

 GasLimit   <span class="token builtin">int64</span>
 GasFeeCap  abi<span class="token punctuation">.</span>TokenAmount
 GasPremium abi<span class="token punctuation">.</span>TokenAmount

 Method abi<span class="token punctuation">.</span>MethodNum
 Params <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨å°†æ¶ˆæ¯ä¼ é€’åˆ°<a href="https://spec.filecoin.io/#section-systems.filecoin_blockchain.chainsync" target="_blank" rel="noopener noreferrer">é“¾åŒæ­¥é€»è¾‘<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ä¹‹å‰ï¼Œè¿˜å°†å¯¹å…¶è¿›è¡ŒéªŒè¯ ï¼š</p><p><a href="https://spec.filecoin.io/#example-validforblockinclusion" target="_blank" rel="noopener noreferrer">ç¤ºä¾‹ï¼šValidForBlockInclusion<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>m <span class="token operator">*</span>Message<span class="token punctuation">)</span> <span class="token function">ValidForBlockInclusion</span><span class="token punctuation">(</span>minGas <span class="token builtin">int64</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
 <span class="token keyword">if</span> m<span class="token punctuation">.</span>Version <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> xerrors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;&#39;Version&#39; unsupported&quot;</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span>

 <span class="token keyword">if</span> m<span class="token punctuation">.</span>To <span class="token operator">==</span> address<span class="token punctuation">.</span>Undef <span class="token punctuation">{</span>
  <span class="token keyword">return</span> xerrors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;&#39;To&#39; address cannot be empty&quot;</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span>

 <span class="token keyword">if</span> m<span class="token punctuation">.</span>From <span class="token operator">==</span> address<span class="token punctuation">.</span>Undef <span class="token punctuation">{</span>
  <span class="token keyword">return</span> xerrors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;&#39;From&#39; address cannot be empty&quot;</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span>

 <span class="token keyword">if</span> m<span class="token punctuation">.</span>Value<span class="token punctuation">.</span>Int <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> xerrors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;&#39;Value&#39; cannot be nil&quot;</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span>

 <span class="token keyword">if</span> m<span class="token punctuation">.</span>Value<span class="token punctuation">.</span><span class="token function">LessThan</span><span class="token punctuation">(</span>big<span class="token punctuation">.</span><span class="token function">Zero</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> xerrors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;&#39;Value&#39; field cannot be negative&quot;</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span>

 <span class="token keyword">if</span> m<span class="token punctuation">.</span>Value<span class="token punctuation">.</span><span class="token function">GreaterThan</span><span class="token punctuation">(</span>TotalFilecoinInt<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> xerrors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;&#39;Value&#39; field cannot be greater than total filecoin supply&quot;</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span>

 <span class="token keyword">if</span> m<span class="token punctuation">.</span>GasFeeCap<span class="token punctuation">.</span>Int <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> xerrors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;&#39;GasFeeCap&#39; cannot be nil&quot;</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span>

 <span class="token keyword">if</span> m<span class="token punctuation">.</span>GasFeeCap<span class="token punctuation">.</span><span class="token function">LessThan</span><span class="token punctuation">(</span>big<span class="token punctuation">.</span><span class="token function">Zero</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> xerrors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;&#39;GasFeeCap&#39; field cannot be negative&quot;</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span>

 <span class="token keyword">if</span> m<span class="token punctuation">.</span>GasPremium<span class="token punctuation">.</span>Int <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> xerrors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;&#39;GasPremium&#39; cannot be nil&quot;</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span>

 <span class="token keyword">if</span> m<span class="token punctuation">.</span>GasPremium<span class="token punctuation">.</span><span class="token function">LessThan</span><span class="token punctuation">(</span>big<span class="token punctuation">.</span><span class="token function">Zero</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> xerrors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;&#39;GasPremium&#39; field cannot be negative&quot;</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span>

 <span class="token keyword">if</span> m<span class="token punctuation">.</span>GasPremium<span class="token punctuation">.</span><span class="token function">GreaterThan</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>GasFeeCap<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> xerrors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;&#39;GasFeeCap&#39; less than &#39;GasPremium&#39;&quot;</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span>

 <span class="token keyword">if</span> m<span class="token punctuation">.</span>GasLimit <span class="token operator">&gt;</span> build<span class="token punctuation">.</span>BlockGasLimit <span class="token punctuation">{</span>
  <span class="token keyword">return</span> xerrors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;&#39;GasLimit&#39; field cannot be greater than a block&#39;s gas limit&quot;</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span>

 <span class="token comment">// since prices might vary with time, this is technically semantic validation</span>
 <span class="token keyword">if</span> m<span class="token punctuation">.</span>GasLimit <span class="token operator">&lt;</span> minGas <span class="token punctuation">{</span>
  <span class="token keyword">return</span> xerrors<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;&#39;GasLimit&#39; field cannot be less than the cost of storing a message on chain %d &lt; %d&quot;</span><span class="token punctuation">,</span> m<span class="token punctuation">.</span>GasLimit<span class="token punctuation">,</span> minGas<span class="token punctuation">)</span>
 <span class="token punctuation">}</span>

 <span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_2-4-1-1-1å—è¯­æ³•éªŒè¯" tabindex="-1"><a class="header-anchor" href="#_2-4-1-1-1å—è¯­æ³•éªŒè¯" aria-hidden="true">#</a> 2.4.1.1.1<a href="https://spec.filecoin.io/#section-systems.filecoin_blockchain.struct.block.block-syntax-validation" target="_blank" rel="noopener noreferrer">å—è¯­æ³•éªŒè¯<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h5><p>è¯­æ³•éªŒè¯æ˜¯æŒ‡åº”åœ¨<em>ä¸</em>å‚è€ƒå¤–éƒ¨ä¿¡æ¯ï¼ˆä¾‹å¦‚çˆ¶çŠ¶æ€æ ‘ï¼‰çš„<em>æƒ…å†µä¸‹</em>å¯¹å—åŠå…¶æ¶ˆæ¯æ‰§è¡Œçš„éªŒè¯ã€‚è¿™ç§éªŒè¯ç±»å‹æœ‰æ—¶ç§°ä¸º<em>é™æ€éªŒè¯</em>ã€‚</p><p>æ— æ•ˆçš„å—ä¸å¾—ä½œä¸ºçˆ¶å¯¹è±¡ä¼ è¾“æˆ–å¼•ç”¨ã€‚</p><p>è¯­æ³•ä¸Šæœ‰æ•ˆçš„å—å¤´å¿…é¡»è§£ç ä¸ºä¸ä»¥ä¸‹å®šä¹‰åŒ¹é…çš„å­—æ®µï¼Œå¿…é¡»æ˜¯æœ‰æ•ˆçš„CBOR PubSub<code>BlockMsg</code>æ¶ˆæ¯ï¼Œå¹¶ä¸”å¿…é¡»å…·æœ‰ï¼š</p><ul><li><p>åœ¨1å’Œ<code>5*ec.ExpectedLeaders</code> <code>Parents</code>CIDä¹‹é—´ï¼Œå¦‚æœ<code>Epoch</code>å¤§äºé›¶ï¼ˆå¦åˆ™ä¸ºç©º<code>Parents</code>ï¼‰ï¼Œ</p></li><li><p>ä¸€ä¸ªéè´Ÿ<code>ParentWeight</code>ï¼Œ</p></li><li><p>å°‘äºæˆ–ç­‰äº<code>BlockMessageLimit</code>æ¶ˆæ¯æ•°ï¼Œ</p></li><li><p>å°è£…åœ¨<code>MsgMeta</code>ç»“æ„ä¸­çš„èšåˆæ¶ˆæ¯CIDï¼Œåºåˆ—åŒ–ä¸º<code>Messages</code>å—å¤´ä¸­çš„CIDï¼Œ</p></li><li><p>ä¸€ä¸ª<code>Miner</code>æ˜¯IDåœ°å€çš„åœ°å€ã€‚<code>Address</code>å—å¤´ä¸­çš„Mineråº”è¯¥å­˜åœ¨ï¼Œå¹¶ä¸å½“å‰é“¾çŠ¶æ€ä¸‹çš„å…¬å…±å¯†é’¥åœ°å€ç›¸å¯¹åº”ã€‚</p></li><li><p><code>BlockSig</code>å±äºçŸ¿å·¥æ£€ç´¢åˆ°çš„å…¬é’¥åœ°å€çš„å—ç­¾åï¼ˆï¼‰</p></li><li><p>ä¸€ä¸ªéè´Ÿ<code>Epoch</code>ï¼Œ</p></li><li><p>ä¸€ä¸ªç§¯æçš„<code>Timestamp</code>ï¼Œ</p></li><li><p>ä¸€ä¸ª<code>Ticket</code>éç©º<code>VRFResult</code>ï¼Œ</p></li><li><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>ElectionPoStOutput
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>åŒ…å«ï¼š</p><ul><li>ä¸€ä¸ª<code>Candidates</code>ä»‹äº1å’Œ<code>EC.ExpectedLeaders</code>å€¼ä¹‹é—´ï¼ˆå«ï¼‰çš„æ•°ç»„ï¼Œ</li><li>ä¸€ä¸ªéç©º<code>PoStRandomness</code>å­—æ®µï¼Œ</li><li>ä¸€ä¸ªéç©º<code>Proof</code>å­—æ®µï¼Œ</li></ul></li><li><p>ä¸€ä¸ªéç©º<code>ForkSignal</code>å­—æ®µã€‚</p></li></ul><p>å¥æ³•æœ‰æ•ˆçš„å®Œæ•´å—å¿…é¡»å…·æœ‰ï¼š</p><ul><li>æ‰€æœ‰å¼•ç”¨çš„æ¶ˆæ¯åœ¨è¯­æ³•ä¸Šå‡æœ‰æ•ˆï¼Œ</li><li>æ‰€æœ‰å¼•ç”¨çš„çˆ¶æ¯æ”¶æ®åœ¨è¯­æ³•ä¸Šå‡æœ‰æ•ˆï¼Œ</li><li>å—å¤´å’ŒåŒ…å«çš„æ¶ˆæ¯çš„åºåˆ—åŒ–å¤§å°ä¹‹å’Œä¸å¤§äº<code>block.BlockMaxSize</code>ï¼Œ</li><li>æ‰€æœ‰æ˜¾å¼æ¶ˆæ¯çš„æ°”ä½“é™åˆ¶æ€»å’Œä¸å¤§äº<code>block.BlockGasLimit</code>ã€‚</li></ul><p>è¯·æ³¨æ„ï¼Œå—ç­¾åçš„éªŒè¯éœ€è¦ä»çˆ¶æç¤ºé›†çŠ¶æ€è®¿é—®çŸ¿å·¥çš„åœ°å€å’Œå…¬é’¥ï¼Œå› æ­¤ç­¾åéªŒè¯æ˜¯è¯­ä¹‰éªŒè¯çš„ä¸€éƒ¨åˆ†ã€‚åŒæ ·ï¼Œæ¶ˆæ¯ç­¾åéªŒè¯è¦æ±‚æŸ¥æ‰¾ä¸<code>From</code>å¤„äºå—çš„çˆ¶çŠ¶æ€çš„æ¯ä¸ªæ¶ˆæ¯çš„å¸æˆ·æ‰§è¡Œè€…ç›¸å…³è”çš„å…¬é’¥ã€‚</p><h5 id="_2-4-1-1-2é˜»æ­¢è¯­ä¹‰éªŒè¯" tabindex="-1"><a class="header-anchor" href="#_2-4-1-1-2é˜»æ­¢è¯­ä¹‰éªŒè¯" aria-hidden="true">#</a> 2.4.1.1.2<a href="https://spec.filecoin.io/#section-systems.filecoin_blockchain.struct.block.block-semantic-validation" target="_blank" rel="noopener noreferrer">é˜»æ­¢è¯­ä¹‰éªŒè¯<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h5><p>è¯­ä¹‰éªŒè¯æ˜¯æŒ‡éœ€è¦å¼•ç”¨å—å¤´å’Œæ¶ˆæ¯æœ¬èº«ä¹‹å¤–çš„ä¿¡æ¯çš„éªŒè¯ã€‚è¯­ä¹‰éªŒè¯ä¸æ„å»ºå—çš„çˆ¶æç¤ºé›†å’ŒçŠ¶æ€æœ‰å…³ã€‚</p><p>ä¸ºäº†è¿›è¡Œè¯­ä¹‰éªŒè¯ï¼Œ<code>FullBlock</code>å¿…é¡»ä»æ¥æ”¶åˆ°çš„å—å¤´ä¸­æå–å…¶Filecoinæ¶ˆæ¯è¿›è¡Œç»„è£…ã€‚å¯ä»¥ä»ç½‘ç»œä¸­æ£€ç´¢é˜»æ­¢æ¶ˆæ¯CIDï¼Œå¹¶å°†å…¶è§£ç ä¸ºæœ‰æ•ˆçš„CBOR <code>Message</code>/ <code>SignedMessage</code>ã€‚</p><p>åœ¨Lotuså®ç°ä¸­ï¼Œæ¨¡å—çš„è¯­ä¹‰éªŒè¯ç”±<code>Syncer</code>æ¨¡å—æ‰§è¡Œï¼š</p><p><a href="https://spec.filecoin.io/#example-validateblock" target="_blank" rel="noopener noreferrer">ç¤ºä¾‹ï¼šValidateBlock<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>ValidateBlockåº”è¯¥ä¸spec.validation.mdä¸­çš„â€œè¯­ä¹‰éªŒè¯â€åŒ¹é…</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>syncer <span class="token operator">*</span>Syncer<span class="token punctuation">)</span> <span class="token function">ValidateBlock</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> b <span class="token operator">*</span>types<span class="token punctuation">.</span>FullBlock<span class="token punctuation">,</span> useCache <span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword">defer</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// b.Cid() could panic for empty blocks that are used in tests.</span>
  <span class="token keyword">if</span> rerr <span class="token operator">:=</span> <span class="token function">recover</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> rerr <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
   err <span class="token operator">=</span> xerrors<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;validate block panic: %w&quot;</span><span class="token punctuation">,</span> rerr<span class="token punctuation">)</span>
   <span class="token keyword">return</span>
  <span class="token punctuation">}</span>
 <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

 <span class="token keyword">if</span> useCache <span class="token punctuation">{</span>
  isValidated<span class="token punctuation">,</span> err <span class="token operator">:=</span> syncer<span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">IsBlockValidated</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> b<span class="token punctuation">.</span><span class="token function">Cid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> xerrors<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;check block validation cache %s: %w&quot;</span><span class="token punctuation">,</span> b<span class="token punctuation">.</span><span class="token function">Cid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> isValidated <span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token boolean">nil</span>
  <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>

 validationStart <span class="token operator">:=</span> build<span class="token punctuation">.</span>Clock<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
 <span class="token keyword">defer</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  stats<span class="token punctuation">.</span><span class="token function">Record</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> metrics<span class="token punctuation">.</span>BlockValidationDurationMilliseconds<span class="token punctuation">.</span><span class="token function">M</span><span class="token punctuation">(</span>metrics<span class="token punctuation">.</span><span class="token function">SinceInMilliseconds</span><span class="token punctuation">(</span>validationStart<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  log<span class="token punctuation">.</span><span class="token function">Infow</span><span class="token punctuation">(</span><span class="token string">&quot;block validation&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;took&quot;</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span><span class="token function">Since</span><span class="token punctuation">(</span>validationStart<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;height&quot;</span><span class="token punctuation">,</span> b<span class="token punctuation">.</span>Header<span class="token punctuation">.</span>Height<span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span><span class="token function">Since</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Unix</span><span class="token punctuation">(</span><span class="token function">int64</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>Header<span class="token punctuation">.</span>Timestamp<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

 ctx<span class="token punctuation">,</span> span <span class="token operator">:=</span> trace<span class="token punctuation">.</span><span class="token function">StartSpan</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token string">&quot;validateBlock&quot;</span><span class="token punctuation">)</span>
 <span class="token keyword">defer</span> span<span class="token punctuation">.</span><span class="token function">End</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

 <span class="token keyword">if</span> err <span class="token operator">:=</span> <span class="token function">blockSanityChecks</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>Header<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> xerrors<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;incoming header failed basic sanity checks: %w&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
 <span class="token punctuation">}</span>

 h <span class="token operator">:=</span> b<span class="token punctuation">.</span>Header

 baseTs<span class="token punctuation">,</span> err <span class="token operator">:=</span> syncer<span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">LoadTipSet</span><span class="token punctuation">(</span>types<span class="token punctuation">.</span><span class="token function">NewTipSetKey</span><span class="token punctuation">(</span>h<span class="token punctuation">.</span>Parents<span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> xerrors<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;load parent tipset failed (%s): %w&quot;</span><span class="token punctuation">,</span> h<span class="token punctuation">.</span>Parents<span class="token punctuation">,</span> err<span class="token punctuation">)</span>
 <span class="token punctuation">}</span>

 lbts<span class="token punctuation">,</span> lbst<span class="token punctuation">,</span> err <span class="token operator">:=</span> stmgr<span class="token punctuation">.</span><span class="token function">GetLookbackTipSetForRound</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> syncer<span class="token punctuation">.</span>sm<span class="token punctuation">,</span> baseTs<span class="token punctuation">,</span> h<span class="token punctuation">.</span>Height<span class="token punctuation">)</span>
 <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> xerrors<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;failed to get lookback tipset for block: %w&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
 <span class="token punctuation">}</span>

 prevBeacon<span class="token punctuation">,</span> err <span class="token operator">:=</span> syncer<span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">GetLatestBeaconEntry</span><span class="token punctuation">(</span>baseTs<span class="token punctuation">)</span>
 <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> xerrors<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;failed to get latest beacon entry: %w&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
 <span class="token punctuation">}</span>

 <span class="token comment">// fast checks first</span>
 nulls <span class="token operator">:=</span> h<span class="token punctuation">.</span>Height <span class="token operator">-</span> <span class="token punctuation">(</span>baseTs<span class="token punctuation">.</span><span class="token function">Height</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
 <span class="token keyword">if</span> tgtTs <span class="token operator">:=</span> baseTs<span class="token punctuation">.</span><span class="token function">MinTimestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> build<span class="token punctuation">.</span>BlockDelaySecs<span class="token operator">*</span><span class="token function">uint64</span><span class="token punctuation">(</span>nulls<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> h<span class="token punctuation">.</span>Timestamp <span class="token operator">!=</span> tgtTs <span class="token punctuation">{</span>
  <span class="token keyword">return</span> xerrors<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;block has wrong timestamp: %d != %d&quot;</span><span class="token punctuation">,</span> h<span class="token punctuation">.</span>Timestamp<span class="token punctuation">,</span> tgtTs<span class="token punctuation">)</span>
 <span class="token punctuation">}</span>

 now <span class="token operator">:=</span> <span class="token function">uint64</span><span class="token punctuation">(</span>build<span class="token punctuation">.</span>Clock<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Unix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 <span class="token keyword">if</span> h<span class="token punctuation">.</span>Timestamp <span class="token operator">&gt;</span> now<span class="token operator">+</span>build<span class="token punctuation">.</span>AllowableClockDriftSecs <span class="token punctuation">{</span>
  <span class="token keyword">return</span> xerrors<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;block was from the future (now=%d, blk=%d): %w&quot;</span><span class="token punctuation">,</span> now<span class="token punctuation">,</span> h<span class="token punctuation">.</span>Timestamp<span class="token punctuation">,</span> ErrTemporal<span class="token punctuation">)</span>
 <span class="token punctuation">}</span>
 <span class="token keyword">if</span> h<span class="token punctuation">.</span>Timestamp <span class="token operator">&gt;</span> now <span class="token punctuation">{</span>
  log<span class="token punctuation">.</span><span class="token function">Warn</span><span class="token punctuation">(</span><span class="token string">&quot;Got block from the future, but within threshold&quot;</span><span class="token punctuation">,</span> h<span class="token punctuation">.</span>Timestamp<span class="token punctuation">,</span> build<span class="token punctuation">.</span>Clock<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Unix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span>

 msgsCheck <span class="token operator">:=</span> async<span class="token punctuation">.</span><span class="token function">Err</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> err <span class="token operator">:=</span> syncer<span class="token punctuation">.</span><span class="token function">checkBlockMessages</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> b<span class="token punctuation">,</span> baseTs<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> xerrors<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;block had invalid messages: %w&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token boolean">nil</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span>

 minerCheck <span class="token operator">:=</span> async<span class="token punctuation">.</span><span class="token function">Err</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> err <span class="token operator">:=</span> syncer<span class="token punctuation">.</span><span class="token function">minerIsValid</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> h<span class="token punctuation">.</span>Miner<span class="token punctuation">,</span> baseTs<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> xerrors<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;minerIsValid failed: %w&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token boolean">nil</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span>

 baseFeeCheck <span class="token operator">:=</span> async<span class="token punctuation">.</span><span class="token function">Err</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
  baseFee<span class="token punctuation">,</span> err <span class="token operator">:=</span> syncer<span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">ComputeBaseFee</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> baseTs<span class="token punctuation">)</span>
  <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> xerrors<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;computing base fee: %w&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> types<span class="token punctuation">.</span><span class="token function">BigCmp</span><span class="token punctuation">(</span>baseFee<span class="token punctuation">,</span> b<span class="token punctuation">.</span>Header<span class="token punctuation">.</span>ParentBaseFee<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> xerrors<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;base fee doesn&#39;t match: %s (header) != %s (computed)&quot;</span><span class="token punctuation">,</span>
    b<span class="token punctuation">.</span>Header<span class="token punctuation">.</span>ParentBaseFee<span class="token punctuation">,</span> baseFee<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token boolean">nil</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span>
 pweight<span class="token punctuation">,</span> err <span class="token operator">:=</span> syncer<span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">Weight</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> baseTs<span class="token punctuation">)</span>
 <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> xerrors<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;getting parent weight: %w&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
 <span class="token punctuation">}</span>

 <span class="token keyword">if</span> types<span class="token punctuation">.</span><span class="token function">BigCmp</span><span class="token punctuation">(</span>pweight<span class="token punctuation">,</span> b<span class="token punctuation">.</span>Header<span class="token punctuation">.</span>ParentWeight<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> xerrors<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;parrent weight different: %s (header) != %s (computed)&quot;</span><span class="token punctuation">,</span>
   b<span class="token punctuation">.</span>Header<span class="token punctuation">.</span>ParentWeight<span class="token punctuation">,</span> pweight<span class="token punctuation">)</span>
 <span class="token punctuation">}</span>

 stateRootCheck <span class="token operator">:=</span> async<span class="token punctuation">.</span><span class="token function">Err</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
  stateroot<span class="token punctuation">,</span> precp<span class="token punctuation">,</span> err <span class="token operator">:=</span> syncer<span class="token punctuation">.</span>sm<span class="token punctuation">.</span><span class="token function">TipSetState</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> baseTs<span class="token punctuation">)</span>
  <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> xerrors<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;get tipsetstate(%d, %s) failed: %w&quot;</span><span class="token punctuation">,</span> h<span class="token punctuation">.</span>Height<span class="token punctuation">,</span> h<span class="token punctuation">.</span>Parents<span class="token punctuation">,</span> err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> stateroot <span class="token operator">!=</span> h<span class="token punctuation">.</span>ParentStateRoot <span class="token punctuation">{</span>
   msgs<span class="token punctuation">,</span> err <span class="token operator">:=</span> syncer<span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">MessagesForTipset</span><span class="token punctuation">(</span>baseTs<span class="token punctuation">)</span>
   <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token string">&quot;failed to load messages for tipset during tipset state mismatch error: &quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
   <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">Warn</span><span class="token punctuation">(</span><span class="token string">&quot;Messages for tipset with mismatching state:&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i<span class="token punctuation">,</span> m <span class="token operator">:=</span> <span class="token keyword">range</span> msgs <span class="token punctuation">{</span>
     mm <span class="token operator">:=</span> m<span class="token punctuation">.</span><span class="token function">VMMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
     log<span class="token punctuation">.</span><span class="token function">Warnf</span><span class="token punctuation">(</span><span class="token string">&quot;Message[%d]: from=%s to=%s method=%d params=%x&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> mm<span class="token punctuation">.</span>From<span class="token punctuation">,</span> mm<span class="token punctuation">.</span>To<span class="token punctuation">,</span> mm<span class="token punctuation">.</span>Method<span class="token punctuation">,</span> mm<span class="token punctuation">.</span>Params<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">return</span> xerrors<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;parent state root did not match computed state (%s != %s)&quot;</span><span class="token punctuation">,</span> stateroot<span class="token punctuation">,</span> h<span class="token punctuation">.</span>ParentStateRoot<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> precp <span class="token operator">!=</span> h<span class="token punctuation">.</span>ParentMessageReceipts <span class="token punctuation">{</span>
   <span class="token keyword">return</span> xerrors<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;parent receipts root did not match computed value (%s != %s)&quot;</span><span class="token punctuation">,</span> precp<span class="token punctuation">,</span> h<span class="token punctuation">.</span>ParentMessageReceipts<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token boolean">nil</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span>

 <span class="token comment">// Stuff that needs worker address</span>
 waddr<span class="token punctuation">,</span> err <span class="token operator">:=</span> stmgr<span class="token punctuation">.</span><span class="token function">GetMinerWorkerRaw</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> syncer<span class="token punctuation">.</span>sm<span class="token punctuation">,</span> lbst<span class="token punctuation">,</span> h<span class="token punctuation">.</span>Miner<span class="token punctuation">)</span>
 <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> xerrors<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;GetMinerWorkerRaw failed: %w&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
 <span class="token punctuation">}</span>

 winnerCheck <span class="token operator">:=</span> async<span class="token punctuation">.</span><span class="token function">Err</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> h<span class="token punctuation">.</span>ElectionProof<span class="token punctuation">.</span>WinCount <span class="token operator">&lt;</span> <span class="token number">1</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> xerrors<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;block is not claiming to be a winner&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  eligible<span class="token punctuation">,</span> err <span class="token operator">:=</span> stmgr<span class="token punctuation">.</span><span class="token function">MinerEligibleToMine</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> syncer<span class="token punctuation">.</span>sm<span class="token punctuation">,</span> h<span class="token punctuation">.</span>Miner<span class="token punctuation">,</span> baseTs<span class="token punctuation">,</span> lbts<span class="token punctuation">)</span>
  <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> xerrors<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;determining if miner has min power failed: %w&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token operator">!</span>eligible <span class="token punctuation">{</span>
   <span class="token keyword">return</span> xerrors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;block&#39;s miner is ineligible to mine&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  rBeacon <span class="token operator">:=</span> <span class="token operator">*</span>prevBeacon
  <span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>h<span class="token punctuation">.</span>BeaconEntries<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">{</span>
   rBeacon <span class="token operator">=</span> h<span class="token punctuation">.</span>BeaconEntries<span class="token punctuation">[</span><span class="token function">len</span><span class="token punctuation">(</span>h<span class="token punctuation">.</span>BeaconEntries<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
  buf <span class="token operator">:=</span> <span class="token function">new</span><span class="token punctuation">(</span>bytes<span class="token punctuation">.</span>Buffer<span class="token punctuation">)</span>
  <span class="token keyword">if</span> err <span class="token operator">:=</span> h<span class="token punctuation">.</span>Miner<span class="token punctuation">.</span><span class="token function">MarshalCBOR</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> xerrors<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;failed to marshal miner address to cbor: %w&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  vrfBase<span class="token punctuation">,</span> err <span class="token operator">:=</span> store<span class="token punctuation">.</span><span class="token function">DrawRandomness</span><span class="token punctuation">(</span>rBeacon<span class="token punctuation">.</span>Data<span class="token punctuation">,</span> crypto<span class="token punctuation">.</span>DomainSeparationTag_ElectionProofProduction<span class="token punctuation">,</span> h<span class="token punctuation">.</span>Height<span class="token punctuation">,</span> buf<span class="token punctuation">.</span><span class="token function">Bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> xerrors<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;could not draw randomness: %w&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> err <span class="token operator">:=</span> <span class="token function">VerifyElectionPoStVRF</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> waddr<span class="token punctuation">,</span> vrfBase<span class="token punctuation">,</span> h<span class="token punctuation">.</span>ElectionProof<span class="token punctuation">.</span>VRFProof<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> xerrors<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;validating block election proof failed: %w&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  slashed<span class="token punctuation">,</span> err <span class="token operator">:=</span> stmgr<span class="token punctuation">.</span><span class="token function">GetMinerSlashed</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> syncer<span class="token punctuation">.</span>sm<span class="token punctuation">,</span> baseTs<span class="token punctuation">,</span> h<span class="token punctuation">.</span>Miner<span class="token punctuation">)</span>
  <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> xerrors<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;failed to check if block miner was slashed: %w&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> slashed <span class="token punctuation">{</span>
   <span class="token keyword">return</span> xerrors<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;received block was from slashed or invalid miner&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  mpow<span class="token punctuation">,</span> tpow<span class="token punctuation">,</span> <span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">:=</span> stmgr<span class="token punctuation">.</span><span class="token function">GetPowerRaw</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> syncer<span class="token punctuation">.</span>sm<span class="token punctuation">,</span> lbst<span class="token punctuation">,</span> h<span class="token punctuation">.</span>Miner<span class="token punctuation">)</span>
  <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> xerrors<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;failed getting power: %w&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  j <span class="token operator">:=</span> h<span class="token punctuation">.</span>ElectionProof<span class="token punctuation">.</span><span class="token function">ComputeWinCount</span><span class="token punctuation">(</span>mpow<span class="token punctuation">.</span>QualityAdjPower<span class="token punctuation">,</span> tpow<span class="token punctuation">.</span>QualityAdjPower<span class="token punctuation">)</span>
  <span class="token keyword">if</span> h<span class="token punctuation">.</span>ElectionProof<span class="token punctuation">.</span>WinCount <span class="token operator">!=</span> j <span class="token punctuation">{</span>
   <span class="token keyword">return</span> xerrors<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;miner claims wrong number of wins: miner: %d, computed: %d&quot;</span><span class="token punctuation">,</span> h<span class="token punctuation">.</span>ElectionProof<span class="token punctuation">.</span>WinCount<span class="token punctuation">,</span> j<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token boolean">nil</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span>

 blockSigCheck <span class="token operator">:=</span> async<span class="token punctuation">.</span><span class="token function">Err</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> err <span class="token operator">:=</span> sigs<span class="token punctuation">.</span><span class="token function">CheckBlockSignature</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> h<span class="token punctuation">,</span> waddr<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> xerrors<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;check block signature failed: %w&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token boolean">nil</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span>

 beaconValuesCheck <span class="token operator">:=</span> async<span class="token punctuation">.</span><span class="token function">Err</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> os<span class="token punctuation">.</span><span class="token function">Getenv</span><span class="token punctuation">(</span><span class="token string">&quot;LOTUS_IGNORE_DRAND&quot;</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">&quot;_yes_&quot;</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token boolean">nil</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> err <span class="token operator">:=</span> beacon<span class="token punctuation">.</span><span class="token function">ValidateBlockValues</span><span class="token punctuation">(</span>syncer<span class="token punctuation">.</span>beacon<span class="token punctuation">,</span> h<span class="token punctuation">,</span> baseTs<span class="token punctuation">.</span><span class="token function">Height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">*</span>prevBeacon<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> xerrors<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;failed to validate blocks random beacon values: %w&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token boolean">nil</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span>

 tktsCheck <span class="token operator">:=</span> async<span class="token punctuation">.</span><span class="token function">Err</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
  buf <span class="token operator">:=</span> <span class="token function">new</span><span class="token punctuation">(</span>bytes<span class="token punctuation">.</span>Buffer<span class="token punctuation">)</span>
  <span class="token keyword">if</span> err <span class="token operator">:=</span> h<span class="token punctuation">.</span>Miner<span class="token punctuation">.</span><span class="token function">MarshalCBOR</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> xerrors<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;failed to marshal miner address to cbor: %w&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> h<span class="token punctuation">.</span>Height <span class="token operator">&gt;</span> build<span class="token punctuation">.</span>UpgradeSmokeHeight <span class="token punctuation">{</span>
   buf<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>baseTs<span class="token punctuation">.</span><span class="token function">MinTicket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>VRFProof<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  beaconBase <span class="token operator">:=</span> <span class="token operator">*</span>prevBeacon
  <span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>h<span class="token punctuation">.</span>BeaconEntries<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">{</span>
   beaconBase <span class="token operator">=</span> h<span class="token punctuation">.</span>BeaconEntries<span class="token punctuation">[</span><span class="token function">len</span><span class="token punctuation">(</span>h<span class="token punctuation">.</span>BeaconEntries<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>

  vrfBase<span class="token punctuation">,</span> err <span class="token operator">:=</span> store<span class="token punctuation">.</span><span class="token function">DrawRandomness</span><span class="token punctuation">(</span>beaconBase<span class="token punctuation">.</span>Data<span class="token punctuation">,</span> crypto<span class="token punctuation">.</span>DomainSeparationTag_TicketProduction<span class="token punctuation">,</span> h<span class="token punctuation">.</span>Height<span class="token operator">-</span>build<span class="token punctuation">.</span>TicketRandomnessLookback<span class="token punctuation">,</span> buf<span class="token punctuation">.</span><span class="token function">Bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> xerrors<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;failed to compute vrf base for ticket: %w&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  err <span class="token operator">=</span> <span class="token function">VerifyElectionPoStVRF</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> waddr<span class="token punctuation">,</span> vrfBase<span class="token punctuation">,</span> h<span class="token punctuation">.</span>Ticket<span class="token punctuation">.</span>VRFProof<span class="token punctuation">)</span>
  <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> xerrors<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;validating block tickets failed: %w&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token boolean">nil</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span>

 wproofCheck <span class="token operator">:=</span> async<span class="token punctuation">.</span><span class="token function">Err</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> err <span class="token operator">:=</span> syncer<span class="token punctuation">.</span><span class="token function">VerifyWinningPoStProof</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> h<span class="token punctuation">,</span> <span class="token operator">*</span>prevBeacon<span class="token punctuation">,</span> lbst<span class="token punctuation">,</span> waddr<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> xerrors<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;invalid election post: %w&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token boolean">nil</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span>

 await <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>async<span class="token punctuation">.</span>ErrorFuture<span class="token punctuation">{</span>
  minerCheck<span class="token punctuation">,</span>
  tktsCheck<span class="token punctuation">,</span>
  blockSigCheck<span class="token punctuation">,</span>
  beaconValuesCheck<span class="token punctuation">,</span>
  wproofCheck<span class="token punctuation">,</span>
  winnerCheck<span class="token punctuation">,</span>
  msgsCheck<span class="token punctuation">,</span>
  baseFeeCheck<span class="token punctuation">,</span>
  stateRootCheck<span class="token punctuation">,</span>
 <span class="token punctuation">}</span>

 <span class="token keyword">var</span> merr <span class="token builtin">error</span>
 <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> fut <span class="token operator">:=</span> <span class="token keyword">range</span> await <span class="token punctuation">{</span>
  <span class="token keyword">if</span> err <span class="token operator">:=</span> fut<span class="token punctuation">.</span><span class="token function">AwaitContext</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
   merr <span class="token operator">=</span> multierror<span class="token punctuation">.</span><span class="token function">Append</span><span class="token punctuation">(</span>merr<span class="token punctuation">,</span> err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
 <span class="token keyword">if</span> merr <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  mulErr <span class="token operator">:=</span> merr<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token operator">*</span>multierror<span class="token punctuation">.</span>Error<span class="token punctuation">)</span>
  mulErr<span class="token punctuation">.</span>ErrorFormat <span class="token operator">=</span> <span class="token keyword">func</span><span class="token punctuation">(</span>es <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
   <span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>es<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;1 error occurred:\n\t* %+v\n\n&quot;</span><span class="token punctuation">,</span> es<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span>

   points <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>es<span class="token punctuation">)</span><span class="token punctuation">)</span>
   <span class="token keyword">for</span> i<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token keyword">range</span> es <span class="token punctuation">{</span>
    points<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;* %+v&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">return</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span>
    <span class="token string">&quot;%d errors occurred:\n\t%s\n\n&quot;</span><span class="token punctuation">,</span>
    <span class="token function">len</span><span class="token punctuation">(</span>es<span class="token punctuation">)</span><span class="token punctuation">,</span> strings<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span>points<span class="token punctuation">,</span> <span class="token string">&quot;\n\t&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> mulErr
 <span class="token punctuation">}</span>

 <span class="token keyword">if</span> useCache <span class="token punctuation">{</span>
  <span class="token keyword">if</span> err <span class="token operator">:=</span> syncer<span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">MarkBlockAsValidated</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> b<span class="token punctuation">.</span><span class="token function">Cid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> xerrors<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;caching block validation %s: %w&quot;</span><span class="token punctuation">,</span> b<span class="token punctuation">.</span><span class="token function">Cid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>

 <span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é‚®ä»¶æ˜¯é€šè¿‡æ£€ç´¢çš„<code>Syncer</code>ã€‚éµå¾ªä»¥ä¸‹ä¸¤ä¸ªæ­¥éª¤<code>Syncer</code>ï¼š1-<code>FullTipSet</code>ç”¨å…ˆå‰æ”¶åˆ°çš„å•ä¸ªå—ç»„è£…ä¸€ä¸ªå¡«å……å—ã€‚è¯¥æ•°æ®å—<code>ParentWeight</code>å¤§äºæœ€é‡çš„æç¤ºé›†ï¼ˆç¬¬ä¸€ä¸ªæ•°æ®å—ï¼‰ä¸­çš„æ•°æ®å—ã€‚2-ä»æ”¶åˆ°çš„å—ä¸­æ£€ç´¢æ‰€æœ‰æç¤ºé›†ï¼Œç›´åˆ°æˆ‘ä»¬çš„é“¾ã€‚éªŒè¯æ‰©å±•åˆ°è¿™äº›æç¤ºé›†ä¸­çš„æ¯ä¸ªå—ã€‚éªŒè¯åº”ç¡®ä¿ï¼š-ä¿¡æ ‡æ•´ä½“æŒ‰å…¶è½®æ¬¡æ’åºã€‚-æç¤ºé›†<code>Parents</code>CIDä¸é€šè¿‡BlockSyncè·å–çš„çˆ¶æç¤ºé›†åŒ¹é…ã€‚</p><p>è¯­ä¹‰ä¸Šæœ‰æ•ˆçš„å—å¿…é¡»æ»¡è¶³ä»¥ä¸‹æ‰€æœ‰è¦æ±‚ã€‚</p><p><strong><code>Parents</code>-æœ‰å…³</strong></p><ul><li><code>Parents</code>æŒ‰å…¶æ ‡é¢˜çš„å­—å…¸é¡ºåºåˆ—å‡º<code>Ticket</code>ã€‚</li><li><code>ParentStateRoot</code>å—çš„CIDä¸ä»çˆ¶<a href="https://spec.filecoin.io/#section-systems.filecoin_blockchain.struct.tipset" target="_blank" rel="noopener noreferrer">Tipset<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>è®¡ç®—çš„çŠ¶æ€CIDåŒ¹é… ã€‚</li><li><code>ParentState</code> å°†é€šè¿‡æ‰§è¡Œçˆ¶æç¤ºé›†çš„æ¶ˆæ¯ï¼ˆç”±VMè§£é‡Šå™¨å®šä¹‰ï¼‰äº§ç”Ÿçš„çŠ¶æ€æ ‘ä¸è¯¥æç¤ºé›†çš„çˆ¶çŠ¶æ€ç›¸åŒ¹é…ã€‚</li><li><code>ParentMessageReceipts</code>æ ‡è¯†çˆ¶æç¤ºé›†æ‰§è¡Œäº§ç”Ÿçš„æ”¶æ®åˆ—è¡¨ï¼Œå¹¶ä¸ºçˆ¶æç¤ºé›†çš„æ¯æ¡å”¯ä¸€æ¶ˆæ¯æä¾›ä¸€å¼ æ”¶æ®ã€‚æ¢å¥è¯è¯´ï¼Œå—çš„<code>ParentMessageReceipts</code>CIDä¸ä»çˆ¶æç¤ºé›†è®¡ç®—çš„æ”¶æ®CIDåŒ¹é…ã€‚</li><li><code>ParentWeight</code> åŒ¹é…é“¾çš„æƒé‡ï¼Œç›´åˆ°å¹¶åŒ…æ‹¬çˆ¶æç¤ºé›†ã€‚</li></ul><p><strong>ä¸æ—¶é—´æœ‰å…³</strong></p><ul><li><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Epoch
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å¤§äºå…¶</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Parents
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ï¼Œå¹¶ä¸”</p><ul><li><p>å°†æ¥ä¸ä¼šæ ¹æ®èŠ‚ç‚¹å½“å‰æ—¶é—´çš„æœ¬åœ°æ—¶é’Ÿè¯»æ•°ï¼Œ</p><ul><li>åœ¨é€‚å½“çš„æ—¶æœŸä¹‹å‰ï¼Œä¸åº”æ‹’ç»å…·æœ‰æœªæ¥æ—¶æœŸçš„æ¨¡å—ï¼Œä½†ä¸åº”å¯¹å…¶è¿›è¡Œè¯„ä¼°ï¼ˆéªŒè¯æˆ–åŒ…å«åœ¨æç¤ºé›†ä¸­ï¼‰</li></ul></li><li><p>ä¸è¿‡å»æ¯”è½¯ç»ˆç»“æ›´è¿œé€šè¿‡SPCå®šä¹‰çš„</p><p>ç»ˆå±€æ€§</p><p>ï¼Œ</p><ul><li>è¯¥è§„åˆ™ä»…åœ¨æ¥æ”¶åˆ°æ–°çš„å…«å¦å—ï¼ˆå³ä»å½“å‰é“¾å¤´ï¼‰æ¥æ”¶æ—¶æ‰é€‚ç”¨ï¼Œè€Œä¸æ˜¯åœ¨é¦–æ¬¡åŒæ­¥åˆ°é“¾æ—¶ã€‚</li></ul></li></ul></li><li><p>åœ¨</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Timestamp
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>åŒ…æ‹¬ä»¥ç§’ä¸ºå•ä½çš„æ˜¯ï¼š</p><ul><li>ä¸å¾—å¤§äºå½“å‰æ—¶é—´åŠ ä¸Š <code>Î‘llowableClockDriftSecs</code></li><li>ä¸å¾—å°äºå‰ä¸€ä¸ªå—çš„<code>Timestamp</code>åŠ å·<code>BlockDelay</code>ï¼ˆåŒ…æ‹¬ç©ºå—ï¼‰</li><li>å…·æœ‰åˆ›ä¸–å—çš„æ—¶é—´æˆ³ï¼Œç½‘ç»œçš„é”å®šæ—¶é—´å’Œé”å®šçš„æ‰€éšå«çš„ç²¾ç¡®å€¼<code>Epoch</code>ã€‚</li></ul></li></ul><p><strong><code>Miner</code>-æœ‰å…³</strong></p><ul><li><p>çš„<code>Miner</code>æ˜¯åœ¨çˆ¶tipsetçŠ¶æ€å­˜å‚¨åŠŸç‡è¡¨æ´»æ€§ã€‚çŸ¿å·¥çš„åœ°å€å·²æ³¨å†Œåœ¨<code>Claims</code>Power Actorçš„HAMTä¸­</p></li><li><p>å¯¹äº</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>TipSetState
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>è¦éªŒè¯çš„æ¯ä¸ªæç¤ºé›†ï¼Œéƒ½åº”åŒ…å«ã€‚</p><ul><li>æç¤ºé›†ä¸­çš„æ¯ä¸ªåŒºå—éƒ½åº”å±äºä¸åŒçš„çŸ¿å·¥ã€‚</li></ul></li><li><p>ä¸æ¶ˆæ¯çš„<code>From</code>åœ°å€å…³è”çš„Actorå­˜åœ¨ï¼Œæ˜¯å¸æˆ·actorï¼Œå…¶Nonceä¸æ¶ˆæ¯NonceåŒ¹é…ã€‚</p></li><li><p>åŒ…æ‹¬æœ‰æ•ˆçš„è¯æ®ï¼Œè¯æ˜è¯¥çŸ¿å·¥è¯æ˜å¯ä»¥è®¿é—®å…¶é¢ä¸´æŒ‘æˆ˜çš„éƒ¨é—¨çš„å¯†å°ç‰ˆæœ¬ã€‚ä¸ºäº†å®ç°è¿™ä¸€ç›®æ ‡ï¼š</p><ul><li>ä½¿ç”¨<code>WinningPoSt</code>åŸŸåˆ†éš”æ ‡ç­¾ä¸ºå½“å‰æ—¶æœŸç»˜åˆ¶éšæœºæ€§ã€‚</li><li>æ ¹æ®ç»˜åˆ¶çš„éšæœºæ€§ï¼Œè·å–æ­¤çŸ¿å·¥åœ¨æ­¤æ—¶æœŸé¢ä¸´æŒ‘æˆ˜çš„æ‰‡åŒºåˆ—è¡¨ã€‚</li></ul></li><li><p>çŸ¿å·¥ä¸è¢«å‰Šå‡<code>StoragePowerActor</code>ã€‚</p></li></ul><p><strong><code>Beacon</code>- ï¼†<code>Ticket</code>-ç›¸å…³</strong></p><ul><li><p>æœ‰æ•ˆæœŸ</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>BeaconEntries
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>åº”åŒ…æ‹¬ï¼š</p><ul><li>æ£€æŸ¥ä¸­çš„æ¯ä¸€ä¸ª<code>BeaconEntries</code>éƒ½æ˜¯æ¶ˆæ¯çš„ç­¾åï¼š<code>previousSignature || round</code>ä½¿ç”¨DRANDçš„å…¬é’¥ç­¾åã€‚</li><li>åŒ…æ‹¬ä»<code>MaxBeaconRoundForEpoch</code>ä½åˆ°é«˜<code>prevEntry</code>ï¼ˆä»ä¸Šä¸€ä¸ªæŠ€å·§é›†å¼€å§‹ï¼‰ä¹‹é—´çš„æ‰€æœ‰æ¡ç›®ã€‚</li></ul></li><li><p>ä¸€ä¸ª</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Ticket
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æ¥è‡ªçˆ¶tipsetçš„å—å¤´æœ€å°ç¥¨è·å¾—ï¼Œ</p><ul><li><code>Ticket.VRFResult</code>ç”±<code>Miner</code>æ¼”å‘˜çš„å·¥äººå¸æˆ·å…¬é’¥æœ‰æ•ˆç­¾ç½²ï¼Œ</li></ul></li><li><p><code>ElectionProof Ticket</code>é€šè¿‡ä½¿ç”¨çŸ¿å·¥çš„å¯†é’¥æ£€æŸ¥BLSç­¾åæ¥æ­£ç¡®è®¡ç®—å¾—å‡ºã€‚è¯¥<code>ElectionProof</code>ç¥¨åº”è¯¥æ˜¯ä¸­å¥–ç¥¨ã€‚</p></li></ul><p><strong>æ¶ˆæ¯å’Œç­¾åç›¸å…³</strong></p><ul><li><p><code>secp256k1</code>é‚®ä»¶å·²é€šè¿‡å…¶å‘é€æ–¹ï¼ˆ<code>From</code>ï¼‰å·¥ä½œè€…å¸æˆ·å¯†é’¥æ­£ç¡®ç­¾åï¼Œ</p></li><li><p><code>BLSAggregate</code>åŒ…æ‹¬ä¸€ä¸ªç­¾åï¼Œè¯¥ç­¾åä½¿ç”¨è¯¥å—çš„å‘é€å‚ä¸è€…çš„å¯†é’¥æ¥ç­¾åè¯¥å—å¼•ç”¨çš„æ‰€æœ‰BLSæ¶ˆæ¯çš„CIDæ•°ç»„ã€‚</p></li><li><p><code>Signature</code>åŒ…å«æ¥è‡ªå—çš„<code>Miner</code>å‚ä¸è€…çš„å·¥ä½œäººå‘˜å¸æˆ·å…¬å…±å¯†é’¥çš„å—å¤´çš„æœ‰æ•ˆå­—æ®µã€‚</p></li><li><p>å¯¹äº</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>ValidForBlockInclusion()
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ä»¥ä¸‹ä¿æŒçš„æ¯æ¡æ¶ˆæ¯ï¼š</p><ul><li>æ¶ˆæ¯å­—æ®µ<code>Version</code>ï¼Œ<code>To</code>ï¼Œ<code>From</code>ï¼Œ<code>Value</code>ï¼Œ<code>GasPrice</code>ï¼Œå’Œ<code>GasLimit</code>æ­£ç¡®å®šä¹‰ã€‚</li><li>æ¶ˆæ¯<code>GasLimit</code>ä½äºæ¶ˆæ¯çš„æœ€ä½æ°”ä½“æˆæœ¬ï¼ˆæ¥è‡ªé“¾é«˜åº¦å’Œæ¶ˆæ¯é•¿åº¦ï¼‰ã€‚</li></ul></li><li><p>å¯¹äºå…¶ä¸­çš„æ¯ä¸ªæ¶ˆæ¯</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>ApplyMessage
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ï¼ˆå³åœ¨æ‰§è¡Œæ¶ˆæ¯ä¹‹å‰ï¼‰ï¼Œä»¥ä¸‹ä¿æŒï¼š</p><ul><li><p>åŸºæœ¬æ°”ä½“å’Œä»·å€¼æ£€æŸ¥åœ¨</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>checkMessage()
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ï¼š</p><ul><li>æ¶ˆæ¯<code>GasLimit</code>å¤§äºé›¶ã€‚</li><li>æ¶ˆæ¯<code>GasPrice</code>å’Œ<code>Value</code>å·²è®¾ç½®ã€‚</li></ul></li><li><p>æ¶ˆæ¯çš„å­˜å‚¨æ°”ä½“æˆæœ¬ä½äºæ¶ˆæ¯çš„<code>GasLimit</code>ã€‚</p></li><li><p>æ¶ˆæ¯<code>Nonce</code>ä¸ä»æ¶ˆæ¯<code>From</code>åœ°å€ä¸­æ£€ç´¢åˆ°çš„Actorä¸­çš„éšæœºæ•°åŒ¹é…ã€‚</p></li><li><p>æ¶ˆæ¯çš„æœ€å¤§ç”¨æ°”æˆæœ¬ï¼ˆä»å…¶<code>GasLimit</code>ï¼Œ<code>GasPrice</code>å’Œæ´¾ç”Ÿ<code>Value</code>ï¼‰ä½äºä»æ¶ˆæ¯<code>From</code>åœ°å€æ£€ç´¢çš„Actorçš„ä½™é¢ã€‚</p></li><li><p>æ¶ˆæ¯çš„ä¼ è¾“<code>Value</code>å¤„äºä»æ¶ˆæ¯<code>From</code>åœ°å€ä¸­æ£€ç´¢åˆ°çš„Actorçš„ä½™é¢ä¹‹ä¸‹ã€‚</p></li></ul></li></ul><p>é™¤äº†éªŒè¯ç­¾åä¹‹å¤–ï¼Œæ²¡æœ‰å¯¹å—ä¸­åŒ…å«çš„æ¶ˆæ¯è¿›è¡Œè¯­ä¹‰éªŒè¯çš„æ–¹æ³•ã€‚å¦‚æœå—ä¸­åŒ…å«çš„æ‰€æœ‰æ¶ˆæ¯åœ¨è¯­æ³•ä¸Šå‡æœ‰æ•ˆï¼Œåˆ™å¯ä»¥æ‰§è¡Œå®ƒä»¬å¹¶äº§ç”Ÿæ”¶æ®ã€‚</p><p>é“¾åŒæ­¥ç³»ç»Ÿå¯ä»¥åˆ†é˜¶æ®µæ‰§è¡Œè¯­æ³•å’Œè¯­ä¹‰éªŒè¯ï¼Œä»¥æœ€å¤§ç¨‹åº¦åœ°å‡å°‘ä¸å¿…è¦çš„èµ„æºæ¶ˆè€—ã€‚</p><p>å¦‚æœä»¥ä¸Šæ‰€æœ‰æµ‹è¯•å‡æˆåŠŸï¼Œåˆ™å°†è¯¥å—æ ‡è®°ä¸ºå·²éªŒè¯ã€‚æœ€ç»ˆï¼Œæ— æ•ˆå—ä¸å¾—è¿›ä¸€æ­¥ä¼ æ’­æˆ–éªŒè¯ä¸ºçˆ¶èŠ‚ç‚¹ã€‚</p><h4 id="_2-4-1-2å°è´¹" tabindex="-1"><a class="header-anchor" href="#_2-4-1-2å°è´¹" aria-hidden="true">#</a> 2.4.1.2<a href="https://spec.filecoin.io/#section-systems.filecoin_blockchain.struct.tipset" target="_blank" rel="noopener noreferrer">å°è´¹<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><p>é¢„æœŸå…±è¯†åœ¨æ¯ä¸ªæ—¶æœŸæ¦‚ç‡é€‰ä¸¾å‡ºå¤šä¸ªé¢†å¯¼è€…ï¼Œè¿™æ„å‘³ç€Filecoiné“¾åœ¨æ¯ä¸ªæ—¶æœŸå¯èƒ½åŒ…å«é›¶ä¸ªæˆ–å¤šä¸ªåŒºå—ï¼ˆæ¯ä¸ªé€‰ä¸¾çš„çŸ¿å·¥ä¸€ä¸ªï¼‰ã€‚æ¥è‡ªåŒä¸€æ—¶æœŸçš„å—è¢«ç»„è£…åˆ°æç¤ºé›†ä¸­ã€‚æ‰€è¿° <a href="https://spec.filecoin.io/#section-systems.filecoin_vm.interpreter" target="_blank" rel="noopener noreferrer">VMè§£é‡Šå™¨<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>é€šè¿‡åœ¨tipsetæ‰§è¡Œçš„æ‰€æœ‰æ¶ˆæ¯ï¼ˆåŒ…æ‹¬åœ¨å¤šäºä¸€ä¸ªçš„å—ç›¸åŒæ¶ˆæ¯çš„é‡å¤æ•°æ®åˆ é™¤ä¹‹åï¼‰ä¿®æ”¹FilecoinçŠ¶æ€æ ‘ã€‚</p><p>æ¯ä¸ªå—éƒ½å¼•ç”¨ä¸€ä¸ªçˆ¶æç¤ºé›†ï¼Œå¹¶éªŒè¯<em>è¯¥æç¤ºé›†çš„state</em>ï¼ŒåŒæ—¶æå‡ºè¦åŒ…å«åœ¨å½“å‰æ—¶ä»£çš„æ¶ˆæ¯ã€‚é™¤éå°†è¯¥å—åˆå¹¶åˆ°æç¤ºé›†ä¸­ï¼Œå¦åˆ™æ— æ³•çŸ¥é“æ–°å—çš„æ¶ˆæ¯æ‰€åº”ç”¨çš„çŠ¶æ€ã€‚å› æ­¤ï¼Œå­¤ç«‹åœ°ä»å•ä¸ªå—ä¸­æ‰§è¡Œæ¶ˆæ¯æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼šåªæœ‰æ‰§è¡Œäº†è¯¥å—çš„æŠ€å·§é›†ä¸­çš„æ‰€æœ‰æ¶ˆæ¯åï¼Œæ‰çŸ¥é“æ–°çš„çŠ¶æ€æ ‘ã€‚</p><p>ä¸€ä¸ªæœ‰æ•ˆçš„æç¤ºé›†åŒ…å«ä¸€ä¸ªéç©ºçš„å—é›†åˆï¼Œè¿™äº›å—å…·æœ‰ä¸åŒçš„çŸ¿å·¥ï¼Œå¹¶ä¸”å…¨éƒ¨æŒ‡å®šç›¸åŒï¼š</p><ul><li><code>Epoch</code></li><li><code>Parents</code></li><li><code>ParentWeight</code></li><li><code>StateRoot</code></li><li><code>ReceiptsRoot</code></li></ul><p>æç¤ºé›†ä¸­çš„å„ä¸ªå—æŒ‰æ¯ä¸ªå—ç¥¨è¯ä¸­å­—èŠ‚çš„å­—å…¸é¡ºåºè¿›è¡Œè§„èŒƒæ’åºï¼Œä»è€Œä¸è¯¥å—æœ¬èº«çš„CIDå­—èŠ‚æ–­å¼€è”ç³»ã€‚</p><p>ç”±äºç½‘ç»œä¼ æ’­å»¶è¿Ÿï¼Œåœ¨æ—¶é—´æ®µN + 1ä¸­çš„çŸ¿å·¥å¯èƒ½ä¼šä»å…¶çˆ¶æç¤ºé›†ä¸­å¿½ç•¥åœ¨æ—¶é—´æ®µNå¤„æŒ–æ˜çš„æœ‰æ•ˆå—ã€‚è¿™ä¸ä¼šä½¿æ–°ç”Ÿæˆçš„å—æ— æ•ˆï¼Œä½†æ˜¯ä¼šé™ä½å…¶æƒé‡å’Œæˆä¸ºEC<a href="https://spec.filecoin.io/#section-algorithms.expected_consensus.chain-selection" target="_blank" rel="noopener noreferrer">é“¾é€‰æ‹©<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>åŠŸèƒ½å®šä¹‰çš„åè®®ä¸­è§„èŒƒé“¾ä¸€éƒ¨åˆ†çš„æœºä¼š ã€‚</p><p>å—ç”Ÿäº§è€…åº”è¯¥åè°ƒä»–ä»¬å¦‚ä½•é€‰æ‹©è¦åŒ…å«åœ¨å—ä¸­çš„æ¶ˆæ¯ï¼Œä»¥é¿å…é‡å¤ï¼Œä»è€Œä»æ¶ˆæ¯è´¹ç”¨ä¸­æœ€å¤§åŒ–ä»–ä»¬çš„é¢„æœŸæ”¶ç›Šï¼ˆè¯·å‚é˜… <a href="https://spec.filecoin.io/#section-systems.filecoin_blockchain.message_pool" target="_blank" rel="noopener noreferrer">æ¶ˆæ¯æ± <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ï¼‰ã€‚</p><p>Lotuså®ç°ä¸­çš„ä¸»è¦Tipsetç»“æ„åŒ…æ‹¬ä»¥ä¸‹å†…å®¹ï¼š</p><p><a href="https://spec.filecoin.io/#example-tipset" target="_blank" rel="noopener noreferrer">ç¤ºä¾‹ï¼šTipSet<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> TipSet <span class="token keyword">struct</span> <span class="token punctuation">{</span>
 cids   <span class="token punctuation">[</span><span class="token punctuation">]</span>cid<span class="token punctuation">.</span>Cid
 blks   <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>BlockHeader
 height abi<span class="token punctuation">.</span>ChainEpoch
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Tipsetçš„è¯­ä¹‰éªŒè¯åŒ…æ‹¬ä»¥ä¸‹æ£€æŸ¥ã€‚</p><p><a href="https://spec.filecoin.io/#example-newtipset" target="_blank" rel="noopener noreferrer">ç¤ºä¾‹ï¼šNewTipSet<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>æ£€æŸ¥ï¼š</p><ul><li>æç¤ºé›†ç”±è‡³å°‘ä¸€ä¸ªå—ç»„æˆã€‚ï¼ˆç”±äºæ¯ä¸ªæç¤ºé›†çš„å¯å˜å—æ•°ç”±éšæœºæ€§å†³å®šï¼Œå› æ­¤æˆ‘ä»¬ä¸æ–½åŠ ä¸Šé™ã€‚ï¼‰</li><li>æ‰€æœ‰å—éƒ½å…·æœ‰ç›¸åŒçš„é«˜åº¦ã€‚</li><li>æ‰€æœ‰å—éƒ½å…·æœ‰ç›¸åŒçš„çˆ¶ä»£ï¼ˆå®ƒä»¬å…·æœ‰ç›¸åŒçš„æ•°é‡å’ŒåŒ¹é…çš„CIDï¼‰ã€‚</li></ul><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">NewTipSet</span><span class="token punctuation">(</span>blks <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>BlockHeader<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>TipSet<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>blks<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> xerrors<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;NewTipSet called with zero length array of blocks&quot;</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span>

 sort<span class="token punctuation">.</span><span class="token function">Slice</span><span class="token punctuation">(</span>blks<span class="token punctuation">,</span> <span class="token function">tipsetSortFunc</span><span class="token punctuation">(</span>blks<span class="token punctuation">)</span><span class="token punctuation">)</span>

 <span class="token keyword">var</span> ts TipSet
 ts<span class="token punctuation">.</span>cids <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>cid<span class="token punctuation">.</span>Cid<span class="token punctuation">{</span>blks<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">Cid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
 ts<span class="token punctuation">.</span>blks <span class="token operator">=</span> blks
 <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> b <span class="token operator">:=</span> <span class="token keyword">range</span> blks<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> b<span class="token punctuation">.</span>Height <span class="token operator">!=</span> blks<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Height <span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;cannot create tipset with mismatching heights&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>blks<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Parents<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token function">len</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>Parents<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;cannot create tipset with mismatching number of parents&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">for</span> i<span class="token punctuation">,</span> cid <span class="token operator">:=</span> <span class="token keyword">range</span> b<span class="token punctuation">.</span>Parents <span class="token punctuation">{</span>
   <span class="token keyword">if</span> cid <span class="token operator">!=</span> blks<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Parents<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;cannot create tipset with mismatching parents&quot;</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  ts<span class="token punctuation">.</span>cids <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>ts<span class="token punctuation">.</span>cids<span class="token punctuation">,</span> b<span class="token punctuation">.</span><span class="token function">Cid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

 <span class="token punctuation">}</span>
 ts<span class="token punctuation">.</span>height <span class="token operator">=</span> blks<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Height

 <span class="token keyword">return</span> <span class="token operator">&amp;</span>ts<span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-4-1-3è¿é”åº—ç»ç†" tabindex="-1"><a class="header-anchor" href="#_2-4-1-3è¿é”åº—ç»ç†" aria-hidden="true">#</a> 2.4.1.3<a href="https://spec.filecoin.io/#section-systems.filecoin_blockchain.struct.chain_manager" target="_blank" rel="noopener noreferrer">è¿é”åº—ç»ç†<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><p>æ‰€è¿°<em>é“¾ç»ç†</em>æ˜¯åœ¨blockchainç³»ç»Ÿä¸­çš„ä¸­å¿ƒç»„ä»¶ã€‚å®ƒè·Ÿè¸ªå¹¶æ›´æ–°ç»™å®šèŠ‚ç‚¹æ¥æ”¶åˆ°çš„ç«äº‰å­é“¾ï¼Œä»¥é€‰æ‹©é€‚å½“çš„åŒºå—é“¾å¤´ï¼šå®ƒåœ¨ç³»ç»Ÿä¸­çŸ¥é“çš„æœ€é‡å­é“¾çš„æœ€æ–°å—ã€‚</p><p>è¿™æ ·åšï¼Œ<em>é“¾ç®¡ç†å™¨</em>æ˜¯ä¸­å¤®å­ç³»ç»Ÿï¼Œå®ƒå¤„ç†FilecoinèŠ‚ç‚¹ä¸­è®¸å¤šå…¶ä»–ç³»ç»Ÿçš„ç°¿è®°å·¥ä½œï¼Œå¹¶å…¬å¼€äº†ä¾›é‚£äº›ç³»ç»Ÿä½¿ç”¨çš„ä¾¿æ·æ–¹æ³•ï¼Œä»è€Œä½¿ç³»ç»Ÿèƒ½å¤Ÿä»é“¾ä¸­æŠ½æ ·éšæœºæ€§ï¼Œæˆ–æŸ¥çœ‹å“ªä¸ªå—å·²è¢«å ç”¨ã€‚æœ€è¿‘å®Œæˆã€‚</p><h5 id="_2-4-1-3-1å»¶ä¼¸é“¾" tabindex="-1"><a class="header-anchor" href="#_2-4-1-3-1å»¶ä¼¸é“¾" aria-hidden="true">#</a> 2.4.1.3.1<a href="https://spec.filecoin.io/#section-systems.filecoin_blockchain.struct.chain_manager.chain-extension" target="_blank" rel="noopener noreferrer">å»¶ä¼¸é“¾<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h5><h6 id="_2-4-1-3-1-1æ¥æ”¶å—æ¥æ”¶" tabindex="-1"><a class="header-anchor" href="#_2-4-1-3-1-1æ¥æ”¶å—æ¥æ”¶" aria-hidden="true">#</a> 2.4.1.3.1.1<a href="https://spec.filecoin.io/#section-systems.filecoin_blockchain.struct.chain_manager.incoming-block-reception" target="_blank" rel="noopener noreferrer">æ¥æ”¶å—æ¥æ”¶<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h6><p>å¯¹äºæ¯ä¸ªä¼ å…¥çš„å—ï¼Œå³ä½¿æœªå°†ä¼ å…¥çš„å—æ·»åŠ åˆ°å½“å‰æœ€é‡çš„æç¤ºé›†ä¸­ï¼Œé“¾ç®¡ç†å™¨ä¹Ÿåº”å°†å…¶æ·»åŠ åˆ°å®ƒæ­£åœ¨è·Ÿè¸ªçš„é€‚å½“å­é“¾ä¸­ï¼Œæˆ–ç‹¬ç«‹åœ°å¯¹å…¶è¿›è¡Œè·Ÿè¸ªï¼Œç›´åˆ°ï¼š</p><ul><li>å®ƒèƒ½å¤Ÿé€šè¿‡æ¥æ”¶è¯¥å­é“¾ä¸­çš„å¦ä¸€ä¸ªå—æ¥æ·»åŠ åˆ°å½“å‰æœ€é‡çš„å­é“¾ä¸­ï¼Œæˆ–è€…</li><li>å®ƒå¯ä»¥ä¸¢å¼ƒå®ƒï¼Œå› ä¸ºè¯¥å—æ˜¯åœ¨æœ€ç»ˆç¡®å®šä¹‹å‰å¼€é‡‡çš„ã€‚</li></ul><p>é‡è¦çš„æ˜¯è¦æ³¨æ„ï¼Œåœ¨æœ€ç»ˆç¡®å®šä¹‹å‰ï¼Œç»™å®šçš„å­é“¾å¯èƒ½ä¼šè¢«æ›¿æ¢ä¸ºåœ¨ç»™å®šå›åˆä¸­å¼€é‡‡çš„å¦ä¸€ä¸ªè¾ƒé‡çš„å­é“¾ã€‚ä¸ºäº†å¿«é€Ÿé€‚åº”è¿™ç§æƒ…å†µï¼Œé“¾ç®¡ç†è€…å¿…é¡»ç»´æŠ¤å’Œæ›´æ–°æ‰€æœ‰è€ƒè™‘åˆ°æœ€ç»ˆçš„å­é“¾ã€‚</p><p>é“¾é€‰æ‹©æ˜¯FilecoinåŒºå—é“¾å·¥ä½œæ–¹å¼çš„å…³é”®ç»„æˆéƒ¨åˆ†ã€‚ç®€è€Œè¨€ä¹‹ï¼Œæ¯ä¸ªé“¾éƒ½æœ‰ç›¸å…³çš„æƒé‡ï¼Œè¿™äº›æƒé‡è¯´æ˜äº†åœ¨å…¶ä¸Šå¼€é‡‡çš„å—æ•°ä»¥åŠå®ƒä»¬è·Ÿè¸ªçš„åŠŸç‡ï¼ˆå­˜å‚¨ï¼‰ã€‚â€œé€‰æ‹©<a href="https://spec.filecoin.io/#section-algorithms.expected_consensus.chain-selection" target="_blank" rel="noopener noreferrer">é“¾â€<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>éƒ¨åˆ†æä¾›äº†æœ‰å…³é€‰æ‹©å·¥ä½œåŸç†çš„å…¨éƒ¨è¯¦ç»†ä¿¡æ¯ ã€‚</p><p><strong>æ³¨é‡Š/å»ºè®®ï¼š</strong></p><ol><li>ä¸ºäº†ç®€åŒ–æŸäº›éªŒè¯æ£€æŸ¥ï¼Œåº”è¯¥æŒ‰é«˜åº¦å’Œçˆ¶é›†å¯¹å—è¿›è¡Œç´¢å¼•ã€‚è¿™æ ·ï¼Œå¯ä»¥å¿«é€ŸæŸ¥è¯¢å…·æœ‰ç»™å®šé«˜åº¦å’Œæ™®é€šçˆ¶æ¯çš„å‡ ç»„ç§¯æœ¨ã€‚</li><li>åœ¨è¿™äº›é›†ä¸­è®¡ç®—å’Œç¼“å­˜å—çš„ç»“æœèšåˆçŠ¶æ€å¯èƒ½ä¹Ÿå¾ˆæœ‰ç”¨ï¼Œå½“æ£€æŸ¥æœ‰å¤šä¸ªçˆ¶çº§çš„å—ä»å“ªä¸ªçŠ¶æ€æ ¹å¼€å§‹æ—¶ï¼Œè¿™æ ·å¯ä»¥èŠ‚çœé¢å¤–çš„çŠ¶æ€è®¡ç®—ã€‚</li><li>å»ºè®®å°†å—ä¿ç•™åœ¨æœ¬åœ°æ•°æ®å­˜å‚¨ä¸­ï¼Œæ— è®ºæ­¤æ—¶æ˜¯å¦å°†å…¶ç†è§£ä¸ºæœ€ä½³æŠ€å·§-è¿™æ˜¯ä¸ºäº†é¿å…å°†æ¥ä¸å¾—ä¸é‡æ–°æå–ç›¸åŒçš„å—ã€‚</li></ol><h6 id="_2-4-1-3-1-2chaintipsmanager" tabindex="-1"><a class="header-anchor" href="#_2-4-1-3-1-2chaintipsmanager" aria-hidden="true">#</a> 2.4.1.3.1.2<a href="https://spec.filecoin.io/#section-systems.filecoin_blockchain.struct.chain_manager.chaintipsmanager" target="_blank" rel="noopener noreferrer">ChainTipsManager<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h6><p>é“¾æŠ€å·§ç®¡ç†å™¨æ˜¯Filecoinå…±è¯†çš„å­ç»„ä»¶ï¼Œè´Ÿè´£è·Ÿè¸ªFilecoinåŒºå—é“¾çš„æ‰€æœ‰å®æ—¶æŠ€å·§ï¼Œå¹¶è·Ÿè¸ªå½“å‰çš„â€œæœ€ä½³â€æŠ€å·§é›†ã€‚</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// Returns the ticket that is at round &#39;r&#39; in the chain behind &#39;head&#39;</span>
<span class="token keyword">func</span> <span class="token function">TicketFromRound</span><span class="token punctuation">(</span>head Tipset<span class="token punctuation">,</span> r Round<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">// Returns the tipset that contains round r (Note: multiple rounds&#39; worth of tickets may exist within a single block due to losing tickets being added to the eventually successfully generated block)</span>
<span class="token keyword">func</span> <span class="token function">TipsetFromRound</span><span class="token punctuation">(</span>head Tipset<span class="token punctuation">,</span> r Round<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">// GetBestTipset returns the best known tipset. If the &#39;best&#39; tipset hasn&#39;t changed, then this</span>
<span class="token comment">// will return the previous best tipset.</span>
<span class="token keyword">func</span> <span class="token function">GetBestTipset</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// Adds the losing ticket to the chaintips manager so that blocks can be mined on top of it</span>
<span class="token keyword">func</span> <span class="token function">AddLosingTicket</span><span class="token punctuation">(</span>parent Tipset<span class="token punctuation">,</span> t Ticket<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-4-1-4åˆ¶ç‰‡äºº" tabindex="-1"><a class="header-anchor" href="#_2-4-1-4åˆ¶ç‰‡äºº" aria-hidden="true">#</a> 2.4.1.4<a href="https://spec.filecoin.io/#section-systems.filecoin_blockchain.struct.block_producer" target="_blank" rel="noopener noreferrer">åˆ¶ç‰‡äºº<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><h5 id="_2-4-1-4-1é‡‡çŸ¿å—" tabindex="-1"><a class="header-anchor" href="#_2-4-1-4-1é‡‡çŸ¿å—" aria-hidden="true">#</a> 2.4.1.4.1<a href="https://spec.filecoin.io/#section-systems.filecoin_blockchain.struct.block_producer.mining-blocks" target="_blank" rel="noopener noreferrer">é‡‡çŸ¿å—<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h5><p>å¦‚æœå·²è¯æ˜æ‹¥æœ‰æ»¡è¶³<a href="https://spec.filecoin.io/#section-systems.filecoin_blockchain.storage_power_consensus.minimum-miner-size" target="_blank" rel="noopener noreferrer">æœ€å°çŸ¿å·¥è§„æ¨¡<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>é˜ˆå€¼è¦æ±‚çš„å‚¨é‡ï¼Œåˆ™å‘å‚¨èƒ½æ¼”å‘˜æ³¨å†Œçš„çŸ¿å·¥å¯ä»¥å¼€å§‹ç”Ÿæˆå’Œæ£€æŸ¥é€‰ä¸¾ç¥¨ ã€‚</p><p>ä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼ŒçŸ¿å·¥å¿…é¡»è¿›è¡Œè¿é”éªŒè¯ï¼Œå¹¶è·Ÿè¸ªæ”¶åˆ°çš„æœ€æ–°åŒºå—ã€‚çŸ¿å·¥çš„æ–°åŒºå—å°†åŸºäºå‰ä¸€ä¸ªæ—¶æœŸçš„çˆ¶æ¯ã€‚</p><h6 id="_2-4-1-4-1-1å—åˆ›å»º" tabindex="-1"><a class="header-anchor" href="#_2-4-1-4-1-1å—åˆ›å»º" aria-hidden="true">#</a> 2.4.1.4.1.1<a href="https://spec.filecoin.io/#section-systems.filecoin_blockchain.struct.block_producer.block-creation" target="_blank" rel="noopener noreferrer">å—åˆ›å»º<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h6><p>ä¸ºä¸€ä¸ªæ—¶æœŸç”Ÿæˆä¸€ä¸ªå—<code>H</code>éœ€è¦ç­‰å¾…è¯¥æ—¶æœŸçš„ä¿¡æ ‡è¾“å…¥å¹¶ä½¿ç”¨å®ƒæ¥è¿è¡Œ<code>GenerateElectionProof</code>ã€‚å¦‚æœ<code>WinCount</code>â‰¥1ï¼ˆå³ï¼Œå½“çŸ¿å·¥å½“é€‰ï¼‰ï¼Œç›¸åŒçš„ä¿¡æ ‡æ¡ç›®ç”¨äºè¿è¡Œ<code>WinningPoSt</code>ã€‚æœ‰äº†<code>ElectionProof</code>ç¥¨è¯ï¼ˆçš„è¾“å‡º<code>GenerateElectionProof</code>ï¼‰å’Œ<code>WinningPoSt</code>è¯æ˜ï¼ŒçŸ¿å·¥å¯ä»¥ç”Ÿäº§ä¸€ä¸ªæ–°çš„åŒºå—ã€‚</p><p>è§ <a href="https://spec.filecoin.io/#section-systems.filecoin_vm.interpreter" target="_blank" rel="noopener noreferrer">VMè§£é‡Š<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ä¸ºæ¯ä½“tipsetè¯„ä»·çš„ç»†èŠ‚ï¼Œå¹¶ <a href="https://spec.filecoin.io/#section-systems.filecoin_blockchain.struct.block" target="_blank" rel="noopener noreferrer">é˜»æ­¢<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>å¯¹æœ‰æ•ˆå—æ ‡å¤´å€¼çš„çº¦æŸã€‚</p><p>è¦åˆ›å»ºä¸€ä¸ªåŒºå—ï¼Œåˆæ ¼çš„çŸ¿å·¥å¿…é¡»è®¡ç®—ä¸€äº›å­—æ®µï¼š</p><ul><li><p><code>Parents</code> -çˆ¶æç¤ºé›†å—çš„CIDã€‚</p></li><li><p><code>ParentWeight</code>-çˆ¶é“¾çš„æƒé‡ï¼ˆè¯·å‚é˜…â€œ <a href="https://spec.filecoin.io/#section-algorithms.expected_consensus.chain-selection" target="_blank" rel="noopener noreferrer">é“¾é€‰æ‹©â€<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ï¼‰ã€‚</p></li><li><p><code>ParentState</code>-æ¥è‡ªçˆ¶æç¤ºé›†çŠ¶æ€è¯„ä¼°çš„çŠ¶æ€æ ¹çš„CIDï¼ˆè¯·å‚é˜… <a href="https://spec.filecoin.io/#section-systems.filecoin_vm.interpreter" target="_blank" rel="noopener noreferrer">VM Interpreter<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ï¼‰ã€‚</p></li><li><p><code>ParentMessageReceipts</code>-AMTæ ¹ç›®å½•çš„CIDï¼Œå…¶ä¸­åŒ…å«è®¡ç®—æ—¶äº§ç”Ÿçš„æ”¶æ®<code>ParentState</code>ã€‚</p></li><li><p><code>Epoch</code>-å—çš„çºªå…ƒï¼Œä»è¯¥<code>Parents</code>çºªå…ƒå’Œç”Ÿæˆè¯¥å—æ‰€èŠ±è´¹çš„çºªå…ƒæ•°å¾—å‡ºã€‚</p></li><li><p><code>Timestamp</code> -åˆ›å»ºå—æ—¶ç”Ÿæˆçš„Unixæ—¶é—´æˆ³ï¼ˆä»¥ç§’ä¸ºå•ä½ï¼‰ã€‚</p></li><li><p><code>BeaconEntries</code>-ä»æœ€åä¸€ä¸ªå—å¼€å§‹ç”Ÿæˆçš„ä¸€ç»„drandæ¡ç›®ï¼ˆè¯·å‚é˜… <a href="https://spec.filecoin.io/#section-systems.filecoin_blockchain.storage_power_consensus.beacon-entries" target="_blank" rel="noopener noreferrer">Beacon Entries<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ï¼‰ã€‚</p></li><li><p><code>Ticket</code>-ä»ä¸Šä¸€ä¸ªçºªå…ƒç”Ÿæˆçš„æ–°ç¥¨è¯ï¼ˆè¯·å‚è§ <a href="https://spec.filecoin.io/#section-systems.filecoin_blockchain.storage_power_consensus.randomness-ticket-generation" target="_blank" rel="noopener noreferrer">ç¥¨è¯ç”Ÿæˆ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ï¼‰ã€‚</p></li><li><p><code>Miner</code> -åŒºå—ç”Ÿäº§è€…çš„çŸ¿å·¥æ¼”å‘˜åœ°å€ã€‚</p></li><li><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Messages
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>-</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>TxMeta
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>åŒ…å«å»ºè®®åŒ…å«åœ¨æ–°å—ä¸­çš„æ¶ˆæ¯çš„å¯¹è±¡çš„CID ï¼š</p><ul><li>ä»å†…å­˜æ± ä¸­é€‰æ‹©ä¸€ç»„æ¶ˆæ¯ä»¥åŒ…æ‹¬åœ¨å—ä¸­ï¼Œä»¥æ»¡è¶³å—å¤§å°å’Œæ°”ä½“é™åˆ¶</li><li>å°†é‚®ä»¶åˆ†ä¸ºBLSç­¾åé‚®ä»¶å’Œsecpkç­¾åé‚®ä»¶</li><li><code>TxMeta.BLSMessages</code>ï¼šåŒ…å«è£¸ç¬”<code>UnsignedMessage</code>çš„AMTæ ¹ç›®å½•çš„CID</li><li><code>TxMeta.SECPMessages</code>ï¼šä¸€ä¸ªAMTçš„æ ¹çš„CIDåŒ…æ‹¬<code>SignedMessage</code>å°å·</li></ul></li><li><p><code>BeaconEntries</code>ï¼šä»ä¸­å¯¼å‡ºéšæœºæ€§çš„ä¿¡æ ‡æ¡ç›®åˆ—è¡¨</p></li><li><p><code>BLSAggregate</code> -ä½¿ç”¨BLSç­¾åçš„å—ä¸­æ‰€æœ‰æ¶ˆæ¯çš„èšé›†ç­¾åã€‚</p></li><li><p><code>Signature</code> -åœ¨åŒºå—æ ‡é¢˜çš„åºåˆ—åŒ–è¡¨ç¤ºå½¢å¼ï¼ˆå¸¦æœ‰ç©ºç­¾åï¼‰ä¸Šå…·æœ‰çŸ¿å·¥çš„å·¥äººå¸æˆ·ç§é’¥çš„ç­¾åï¼ˆè¿˜å¿…é¡»ä¸ç¥¨è¯ç­¾ååŒ¹é…ï¼‰ã€‚</p></li><li><p><code>ForkSignaling</code>-uint64æ ‡å¿—ç”¨ä½œä¿¡ä»¤åˆ†å‰çš„ä¸€éƒ¨åˆ†ã€‚é»˜è®¤æƒ…å†µä¸‹åº”è®¾ç½®ä¸º0ã€‚</p></li></ul><p>æ³¨æ„ï¼Œè¦ç”Ÿæˆæœ‰æ•ˆå—ï¼Œæ— éœ€è¯„ä¼°è¦åŒ…å«åœ¨å—ä¸­çš„æ¶ˆæ¯ã€‚çŸ¿å·¥å¯èƒ½ä»å¸Œæœ›é€šè¿‡æŠ•æœºæ–¹å¼è¯„ä¼°æ¶ˆæ¯ï¼Œä»¥ä¾¿è¿›è¡Œä¼˜åŒ–ï¼Œä»¥åŒ…æ‹¬å°†æˆåŠŸæ‰§è¡Œå¹¶æ”¯ä»˜æœ€å¤šæ±½æ²¹çš„æ¶ˆæ¯ã€‚</p><p>äº§ç”Ÿç§¯æœ¨æ—¶ä¸è¯„ä¼°ç§¯æœ¨å¥–åŠ±ã€‚åœ¨ä»¥ä¸‹çºªå…ƒçš„æç¤ºé›†ä¸­åŒ…å«è¯¥åŒºå—æ—¶ï¼Œå°†å¯¹å…¶è¿›è¡Œæ”¯ä»˜ã€‚</p><p>åŒºå—çš„ç­¾åç¡®ä¿äº†åŒºå—åœ¨ä¼ æ’­åçš„å®Œæ•´æ€§ï¼Œå› ä¸ºä¸è®¸å¤šPoWåŒºå—é“¾ä¸åŒï¼Œå‘ç°ä¸­å¥–ç¥¨è¯ä¸åŒºå—ç”Ÿæˆæ— å…³ã€‚</p><h6 id="_2-4-1-4-1-2å—å¹¿æ’­" tabindex="-1"><a class="header-anchor" href="#_2-4-1-4-1-2å—å¹¿æ’­" aria-hidden="true">#</a> 2.4.1.4.1.2<a href="https://spec.filecoin.io/#section-systems.filecoin_blockchain.struct.block_producer.block-broadcast" target="_blank" rel="noopener noreferrer">å—å¹¿æ’­<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h6><p>åˆæ ¼çš„çŸ¿å·¥ä½¿ç”¨<a href="https://spec.filecoin.io/#section-algorithms.gossip_sub" target="_blank" rel="noopener noreferrer">GossipSub<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> <code>/fil/blocks</code>ä¸»é¢˜å°†å®Œæˆçš„åŒºå—ä¼ æ’­åˆ°ç½‘ç»œ ï¼Œå¹¶ä¸”å‡è®¾ä¸€åˆ‡éƒ½æ­£ç¡®å®Œæˆï¼Œåˆ™ç½‘ç»œå°†æ¥å—å®ƒï¼Œå…¶ä»–çŸ¿å·¥å°†åœ¨å…¶ä¹‹ä¸Šè¿›è¡ŒæŒ–æ˜ï¼Œä»è€Œè·å¾—çŸ¿å·¥çš„å¥–åŠ±ã€‚</p><p>çŸ¿å·¥åº”åœ¨äº§ç”Ÿæœ‰æ•ˆå—åç«‹å³è¾“å‡ºå…¶æœ‰æ•ˆå—ï¼Œå¦åˆ™å†’ç€å…¶ä»–çŸ¿å·¥å†’ç€åœ¨EPOCH_CUTOFFä¹‹åæ¥æ”¶è¯¥å—ä¸”ä¸å°†å…¶åŒ…æ‹¬åœ¨å½“å‰æ—¶æœŸä¸­çš„é£é™©ã€‚</p><h5 id="_2-4-1-4-2å—å¥–åŠ±" tabindex="-1"><a class="header-anchor" href="#_2-4-1-4-2å—å¥–åŠ±" aria-hidden="true">#</a> 2.4.1.4.2<a href="https://spec.filecoin.io/#section-systems.filecoin_blockchain.struct.block_producer.block-rewards" target="_blank" rel="noopener noreferrer">å—å¥–åŠ±<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h5><p>é›†ä½“å¥–åŠ±ç”±<a href="https://spec.filecoin.io/#section-systems.filecoin_vm.sysactors.rewardactor" target="_blank" rel="noopener noreferrer">å¥–åŠ±æ¼”å‘˜<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>å¤„ç† ã€‚åœ¨<a href="https://spec.filecoin.io/#section-systems.filecoin_token" target="_blank" rel="noopener noreferrer">Filecoinä»¤ç‰Œ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>éƒ¨åˆ†è®¨è®ºäº† æœ‰å…³åŒºå—å¥–åŠ±çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œåœ¨<a href="https://spec.filecoin.io/#section-systems.filecoin_mining.miner_collaterals" target="_blank" rel="noopener noreferrer">çŸ¿å·¥æŠµæŠ¼å“<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>éƒ¨åˆ†è®¨è®ºäº†æœ‰å…³åŒºå—å¥–åŠ±æŠµæŠ¼çš„è¯¦ç»†ä¿¡æ¯ ã€‚</p><h3 id="_2-4-ä¿¡æ¯æ± " tabindex="-1"><a class="header-anchor" href="#_2-4-ä¿¡æ¯æ± " aria-hidden="true">#</a> 2.4.<a href="https://spec.filecoin.io/#section-systems.filecoin_blockchain.message_pool" target="_blank" rel="noopener noreferrer">ä¿¡æ¯æ± <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h3><p>æ¶ˆæ¯æ± ï¼Œæˆ–è€…<code>mpool</code>æˆ–è€…<code>mempool</code>æ˜¯Filecoinåè®®ä¸­çš„æ¶ˆæ¯æ± ã€‚å®ƒå……å½“FilecoinèŠ‚ç‚¹ä¸ç”¨äºé“¾ä¸‹æ¶ˆæ¯ä¼ æ’­çš„å…¶ä»–èŠ‚ç‚¹çš„å¯¹ç­‰ç½‘ç»œä¹‹é—´çš„æ¥å£ã€‚èŠ‚ç‚¹ä½¿ç”¨æ¶ˆæ¯æ± æ¥ç»´æŠ¤å®ƒä»¬è¦ä¼ è¾“åˆ°Filecoin VMå¹¶æ·»åŠ åˆ°é“¾ä¸­çš„ä¸€ç»„æ¶ˆæ¯ï¼ˆå³ï¼Œæ·»åŠ ç”¨äºâ€œé“¾ä¸Šâ€æ‰§è¡Œï¼‰ã€‚</p><p>ä¸ºäº†ä½¿æ¶ˆæ¯æœ€ç»ˆå‡ºç°åœ¨åŒºå—é“¾ä¸­ï¼Œå®ƒé¦–å…ˆå¿…é¡»ä½äºæ¶ˆæ¯æ± ä¸­ã€‚å®é™…ä¸Šï¼Œè‡³å°‘åœ¨Filecoinçš„Lotuså®ç°ä¸­ï¼Œæ²¡æœ‰ä¸­å¤®æ¶ˆæ¯æ± å­˜å‚¨åœ¨æŸå¤„ã€‚è€Œæ˜¯ï¼Œæ¶ˆæ¯æ± æ˜¯ä¸€ç§æŠ½è±¡ï¼Œå¹¶å®ç°ä¸ºç½‘ç»œä¸­æ¯ä¸ªèŠ‚ç‚¹ä¿ç•™çš„æ¶ˆæ¯åˆ—è¡¨ã€‚å› æ­¤ï¼Œå½“èŠ‚ç‚¹å°†æ–°æ¶ˆæ¯æ”¾å…¥æ¶ˆæ¯æ± æ—¶ï¼Œè¯¥æ¶ˆæ¯å°†ä½¿ç”¨libp2pçš„pubsubåè®®GossipSubä¼ æ’­åˆ°ç½‘ç»œçš„å…¶ä½™éƒ¨åˆ†ã€‚èŠ‚ç‚¹éœ€è¦è®¢é˜…ç›¸åº”çš„pubsubä¸»é¢˜æ‰èƒ½æ¥æ”¶æ¶ˆæ¯ã€‚</p><p>ä½¿ç”¨GossipSubè¿›è¡Œæ¶ˆæ¯ä¼ æ’­ä¸ä¼šç«‹å³å‘ç”Ÿï¼Œå› æ­¤ï¼Œåœ¨ä¸åŒèŠ‚ç‚¹ä¸Šçš„æ¶ˆæ¯æ± å¯ä»¥åŒæ­¥ä¹‹å‰å­˜åœ¨ä¸€äº›æ»åã€‚å®é™…ä¸Šï¼Œåœ¨ç»™æ¶ˆæ¯æ± æ·»åŠ è¿ç»­çš„æ¶ˆæ¯æµä»¥åŠä¼ æ’­æ¶ˆæ¯çš„å»¶è¿Ÿçš„æƒ…å†µä¸‹ï¼Œæ¶ˆæ¯æ± æ°¸è¿œä¸ä¼šåœ¨ç½‘ç»œä¸­çš„æ‰€æœ‰èŠ‚ç‚¹ä¹‹é—´åŒæ­¥ã€‚è¿™ä¸æ˜¯ç³»ç»Ÿçš„ç¼ºç‚¹ï¼Œå¦‚ä¸æ˜¯çŸ­ä¿¡æ± ä¹Ÿ<em>éœ€è¦</em>é€šè¿‡ç½‘ç»œè¿›è¡ŒåŒæ­¥ã€‚</p><p>æ¶ˆæ¯æ± åº”å…·æœ‰å®šä¹‰çš„æœ€å¤§å¤§å°ï¼Œä»¥é¿å…DoSæ”»å‡»ï¼Œåœ¨DoSæ”»å‡»ä¸­ï¼ŒèŠ‚ç‚¹è¢«åƒåœ¾é‚®ä»¶åå™¬å¹¶è€—å°½å†…å­˜ã€‚æ¶ˆæ¯æ± çš„å»ºè®®å¤§å°ä¸º5000æ¡æ¶ˆæ¯ã€‚</p><h4 id="_2-4-2-1è®¯æ¯ä¼ æ’­" tabindex="-1"><a class="header-anchor" href="#_2-4-2-1è®¯æ¯ä¼ æ’­" aria-hidden="true">#</a> 2.4.2.1<a href="https://spec.filecoin.io/#section-systems.filecoin_blockchain.message_pool.message_syncer" target="_blank" rel="noopener noreferrer">è®¯æ¯ä¼ æ’­<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><p>æ¶ˆæ¯æ± å¿…é¡»ä¸libp2p pubsub <a href="https://github.com/libp2p/specs/tree/master/pubsub/gossipsub" target="_blank" rel="noopener noreferrer">GossipSub<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>åè®®æ¥å£ ã€‚è¿™æ˜¯å› ä¸ºæ¶ˆæ¯é€šè¿‡<a href="https://github.com/libp2p/specs/tree/master/pubsub/gossipsub" target="_blank" rel="noopener noreferrer">GossipSub<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ä¼ æ’­äº† ç›¸åº”çš„<code>/fil/msgs/</code> <em>ä¸»é¢˜</em>ã€‚å‚ä¸ç½‘ç»œçš„ä»»ä½•èŠ‚ç‚¹éƒ½ä¼šåœ¨ç›¸åº”çš„ä¸»é¢˜ä¸­å®£å¸ƒæ¯ä¸ª <a href="https://spec.filecoin.io/#section-systems.filecoin_vm.message" target="_blank" rel="noopener noreferrer">æ¶ˆæ¯<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><code>/fil/msgs/</code>ã€‚</p><p>æœ‰ä¸¤ä¸ªä¸æ¶ˆæ¯å’Œå—ç›¸å…³çš„ä¸»è¦pubsubä¸»é¢˜ï¼šiï¼‰<code>/fil/msgs/</code>æºå¸¦æ¶ˆæ¯çš„ä¸»é¢˜ï¼Œä»¥åŠiiï¼‰<code>/fil/blocks/</code>æºå¸¦å—çš„ä¸»é¢˜ã€‚è¯¥<code>/fil/msgs/</code>ä¸»é¢˜é“¾æ¥åˆ°<code>mpool</code>ã€‚æµç¨‹å¦‚ä¸‹ï¼š</p><ol><li>å½“å®¢æˆ·æƒ³è¦åœ¨Filecoinç½‘ç»œä¸­å‘é€æ¶ˆæ¯æ—¶ï¼Œä»–ä»¬ä¼šå°†æ¶ˆæ¯å‘å¸ƒåˆ°<code>/fil/msgs/</code>ä¸»é¢˜ã€‚</li><li>è¯¥æ¶ˆæ¯ä½¿ç”¨GossipSubä¼ æ’­åˆ°ç½‘ç»œä¸­çš„æ‰€æœ‰å…¶ä»–èŠ‚ç‚¹ï¼Œå¹¶æœ€ç»ˆå‡ºç°åœ¨<code>mpool</code>æ‰€æœ‰çŸ¿å·¥ä¸­ã€‚</li><li>æ ¹æ®åŠ å¯†è´§å¸ç»æµè§„åˆ™ï¼ŒæŸäº›çŸ¿å·¥æœ€ç»ˆä¼šä»ä¸­<code>mpool</code>ï¼ˆä¸å…¶ä»–æ¶ˆæ¯ä¸€èµ·ï¼‰æŒ‘é€‰æ¶ˆæ¯å¹¶å°†å…¶åŒ…å«åœ¨ä¸€ä¸ªå—ä¸­ã€‚</li><li>çŸ¿å·¥åœ¨<code>/fil/blocks/</code>pubsubä¸»é¢˜ä¸­å‘å¸ƒæ–°æŒ–æ˜çš„å—ï¼Œå¹¶ä¸”è¯¥å—ä¼ æ’­åˆ°ç½‘ç»œä¸­çš„æ‰€æœ‰èŠ‚ç‚¹ï¼ˆåŒ…æ‹¬å‘å¸ƒæ­¤å—ä¸­åŒ…å«çš„æ¶ˆæ¯çš„èŠ‚ç‚¹ï¼‰ã€‚</li></ol><p>èŠ‚ç‚¹å¿…é¡»æ£€æŸ¥ä¼ å…¥æ¶ˆæ¯æ˜¯å¦æœ‰æ•ˆï¼Œå³å®ƒä»¬æ˜¯å¦å…·æœ‰æœ‰æ•ˆç­¾åã€‚å¦‚æœè¯¥æ¶ˆæ¯æ— æ•ˆï¼Œåˆ™åº”å°†å…¶ä¸¢å¼ƒå¹¶ä¸”ä¸å¾—è½¬å‘ã€‚</p><p>GossipSubåè®®çš„æ›´æ–°çš„å¼ºåŒ–ç‰ˆæœ¬åŒ…æ‹¬å¤šç§ç¼“è§£æ”»å‡»çš„ç­–ç•¥ã€‚ä¾‹å¦‚ï¼Œå½“èŠ‚ç‚¹æ”¶åˆ°æ— æ•ˆæ¶ˆæ¯æ—¶ï¼Œå®ƒå°†è´Ÿ<em>åˆ†æ•°</em>åˆ†é…ç»™å‘é€æ–¹å¯¹ç­‰æ–¹ã€‚å¯¹ç­‰åˆ†æ•°ä¸ä¸å…¶ä»–èŠ‚ç‚¹å…±äº«ï¼Œè€Œæ˜¯ç”±å…¶ä¸ä¹‹äº¤äº’çš„æ‰€æœ‰å…¶ä»–å¯¹ç­‰ç‚¹åœ¨æ¯ä¸ªå¯¹ç­‰ç‚¹æœ¬åœ°ä¿å­˜ã€‚å¦‚æœå¯¹ç­‰æ–¹çš„å¾—åˆ†ä¸‹é™åˆ°é˜ˆå€¼ä»¥ä¸‹ï¼Œåˆ™å°†å…¶ä»è¯„åˆ†å¯¹ç­‰æ–¹çš„ç½‘æ ¼ä¸­æ’é™¤ã€‚æˆ‘ä»¬å°†åœ¨GossipSubéƒ¨åˆ†ä¸­è®¨è®ºæœ‰å…³è¿™äº›è®¾ç½®çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚å®Œæ•´çš„ç»†èŠ‚å¯ä»¥åœ¨<a href="https://github.com/libp2p/specs/tree/master/pubsub/gossipsub" target="_blank" rel="noopener noreferrer">GossipSubè§„èŒƒä¸­<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>æ‰¾åˆ° ã€‚</p><p>ç¬”è®°ï¼š</p><ul><li>*èµ„é‡‘æ£€æŸ¥ï¼š*é‡è¦çš„æ˜¯è¦æ³¨æ„ï¼Œ<code>mpool</code>é€»è¾‘ä¸æ˜¯æ£€æŸ¥é‚®ä»¶å‘è¡Œè€…å¸æˆ·ä¸­æ˜¯å¦æœ‰è¶³å¤Ÿçš„èµ„é‡‘ã€‚çŸ¿å·¥åœ¨å°†æ¶ˆæ¯åŒ…å«åœ¨å—ä¸­ä¹‹å‰ä¼šå¯¹æ­¤è¿›è¡Œæ£€æŸ¥ã€‚</li><li>*æ¶ˆæ¯æ’åºï¼š*æ¶ˆæ¯æŒ‰ç…§<code>mpool</code>åˆ°è¾¾çŸ¿å·¥æ—¶éµå¾ªçš„åŠ å¯†ç»æµè§„åˆ™ï¼ŒæŒ‰çŸ¿å·¥çš„é¡ºåºè¿›è¡Œæ’åºï¼Œä»¥ä¾¿çŸ¿å·¥ç»„æˆä¸‹ä¸€ä¸ªåŒºå—ã€‚</li></ul><h4 id="_2-4-2-2è®¯æ¯å‚¨å­˜" tabindex="-1"><a class="header-anchor" href="#_2-4-2-2è®¯æ¯å‚¨å­˜" aria-hidden="true">#</a> 2.4.2.2<a href="https://spec.filecoin.io/#section-systems.filecoin_blockchain.message_pool.message_storage" target="_blank" rel="noopener noreferrer">è®¯æ¯å‚¨å­˜<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><p>å¦‚å‰æ‰€è¿°ï¼Œæ²¡æœ‰åŒ…å«æ¶ˆæ¯çš„ä¸­å¤®æ± ã€‚ç›¸åï¼Œæ¯ä¸ªèŠ‚ç‚¹å¿…é¡»å·²ä¸ºä¼ å…¥æ¶ˆæ¯åˆ†é…äº†å†…å­˜ã€‚</p><h3 id="_2-4-3é“¾åŒæ­¥" tabindex="-1"><a class="header-anchor" href="#_2-4-3é“¾åŒæ­¥" aria-hidden="true">#</a> 2.4.3<a href="https://spec.filecoin.io/#section-systems.filecoin_blockchain.chainsync" target="_blank" rel="noopener noreferrer">é“¾åŒæ­¥<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h3><p>åŒºå—é“¾åŒæ­¥ï¼ˆâ€œ syncâ€ï¼‰æ˜¯åŒºå—é“¾ç³»ç»Ÿçš„å…³é”®éƒ¨åˆ†ã€‚å®ƒå¤„ç†å—å’Œæ¶ˆæ¯çš„æ£€ç´¢å’Œä¼ æ’­ï¼Œå› æ­¤è´Ÿè´£åˆ†å¸ƒå¼çŠ¶æ€å¤åˆ¶ã€‚å› æ­¤ï¼Œæ­¤è¿‡ç¨‹å¯¹å®‰å…¨æ€§è‡³å…³é‡è¦-çŠ¶æ€å¤åˆ¶é—®é¢˜å¯èƒ½å¯¹åŒºå—é“¾çš„è¿è¡Œäº§ç”Ÿä¸¥é‡å½±å“ã€‚</p><p>å½“èŠ‚ç‚¹é¦–æ¬¡åŠ å…¥ç½‘ç»œæ—¶ï¼Œå®ƒä¼šå‘ç°å¯¹ç­‰èŠ‚ç‚¹ï¼ˆé€šè¿‡ä¸Šé¢è®¨è®ºçš„å¯¹ç­‰èŠ‚ç‚¹å‘ç°ï¼‰ï¼Œå¹¶åŠ å…¥<code>/fil/blocks</code>å’Œ<code>/fil/msgs</code>GossipSubä¸»é¢˜ã€‚å®ƒä¾¦å¬å…¶ä»–èŠ‚ç‚¹æ­£åœ¨ä¼ æ’­çš„æ–°å—ã€‚å®ƒé€‰æ‹©ä¸€ä¸ªå—ä½œä¸ºï¼Œ<code>BestTargetHead</code>å¹¶å¼€å§‹åŒæ­¥ä»åˆ°æ­¤é«˜åº¦çš„åŒºå—é“¾<code>TrustedCheckpoint</code>ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¸º<code>GenesisBlock</code>or <code>GenesisCheckpoint</code>ã€‚ä¸ºäº†æŒ‘é€‰<code>BestTargetHead</code>åŒä¼´ï¼Œä»–ä»¬æ¯”è¾ƒèº«é«˜å’Œä½“é‡çš„ç»„åˆ-è¿™äº›å€¼è¶Šé«˜ï¼ŒåŒºå—å‡ºç°åœ¨ä¸»é“¾ä¸Šçš„æœºä¼šå°±è¶Šé«˜ã€‚å¦‚æœä¸¤ä¸ªå—çš„é«˜åº¦ç›¸åŒï¼Œåˆ™å¯¹ç­‰æ–¹åº”é€‰æ‹©æƒé‡è¾ƒé«˜çš„ä¸€ä¸ªã€‚ä¸€æ—¦å¯¹ç­‰æ–¹é€‰æ‹©ï¼Œ<code>BestTargetHead</code>å®ƒå°†ä½¿ç”¨BlockSyncåè®®æ¥è·å–å—å¹¶è¾¾åˆ°å½“å‰é«˜åº¦ã€‚ä»é‚£ä¸€ç‚¹å¼€å§‹<code>CHAIN_FOLLOW</code> æ¨¡å¼ï¼Œå®ƒä½¿ç”¨GossipSubæ¥æ”¶æ–°çš„å—ï¼Œæˆ–è€…ï¼Œå¦‚æœå¬åˆ°æœ‰å…³å®ƒå°šæœªé€šè¿‡GossipSubæ¥æ”¶çš„å—çš„æ¶ˆæ¯ï¼Œåˆ™ä½¿ç”¨Bitswapã€‚</p><h4 id="_2-4-3-chainsyncæ¦‚è¿°" tabindex="-1"><a class="header-anchor" href="#_2-4-3-chainsyncæ¦‚è¿°" aria-hidden="true">#</a> 2.4.3.<a href="https://spec.filecoin.io/#section-systems.filecoin_blockchain.chainsync.chainsync-overview" target="_blank" rel="noopener noreferrer">ChainSyncæ¦‚è¿°<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><p><code>ChainSync</code>æ˜¯Filecoinç”¨æ¥åŒæ­¥å…¶åŒºå—é“¾çš„åè®®ã€‚å®ƒç‰¹å®šäºFilecoinåœ¨çŠ¶æ€è¡¨ç¤ºå’Œå…±è¯†è§„åˆ™ä¸­çš„é€‰æ‹©ï¼Œä½†æ˜¯è¶³å¤Ÿé€šç”¨ï¼Œå¯ä»¥æœåŠ¡äºå…¶ä»–åŒºå—é“¾ã€‚<code>ChainSync</code>æ˜¯ä¸€ç»„è¾ƒå°çš„åè®®ï¼Œå®ƒä»¬å¤„ç†åŒæ­¥è¿‡ç¨‹çš„ä¸åŒéƒ¨åˆ†ã€‚</p><p>åœ¨ä»¥ä¸‹æƒ…å†µä¸‹ï¼Œé€šå¸¸éœ€è¦é“¾åŒæ­¥ï¼š</p><ol><li>å½“èŠ‚ç‚¹é¦–æ¬¡åŠ å…¥ç½‘ç»œå¹¶ä¸”éœ€è¦åœ¨éªŒè¯æˆ–æ‰©å±•é“¾ä¹‹å‰è¾¾åˆ°å½“å‰çŠ¶æ€æ—¶ã€‚</li><li>å½“èŠ‚ç‚¹ç”±äºçŸ­æš‚æ–­å¼€è€Œå¤±å»åŒæ­¥æ—¶ã€‚</li><li>åœ¨æ­£å¸¸æ“ä½œæœŸé—´ï¼Œä»¥è·Ÿä¸Šæœ€æ–°æ¶ˆæ¯å’Œå—ã€‚</li></ol><p>åœ¨è¿™ä¸‰ç§æƒ…å†µä¸‹ï¼Œä½¿ç”¨ä¸‰ç§ä¸»è¦åè®®æ¥å®ç°åŒæ­¥ã€‚</p><ul><li><code>GossipSub</code>æ˜¯ç”¨äºä¼ æ’­æ¶ˆæ¯å’Œå—çš„libp2p pubsubåè®®ã€‚å½“èŠ‚ç‚¹éœ€è¦ä¸æ­£åœ¨äº§ç”Ÿå’Œä¼ æ’­çš„æ–°å—ä¿æŒåŒæ­¥æ—¶ï¼Œå®ƒä¸»è¦ç”¨äºä»¥ä¸Šç¬¬ä¸‰æ­¥ã€‚</li><li><code>BlockSync</code> ç”¨äºåŒæ­¥é“¾çš„ç‰¹å®šéƒ¨åˆ†ï¼Œå³ä»ç‰¹å®šé«˜åº¦åˆ°ç‰¹å®šé«˜åº¦ã€‚</li><li><code>hello</code>åè®®ï¼Œå½“ä¸¤ä¸ªå¯¹ç­‰æ–¹é¦–æ¬¡â€œè§é¢â€æ—¶ï¼ˆå³ï¼Œä»–ä»¬ç¬¬ä¸€æ¬¡ç›¸äº’è¿æ¥ï¼‰ä½¿ç”¨ã€‚æ ¹æ®åè®®ï¼Œä»–ä»¬äº¤æ¢é“¾å¤´ã€‚</li></ul><p>å¦å¤–ï¼Œ<code>Bitswap</code>å½“èŠ‚ç‚¹åŒæ­¥ï¼ˆâ€œè¿½èµ¶â€ï¼‰ä½†GossipSubæ— æ³•å°†æŸäº›å—ä¼ é€’åˆ°èŠ‚ç‚¹æ—¶ï¼Œç”¨äºè¯·æ±‚å’Œæ¥æ”¶å—ã€‚æœ€åï¼Œ<code>GraphSync</code>å¯ä»¥ç”¨æ¥è·å–åŒºå—é“¾çš„ä¸€éƒ¨åˆ†ä½œä¸ºçš„æ›´æœ‰æ•ˆç‰ˆæœ¬<code>Bitswap</code>ã€‚</p><p>FilecoinèŠ‚ç‚¹æ˜¯libp2pèŠ‚ç‚¹ï¼Œå› æ­¤å¯ä»¥è¿è¡Œå¤šç§å…¶ä»–åè®®ã€‚ä¸Filecoinä¸­çš„å…¶ä»–ä»»ä½•å†…å®¹ä¸€æ ·ï¼ŒèŠ‚ç‚¹å¯ä»¥é€‰æ‹©ä½¿ç”¨å…¶ä»–åè®®æ¥è·å¾—ç»“æœã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒèŠ‚ç‚¹å¿…é¡»å®ç°<code>ChainSync</code>æœ¬è§„èŒƒä¸­æ‰€è¿°çš„ç‰ˆæœ¬ï¼Œæ‰èƒ½è¢«è§†ä¸ºFilecoinçš„å®ç°ã€‚</p><h4 id="_2-4-3-2æœ¯è¯­å’Œæ¦‚å¿µ" tabindex="-1"><a class="header-anchor" href="#_2-4-3-2æœ¯è¯­å’Œæ¦‚å¿µ" aria-hidden="true">#</a> 2.4.3.2<a href="https://spec.filecoin.io/#section-systems.filecoin_blockchain.chainsync.terms-and-concepts" target="_blank" rel="noopener noreferrer">æœ¯è¯­å’Œæ¦‚å¿µ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><ul><li><code>LastCheckpoint``ChainSync</code>æ„è¯†åˆ°çš„æœ€åä¸€ä¸ªä¸¥æ ¼çš„é¢å‘ç¤¾ä¼šå…±è¯†çš„æ£€æŸ¥ç‚¹ã€‚è¿™ä¸ªå…±è¯†æ£€æŸ¥ç‚¹å®šä¹‰äº†æœ€å°çš„ç»ˆç»“æ€§å’Œæœ€å°çš„å†å²åŸºç¡€ã€‚ <code>ChainSync</code>æ¥å—<code>LastCheckpoint</code>å¹¶å»ºç«‹ä¿¡å¿µï¼Œæ°¸ä¸èƒŒç¦»å…¶å†å²ã€‚</li><li><code>TargetHeads``BlockCIDs</code>ä»£è¡¨å—ç”Ÿäº§è¾¹ç¼˜çš„å—çš„åˆ—è¡¨ã€‚è¿™äº›æ˜¯æœ€æ–°å’Œæœ€å¥½çš„<code>ChainSync</code>çŸ¥è¯†ã€‚å®ƒä»¬æ˜¯â€œç›®æ ‡â€å¤´ï¼Œå› ä¸º <code>ChainSync</code>å°†å°è¯•ä¸å…¶åŒæ­¥ã€‚è¯¥åˆ—è¡¨æŒ‰â€œæˆä¸ºæœ€ä½³è¿é”åº—çš„å¯èƒ½æ€§â€æ’åºã€‚åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œåªéœ€é€šè¿‡å³å¯å®ç°<code>ChainWeight</code>ã€‚</li><li><code>BestTargetHead``BlockCID</code>å°è¯•ä¸ä¹‹åŒæ­¥çš„æœ€ä½³é“¾å¤´ã€‚è¿™æ˜¯<code>TargetHeads</code></li></ul><h4 id="_2-4-3-3chainsyncçŠ¶æ€æœº" tabindex="-1"><a class="header-anchor" href="#_2-4-3-3chainsyncçŠ¶æ€æœº" aria-hidden="true">#</a> 2.4.3.3<a href="https://spec.filecoin.io/#section-systems.filecoin_blockchain.chainsync.chainsync-state-machine" target="_blank" rel="noopener noreferrer">ChainSyncçŠ¶æ€æœº<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><p>åœ¨è¾ƒé«˜çº§åˆ«ä¸Šï¼Œè¯·<code>ChainSync</code>æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p><ul><li>ç¬¬1éƒ¨åˆ†ï¼šéªŒè¯å†…éƒ¨çŠ¶æ€ï¼ˆ<code>INIT</code>ä»¥ä¸‹çŠ¶æ€ï¼‰ <ul><li>åº”è¯¥éªŒè¯æ•°æ®ç»“æ„å¹¶éªŒè¯æœ¬åœ°é“¾</li><li>èµ„æºæ˜‚è´µçš„éªŒè¯å¯èƒ½ä¼šè¢«è·³è¿‡ï¼ŒèŠ‚ç‚¹è‡ªè¡Œæ‰¿æ‹…é£é™©</li></ul></li><li>ç¬¬2éƒ¨åˆ†ï¼šå¼•å¯¼è‡³ç½‘ç»œï¼ˆ<code>BOOTSTRAP</code>ï¼‰ <ul><li>æ­¥éª¤1.å¼•å¯¼åˆ°ç½‘ç»œï¼Œå¹¶è·å¾—ä¸€ç»„â€œè¶³å¤Ÿå®‰å…¨â€çš„å¯¹ç­‰ä½“ï¼ˆä¸‹é¢æœ‰æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼‰</li><li>æ­¥éª¤2.å¼•å¯¼è‡³<code>GossipSub</code>æ¸ é“</li></ul></li><li>ç¬¬3éƒ¨åˆ†ï¼šåŒæ­¥å—ä¿¡ä»»çš„æ£€æŸ¥ç‚¹çŠ¶æ€ï¼ˆ<code>SYNC_CHECKPOINT</code>ï¼‰ <ul><li>æ­¥éª¤1.ä»¥<code>TrustedCheckpoint</code>ï¼ˆé»˜è®¤ä¸º<code>GenesisCheckpoint</code>ï¼‰å¼€å¤´ã€‚æœ¬<code>TrustedCheckpoint</code>ä¸åº”è¯¥åœ¨è½¯ä»¶è¿›è¡ŒéªŒè¯ï¼Œå®ƒåº”è¯¥ç”±è¿è¥å•†è¿›è¡ŒéªŒè¯ã€‚</li><li>ç¬¬2æ­¥ã€‚è·å–å®ƒæ‰€æŒ‡å‘çš„å—ï¼Œä»¥åŠè¯¥å—çš„çˆ¶æ¯</li><li>ç¬¬3æ­¥ã€‚ <code>StateTree</code></li></ul></li><li>ç¬¬4éƒ¨åˆ†ï¼šè¿½ä¸Šé“¾ï¼ˆ<code>CHAIN_CATCHUP</code>ï¼‰ <ul><li>æ­¥éª¤1.ä¿æŒä¸€ç»„<code>TargetHeads</code>ï¼ˆ<code>BlockCIDs</code>ï¼‰ï¼Œå¹¶é€‰æ‹©<code>BestTargetHead</code>ä»å®ƒ</li><li>æ­¥éª¤2.ä¸æœ€æ–°è§‚å¯Ÿåˆ°çš„å¤´éƒ¨åŒæ­¥ï¼ŒéªŒè¯æœå‘å®ƒä»¬çš„å—ï¼ˆè¯·æ±‚ä¸­é—´ç‚¹ï¼‰</li><li>æ­¥éª¤3.éšç€éªŒè¯çš„è¿›è¡Œï¼Œ<code>TargetHeads</code>å¹¶ä¸”<code>BestTargetHead</code>å¯èƒ½ä¼šæ”¹å˜ï¼Œå› ä¸ºç”Ÿäº§è¾¹ç¼˜çš„æ–°å—å°†åˆ°è¾¾ï¼Œå¹¶ä¸”æŸäº›ç›®æ ‡å¤´æˆ–é€šå¾€å®ƒä»¬çš„è·¯å¾„å¯èƒ½æ— æ³•éªŒè¯ã€‚</li><li>ç¬¬4æ­¥ã€‚å½“èŠ‚ç‚¹â€œèµ¶ä¸Šâ€æ—¶å®Œæˆ<code>BestTargetHead</code>ï¼ˆæ£€ç´¢æ‰€æœ‰çŠ¶æ€ï¼Œé“¾æ¥åˆ°æœ¬åœ°é“¾ï¼ŒéªŒè¯æ‰€æœ‰å—ç­‰ï¼‰ã€‚</li></ul></li><li>ç¬¬5éƒ¨åˆ†ï¼šä¿æŒåŒæ­¥ï¼Œå¹¶å‚ä¸å—ä¼ æ’­ï¼ˆ<code>CHAIN_FOLLOW</code>ï¼‰ <ul><li>æ­¥éª¤1.å¦‚æœå®‰å…¨æ¡ä»¶å‘ç”Ÿå˜åŒ–ï¼Œè¯·è¿”å›è‡³ç¬¬4éƒ¨åˆ†ï¼ˆ<code>CHAIN_CATCHUP</code>ï¼‰</li><li>æ­¥éª¤2.æ¥æ”¶ï¼ŒéªŒè¯å’Œä¼ æ’­æ”¶åˆ°çš„ä¿¡æ¯ <code>Blocks</code></li><li>ç¬¬3æ­¥ã€‚ç°åœ¨æ›´åŠ ç¡®å®šæ‹¥æœ‰æœ€ä½³é“¾ï¼Œæœ€ç»ˆç¡®å®šâ€œæç¤ºâ€å¹¶æ¨è¿›é“¾çŠ¶æ€ã€‚</li></ul></li></ul><p><code>ChainSync</code>ä½¿ç”¨ä»¥ä¸‹<em>æ¦‚å¿µæ€§</em>çŠ¶æ€æœºã€‚ç”±äºè¿™æ˜¯ä¸€ä¸ª<em>æ¦‚å¿µæ€§çš„</em>çŠ¶æ€æœºï¼Œå› æ­¤å®ç°å¯èƒ½ä¼šåç¦»ç²¾ç¡®å®ç°è¿™äº›çŠ¶æ€æˆ–ä¸¥æ ¼åˆ’åˆ†å®ƒä»¬çš„çŠ¶æ€ã€‚å®ç°å¯èƒ½ä¼šæ¨¡ç³ŠçŠ¶æ€ä¹‹é—´çš„ç•Œçº¿ã€‚å¦‚æœæ˜¯è¿™æ ·ï¼Œå®ç°å¿…é¡»ç¡®ä¿æ›´æ”¹åçš„åè®®çš„å®‰å…¨æ€§ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gn7v5rtlrlj31aw0petbh.jpg" alt="image-20210201111716710"></p><h4 id="_2-4-3-4åŒè¡Œå‘ç°" tabindex="-1"><a class="header-anchor" href="#_2-4-3-4åŒè¡Œå‘ç°" aria-hidden="true">#</a> 2.4.3.4<a href="https://spec.filecoin.io/#section-systems.filecoin_blockchain.chainsync.peer-discovery" target="_blank" rel="noopener noreferrer">åŒè¡Œå‘ç°<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><p>å¯¹ç­‰å‘ç°æ˜¯æ•´ä¸ªä½“ç³»ç»“æ„çš„å…³é”®éƒ¨åˆ†ã€‚é”™è¯¯åœ°æ“ä½œå¯èƒ½ä¼šå¯¹åè®®çš„æ“ä½œé€ æˆä¸¥é‡åæœã€‚å½“åŠ å…¥ç½‘ç»œæ—¶ï¼Œæ–°èŠ‚ç‚¹æœ€åˆè¿æ¥çš„ä¸€ç»„å¯¹ç­‰ç‚¹å¯èƒ½ä¼šå®Œå…¨æ”¯é…è¯¥èŠ‚ç‚¹å¯¹å…¶ä»–å¯¹ç­‰ç‚¹çš„äº†è§£ï¼Œå› æ­¤ï¼Œå°†ä¸»å¯¼è¯¥èŠ‚ç‚¹æ‰€æ‹¥æœ‰çš„ç½‘ç»œçŠ¶æ€ã€‚</p><p>å¯¹ç­‰å‘ç°å¯ä»¥é€šè¿‡ä»»æ„å¤–éƒ¨æ‰‹æ®µæ¥é©±åŠ¨ï¼Œå¹¶è¢«æ¨åˆ°ChainSyncæ‰€æ¶‰åŠåè®®ï¼ˆå³GossipSubï¼ŒBitswapï¼ŒBlockSyncï¼‰çš„æ ¸å¿ƒåŠŸèƒ½ä¹‹å¤–ã€‚è¿™å…è®¸è¿›è¡Œæ­£äº¤çš„ï¼Œç”±åº”ç”¨ç¨‹åºé©±åŠ¨çš„å¼€å‘ï¼Œå¹¶ä¸”æ— éœ€å¤–éƒ¨ä¾èµ–æ¥å®ç°åè®®ã€‚ä½†æ˜¯ï¼ŒGossipSubåè®®æ”¯æŒï¼šiï¼‰å¯¹ç­‰äº¤æ¢ï¼Œä»¥åŠiiï¼‰æ˜¾å¼å¯¹ç­‰åè®®ã€‚</p><h5 id="_2-4-3-4-1åŒè¡Œäº¤æµ" tabindex="-1"><a class="header-anchor" href="#_2-4-3-4-1åŒè¡Œäº¤æµ" aria-hidden="true">#</a> 2.4.3.4.1<a href="https://spec.filecoin.io/#section-systems.filecoin_blockchain.chainsync.peer-exchange" target="_blank" rel="noopener noreferrer">åŒè¡Œäº¤æµ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h5><p>Peer Exchangeå…è®¸åº”ç”¨ç¨‹åºä»ä¸€ç»„å·²çŸ¥çš„å¯¹ç­‰æ–¹è¿›è¡Œå¼•å¯¼ï¼Œè€Œæ— éœ€å¤–éƒ¨å¯¹ç­‰æ–¹å‘ç°æœºåˆ¶ã€‚æ­¤è¿‡ç¨‹å¯ä»¥é€šè¿‡å¼•å¯¼èŠ‚ç‚¹æˆ–å…¶ä»–æ™®é€šå¯¹ç­‰èŠ‚ç‚¹æ¥å®ç°ã€‚**å¼•å¯¼èŠ‚ç‚¹å¿…é¡»ç”±ç³»ç»Ÿæ“ä½œå‘˜ç»´æŠ¤ï¼Œå¹¶ä¸”å¿…é¡»æ­£ç¡®é…ç½®ã€‚**å®ƒä»¬å¿…é¡»ç¨³å®šå¹¶ä¸”ç‹¬ç«‹äºåè®®æ„é€ ï¼ˆä¾‹å¦‚GossipSubç½‘æ ¼æ„é€ ï¼‰è¿è¡Œï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¼•å¯¼èŠ‚ç‚¹ä¸ç»´æŠ¤ä¸ç½‘æ ¼çš„è¿æ¥ã€‚</p><p>æœ‰å…³Peer Exchangeçš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è€ƒ <a href="https://github.com/libp2p/specs/tree/master/pubsub/gossipsub" target="_blank" rel="noopener noreferrer">GossipSubè§„èŒƒ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ã€‚</p><h5 id="_2-4-3-4-2æ˜ç¡®çš„å¯¹ç­‰åè®®" tabindex="-1"><a class="header-anchor" href="#_2-4-3-4-2æ˜ç¡®çš„å¯¹ç­‰åè®®" aria-hidden="true">#</a> 2.4.3.4.2<a href="https://spec.filecoin.io/#section-systems.filecoin_blockchain.chainsync.explicit-peering-agreements" target="_blank" rel="noopener noreferrer">æ˜ç¡®çš„å¯¹ç­‰åè®®<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h5><p>ä½¿ç”¨æ˜ç¡®çš„å¯¹ç­‰åè®®ï¼Œè¿è¥å•†å¿…é¡»æŒ‡å®šåŠ å…¥èŠ‚ç‚¹æ—¶èŠ‚ç‚¹åº”è¿æ¥åˆ°çš„å¯¹ç­‰æ–¹åˆ—è¡¨ã€‚è¯¥åè®®å¿…é¡»å…·æœ‰å¯ç”¨äºæŒ‡å®šè¿™äº›é€‰é¡¹çš„é€‰é¡¹ã€‚å¯¹äºæ¯ä¸ªæ˜¾å¼å¯¹ç­‰æ–¹ï¼Œè·¯ç”±å™¨å¿…é¡»å»ºç«‹å¹¶ç»´æŒåŒå‘ï¼ˆå¯¹ç­‰ï¼‰è¿æ¥ã€‚</p><h4 id="_2-4-3æ¸è¿›å—éªŒè¯" tabindex="-1"><a class="header-anchor" href="#_2-4-3æ¸è¿›å—éªŒè¯" aria-hidden="true">#</a> 2.4.3<a href="https://spec.filecoin.io/#section-systems.filecoin_blockchain.chainsync.progressive-block-validation" target="_blank" rel="noopener noreferrer">æ¸è¿›å—éªŒè¯<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><ul><li>ä¸ºäº†ä½¿èµ„æºæ”¯å‡ºæœ€å°åŒ–ï¼Œå¯ä»¥é€æ­¥è¿›è¡Œ<a href="https://spec.filecoin.io/#section-systems.filecoin_blockchain.struct.block" target="_blank" rel="noopener noreferrer">åŒºå—<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>éªŒè¯ã€‚</li><li>éªŒè¯è®¡ç®—é‡å¾ˆå¤§ï¼Œå¹¶ä¸”æ˜¯ä¸¥é‡çš„DOSæ”»å‡»åª’ä»‹ã€‚</li><li>å®‰å…¨çš„å®ç°å¿…é¡»ä»”ç»†å®‰æ’éªŒè¯æ—¶é—´ï¼Œå¹¶åœ¨ä¸å®Œå…¨éªŒè¯å—çš„æƒ…å†µä¸‹å°†ä¿®å‰ªå—çš„å·¥ä½œå‡è‡³æœ€å°‘ã€‚</li><li><code>ChainSync</code>åº”è¯¥ä¿ç•™æœªéªŒè¯å—çš„ç¼“å­˜ï¼ˆæœ€å¥½æŒ‰å±äºé“¾çš„å¯èƒ½æ€§æ’åºï¼‰ï¼Œå¹¶åœ¨ä¼ é€’æœªéªŒè¯å—<code>FinalityTipset</code>æˆ–<code>ChainSync</code>æ‰¿å—å¤§é‡èµ„æºæ—¶åˆ é™¤æœªéªŒè¯å—ã€‚</li><li>è¿™äº›é˜¶æ®µå¯ä»¥éƒ¨åˆ†åœ°ç”¨äºå€™é€‰é“¾ä¸­çš„è®¸å¤šå—ï¼Œä»¥ä¾¿åœ¨å®é™…è¿›è¡Œæ˜‚è´µçš„éªŒè¯å·¥ä½œä¹‹å‰å¾ˆé•¿æ—¶é—´å°±æ¸…é™¤æ‰åå—ã€‚</li><li><strong>å—éªŒè¯çš„æ¸è¿›é˜¶æ®µ</strong><ul><li><strong>BV0-è¯­æ³•</strong>ï¼šåºåˆ—åŒ–ï¼Œé”®å…¥ï¼Œå€¼èŒƒå›´ã€‚</li><li><strong>BV1-åˆç†çš„å…±è¯†</strong>ï¼šåˆç†çš„çŸ¿å·¥ï¼Œé‡é‡å’Œå†æ—¶å€¼ï¼ˆä¾‹å¦‚æ¥è‡ªçš„é“¾çŠ¶çŠ¶æ€<code>b.ChainEpoch - consensus.LookbackParameter</code>ï¼‰ã€‚</li><li><strong>BV2-å—ç­¾å</strong></li><li><strong>BV3-ä¿¡æ ‡æ¡ç›®</strong>ï¼šæœ‰æ•ˆçš„éšæœºä¿¡æ ‡æ¡ç›®å·²æ’å…¥åˆ°å—ä¸­ï¼ˆè¯·å‚é˜… <a href="https://spec.filecoin.io/#section-systems.filecoin_blockchain.storage_power_consensus.validating-beacon-entries-on-block-reception" target="_blank" rel="noopener noreferrer">ä¿¡æ ‡æ¡ç›®éªŒè¯<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ï¼‰ã€‚</li><li><strong>BV4-ElectionProof</strong>ï¼šç”Ÿæˆäº†æœ‰æ•ˆçš„é€‰ä¸¾è¯æ˜ã€‚</li><li><strong>BV5-WinningPoSt</strong>ï¼šç”Ÿæˆæ­£ç¡®çš„PoStã€‚</li><li><strong>BV6-é“¾è¡€ç»Ÿå’Œç»ˆç»“æ€§</strong>ï¼šéªŒè¯åŒºå—é“¾æ˜¯å¦å›åˆ°ç»ˆç»“é“¾ï¼Œè€Œä¸æ˜¯ç»ˆç»“æ€§ã€‚</li><li><strong>BV7-æ¶ˆæ¯ç­¾å</strong>ï¼š</li><li><strong>BV8-çŠ¶æ€æ ‘</strong>ï¼šçˆ¶æç¤ºæ¶ˆæ¯æ‰§è¡Œå°†äº§ç”Ÿå£°æ˜çš„çŠ¶æ€æ ‘æ ¹å’Œæ”¶æ®ã€‚</li></ul></li></ul><h3 id="_2-4-å‚¨èƒ½å…±è¯†" tabindex="-1"><a class="header-anchor" href="#_2-4-å‚¨èƒ½å…±è¯†" aria-hidden="true">#</a> 2.4.<a href="https://spec.filecoin.io/#section-systems.filecoin_blockchain.storage_power_consensus" target="_blank" rel="noopener noreferrer">å‚¨èƒ½å…±è¯†<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h3><p>å­˜å‚¨ç”µæºå…±è¯†ï¼ˆSPCï¼‰å­ç³»ç»Ÿæ˜¯ä½¿FilecoinèŠ‚ç‚¹èƒ½å¤Ÿå°±ç³»ç»ŸçŠ¶æ€è¾¾æˆä¸€è‡´çš„ä¸»è¦æ¥å£ã€‚ã€Šå­˜å‚¨åŠŸç‡å…±è¯†ã€‹åœ¨å…¶â€œ<a href="https://spec.filecoin.io/#section-systems.filecoin_blockchain.storage_power_consensus.storage_power_actor.the-power-table" target="_blank" rel="noopener noreferrer">åŠŸç‡è¡¨â€<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ä¸­è€ƒè™‘äº†å„ä¸ªå­˜å‚¨çŸ¿å·¥åœ¨ç»™å®šé“¾ä¸­è¶…è¿‡å…±è¯†çš„æœ‰æ•ˆåŠŸç‡ ã€‚å®ƒè¿˜è¿è¡Œâ€œ <a href="https://spec.filecoin.io/#section-algorithms.expected_consensus" target="_blank" rel="noopener noreferrer">é¢„æœŸå…±è¯†â€<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ï¼ˆFilecoinä½¿ç”¨çš„åŸºç¡€å…±è¯†ç®—æ³•ï¼‰ï¼Œä½¿å­˜å‚¨çŸ¿å·¥å¯ä»¥è¿›è¡Œé¢†å¯¼è€…é€‰ä¸¾å¹¶ç”Ÿæˆæ›´æ–°Filecoinç³»ç»ŸçŠ¶æ€çš„æ–°å—ã€‚</p><p>ç®€è€Œè¨€ä¹‹ï¼ŒSPCå­ç³»ç»Ÿæä¾›ä»¥ä¸‹æœåŠ¡ï¼š</p><ul><li>è®¿é—®æ¯ä¸ªå­é“¾çš„ <a href="https://spec.filecoin.io/#section-systems.filecoin_blockchain.storage_power_consensus.storage_power_actor.the-power-table" target="_blank" rel="noopener noreferrer">åŠŸç‡è¡¨<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ï¼Œè¯´æ˜å„ä¸ªå­˜å‚¨çŸ¿å·¥çš„åŠŸç‡å’Œé“¾ä¸Šçš„æ€»åŠŸç‡ã€‚</li><li>è®¿é—® å„ä¸ªå­˜å‚¨çŸ¿å·¥çš„<a href="https://spec.filecoin.io/#section-algorithms.expected_consensus" target="_blank" rel="noopener noreferrer">é¢„æœŸå…±è¯†<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ï¼Œä»è€Œå®ç°ï¼š <ul><li>æ ¹æ®åè®®çš„å…¶ä½™éƒ¨åˆ†ï¼Œè®¿é—®<a href="https://spec.filecoin.io/#section-libraries.drand" target="_blank" rel="noopener noreferrer">drand<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>æä¾›çš„ å¯éªŒè¯çš„éšæœºæ€§ <a href="https://spec.filecoin.io/#section-systems.filecoin_blockchain.storage_power_consensus.tickets" target="_blank" rel="noopener noreferrer">ç¥¨è¯<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ã€‚</li><li>è¿›è¡Œ <a href="https://spec.filecoin.io/#section-algorithms.expected_consensus.secret-leader-election" target="_blank" rel="noopener noreferrer">é¢†å¯¼äººé€‰ä¸¾<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>äº§ç”Ÿæ–°çš„éšœç¢ã€‚</li><li>ä½¿ç”¨ECçš„åŠ æƒåŠŸèƒ½è·¨å­é“¾è¿è¡Œ <a href="https://spec.filecoin.io/#section-algorithms.expected_consensus.chain-selection" target="_blank" rel="noopener noreferrer">é“¾é€‰æ‹©<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ã€‚</li><li>æ ‡è¯† <a href="https://spec.filecoin.io/#section-algorithms.expected_consensus.finality-in-ec" target="_blank" rel="noopener noreferrer">æœ€è¿‘å®Œæˆçš„æç¤ºé›†<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ï¼Œä¾›æ‰€æœ‰åè®®å‚ä¸è€…ä½¿ç”¨ã€‚</li></ul></li></ul><h4 id="_2-4-4-1åŒºåˆ†å­˜å‚¨çŸ¿å·¥å’Œå—çŸ¿å·¥" tabindex="-1"><a class="header-anchor" href="#_2-4-4-1åŒºåˆ†å­˜å‚¨çŸ¿å·¥å’Œå—çŸ¿å·¥" aria-hidden="true">#</a> 2.4.4.1<a href="https://spec.filecoin.io/#section-systems.filecoin_blockchain.storage_power_consensus.distinguishing-between-storage-miners-and-block-miners" target="_blank" rel="noopener noreferrer">åŒºåˆ†å­˜å‚¨çŸ¿å·¥å’Œå—çŸ¿å·¥<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><p>åœ¨Filecoinç½‘ç»œä¸­æœ‰ä¸¤ç§è·å–Filecoinä»¤ç‰Œçš„æ–¹æ³•ï¼š</p><ul><li>é€šè¿‡ä½œä¸ºå­˜å‚¨æä¾›è€…å‚åŠ  <a href="https://spec.filecoin.io/#section-systems.filecoin_markets.storage_market" target="_blank" rel="noopener noreferrer">å­˜å‚¨å¸‚åœº<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>å¹¶ç”±å®¢æˆ·æ”¯ä»˜æ–‡ä»¶å­˜å‚¨äº¤æ˜“çš„è´¹ç”¨ã€‚</li><li>é€šè¿‡æŒ–æ˜æ–°çš„åŒºå—ï¼Œæ‰©å±•åŒºå—é“¾ï¼Œä¿æŠ¤Filecoinå…±è¯†æœºåˆ¶ä»¥åŠè¿è¡Œæ™ºèƒ½åˆçº¦ä»¥æ‰§è¡ŒçŠ¶æ€æ›´æ–°æ¥ä½œä¸º <a href="https://spec.filecoin.io/#section-systems.filecoin_mining.storage_mining" target="_blank" rel="noopener noreferrer">Storage Miner<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ã€‚</li></ul><p>æœ‰ä¸¤ç§ç±»å‹çš„â€œçŸ¿å·¥â€ï¼ˆå­˜å‚¨çŸ¿å·¥å’Œå—çŸ¿å·¥ï¼‰å¯ä»¥åŒºåˆ†ã€‚ Filecoinçš„<a href="https://spec.filecoin.io/#section-algorithms.expected_consensus.secret-leader-election" target="_blank" rel="noopener noreferrer">é¢†å¯¼è€…é€‰ä¸¾<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>å–å†³äºçŸ¿å·¥çš„å­˜å‚¨èƒ½åŠ›ã€‚å› æ­¤ï¼Œè™½ç„¶æ‰€æœ‰åŒºå—çŸ¿å·¥éƒ½å°†æ˜¯å­˜å‚¨çŸ¿å·¥ï¼Œä½†ä¸ä¸€å®šç›¸åã€‚</p><p>ä½†æ˜¯ï¼Œé‰´äºFilecoinçš„â€œæœ‰ç”¨çš„å·¥ä½œé‡è¯æ˜â€æ˜¯é€šè¿‡æ–‡ä»¶å­˜å‚¨ï¼ˆ <a href="https://spec.filecoin.io/#section-algorithms.pos.porep" target="_blank" rel="noopener noreferrer">PoRep<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>å’Œ <a href="https://spec.filecoin.io/#section-algorithms.pos.post" target="_blank" rel="noopener noreferrer">PoSt<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ï¼‰å®ç°çš„ï¼Œå­˜å‚¨çŸ¿å·¥å‚ä¸é¢†å¯¼è€…é€‰ä¸¾çš„å¼€é”€å¾ˆå°‘ã€‚è¿™æ ·çš„ <a href="https://spec.filecoin.io/#section-systems.filecoin_mining.storage_mining.storage_miner_actor" target="_blank" rel="noopener noreferrer">Storage Miner Actor<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ä»…éœ€è¦å‘<a href="https://spec.filecoin.io/#section-systems.filecoin_blockchain.storage_power_consensus.storage_power_actor" target="_blank" rel="noopener noreferrer">Storage Power Actor<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>æ³¨å†Œ å³å¯å‚ä¸â€œé¢„æœŸå…±è¯†â€å’ŒçŸ¿åŒºã€‚</p><h4 id="_2-4-4-2ä¸Šç”µ" tabindex="-1"><a class="header-anchor" href="#_2-4-4-2ä¸Šç”µ" aria-hidden="true">#</a> 2.4.4.2<a href="https://spec.filecoin.io/#section-systems.filecoin_blockchain.storage_power_consensus.on-power" target="_blank" rel="noopener noreferrer">ä¸Šç”µ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><p>è´¨é‡è°ƒæ•´åçš„åŠŸç‡ä½œä¸ºå…¶<em><strong>æ‰‡åŒºè´¨é‡*<strong>çš„é™æ€å‡½æ•°åˆ†é…ç»™æ¯ä¸ªæ‰‡åŒºï¼Œå…¶ä¸­åŒ…æ‹¬ï¼šiï¼‰<strong>æ‰‡åŒºæ—¶ç©º</strong>ï¼Œå®ƒæ˜¯æ‰‡åŒºå¤§å°å’Œæ‰¿è¯ºçš„å­˜å‚¨æŒç»­æ—¶é—´çš„ä¹˜ç§¯ï¼Œiiï¼‰<strong>äº¤æ˜“æƒé‡</strong>ï¼Œè¯¥æƒ</strong>é‡</strong>è½¬æ¢ç”±äº¤æ˜“è¾¾æˆå…±è¯†çš„æƒåŠ›ï¼Œiiiï¼‰<strong>äº¤æ˜“è´¨é‡ä¹˜æ•°</strong>ï¼Œè¯¥</em><em>ä¹˜æ•°</em>*å–å†³äºè¡Œä¸šå†…å®Œæˆçš„äº¤æ˜“ç±»å‹ï¼ˆå³CCï¼Œå¸¸è§„äº¤æ˜“æˆ–å·²éªŒè¯çš„å®¢æˆ·äº¤æ˜“ï¼‰ï¼Œæœ€åï¼Œivï¼‰<strong>éƒ¨é—¨è´¨é‡ä¹˜æ•°</strong>ï¼Œå³äº¤æ˜“è´¨é‡ä¹˜æ•°ä¹˜ä»¥è¯¥è¡Œä¸šä¸­æ¯ç§ç±»å‹çš„äº¤æ˜“æ‰€å ç”¨çš„æ—¶ç©ºé‡æ¥åŠ æƒã€‚</p><p>è¯¥<strong>éƒ¨é—¨çš„è´¨é‡</strong>æ˜¯æ˜ å°„å¤§å°ï¼ŒæŒç»­æ—¶é—´å’Œæ´»è·ƒäº¤æ˜“çš„éƒ¨é—¨å…¶ä¸€ç”Ÿçš„æ—¶é—´å»å¯¹æƒåŠ›å’ŒæŠ¥é…¬åˆ†é…ç¢°æ’æ—¶ç±»å‹çš„æªæ–½ã€‚</p><p>ä¸€ä¸ªéƒ¨é—¨çš„è´¨é‡å–å†³äºå¯¹è¯¥éƒ¨é—¨å†…éƒ¨æ•°æ®è¿›è¡Œçš„äº¤æ˜“ã€‚é€šå¸¸æœ‰ä¸‰ç§ç±»å‹çš„äº¤æ˜“ï¼š<em>æ‰¿è¯ºå®¹é‡ï¼ˆCCï¼‰</em>ï¼ˆå®é™…ä¸Šæ²¡æœ‰ä»»ä½•äº¤æ˜“ï¼Œè€ŒçŸ¿å·¥åœ¨è¯¥éƒ¨é—¨å†…éƒ¨å­˜å‚¨ä»»æ„æ•°æ®ï¼‰ï¼Œ<em>å¸¸è§„äº¤æ˜“</em>ï¼ˆçŸ¿å·¥å’Œå®¢æˆ·å°±å¸‚åœºä»·æ ¼è¾¾æˆä¸€è‡´ï¼‰ä»¥åŠåœ¨<em>éªŒè¯å®¢æˆ·</em>çš„äº¤æ˜“ï¼Œè¿™ç»™æ›´å¤šçš„æƒåŠ›éƒ¨é—¨ã€‚æˆ‘ä»¬è¯·è¯»è€…é˜…è¯»â€œ <a href="https://spec.filecoin.io/#section-systems.filecoin_mining.sector" target="_blank" rel="noopener noreferrer">æ‰‡åŒº<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>å’Œ <a href="https://spec.filecoin.io/#section-systems.filecoin_mining.sector.sector_quality" target="_blank" rel="noopener noreferrer">æ‰‡åŒºè´¨é‡â€<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>éƒ¨åˆ†ï¼Œä»¥è·å–æœ‰å…³æ‰‡åŒºç±»å‹å’Œæ‰‡åŒºè´¨é‡çš„è¯¦ç»†ä¿¡æ¯ï¼Œâ€œ <a href="https://spec.filecoin.io/#section-algorithms.verified_clients" target="_blank" rel="noopener noreferrer">å·²éªŒè¯çš„å®¢æˆ·â€<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>éƒ¨åˆ†å¯è·å¾—æœ‰å…³å·²éªŒè¯çš„å®¢æˆ·æ˜¯ä»€ä¹ˆçš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œä»¥åŠ <a href="https://spec.filecoin.io/#section-algorithms.cryptoecon" target="_blank" rel="noopener noreferrer">CryptoEconomics<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> éƒ¨åˆ†ï¼Œä»¥è·å–äº¤æ˜“æƒé‡å’Œè´¨é‡ä¹˜æ•°ä¸Šçš„ç‰¹å®šå‚æ•°å€¼ã€‚</p><p><strong>è´¨é‡è°ƒæ•´åçš„æƒåŠ›</strong>æ˜¯æŒ‡çŸ¿å·¥åœ¨â€œ<a href="https://spec.filecoin.io/#section-algorithms.expected_consensus.secret-leader-election" target="_blank" rel="noopener noreferrer">ç§˜å¯†é¢†å¯¼äººé€‰ä¸¾â€ä¸­<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>æ‰€è·å¾—çš„ç¥¨æ•°ï¼Œå…¶ å®šä¹‰æ˜¯éšç€çŸ¿å·¥å¯¹ç½‘ç»œçš„æ‰¿è¯ºå­˜å‚¨é‡çº¿æ€§å¢åŠ ã€‚</p><p>æ›´å‡†ç¡®åœ°è¯´ï¼Œæˆ‘ä»¬å…·æœ‰ä»¥ä¸‹å®šä¹‰ï¼š</p><ul><li><em>åŸå§‹å­—èŠ‚åŠŸç‡</em>ï¼šæ‰‡åŒºå¤§å°ï¼Œä»¥å­—èŠ‚ä¸ºå•ä½ã€‚</li><li><em>è´¨é‡è°ƒæ•´åçš„åŠŸç‡</em>ï¼šç½‘ç»œä¸Šå­˜å‚¨çš„æ•°æ®çš„å…±è¯†åŠŸç‡ï¼Œç­‰äºåŸå§‹å­—èŠ‚åŠŸç‡ä¹˜ä»¥æ‰‡åŒºè´¨é‡ä¹˜æ•°ã€‚</li></ul><h4 id="_2-4-4-3ä¿¡æ ‡æ¡ç›®" tabindex="-1"><a class="header-anchor" href="#_2-4-4-3ä¿¡æ ‡æ¡ç›®" aria-hidden="true">#</a> 2.4.4.3<a href="https://spec.filecoin.io/#section-systems.filecoin_blockchain.storage_power_consensus.beacon-entries" target="_blank" rel="noopener noreferrer">ä¿¡æ ‡æ¡ç›®<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><p>Filecoinåè®®ä½¿ç”¨<a href="https://spec.filecoin.io/#section-libraries.drand" target="_blank" rel="noopener noreferrer">drand<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ä¿¡æ ‡äº§ç”Ÿçš„ éšæœºæ€§æ¥æ’­ç§å¯åœ¨é“¾ä¸­ä½¿ç”¨çš„æ— åéšæœºæ€§ç§å­ï¼ˆè¯·å‚é˜… <a href="https://spec.filecoin.io/#section-algorithms.crypto.randomness" target="_blank" rel="noopener noreferrer">éšæœºæ€§<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ï¼‰ã€‚</p><p>åè¿‡æ¥ï¼Œè¿™äº›éšæœºç§å­ç”±ä»¥ä¸‹äººå‘˜ä½¿ç”¨ï¼š</p><ul><li>è¯¥ <a href="https://spec.filecoin.io/#section-systems.filecoin_mining.sector.sealing" target="_blank" rel="noopener noreferrer">sector_sealer<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ä¸ºSealSeedsç»“åˆéƒ¨é—¨æ‰¿è¯ºç»™å®šçš„å­é“¾ã€‚</li><li>è¯¥ <a href="https://spec.filecoin.io/#section-systems.filecoin_mining.storage_proving.poster" target="_blank" rel="noopener noreferrer">post_generator<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ä¸ºPoStChallengesè¯æ˜éƒ¨é—¨ç»§ç»­è‡´åŠ›äºä¸ºç»™å®šå—çš„ã€‚</li><li>Storage Powerå­ç³»ç»Ÿä½œä¸ºâ€œ<a href="https://spec.filecoin.io/#section-algorithms.expected_consensus.secret-leader-election" target="_blank" rel="noopener noreferrer">ç§˜å¯†é¢†å¯¼è€…â€é€‰ä¸¾ä¸­çš„<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>éšæœºæ€§ï¼Œ ç”¨äºç¡®å®šé€‰æ‹©çŸ¿å·¥é‡‡çŸ¿æ–°åŒºå—çš„é¢‘ç‡ã€‚</li></ul><p>è¯¥éšæœºæ€§å¯ä»¥é€šè¿‡æ ¹æ®å…¶å®‰å…¨æ€§è¦æ±‚ä½¿ç”¨å®ƒä»¬çš„å„ä¸ªåè®®ä»å„ç§Filecoiné“¾çºªå…ƒä¸­å¾—å‡ºã€‚</p><p>é‡è¦çš„æ˜¯è¦æ³¨æ„ï¼Œç»™å®šçš„Filecoinç½‘ç»œå’Œç»™å®šçš„drandç½‘ç»œä¸å¿…å…·æœ‰ç›¸åŒçš„å¾ªç¯æ—¶é—´ï¼Œå³Filecoinç”Ÿæˆçš„å—å¯èƒ½æ¯”drandç”Ÿæˆçš„éšæœºæ€§æ›´å¿«æˆ–æ›´æ…¢ã€‚ä¾‹å¦‚ï¼Œå¦‚æœdrandä¿¡æ ‡äº§ç”Ÿçš„éšæœºæ€§æ˜¯Filecoinäº§ç”Ÿå—çš„ä¸¤å€ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯èƒ½æœŸæœ›åœ¨Filecoinæ—¶ä»£äº§ç”Ÿä¸¤ä¸ªéšæœºå€¼ï¼Œåä¹‹ï¼Œå¦‚æœFilecoinç½‘ç»œçš„é€Ÿåº¦æ˜¯drandçš„ä¸¤å€ï¼Œåˆ™æˆ‘ä»¬å¯èƒ½æœŸæœ›ä¸€ä¸ªéšæœºå€¼æ¯éš”ä¸€ä¸ªFilecoinæ—¶ä»£ã€‚å› æ­¤ï¼Œå–å†³äºä¸¤ä¸ªç½‘ç»œçš„é…ç½®ï¼ŒæŸäº›Filecoinå—å¯èƒ½åŒ…å«å¤šä¸ªæˆ–ä¸åŒ…å«drandæ¡ç›®ã€‚æ­¤å¤–ï¼Œå¿…é¡»ç¡®ä¿ä¸­æ–­æœŸé—´å¯¹drandç½‘ç»œè¿›è¡Œçš„æ–°çš„éšæœºæ€§æ¡ç›®çš„ä»»ä½•å‘¼å«éƒ½åº”è¢«é˜»æ­¢ï¼Œå¦‚<code>drand.Public()</code> ä¸‹é¢çš„ç”µè¯ã€‚åœ¨æ‰€æœ‰æƒ…å†µä¸‹ï¼ŒFilecoinå—éƒ½å¿…é¡»åŒ…æ‹¬è‡ª<code>BeaconEntries</code>å—å¤´å­—æ®µä¸­çš„æœ€åä¸€ä¸ªçºªå…ƒä»¥æ¥ç”Ÿæˆçš„æ‰€æœ‰drand beaconè¾“å‡ºã€‚ç»™å®šFilecoinçºªå…ƒçš„ä»»ä½•éšæœºæ€§ä½¿ç”¨éƒ½åº”ä½¿ç”¨Filecoinå—ä¸­åŒ…å«çš„æœ€åä¸€ä¸ªæœ‰æ•ˆdrandæ¡ç›®ã€‚å¦‚ä¸‹æ‰€ç¤ºã€‚</p><h5 id="_2-4-4-3-1è·å–vmçš„drandéšæœºæ€§" tabindex="-1"><a class="header-anchor" href="#_2-4-4-3-1è·å–vmçš„drandéšæœºæ€§" aria-hidden="true">#</a> 2.4.4.3.1<a href="https://spec.filecoin.io/#section-systems.filecoin_blockchain.storage_power_consensus.get-drand-randomness-for-vm" target="_blank" rel="noopener noreferrer">è·å–VMçš„drandéšæœºæ€§<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h5><p>å¯¹äºè¯¸å¦‚PoRepåˆ›å»ºï¼Œè¯æ˜éªŒè¯ä¹‹ç±»çš„æ“ä½œï¼Œæˆ–è€…éœ€è¦Filecoin VMéšæœºæ€§çš„ä»»ä½•æ“ä½œï¼Œåº”è¯¥æœ‰ä¸€ç§æ–¹æ³•å¯ä»¥ä»é“¾ä¸­æ­£ç¡®æå–drandæ¡ç›®ã€‚è¯·æ³¨æ„ï¼Œå¦‚æœdrandè¾ƒæ…¢ï¼Œåˆ™è¯¥å›åˆå¯èƒ½è·¨è¶Šå¤šä¸ªfilecoinæ—¶æœŸã€‚æœ€ä½çš„æ—¶æœŸå·å—å°†åŒ…å«è¯·æ±‚çš„ä¿¡æ ‡æ¡ç›®ã€‚åŒæ ·ï¼Œå¦‚æœåœ¨åº”æ’å…¥ä¿¡æ ‡çš„ä½ç½®å­˜åœ¨é›¶è½®ï¼Œæˆ‘ä»¬éœ€è¦åœ¨é“¾ä¸Šè¿›è¡Œè¿­ä»£ä»¥æ‰¾åˆ°å°†æ¡ç›®æ’å…¥åˆ°çš„ä½ç½®ã€‚å…·ä½“è€Œè¨€ï¼Œä¸‹ä¸€ä¸ªéç©ºå—å¿…é¡»åŒ…å«å®šä¹‰æ‰€è¯·æ±‚çš„drandæ¡ç›®ã€‚</p><h5 id="_2-4-4-3-2ä»drandç½‘ç»œè·å–éšæœºæ€§" tabindex="-1"><a class="header-anchor" href="#_2-4-4-3-2ä»drandç½‘ç»œè·å–éšæœºæ€§" aria-hidden="true">#</a> 2.4.4.3.2<a href="https://spec.filecoin.io/#section-systems.filecoin_blockchain.storage_power_consensus.fetch-randomness-from-drand-network" target="_blank" rel="noopener noreferrer">ä»drandç½‘ç»œè·å–éšæœºæ€§<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h5><p>è¿›è¡ŒæŒ–æ˜æ—¶ï¼ŒçŸ¿å·¥å¯ä»¥ä»drandç½‘ç»œä¸­è·å–æ¡ç›®ï¼Œä»¥å°†å…¶åŒ…æ‹¬åœ¨æ–°å—ä¸­ã€‚</p><p><a href="https://spec.filecoin.io/#example-drandbeacon" target="_blank" rel="noopener noreferrer">ç¤ºä¾‹ï¼šDrandBeacon<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>DrandBeaconå°†Lotusä¸drandç½‘ç»œç›¸è¿ï¼Œä»¥ä¾¿ä»¥ä¸Filecoinè½®æ¬¡/çºªå…ƒä¸€è‡´çš„æ–¹å¼å‘ç³»ç»Ÿæä¾›éšæœºæ€§ã€‚</p><p>æˆ‘ä»¬é€šè¿‡å…¶å…¬å…±HTTPç«¯ç‚¹è¿æ¥åˆ°drandå¯¹ç­‰æ–¹ã€‚å¯¹ç­‰ç‚¹åœ¨drandServerså˜é‡ä¸­æšä¸¾ã€‚</p><p>Drandé“¾çš„æ ¹ä¿¡ä»»æ˜¯ä»build.DrandChainé…ç½®çš„ã€‚</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> DrandBeacon <span class="token keyword">struct</span> <span class="token punctuation">{</span>
 client dclient<span class="token punctuation">.</span>Client

 pubkey kyber<span class="token punctuation">.</span>Point

 <span class="token comment">// seconds</span>
 interval time<span class="token punctuation">.</span>Duration

 drandGenTime <span class="token builtin">uint64</span>
 filGenTime   <span class="token builtin">uint64</span>
 filRoundTime <span class="token builtin">uint64</span>

 cacheLk    sync<span class="token punctuation">.</span>Mutex
 localCache <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">uint64</span><span class="token punctuation">]</span>types<span class="token punctuation">.</span>BeaconEntry
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a href="https://spec.filecoin.io/#example-beaconentriesforblock" target="_blank" rel="noopener noreferrer">ç¤ºä¾‹ï¼šBeaconEntriesForBlock<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">BeaconEntriesForBlock</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> bSchedule Schedule<span class="token punctuation">,</span> epoch abi<span class="token punctuation">.</span>ChainEpoch<span class="token punctuation">,</span> parentEpoch abi<span class="token punctuation">.</span>ChainEpoch<span class="token punctuation">,</span> prev types<span class="token punctuation">.</span>BeaconEntry<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span>types<span class="token punctuation">.</span>BeaconEntry<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token punctuation">{</span>
  parentBeacon <span class="token operator">:=</span> bSchedule<span class="token punctuation">.</span><span class="token function">BeaconForEpoch</span><span class="token punctuation">(</span>parentEpoch<span class="token punctuation">)</span>
  currBeacon <span class="token operator">:=</span> bSchedule<span class="token punctuation">.</span><span class="token function">BeaconForEpoch</span><span class="token punctuation">(</span>epoch<span class="token punctuation">)</span>
  <span class="token keyword">if</span> parentBeacon <span class="token operator">!=</span> currBeacon <span class="token punctuation">{</span>
   <span class="token comment">// Fork logic</span>
   round <span class="token operator">:=</span> currBeacon<span class="token punctuation">.</span><span class="token function">MaxBeaconRoundForEpoch</span><span class="token punctuation">(</span>epoch<span class="token punctuation">)</span>
   out <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span>types<span class="token punctuation">.</span>BeaconEntry<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
   rch <span class="token operator">:=</span> currBeacon<span class="token punctuation">.</span><span class="token function">Entry</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> round<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
   res <span class="token operator">:=</span> <span class="token operator">&lt;-</span>rch
   <span class="token keyword">if</span> res<span class="token punctuation">.</span>Err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> xerrors<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;getting entry %d returned error: %w&quot;</span><span class="token punctuation">,</span> round<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> res<span class="token punctuation">.</span>Err<span class="token punctuation">)</span>
   <span class="token punctuation">}</span>
   out<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> res<span class="token punctuation">.</span>Entry
   rch <span class="token operator">=</span> currBeacon<span class="token punctuation">.</span><span class="token function">Entry</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> round<span class="token punctuation">)</span>
   res <span class="token operator">=</span> <span class="token operator">&lt;-</span>rch
   <span class="token keyword">if</span> res<span class="token punctuation">.</span>Err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> xerrors<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;getting entry %d returned error: %w&quot;</span><span class="token punctuation">,</span> round<span class="token punctuation">,</span> res<span class="token punctuation">.</span>Err<span class="token punctuation">)</span>
   <span class="token punctuation">}</span>
   out<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> res<span class="token punctuation">.</span>Entry
   <span class="token keyword">return</span> out<span class="token punctuation">,</span> <span class="token boolean">nil</span>
  <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>

 beacon <span class="token operator">:=</span> bSchedule<span class="token punctuation">.</span><span class="token function">BeaconForEpoch</span><span class="token punctuation">(</span>epoch<span class="token punctuation">)</span>

 start <span class="token operator">:=</span> build<span class="token punctuation">.</span>Clock<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

 maxRound <span class="token operator">:=</span> beacon<span class="token punctuation">.</span><span class="token function">MaxBeaconRoundForEpoch</span><span class="token punctuation">(</span>epoch<span class="token punctuation">)</span>
 <span class="token keyword">if</span> maxRound <span class="token operator">==</span> prev<span class="token punctuation">.</span>Round <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
 <span class="token punctuation">}</span>

 <span class="token comment">// TODO: this is a sketchy way to handle the genesis block not having a beacon entry</span>
 <span class="token keyword">if</span> prev<span class="token punctuation">.</span>Round <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>
  prev<span class="token punctuation">.</span>Round <span class="token operator">=</span> maxRound <span class="token operator">-</span> <span class="token number">1</span>
 <span class="token punctuation">}</span>

 cur <span class="token operator">:=</span> maxRound
 <span class="token keyword">var</span> out <span class="token punctuation">[</span><span class="token punctuation">]</span>types<span class="token punctuation">.</span>BeaconEntry
 <span class="token keyword">for</span> cur <span class="token operator">&gt;</span> prev<span class="token punctuation">.</span>Round <span class="token punctuation">{</span>
  rch <span class="token operator">:=</span> beacon<span class="token punctuation">.</span><span class="token function">Entry</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> cur<span class="token punctuation">)</span>
  <span class="token keyword">select</span> <span class="token punctuation">{</span>
  <span class="token keyword">case</span> resp <span class="token operator">:=</span> <span class="token operator">&lt;-</span>rch<span class="token punctuation">:</span>
   <span class="token keyword">if</span> resp<span class="token punctuation">.</span>Err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> xerrors<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;beacon entry request returned error: %w&quot;</span><span class="token punctuation">,</span> resp<span class="token punctuation">.</span>Err<span class="token punctuation">)</span>
   <span class="token punctuation">}</span>

   out <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>out<span class="token punctuation">,</span> resp<span class="token punctuation">.</span>Entry<span class="token punctuation">)</span>
   cur <span class="token operator">=</span> resp<span class="token punctuation">.</span>Entry<span class="token punctuation">.</span>Round <span class="token operator">-</span> <span class="token number">1</span>
  <span class="token keyword">case</span> <span class="token operator">&lt;-</span>ctx<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
   <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> xerrors<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;context timed out waiting on beacon entry to come back for epoch %d: %w&quot;</span><span class="token punctuation">,</span> epoch<span class="token punctuation">,</span> ctx<span class="token punctuation">.</span><span class="token function">Err</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>

 log<span class="token punctuation">.</span><span class="token function">Debugw</span><span class="token punctuation">(</span><span class="token string">&quot;fetching beacon entries&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;took&quot;</span><span class="token punctuation">,</span> build<span class="token punctuation">.</span>Clock<span class="token punctuation">.</span><span class="token function">Since</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;numEntries&quot;</span><span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>out<span class="token punctuation">)</span><span class="token punctuation">)</span>
 <span class="token function">reverse</span><span class="token punctuation">(</span>out<span class="token punctuation">)</span>
 <span class="token keyword">return</span> out<span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a href="https://spec.filecoin.io/#example-maxbeaconroundforepoch" target="_blank" rel="noopener noreferrer">ç¤ºä¾‹ï¼šMaxBeaconRoundForEpoch<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>db <span class="token operator">*</span>DrandBeacon<span class="token punctuation">)</span> <span class="token function">MaxBeaconRoundForEpoch</span><span class="token punctuation">(</span>filEpoch abi<span class="token punctuation">.</span>ChainEpoch<span class="token punctuation">)</span> <span class="token builtin">uint64</span> <span class="token punctuation">{</span>
 <span class="token comment">// TODO: sometimes the genesis time for filecoin is zero and this goes negative</span>
 latestTs <span class="token operator">:=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">uint64</span><span class="token punctuation">(</span>filEpoch<span class="token punctuation">)</span> <span class="token operator">*</span> db<span class="token punctuation">.</span>filRoundTime<span class="token punctuation">)</span> <span class="token operator">+</span> db<span class="token punctuation">.</span>filGenTime<span class="token punctuation">)</span> <span class="token operator">-</span> db<span class="token punctuation">.</span>filRoundTime
 dround <span class="token operator">:=</span> <span class="token punctuation">(</span>latestTs <span class="token operator">-</span> db<span class="token punctuation">.</span>drandGenTime<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token function">uint64</span><span class="token punctuation">(</span>db<span class="token punctuation">.</span>interval<span class="token punctuation">.</span><span class="token function">Seconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 <span class="token keyword">return</span> dround
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_2-4-4-3-3åœ¨å—æ¥æ”¶æ—¶éªŒè¯ä¿¡æ ‡æ¡ç›®" tabindex="-1"><a class="header-anchor" href="#_2-4-4-3-3åœ¨å—æ¥æ”¶æ—¶éªŒè¯ä¿¡æ ‡æ¡ç›®" aria-hidden="true">#</a> 2.4.4.3.3<a href="https://spec.filecoin.io/#section-systems.filecoin_blockchain.storage_power_consensus.validating-beacon-entries-on-block-reception" target="_blank" rel="noopener noreferrer">åœ¨å—æ¥æ”¶æ—¶éªŒè¯ä¿¡æ ‡æ¡ç›®<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h5><p>Filecoiné“¾å°†åŒ…å«ä»Filecoinèµ·æºåˆ°å½“å‰åŒºå—çš„æ•´ä¸ªä¿¡æ ‡è¾“å‡ºã€‚</p><p>è€ƒè™‘åˆ°å®ƒä»¬åœ¨é¢†å¯¼è€…é€‰ä¸¾å’ŒFilecoinä¸­å…¶ä»–å…³é”®åè®®ä¸­çš„ä½œç”¨ï¼Œå¿…é¡»ä¸ºæ¯ä¸ªåŒºå—éªŒè¯åŒºå—çš„ä¿¡æ ‡æ¡ç›®ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§ <a href="https://spec.filecoin.io/#section-libraries.drand" target="_blank" rel="noopener noreferrer">drand<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ã€‚å¯ä»¥é€šè¿‡ä½¿ç”¨drandçš„<a href="https://github.com/drand/drand/blob/763e9a252cf59060c675ced0562e8eba506971c1/chain/beacon.go#L76" target="_blank" rel="noopener noreferrer"><code>Verify</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ç«¯ç‚¹ï¼Œç¡®ä¿æ¯ä¸ªä¿¡æ ‡æ¡ç›®éƒ½æ˜¯é“¾ä¸­å‰ä¸€ä¸ªæ¡ç›®çš„æœ‰æ•ˆç­¾åæ¥å®Œæˆæ­¤æ“ä½œ ï¼š</p><p><a href="https://spec.filecoin.io/#example-validateblockvalues" target="_blank" rel="noopener noreferrer">ç¤ºä¾‹ï¼šValidateBlockValues<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">ValidateBlockValues</span><span class="token punctuation">(</span>bSchedule Schedule<span class="token punctuation">,</span> h <span class="token operator">*</span>types<span class="token punctuation">.</span>BlockHeader<span class="token punctuation">,</span> parentEpoch abi<span class="token punctuation">.</span>ChainEpoch<span class="token punctuation">,</span>
 prevEntry types<span class="token punctuation">.</span>BeaconEntry<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
 <span class="token punctuation">{</span>
  parentBeacon <span class="token operator">:=</span> bSchedule<span class="token punctuation">.</span><span class="token function">BeaconForEpoch</span><span class="token punctuation">(</span>parentEpoch<span class="token punctuation">)</span>
  currBeacon <span class="token operator">:=</span> bSchedule<span class="token punctuation">.</span><span class="token function">BeaconForEpoch</span><span class="token punctuation">(</span>h<span class="token punctuation">.</span>Height<span class="token punctuation">)</span>
  <span class="token keyword">if</span> parentBeacon <span class="token operator">!=</span> currBeacon <span class="token punctuation">{</span>
   <span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>h<span class="token punctuation">.</span>BeaconEntries<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">2</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> xerrors<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;expected two beacon entries at beacon fork, got %d&quot;</span><span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>h<span class="token punctuation">.</span>BeaconEntries<span class="token punctuation">)</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span>
   err <span class="token operator">:=</span> currBeacon<span class="token punctuation">.</span><span class="token function">VerifyEntry</span><span class="token punctuation">(</span>h<span class="token punctuation">.</span>BeaconEntries<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> h<span class="token punctuation">.</span>BeaconEntries<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
   <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> xerrors<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;beacon at fork point invalid: (%v, %v): %w&quot;</span><span class="token punctuation">,</span>
     h<span class="token punctuation">.</span>BeaconEntries<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> h<span class="token punctuation">.</span>BeaconEntries<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">return</span> <span class="token boolean">nil</span>
  <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>

 <span class="token comment">// TODO: fork logic</span>
 b <span class="token operator">:=</span> bSchedule<span class="token punctuation">.</span><span class="token function">BeaconForEpoch</span><span class="token punctuation">(</span>h<span class="token punctuation">.</span>Height<span class="token punctuation">)</span>
 maxRound <span class="token operator">:=</span> b<span class="token punctuation">.</span><span class="token function">MaxBeaconRoundForEpoch</span><span class="token punctuation">(</span>h<span class="token punctuation">.</span>Height<span class="token punctuation">)</span>
 <span class="token keyword">if</span> maxRound <span class="token operator">==</span> prevEntry<span class="token punctuation">.</span>Round <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>h<span class="token punctuation">.</span>BeaconEntries<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> xerrors<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;expected not to have any beacon entries in this block, got %d&quot;</span><span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>h<span class="token punctuation">.</span>BeaconEntries<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token boolean">nil</span>
 <span class="token punctuation">}</span>

 <span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>h<span class="token punctuation">.</span>BeaconEntries<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> xerrors<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;expected to have beacon entries in this block, but didn&#39;t find any&quot;</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span>

 last <span class="token operator">:=</span> h<span class="token punctuation">.</span>BeaconEntries<span class="token punctuation">[</span><span class="token function">len</span><span class="token punctuation">(</span>h<span class="token punctuation">.</span>BeaconEntries<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
 <span class="token keyword">if</span> last<span class="token punctuation">.</span>Round <span class="token operator">!=</span> maxRound <span class="token punctuation">{</span>
  <span class="token keyword">return</span> xerrors<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;expected final beacon entry in block to be at round %d, got %d&quot;</span><span class="token punctuation">,</span> maxRound<span class="token punctuation">,</span> last<span class="token punctuation">.</span>Round<span class="token punctuation">)</span>
 <span class="token punctuation">}</span>

 <span class="token keyword">for</span> i<span class="token punctuation">,</span> e <span class="token operator">:=</span> <span class="token keyword">range</span> h<span class="token punctuation">.</span>BeaconEntries <span class="token punctuation">{</span>
  <span class="token keyword">if</span> err <span class="token operator">:=</span> b<span class="token punctuation">.</span><span class="token function">VerifyEntry</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> prevEntry<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> xerrors<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;beacon entry %d (%d - %x (%d)) was invalid: %w&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> e<span class="token punctuation">.</span>Round<span class="token punctuation">,</span> e<span class="token punctuation">.</span>Data<span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>Data<span class="token punctuation">)</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  prevEntry <span class="token operator">=</span> e
 <span class="token punctuation">}</span>

 <span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-4-4-4é—¨ç¥¨" tabindex="-1"><a class="header-anchor" href="#_2-4-4-4é—¨ç¥¨" aria-hidden="true">#</a> 2.4.4.4<a href="https://spec.filecoin.io/#section-systems.filecoin_blockchain.storage_power_consensus.tickets" target="_blank" rel="noopener noreferrer">é—¨ç¥¨<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><p>Filecoinå—æ ‡é¢˜è¿˜åŒ…å«ä¸€ä¸ªä»å…¶æ—¶ä»£çš„ä¿¡æ ‡æ¡ç›®ç”Ÿæˆçš„â€œç¥¨â€ã€‚å¯¹äºç­‰é‡çš„è´§å‰ï¼Œç¥¨è¯ç”¨äºåœ¨â€œè´§å‰é€‰æ‹©è§„åˆ™â€ä¸­æ‰“ç ´å¹³å±€ã€‚</p><p>æ¯å½“åœ¨Filecoinä¸­æ¯”è¾ƒç¥¨è¯æ—¶ï¼Œæ¯”è¾ƒå°±æ˜¯ç¥¨è¯çš„VRFæ‘˜è¦çš„å­—èŠ‚ã€‚</p><h5 id="_2-4-4-4-1éšæœºç¥¨ç”Ÿæˆ" tabindex="-1"><a class="header-anchor" href="#_2-4-4-4-1éšæœºç¥¨ç”Ÿæˆ" aria-hidden="true">#</a> 2.4.4.4.1<a href="https://spec.filecoin.io/#section-systems.filecoin_blockchain.storage_power_consensus.randomness-ticket-generation" target="_blank" rel="noopener noreferrer">éšæœºç¥¨ç”Ÿæˆ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h5><p>åœ¨Filecoinæ—¶ä»£<code>n</code>ï¼Œå°†ä½¿ç”¨ç›¸åº”çš„ä¿¡æ ‡æ¡ç›®ç”Ÿæˆæ–°çš„ç¥¨è¯<code>n</code>ã€‚</p><p>çŸ¿å·¥é€šè¿‡å¯éªŒè¯éšæœºå‡½æ•°ï¼ˆVRFï¼‰è¿è¡Œä¿¡æ ‡æ¡ç›®ä»¥è·å–æ–°çš„å”¯ä¸€ç¥¨è¯ã€‚ä¿¡æ ‡æ¡ç›®å‰é¢å¸¦æœ‰ç¥¨è¯åŸŸåˆ†éš”æ ‡ç­¾ï¼Œå¹¶ä¸çŸ¿å·¥å‚ä¸è€…åœ°å€ç›¸è¿ï¼ˆä»¥ç¡®ä¿ä½¿ç”¨ç›¸åŒå·¥ä½œäººå‘˜å¯†é’¥çš„çŸ¿å·¥è·å¾—ä¸åŒçš„ç¥¨è¯ï¼‰ã€‚</p><p>ç”Ÿæˆç»™å®šçºªå…ƒnçš„ç¥¨è¯ï¼š</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>randSeed = GetRandomnessFromBeacon(n)
newTicketRandomness = VRF_miner(H(TicketProdDST || index || Serialization(randSeed, minerActorAddress)))
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><a href="https://spec.filecoin.io/#section-algorithms.crypto.vrf" target="_blank" rel="noopener noreferrer">å¯éªŒè¯çš„éšæœºå‡½æ•°<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ç”¨äºç¥¨è¯ç”Ÿæˆã€‚</p><h5 id="_2-4-4-4-2ç¥¨è¯éªŒè¯" tabindex="-1"><a class="header-anchor" href="#_2-4-4-4-2ç¥¨è¯éªŒè¯" aria-hidden="true">#</a> 2.4.4.4.2<a href="https://spec.filecoin.io/#section-systems.filecoin_blockchain.storage_power_consensus.ticket-validation" target="_blank" rel="noopener noreferrer">ç¥¨è¯éªŒè¯<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h5><p>æ¯ä¸ªç¥¨è¯åº”ä»VRFé“¾ä¸­çš„å‰ä¸€ä¸ªç¥¨è¯ç”Ÿæˆï¼Œå¹¶è¿›è¡Œç›¸åº”çš„éªŒè¯ã€‚</p><h4 id="_2-4-4-5æœ€å°çŸ¿å·¥è§„æ¨¡" tabindex="-1"><a class="header-anchor" href="#_2-4-4-5æœ€å°çŸ¿å·¥è§„æ¨¡" aria-hidden="true">#</a> 2.4.4.5<a href="https://spec.filecoin.io/#section-systems.filecoin_blockchain.storage_power_consensus.minimum-miner-size" target="_blank" rel="noopener noreferrer">æœ€å°çŸ¿å·¥è§„æ¨¡<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><p>ä¸ºäº†ç¡®ä¿å­˜å‚¨ç”µæºå…±è¯†ï¼Œç³»ç»Ÿå®šä¹‰äº†å‚ä¸å…±è¯†æ‰€éœ€çš„æœ€å°çŸ¿æœºå¤§å°ã€‚</p><p>å…·ä½“è€Œè¨€ï¼ŒçŸ¿å·¥å¿…é¡»è‡³å°‘<code>MIN_MINER_SIZE_STOR</code>å…·æœ‰ç”µé‡ï¼ˆå³å½“å‰åœ¨å­˜å‚¨äº¤æ˜“ä¸­ä½¿ç”¨çš„å­˜å‚¨ç”µæºï¼‰æ‰èƒ½å‚ä¸é¢†å¯¼è€…é€‰ä¸¾ã€‚å¦‚æœæ²¡æœ‰çŸ¿å·¥æ‹¥æœ‰<code>MIN_MINER_SIZE_STOR</code>æˆ–æ‹¥æœ‰æ›´å¤šæƒåŠ›ï¼Œåˆ™è‡³å°‘å…·æœ‰ä¸çŸ¿å·¥é¡¶éƒ¨æœ€å°<code>MIN_MINER_SIZE_TARG</code>çš„çŸ¿å·¥ï¼ˆæŒ‰å­˜å‚¨åŠŸç‡æ’åºï¼‰çš„åŠŸç‡ç›¸åŒçš„çŸ¿å·¥å°†èƒ½å¤Ÿå‚åŠ é¢†å¯¼äººé€‰ä¸¾ã€‚ä»¥ç®€å•çš„è‹±è¯­<code>MIN_MINER_SIZE_TARG = 3</code>ä¸ºä¾‹ï¼Œè¿™æ„å‘³ç€å…·æœ‰è‡³å°‘ä¸ç¬¬ä¸‰å¤§çŸ¿å•†ç›¸åŒæƒåŠ›çš„çŸ¿å·¥å°†æœ‰èµ„æ ¼å‚åŠ å…±è¯†ã€‚</p><p>å°äºæ­¤å€¼çš„çŸ¿å·¥æ— æ³•åœ¨ç½‘ç»œä¸­è¿›è¡ŒåŒºå—æŒ–æ˜å¹¶è·å¾—åŒºå—å¥–åŠ±ã€‚å³ä½¿ä»–ä»¬çš„æƒåŠ›ä¸ä¼šè¢«ç®—ä½œé¢†å¯¼äººé€‰ä¸¾çš„ç¥¨æ•°ï¼Œä»–ä»¬çš„æƒåŠ›ä»å°†è®¡å…¥æ•´ä¸ªç½‘ç»œï¼ˆåŸå§‹æˆ–è¦æ±‚çš„ï¼‰å­˜å‚¨èƒ½åŠ›ä¸­ã€‚ä½†æ˜¯ï¼Œ<strong>é‡è¦çš„æ˜¯è¦æ³¨æ„ï¼Œæ­¤ç±»çŸ¿å·¥ä»ç„¶ä¼šé­å—å…¶æƒåŠ›çš„è¿‡å¤±å¹¶å› æ­¤å—åˆ°æƒ©ç½š</strong>ã€‚</p><p>å› æ­¤ï¼Œè¦å¼•å¯¼ç½‘ç»œï¼Œèµ·æºå—å¿…é¡»åŒ…æ‹¬çŸ¿å·¥ï¼ˆå¯èƒ½åªæ˜¯CommittedCapacityæ‰‡åŒºï¼‰æ¥å¯åŠ¨ç½‘ç»œã€‚</p><p>è¯¥<code>MIN_MINER_SIZE_TARG</code>æ¡ä»¶å°†ä¸ä¼šåœ¨ä»»ä½•çŸ¿å·¥æ‹¥æœ‰çš„<code>MIN_MINER_SIZE_STOR</code>æƒåŠ›éƒ½è¶…è¿‡çš„ç½‘ç»œä¸­ä½¿ç”¨ã€‚å°½ç®¡å¦‚æ­¤ï¼Œå®ƒçš„å®šä¹‰æ˜¯ä¸ºäº†ç¡®ä¿å°å‹ç½‘ç»œä¸­çš„æ´»åŠ¨ï¼ˆä¾‹å¦‚ï¼Œæ¥è¿‘èµ·æºæˆ–åœ¨æ‰ç”µä¹‹åï¼‰ã€‚</p><h4 id="_2-4-4-6å‚¨èƒ½æ¼”å‘˜" tabindex="-1"><a class="header-anchor" href="#_2-4-4-6å‚¨èƒ½æ¼”å‘˜" aria-hidden="true">#</a> 2.4.4.6<a href="https://spec.filecoin.io/#section-systems.filecoin_blockchain.storage_power_consensus.storage_power_actor" target="_blank" rel="noopener noreferrer">å‚¨èƒ½æ¼”å‘˜<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><h5 id="_2-4-4-6-1storagepoweractorstate-å®ä½œ" tabindex="-1"><a class="header-anchor" href="#_2-4-4-6-1storagepoweractorstate-å®ä½œ" aria-hidden="true">#</a> 2.4.4.6.1<a href="https://spec.filecoin.io/#section-systems.filecoin_blockchain.storage_power_consensus.storage_power_actor.storagepoweractorstate-implementation" target="_blank" rel="noopener noreferrer"><code>StoragePowerActorState</code> å®ä½œ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h5><p><a href="https://spec.filecoin.io/#example-state" target="_blank" rel="noopener noreferrer">ç¤ºä¾‹ï¼šçŠ¶æ€<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> State <span class="token keyword">struct</span> <span class="token punctuation">{</span>
 TotalRawBytePower abi<span class="token punctuation">.</span>StoragePower
 <span class="token comment">// TotalBytesCommitted includes claims from miners below min power threshold</span>
 TotalBytesCommitted  abi<span class="token punctuation">.</span>StoragePower
 TotalQualityAdjPower abi<span class="token punctuation">.</span>StoragePower
 <span class="token comment">// TotalQABytesCommitted includes claims from miners below min power threshold</span>
 TotalQABytesCommitted abi<span class="token punctuation">.</span>StoragePower
 TotalPledgeCollateral abi<span class="token punctuation">.</span>TokenAmount

 <span class="token comment">// These fields are set once per epoch in the previous cron tick and used</span>
 <span class="token comment">// for consistent values across a single epoch&#39;s state transition.</span>
 ThisEpochRawBytePower     abi<span class="token punctuation">.</span>StoragePower
 ThisEpochQualityAdjPower  abi<span class="token punctuation">.</span>StoragePower
 ThisEpochPledgeCollateral abi<span class="token punctuation">.</span>TokenAmount
 ThisEpochQAPowerSmoothed  smoothing<span class="token punctuation">.</span>FilterEstimate

 MinerCount <span class="token builtin">int64</span>
 <span class="token comment">// Number of miners having proven the minimum consensus power.</span>
 MinerAboveMinPowerCount <span class="token builtin">int64</span>

 <span class="token comment">// A queue of events to be triggered by cron, indexed by epoch.</span>
 CronEventQueue cid<span class="token punctuation">.</span>Cid <span class="token comment">// Multimap, (HAMT[ChainEpoch]AMT[CronEvent])</span>

 <span class="token comment">// First epoch in which a cron task may be stored.</span>
 <span class="token comment">// Cron will iterate every epoch between this and the current epoch inclusively to find tasks to execute.</span>
 FirstCronEpoch abi<span class="token punctuation">.</span>ChainEpoch

 <span class="token comment">// Claimed power for each miner.</span>
 Claims cid<span class="token punctuation">.</span>Cid <span class="token comment">// Map, HAMT[address]Claim</span>

 ProofValidationBatch <span class="token operator">*</span>cid<span class="token punctuation">.</span>Cid <span class="token comment">// Multimap, (HAMT[Address]AMT[SealVerifyInfo])</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_2-4-4-6-2storagepoweractor-å®ä½œ" tabindex="-1"><a class="header-anchor" href="#_2-4-4-6-2storagepoweractor-å®ä½œ" aria-hidden="true">#</a> 2.4.4.6.2<a href="https://spec.filecoin.io/#section-systems.filecoin_blockchain.storage_power_consensus.storage_power_actor.storagepoweractor-implementation" target="_blank" rel="noopener noreferrer"><code>StoragePowerActor</code> å®ä½œ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h5><p><a href="https://spec.filecoin.io/#example-exports" target="_blank" rel="noopener noreferrer">ç¤ºä¾‹ï¼šå‡ºå£<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>a Actor<span class="token punctuation">)</span> <span class="token function">Exports</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">{</span>
 <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span>
  builtin<span class="token punctuation">.</span>MethodConstructor<span class="token punctuation">:</span> a<span class="token punctuation">.</span>Constructor<span class="token punctuation">,</span>
  <span class="token number">2</span><span class="token punctuation">:</span>                         a<span class="token punctuation">.</span>CreateMiner<span class="token punctuation">,</span>
  <span class="token number">3</span><span class="token punctuation">:</span>                         a<span class="token punctuation">.</span>UpdateClaimedPower<span class="token punctuation">,</span>
  <span class="token number">4</span><span class="token punctuation">:</span>                         a<span class="token punctuation">.</span>EnrollCronEvent<span class="token punctuation">,</span>
  <span class="token number">5</span><span class="token punctuation">:</span>                         a<span class="token punctuation">.</span>OnEpochTickEnd<span class="token punctuation">,</span>
  <span class="token number">6</span><span class="token punctuation">:</span>                         a<span class="token punctuation">.</span>UpdatePledgeTotal<span class="token punctuation">,</span>
  <span class="token number">7</span><span class="token punctuation">:</span>                         <span class="token boolean">nil</span><span class="token punctuation">,</span> <span class="token comment">// deprecated</span>
  <span class="token number">8</span><span class="token punctuation">:</span>                         a<span class="token punctuation">.</span>SubmitPoRepForBulkVerify<span class="token punctuation">,</span>
  <span class="token number">9</span><span class="token punctuation">:</span>                         a<span class="token punctuation">.</span>CurrentTotalPower<span class="token punctuation">,</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a href="https://spec.filecoin.io/#example-minerconstructorparams" target="_blank" rel="noopener noreferrer">ç¤ºä¾‹ï¼šMinerConstructorParams<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>æ­¤å¤„å®šä¹‰äº†å­˜å‚¨çŸ¿å·¥å‚ä¸è€…çš„æ„é€ å‡½æ•°å‚æ•°ï¼Œä»¥ä¾¿é«˜çº§å‚ä¸è€…å¯ä»¥å°†å®ƒä»¬å‘é€ç»™åˆå§‹åŒ–å‚ä¸è€…ä»¥å®ä¾‹åŒ–çŸ¿å·¥ã€‚ä»v0å¼€å§‹æ›´æ”¹ï¼š</p><ul><li>æ·»åŠ äº†ControlAddrs</li></ul><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> MinerConstructorParams <span class="token keyword">struct</span> <span class="token punctuation">{</span>
 OwnerAddr     addr<span class="token punctuation">.</span>Address
 WorkerAddr    addr<span class="token punctuation">.</span>Address
 ControlAddrs  <span class="token punctuation">[</span><span class="token punctuation">]</span>addr<span class="token punctuation">.</span>Address
 SealProofType abi<span class="token punctuation">.</span>RegisteredSealProof
 PeerId        abi<span class="token punctuation">.</span>PeerID
 Multiaddrs    <span class="token punctuation">[</span><span class="token punctuation">]</span>abi<span class="token punctuation">.</span>Multiaddrs
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_2-4-4-6-3åŠŸç‡è¡¨" tabindex="-1"><a class="header-anchor" href="#_2-4-4-6-3åŠŸç‡è¡¨" aria-hidden="true">#</a> 2.4.4.6.3<a href="https://spec.filecoin.io/#section-systems.filecoin_blockchain.storage_power_consensus.storage_power_actor.the-power-table" target="_blank" rel="noopener noreferrer">åŠŸç‡è¡¨<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h5><p>ç»™å®šçŸ¿å·¥é€šè¿‡ECçš„é¢†å¯¼è€…é€‰ä¸¾äº§ç”Ÿçš„åŒºå—éƒ¨åˆ†ï¼ˆå› æ­¤ä»–ä»¬è·å¾—çš„åŒºå—å¥–åŠ±ï¼‰ä¸ä»–ä»¬<code>Quality-Adjusted Power Fraction</code>çš„æ—¶é—´æˆæ­£æ¯”ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè´¨é‡è°ƒæ•´åçš„åŠŸç‡ä»£è¡¨ç½‘ç»œä¸Šæ€»è´¨é‡è°ƒæ•´åçš„åŠŸç‡çš„1ï¼…çš„çŸ¿å·¥åº”æŒ‰é¢„æœŸå¼€é‡‡1ï¼…çš„åŒºå—ã€‚</p><p>SPCæä¾›äº†ä¸€ä¸ªåŠŸç‡è¡¨æŠ½è±¡ï¼Œå¯éšæ—¶é—´è·Ÿè¸ªçŸ¿å·¥åŠŸç‡ï¼ˆå³çŸ¿å·¥å­˜å‚¨ç›¸å¯¹äºç½‘ç»œå­˜å‚¨ï¼‰ã€‚é’ˆå¯¹æ–°çš„éƒ¨é—¨æ‰¿è¯ºï¼ˆå¢åŠ çŸ¿å·¥åŠŸç‡ï¼‰ï¼Œå¤±è´¥çš„PoStï¼ˆå‡å°‘çŸ¿å·¥åŠŸç‡ï¼‰æˆ–å…¶ä»–å­˜å‚¨å’Œå…±è¯†æ•…éšœï¼Œæ›´æ–°äº†åŠŸç‡è¡¨ã€‚</p><p>éƒ¨é—¨ProveCommitæ˜¯ç¬¬ä¸€æ¬¡å‘ç½‘ç»œè¯æ˜åŠŸç‡ï¼Œå› æ­¤ï¼ŒæˆåŠŸçš„éƒ¨é—¨ProveCommitä¼šé¦–å…ˆæ·»åŠ åŠŸç‡ã€‚å½“å®£å¸ƒä¸€ä¸ªæ‰‡åŒºå·²æ¢å¤æ—¶ï¼Œä¹Ÿä¼šæ·»åŠ ç”µæºã€‚çŸ¿å·¥æœ‰æœ›åœ¨å…¶è´¡çŒ®åŠ›é‡çš„æ‰€æœ‰é¢†åŸŸè¿›è¡Œè¯æ˜ã€‚</p><p>å½“æ‰‡åŒºåˆ°æœŸï¼Œå£°æ˜æˆ–æ£€æµ‹åˆ°æ‰‡åŒºæœ‰æ•…éšœæˆ–é€šè¿‡çŸ¿å·¥è°ƒç”¨ç»ˆæ­¢æ—¶ï¼ŒåŠŸç‡ä¼šé™ä½ã€‚çŸ¿å·¥è¿˜å¯ä»¥é€šè¿‡å»¶é•¿éƒ¨é—¨çš„å¯¿å‘½<code>ExtendSectorExpiration</code>ã€‚</p><p>åŠŸç‡è¡¨ä¸­çš„Minerç”Ÿå‘½å‘¨æœŸåº”å¤§è‡´å¦‚ä¸‹ï¼š</p><ul><li><p><code>MinerRegistration</code>ï¼šå­˜å‚¨æŒ–æ˜å­ç³»ç»Ÿå°†ä¸€ä¸ªå…·æœ‰å…³è”å·¥ä½œäººå‘˜å…¬ç”¨å¯†é’¥å’Œåœ°å€çš„æ–°çŸ¿å·¥åŠå…¶å…³è”çš„æ‰‡åŒºå¤§å°ï¼ˆåœ¨æ¯ä¸ªå·¥ä½œäººå‘˜ä¸­åªæœ‰ä¸€ä¸ªï¼‰æ³¨å†Œåˆ°äº†åŠŸç‡è¡¨ä¸­ã€‚</p></li><li><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>UpdatePower
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ï¼šè¿™äº›åŠŸç‡å¢é‡å’Œå‡é‡ç”±å„ç§å­˜å‚¨å‚ä¸è€…è°ƒç”¨ï¼ˆå› æ­¤å¿…é¡»ç”±ç½‘ç»œä¸Šçš„æ¯ä¸ªå®Œæ•´èŠ‚ç‚¹è¿›è¡ŒéªŒè¯ï¼‰ã€‚ç‰¹åˆ«ï¼š</p><ul><li>åŠŸç‡å¢åŠ ä¸º <code>SectorProveCommit</code></li><li>ä¸¢å¤±WindowPoStï¼ˆ<code>DetectedFault</code>ï¼‰åï¼Œåˆ†åŒºçš„åŠŸæ•ˆä¼šç«‹å³é™ä½ã€‚</li><li>å½“ç‰¹å®šæ‰‡åŒºé€šè¿‡â€œå£°æ˜çš„æ•…éšœâ€æˆ–â€œè·³è¿‡çš„æ•…éšœâ€è¿›å…¥æ•…éšœçŠ¶æ€æ—¶ï¼Œå…¶åŠŸç‡å°†å‡å°ã€‚</li><li>PoStå®£å¸ƒå¹¶è¯æ˜æ¢å¤åï¼Œå°†å¢åŠ ç‰¹å®šéƒ¨é—¨çš„åŠ›é‡ã€‚</li><li>é€šè¿‡çŸ¿å·¥å‘ç¥¨åˆ°æœŸæˆ–ç»ˆæ­¢æŸä¸ªç‰¹å®šéƒ¨é—¨çš„ç”µæºåï¼Œè¯¥ç”µæºå°†è¢«åˆ é™¤ã€‚</li></ul></li></ul><p>æ€»è€Œè¨€ä¹‹ï¼Œåªæœ‰å¤„äºæ´»åŠ¨çŠ¶æ€çš„æ‰‡åŒºæ‰èƒ½æ§åˆ¶ç”µæºã€‚åœ¨ä¸Šæ·»åŠ æ‰‡åŒºåï¼Œè¯¥æ‰‡åŒºå°†å˜ä¸ºæ´»åŠ¨çŠ¶æ€<code>ProveCommit</code>ã€‚è¿›å…¥æ•…éšœçŠ¶æ€åï¼Œç”µæºç«‹å³å‡å°ã€‚ç¡®è®¤å·²å£°æ˜æ¢å¤åï¼Œç”µæºå³ä¼šæ¢å¤ã€‚é€šè¿‡çŸ¿å·¥è°ƒç”¨ç»ˆæ­¢æˆ–ç»ˆæ­¢æŸä¸ªæ‰‡åŒºçš„ç”µæºåï¼Œè¯¥ç”µæºå°†è¢«åˆ é™¤ã€‚</p><h5 id="_2-4-4-6-4è´¨æŠ¼æŠµæŠ¼å“" tabindex="-1"><a class="header-anchor" href="#_2-4-4-6-4è´¨æŠ¼æŠµæŠ¼å“" aria-hidden="true">#</a> 2.4.4.6.4<a href="https://spec.filecoin.io/#section-systems.filecoin_blockchain.storage_power_consensus.storage_power_actor.pledge-collateral" target="_blank" rel="noopener noreferrer">è´¨æŠ¼æŠµæŠ¼å“<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h5><p>è´¨æŠ¼æŠµæŠ¼å“å› å½±å“å­˜å‚¨ç”µæºå…±è¯†çš„ä»»ä½•æ•…éšœè€Œè¢«å‰Šå‡ï¼Œå…¶ä¸­åŒ…æ‹¬ï¼š</p><ul><li>å°¤å…¶æ˜¯é¢„æœŸçš„å…±è¯†é”™è¯¯ï¼ˆè¯·å‚é˜…â€œ <a href="https://spec.filecoin.io/#section-algorithms.expected_consensus.consensus-faults" target="_blank" rel="noopener noreferrer">å…±è¯†é”™è¯¯â€<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ï¼‰ï¼Œç æ€è€…ä¼šå°†è¿™äº›é”™è¯¯æŠ¥å‘Šç»™ï¼Œ<code>StoragePowerActor</code>ä»¥æ¢å–å¥–åŠ±ã€‚</li><li>å½±å“å…±è¯†åŠŸç‡çš„æ•…éšœï¼Œæ›´ä¸€èˆ¬è€Œè¨€ï¼Œå°¤å…¶æ˜¯æœªæ‰¿è¯ºçš„åŠŸç‡æ•…éšœï¼ˆå³ï¼Œ <a href="https://spec.filecoin.io/#section-systems.filecoin_markets.onchain_storage_market.faults.storage-faults" target="_blank" rel="noopener noreferrer">å­˜å‚¨æ•…éšœ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ï¼‰ï¼Œå°†ç”±<code>CronActor</code>è‡ªåŠ¨æŠ¥å‘Šï¼Œæˆ–è€…å½“çŸ¿å·¥ç»ˆæ­¢æ‰‡åŒºçš„æ—¶é—´æ—©äºæ‰¿è¯ºçš„æŒç»­æ—¶é—´æ—¶ï¼Œå°†æŠ¥å‘Šè¿™äº›<a href="https://spec.filecoin.io/#section-systems.filecoin_markets.onchain_storage_market.faults.storage-faults" target="_blank" rel="noopener noreferrer">æ•…éšœ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ã€‚</li></ul><p>æœ‰å…³è´¨æŠ¼æŠµæŠ¼å“çš„æ›´è¯¦ç»†è®¨è®ºï¼Œè¯·å‚é˜… <a href="https://spec.filecoin.io/#section-systems.filecoin_mining.miner_collaterals" target="_blank" rel="noopener noreferrer">çŸ¿å·¥æŠµæŠ¼å“éƒ¨åˆ†<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ã€‚</p></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/token01/token01.github.io/edit/master/docs/blockchain/male-chain-research/FileCoin/FileCoin_technical_documentation.md" rel="noopener noreferrer" target="_blank" aria-label="ç¼–è¾‘æ­¤é¡µ" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->ç¼–è¾‘æ­¤é¡µ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item update-time"><span class="label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><span class="info">2022/12/25 10:12:30</span></div><!----></footer><nav class="page-nav"><!----><a href="/blockchain/male-chain-research/FileCoin/Introduction_to_FileCoin_economic_model.html" class="nav-link next" aria-label="æµ…è°ˆFileCoin|ç»æµæ¨¡å‹"><div class="hint">ä¸‹ä¸€é¡µ<span class="arrow right"></span></div><div class="link">æµ…è°ˆFileCoin|ç»æµæ¨¡å‹<!----></div></a></nav><div class="waline-wrapper" darkmode="false" style="display:block;"><div data-waline provider="Waline"><div class="wl-comment"><!--v-if--><div class="wl-panel"><div class="wl-header item3"><!--[--><div class="wl-header-item"><label for="nick">æ˜µç§°</label><input id="wl-nick" class="wl-input wl-nick" name="nick" type="text" value></div><div class="wl-header-item"><label for="mail">é‚®ç®±</label><input id="wl-mail" class="wl-input wl-mail" name="mail" type="email" value></div><div class="wl-header-item"><label for="link">ç½‘å€</label><input id="wl-link" class="wl-input wl-link" name="link" type="text" value></div><!--]--></div><textarea id="wl-edit" class="wl-editor" placeholder="è¯·ç•™è¨€ã€‚(å¡«å†™é‚®ç®±å¯åœ¨è¢«å›å¤æ—¶æ”¶åˆ°é‚®ä»¶æé†’)"></textarea><div class="wl-preview" style="display:none;"><hr><h4>é¢„è§ˆ:</h4><!-- eslint-disable-next-line vue/no-v-html --><div class="wl-content"></div></div><div class="wl-footer"><div class="wl-actions"><a href="https://guides.github.com/features/mastering-markdown/" title="Markdown Guide" aria-label="Markdown is supported" class="wl-action" target="_blank" rel="noreferrer"><svg width="16" height="16" ariaHidden="true"><path d="M14.85 3H1.15C.52 3 0 3.52 0 4.15v7.69C0 12.48.52 13 1.15 13h13.69c.64 0 1.15-.52 1.15-1.15v-7.7C16 3.52 15.48 3 14.85 3zM9 11H7V8L5.5 9.92 4 8v3H2V5h2l1.5 2L7 5h2v6zm2.99.5L9.5 8H11V5h2v3h1.5l-2.51 3.5z" fill="currentColor"></path></svg></a><button class="wl-action" title="è¡¨æƒ…" style="display:none;"><svg viewBox="0 0 1024 1024" width="24" height="24"><path d="M563.2 463.3 677 540c1.7 1.2 3.7 1.8 5.8 1.8.7 0 1.4-.1 2-.2 2.7-.5 5.1-2.1 6.6-4.4l25.3-37.8c1.5-2.3 2.1-5.1 1.6-7.8s-2.1-5.1-4.4-6.6l-73.6-49.1 73.6-49.1c2.3-1.5 3.9-3.9 4.4-6.6.5-2.7 0-5.5-1.6-7.8l-25.3-37.8a10.1 10.1 0 0 0-6.6-4.4c-.7-.1-1.3-.2-2-.2-2.1 0-4.1.6-5.8 1.8l-113.8 76.6c-9.2 6.2-14.7 16.4-14.7 27.5.1 11 5.5 21.3 14.7 27.4zM387 348.8h-45.5c-5.7 0-10.4 4.7-10.4 10.4v153.3c0 5.7 4.7 10.4 10.4 10.4H387c5.7 0 10.4-4.7 10.4-10.4V359.2c0-5.7-4.7-10.4-10.4-10.4zm333.8 241.3-41-20a10.3 10.3 0 0 0-8.1-.5c-2.6.9-4.8 2.9-5.9 5.4-30.1 64.9-93.1 109.1-164.4 115.2-5.7.5-9.9 5.5-9.5 11.2l3.9 45.5c.5 5.3 5 9.5 10.3 9.5h.9c94.8-8 178.5-66.5 218.6-152.7 2.4-5 .3-11.2-4.8-13.6zm186-186.1c-11.9-42-30.5-81.4-55.2-117.1-24.1-34.9-53.5-65.6-87.5-91.2-33.9-25.6-71.5-45.5-111.6-59.2-41.2-14-84.1-21.1-127.8-21.1h-1.2c-75.4 0-148.8 21.4-212.5 61.7-63.7 40.3-114.3 97.6-146.5 165.8-32.2 68.1-44.3 143.6-35.1 218.4 9.3 74.8 39.4 145 87.3 203.3.1.2.3.3.4.5l36.2 38.4c1.1 1.2 2.5 2.1 3.9 2.6 73.3 66.7 168.2 103.5 267.5 103.5 73.3 0 145.2-20.3 207.7-58.7 37.3-22.9 70.3-51.5 98.1-85 27.1-32.7 48.7-69.5 64.2-109.1 15.5-39.7 24.4-81.3 26.6-123.8 2.4-43.6-2.5-87-14.5-129zm-60.5 181.1c-8.3 37-22.8 72-43 104-19.7 31.1-44.3 58.6-73.1 81.7-28.8 23.1-61 41-95.7 53.4-35.6 12.7-72.9 19.1-110.9 19.1-82.6 0-161.7-30.6-222.8-86.2l-34.1-35.8c-23.9-29.3-42.4-62.2-55.1-97.7-12.4-34.7-18.8-71-19.2-107.9-.4-36.9 5.4-73.3 17.1-108.2 12-35.8 30-69.2 53.4-99.1 31.7-40.4 71.1-72 117.2-94.1 44.5-21.3 94-32.6 143.4-32.6 49.3 0 97 10.8 141.8 32 34.3 16.3 65.3 38.1 92 64.8 26.1 26 47.5 56 63.6 89.2 16.2 33.2 26.6 68.5 31 105.1 4.6 37.5 2.7 75.3-5.6 112.3z" fill="currentColor"></path></svg></button><button class="wl-action" title="è¡¨æƒ…åŒ…"><svg width="24" height="24" fill="currentcolor" viewBox="0 0 24 24"><path style="transform: translateY(0.5px)" d="M18.968 10.5H15.968V11.484H17.984V12.984H15.968V15H14.468V9H18.968V10.5V10.5ZM8.984 9C9.26533 9 9.49967 9.09367 9.687 9.281C9.87433 9.46833 9.968 9.70267 9.968 9.984V10.5H6.499V13.5H8.468V12H9.968V14.016C9.968 14.2973 9.87433 14.5317 9.687 14.719C9.49967 14.9063 9.26533 15 8.984 15H5.984C5.70267 15 5.46833 14.9063 5.281 14.719C5.09367 14.5317 5 14.2973 5 14.016V9.985C5 9.70367 5.09367 9.46933 5.281 9.282C5.46833 9.09467 5.70267 9.001 5.984 9.001H8.984V9ZM11.468 9H12.968V15H11.468V9V9Z"></path><path d="M18.5 3H5.75C3.6875 3 2 4.6875 2 6.75V18C2 20.0625 3.6875 21.75 5.75 21.75H18.5C20.5625 21.75 22.25 20.0625 22.25 18V6.75C22.25 4.6875 20.5625 3 18.5 3ZM20.75 18C20.75 19.2375 19.7375 20.25 18.5 20.25H5.75C4.5125 20.25 3.5 19.2375 3.5 18V6.75C3.5 5.5125 4.5125 4.5 5.75 4.5H18.5C19.7375 4.5 20.75 5.5125 20.75 6.75V18Z"></path></svg></button><input id="wl-image-upload" class="upload" type="file" accept=".png,.jpg,.jpeg,.webp,.bmp,.gif"><label for="wl-image-upload" class="wl-action" title="ä¸Šä¼ å›¾ç‰‡"><svg viewBox="0 0 1024 1024" width="24" height="24"><path d="M784 112H240c-88 0-160 72-160 160v480c0 88 72 160 160 160h544c88 0 160-72 160-160V272c0-88-72-160-160-160zm96 640c0 52.8-43.2 96-96 96H240c-52.8 0-96-43.2-96-96V272c0-52.8 43.2-96 96-96h544c52.8 0 96 43.2 96 96v480z" fill="currentColor"></path><path d="M352 480c52.8 0 96-43.2 96-96s-43.2-96-96-96-96 43.2-96 96 43.2 96 96 96zm0-128c17.6 0 32 14.4 32 32s-14.4 32-32 32-32-14.4-32-32 14.4-32 32-32zm462.4 379.2-3.2-3.2-177.6-177.6c-25.6-25.6-65.6-25.6-91.2 0l-80 80-36.8-36.8c-25.6-25.6-65.6-25.6-91.2 0L200 728c-4.8 6.4-8 14.4-8 24 0 17.6 14.4 32 32 32 9.6 0 16-3.2 22.4-9.6L380.8 640l134.4 134.4c6.4 6.4 14.4 9.6 24 9.6 17.6 0 32-14.4 32-32 0-9.6-4.8-17.6-9.6-24l-52.8-52.8 80-80L769.6 776c6.4 4.8 12.8 8 20.8 8 17.6 0 32-14.4 32-32 0-8-3.2-16-8-20.8z" fill="currentColor"></path></svg></label><button class="wl-action" title="é¢„è§ˆ"><svg viewBox="0 0 1024 1024" width="24" height="24"><path d="M710.816 654.301c70.323-96.639 61.084-230.578-23.705-314.843-46.098-46.098-107.183-71.109-172.28-71.109-65.008 0-126.092 25.444-172.28 71.109-45.227 46.098-70.756 107.183-70.756 172.106 0 64.923 25.444 126.007 71.194 172.106 46.099 46.098 107.184 71.109 172.28 71.109 51.414 0 100.648-16.212 142.824-47.404l126.53 126.006c7.058 7.06 16.297 10.979 26.406 10.979 10.105 0 19.343-3.919 26.402-10.979 14.467-14.467 14.467-38.172 0-52.723L710.816 654.301zm-315.107-23.265c-65.88-65.88-65.88-172.54 0-238.42 32.069-32.07 74.245-49.149 119.471-49.149 45.227 0 87.407 17.603 119.472 49.149 65.88 65.879 65.88 172.539 0 238.42-63.612 63.178-175.242 63.178-238.943 0zm0 0" fill="currentColor"></path><path d="M703.319 121.603H321.03c-109.8 0-199.469 89.146-199.469 199.38v382.034c0 109.796 89.236 199.38 199.469 199.38h207.397c20.653 0 37.384-16.645 37.384-37.299 0-20.649-16.731-37.296-37.384-37.296H321.03c-68.582 0-124.352-55.77-124.352-124.267V321.421c0-68.496 55.77-124.267 124.352-124.267h382.289c68.582 0 124.352 55.771 124.352 124.267V524.72c0 20.654 16.736 37.299 37.385 37.299 20.654 0 37.384-16.645 37.384-37.299V320.549c-.085-109.8-89.321-198.946-199.121-198.946zm0 0" fill="currentColor"></path></svg></button></div><div class="wl-info"><div class="wl-text-number">0 <!--v-if--> Â å­—</div><button class="wl-btn">ç™»å½•</button><button class="wl-btn primary" title="Cmd|Ctrl + Enter"><!--[-->æäº¤<!--]--></button></div><div class="wl-gif-popup"><input type="text" placeholder="æœç´¢è¡¨æƒ…åŒ…"><div class="wl-gallery" style="gap:6px;"><!--[--><!--]--></div><div class="wl-loading"><svg width="30" height="30" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid"><circle cx="50" cy="50" fill="none" stroke="currentColor" strokeWidth="4" r="40" stroke-dasharray="85 30"><animateTransform attributeName="transform" type="rotate" repeatCount="indefinite" dur="1s" values="0 50 50;360 50 50" keyTimes="0;1"></animateTransform></circle></svg></div></div><div class="wl-emoji-popup"><!--[--><!--]--><!--v-if--></div></div></div><!--v-if--></div><div class="wl-meta-head"><div class="wl-count"><!--v-if--> è¯„è®º</div><ul class="wl-sort"><!--[--><li class="active">æŒ‰æ­£åº</li><li class="">æŒ‰å€’åº</li><li class="">æŒ‰çƒ­åº¦</li><!--]--></ul></div><div class="wl-cards"><!--[--><!--]--></div><!--[--><div class="wl-loading"><svg width="30" height="30" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid"><circle cx="50" cy="50" fill="none" stroke="currentColor" strokeWidth="4" r="40" stroke-dasharray="85 30"><animateTransform attributeName="transform" type="rotate" repeatCount="indefinite" dur="1s" values="0 50 50;360 50 50" keyTimes="0;1"></animateTransform></circle></svg></div><!--]--><!-- Copyright Information --><div class="wl-power"> Powered by <a href="https://github.com/walinejs/waline" target="_blank" rel="noreferrer"> Waline </a> v2.9.1</div></div></div><!----><!--]--></main><!--]--><footer class="footer-wrapper"><div class="footer"></div><div class="copyright">Copyright Â© 2023 Abel sun</div></footer><!--]--></div><!--]--><!----><!----><!--]--></div>
    <script type="module" src="/assets/app.18744acf.js" defer></script>
  </body>
</html>